{
  "Topic": {
    "TopicId": "omawdbg9puipc1hfteq8fg",
    "ForumId": "15",
    "Title": "Game setup loop issues",
    "LastUpdated": "2024-06-08T09:12:46.6065806Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "cd97a3b9-32c4-48b3-83d4-8acff7aca83c",
      "UserId": 587281,
      "Username": "PsychoVyse",
      "AvatarUrl": "https://secure.gravatar.com/avatar/f359107abf9dc8cfe62bba1e4a8e84a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I've been implementing the delayed Character Creation method from https://github.com/ThePix/QuestJS/wiki/Character-Creation but I've hit a snag, it keeps wanting to repeat the settings.setup() step and my game is in an infinite loop and I can't see any items added to the Lounge room object or move anywhere because of the wait trigger in the setup.\r\n\r\nsettings.js\r\n```\r\n\"use strict\"\r\n\r\nsettings.title = \"Your new game\"\r\nsettings.author = \"Your name\"\r\nsettings.version = \"0.1\"\r\nsettings.thanks = []\r\nsettings.warnings = \"No warnings have been set for this game.\"\r\nsettings.playMode = \"dev\"\r\n\r\nsettings.genders = [\r\n    { name: \"Male\"},\r\n    { name: \"Female\"},\r\n    { name: \"Non-binary\"},\r\n]\r\n\r\nsettings.setup = function () {\r\n    msg(\"This is the game intro\")\r\n    wait()\r\n    trigger(function () { \r\n        document.getElementById('panes').style = \"display: none\"\r\n        settings.setUpDialog()\r\n        return true\r\n    })\r\n}\r\n\r\nsettings.startingDialogEnabled = false\r\nsettings.startingDialogTitle = \"Who are you?\"\r\nsettings.startingDialogWidth = 500\r\nsettings.startingDialogHeight = 'auto'\r\nsettings.startingDialogButton = 'OK'\r\n\r\nsettings.startingDialogHtml = '<p>Name: <input id=\"CCName\" type=\"text\" value=\"Player\" /></p>'\r\nsettings.startingDialogHtml += '<p>Species: <input id=\"CCSpecies\" type=\"text\" value=\"Human\" /></p>'\r\n\r\nsettings.startingDialogHtml += '<p>Gender: <select id=\"CCGender\">'\r\nfor (const s of settings.genders) {\r\n    settings.startingDialogHtml += '<option value=\"' + s.name + '\">' + s.name + '</option>'\r\n}\r\nsettings.startingDialogHtml += '</select></p>'\r\n\r\nsettings.startingDialogOnClick = function () {\r\n    player.setAlias(document.querySelector(\"#CCName\").value)\r\n    player.species = document.querySelector(\"#CCSpecies\").value\r\n    player.gender = document.querySelector(\"#CCGender\").value\r\n    document.getElementById('panes').style = \"display: block\"\r\n    world.nodesc = false;\r\n    w.me.loc = \"Lounge\";\r\n    clearScreen()\r\n    endTurnUI()\r\n}\r\n\r\nsettings.startingDialogInit = function () {\r\n    document.querySelector('#CCName').focus()\r\n}\r\nsettings.startingDialogAlt = function () {\r\n    player.species = 'Human'\r\n    player.gender = 'Female'\r\n    player.setAlias('Velvet')\r\n}\r\n```\r\n\r\ndata.js\r\n```\r\n\"use strict\"\r\n\r\ncreateItem(\"me\", PLAYER(), {\r\n  loc:\"Lounge\",\r\n  synonyms:['me', 'myself'],\r\n  examine: \"Just a regular guy.\",\r\n  species: 'Human',\r\n  gender: 'Female',\r\n  genitals: 'Vagina'\r\n})\r\n\r\ncreateRoom(\"Lounge\", {\r\n    desc: \"The lounge is boring, the author really needs to put stuff in it.\",\r\n    roomTemplate: [\r\n        \"#{cap:}\",\r\n        \"{terse:{hereDesc}}\",\r\n        \"{objectsHere:You can see {objects} here.}\",\r\n        \"{exitsHere:You can go {exits}.}\",\r\n        \"{ifNot:settings:playMode:play:{ifExists:currentLocation:todo:{class:todo:{show:currentLocation:todo}}}}\",\r\n    ],\r\n    afterCreation: function (o) {\r\n        console.log(\"Lounge creation\")\r\n    },\r\n    north: new Exit(\"Bedroom\")\r\n})\r\n\r\ncreateItem(\"PlayerInfo\", {\r\n    alias: \"Player Info\",\r\n    loc: \"Lounge\",\r\n    hereVerbs: [\"Interact\"],\r\n    examine: \"A machine for displaying the player information and allowing it to be changed\",\r\n    interact: function () {\r\n        //msg(\"<a href=\\\"javascript:void(0);\\\" onclick=\\\"displayPlayerInfo()\\\">Change?</a>\")\r\n    },\r\n})\r\n\r\ncreateRoom(\"Bedroom\", {\r\n    desc: \"\",\r\n    roomTemplate: [\r\n        \"#{cap:}\",\r\n        \"{terse:{hereDesc}}\",\r\n        \"{objectsHere:You can see {objects} here.}\",\r\n        \"{exitsHere:You can go {exits}.}\",\r\n        \"{ifNot:settings:playMode:play:{ifExists:currentLocation:todo:{class:todo:{show:currentLocation:todo}}}}\",\r\n    ],\r\n    south: new Exit(\"Lounge\"),\r\n    beforeEnter: function () {\r\n        clearScreen()\r\n    },\r\n    afterCreation: function (o) {\r\n        console.log(\"Bedroom creation\")\r\n    }\r\n})\r\n```\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>I've been implementing the delayed Character Creation method from https://github.com/ThePix/QuestJS/wiki/Character-Creation but I've hit a snag, it keeps wanting to repeat the settings.setup() step and my game is in an infinite loop and I can't see any items added to the Lounge room object or move anywhere because of the wait trigger in the setup.</p>\n<p>settings.js</p>\n<pre><code>\"use strict\"\n\nsettings.title = \"Your new game\"\nsettings.author = \"Your name\"\nsettings.version = \"0.1\"\nsettings.thanks = []\nsettings.warnings = \"No warnings have been set for this game.\"\nsettings.playMode = \"dev\"\n\nsettings.genders = [\n    { name: \"Male\"},\n    { name: \"Female\"},\n    { name: \"Non-binary\"},\n]\n\nsettings.setup = function () {\n    msg(\"This is the game intro\")\n    wait()\n    trigger(function () { \n        document.getElementById('panes').style = \"display: none\"\n        settings.setUpDialog()\n        return true\n    })\n}\n\nsettings.startingDialogEnabled = false\nsettings.startingDialogTitle = \"Who are you?\"\nsettings.startingDialogWidth = 500\nsettings.startingDialogHeight = 'auto'\nsettings.startingDialogButton = 'OK'\n\nsettings.startingDialogHtml = '&lt;p&gt;Name: &lt;input id=\"CCName\" type=\"text\" value=\"Player\" /&gt;&lt;/p&gt;'\nsettings.startingDialogHtml += '&lt;p&gt;Species: &lt;input id=\"CCSpecies\" type=\"text\" value=\"Human\" /&gt;&lt;/p&gt;'\n\nsettings.startingDialogHtml += '&lt;p&gt;Gender: &lt;select id=\"CCGender\"&gt;'\nfor (const s of settings.genders) {\n    settings.startingDialogHtml += '&lt;option value=\"' + s.name + '\"&gt;' + s.name + '&lt;/option&gt;'\n}\nsettings.startingDialogHtml += '&lt;/select&gt;&lt;/p&gt;'\n\nsettings.startingDialogOnClick = function () {\n    player.setAlias(document.querySelector(\"#CCName\").value)\n    player.species = document.querySelector(\"#CCSpecies\").value\n    player.gender = document.querySelector(\"#CCGender\").value\n    document.getElementById('panes').style = \"display: block\"\n    world.nodesc = false;\n    w.me.loc = \"Lounge\";\n    clearScreen()\n    endTurnUI()\n}\n\nsettings.startingDialogInit = function () {\n    document.querySelector('#CCName').focus()\n}\nsettings.startingDialogAlt = function () {\n    player.species = 'Human'\n    player.gender = 'Female'\n    player.setAlias('Velvet')\n}\n</code></pre>\n<p>data.js</p>\n<pre><code>\"use strict\"\n\ncreateItem(\"me\", PLAYER(), {\n  loc:\"Lounge\",\n  synonyms:['me', 'myself'],\n  examine: \"Just a regular guy.\",\n  species: 'Human',\n  gender: 'Female',\n  genitals: 'Vagina'\n})\n\ncreateRoom(\"Lounge\", {\n    desc: \"The lounge is boring, the author really needs to put stuff in it.\",\n    roomTemplate: [\n        \"#{cap:}\",\n        \"{terse:{hereDesc}}\",\n        \"{objectsHere:You can see {objects} here.}\",\n        \"{exitsHere:You can go {exits}.}\",\n        \"{ifNot:settings:playMode:play:{ifExists:currentLocation:todo:{class:todo:{show:currentLocation:todo}}}}\",\n    ],\n    afterCreation: function (o) {\n        console.log(\"Lounge creation\")\n    },\n    north: new Exit(\"Bedroom\")\n})\n\ncreateItem(\"PlayerInfo\", {\n    alias: \"Player Info\",\n    loc: \"Lounge\",\n    hereVerbs: [\"Interact\"],\n    examine: \"A machine for displaying the player information and allowing it to be changed\",\n    interact: function () {\n        //msg(\"&lt;a href=\\\"javascript:void(0);\\\" onclick=\\\"displayPlayerInfo()\\\"&gt;Change?&lt;/a&gt;\")\n    },\n})\n\ncreateRoom(\"Bedroom\", {\n    desc: \"\",\n    roomTemplate: [\n        \"#{cap:}\",\n        \"{terse:{hereDesc}}\",\n        \"{objectsHere:You can see {objects} here.}\",\n        \"{exitsHere:You can go {exits}.}\",\n        \"{ifNot:settings:playMode:play:{ifExists:currentLocation:todo:{class:todo:{show:currentLocation:todo}}}}\",\n    ],\n    south: new Exit(\"Lounge\"),\n    beforeEnter: function () {\n        clearScreen()\n    },\n    afterCreation: function (o) {\n        console.log(\"Bedroom creation\")\n    }\n})\n</code></pre>\n\n",
      "PostDate": "2024-06-08T09:12:46.6065806Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "030feda1-cbbb-4bf0-b6f9-b9dcc3be89e0",
      "UserId": 659063,
      "Username": "cellarderecho",
      "AvatarUrl": "https://secure.gravatar.com/avatar/c0c504aab6249b22fd8633e13dc9c62f?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "The problem seems to be that you have `settings.startingDialogEnabled = false`.  If this were set to true, the `world.begin()` function would exit immediately, instead of calling `settings.setup()` again. As it is, when you click \"OK\", it calls `world.begin()`, which calls `settings.setup()`, and the process restarts.\r\n\r\nTo keep `settings.startingDialogEnabled = false`, you can add this function to `settings.js`. It's just the default function with `world.begin()` commented out.\r\n```\r\nsettings.setUpDialogClick = function() {\r\n  settings.startingDialogEnabled = false\r\n  io.enable()\r\n  settings.startingDialogOnClick()\r\n  //world.begin()\r\n  if (settings.textInput) { document.querySelector('#textbox').focus(); }\r\n  document.querySelector(\"#dialog\").style.display = 'none'\r\n}\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>The problem seems to be that you have <code>settings.startingDialogEnabled = false</code>.  If this were set to true, the <code>world.begin()</code> function would exit immediately, instead of calling <code>settings.setup()</code> again. As it is, when you click \"OK\", it calls <code>world.begin()</code>, which calls <code>settings.setup()</code>, and the process restarts.</p>\n<p>To keep <code>settings.startingDialogEnabled = false</code>, you can add this function to <code>settings.js</code>. It's just the default function with <code>world.begin()</code> commented out.</p>\n<pre><code>settings.setUpDialogClick = function() {\n  settings.startingDialogEnabled = false\n  io.enable()\n  settings.startingDialogOnClick()\n  //world.begin()\n  if (settings.textInput) { document.querySelector('#textbox').focus(); }\n  document.querySelector(\"#dialog\").style.display = 'none'\n}\n</code></pre>\n\n",
      "PostDate": "2024-06-08T12:01:27.6056082Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
