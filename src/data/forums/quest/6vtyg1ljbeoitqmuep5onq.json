{
  "Topic": {
    "TopicId": "6vtyg1ljbeoitqmuep5onq",
    "ForumId": "10",
    "Title": "Silly backdrop scope script",
    "LastUpdated": "2018-12-18T08:27:49.8749434Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "6c322ff8-7155-43ff-ac39-32eee0fc9eb2",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "This idea's been bouncing around in my head for a while now. Thought I'd try typing it out.\r\n\r\n```\r\ndummy_scenery_object.parent = player.parent\r\n\r\nwords = Split (\"room;floor;sky;walls;ceiling;feet;hands\")\r\nif (HasString (player.parent, \"alias\")) {\r\n  foreach (word, RegexSplit (\"\\\\W+\", LCase(player.parent.alias))) {\r\n    list add (words, word)\r\n  }\r\n}\r\nif (HasString (player.parent, \"description\")) {\r\n  foreach (word, RegexSplit (\"\\\\W+\", LCase(player.parent.description))) {\r\n    list add (words, word)\r\n  }\r\n}\r\n\r\nskipwords = Split (\"a;the\")\r\nforeach (item, items) {\r\n  alias = GetDisplayAlias (item)\r\n  if (HasAttribute (item, \"alt\")) {\r\n    alias = alias + \" \" + Join (item.alt, \" \")\r\n  }\r\n  alias = LCase (Trim (alias))\r\n  foreach (word, Split (alias, \" \")) {\r\n    while (LengthOf (word) > 0 and not ListContains (skipwords, word)) {\r\n      list add (skipwords, word)\r\n    }\r\n  }\r\n}\r\nwords = ListExclude (words, skipwords)\r\ndummy_scenery_object.alt = Split (Join (words, \" \"))\r\nif (ListContains (items, dummy_scenery_object)) {\r\n  list remove (items, dummy_scenery_object)\r\n}\r\n```\r\n\r\nThe dummy scenery object could have a description like \"That doesn't seem very interesting\", or \"You don't want to waste time with that\". So that it catches the player trying to interact with objects that are mentioned in the room description but aren't an object's alias.\r\n\r\nThe object is never in scope, to minimise its disambiguation menus, but it's always visible. It should have an alias like \"background\" or similar, just in case it shows up somehow.\r\n\r\nOh, I used this function because I couldn't find mention of one in the Quest documentation. Maybe I missed it.\r\n```\r\n<function name=\"RegexSplit\" parameters=\"pattern, string\" type=\"stringdictionary\"><![CDATA[\r\n  words = NewStringDictionary()\r\n  pattern = pattern + \"(?<!.)\"\r\n  while (not string = \"\" and IsRegexMatch (pattern, string)) {\r\n    parts = Populate (\"^(?<split_left>.*?)\"+pattern+\"(?<split_right>.*)$\", string)\r\n    string = DictionaryItem (parts, \"split_right\")\r\n    list add (words, DictionaryItem (parts, \"split_left\"))\r\n  }\r\n  if (LengthOf (string) > 0) {\r\n    list add (words, string)\r\n  }\r\n  return (words)\r\n]]></function>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>This idea's been bouncing around in my head for a while now. Thought I'd try typing it out.</p>\n<pre><code>dummy_scenery_object.parent = player.parent\n\nwords = Split (\"room;floor;sky;walls;ceiling;feet;hands\")\nif (HasString (player.parent, \"alias\")) {\n  foreach (word, RegexSplit (\"\\\\W+\", LCase(player.parent.alias))) {\n    list add (words, word)\n  }\n}\nif (HasString (player.parent, \"description\")) {\n  foreach (word, RegexSplit (\"\\\\W+\", LCase(player.parent.description))) {\n    list add (words, word)\n  }\n}\n\nskipwords = Split (\"a;the\")\nforeach (item, items) {\n  alias = GetDisplayAlias (item)\n  if (HasAttribute (item, \"alt\")) {\n    alias = alias + \" \" + Join (item.alt, \" \")\n  }\n  alias = LCase (Trim (alias))\n  foreach (word, Split (alias, \" \")) {\n    while (LengthOf (word) &gt; 0 and not ListContains (skipwords, word)) {\n      list add (skipwords, word)\n    }\n  }\n}\nwords = ListExclude (words, skipwords)\ndummy_scenery_object.alt = Split (Join (words, \" \"))\nif (ListContains (items, dummy_scenery_object)) {\n  list remove (items, dummy_scenery_object)\n}\n</code></pre>\n<p>The dummy scenery object could have a description like \"That doesn't seem very interesting\", or \"You don't want to waste time with that\". So that it catches the player trying to interact with objects that are mentioned in the room description but aren't an object's alias.</p>\n<p>The object is never in scope, to minimise its disambiguation menus, but it's always visible. It should have an alias like \"background\" or similar, just in case it shows up somehow.</p>\n<p>Oh, I used this function because I couldn't find mention of one in the Quest documentation. Maybe I missed it.</p>\n<pre><code>&lt;function name=\"RegexSplit\" parameters=\"pattern, string\" type=\"stringdictionary\"&gt;&lt;![CDATA[\n  words = NewStringDictionary()\n  pattern = pattern + \"(?&lt;!.)\"\n  while (not string = \"\" and IsRegexMatch (pattern, string)) {\n    parts = Populate (\"^(?&lt;split_left&gt;.*?)\"+pattern+\"(?&lt;split_right&gt;.*)$\", string)\n    string = DictionaryItem (parts, \"split_right\")\n    list add (words, DictionaryItem (parts, \"split_left\"))\n  }\n  if (LengthOf (string) &gt; 0) {\n    list add (words, string)\n  }\n  return (words)\n]]&gt;&lt;/function&gt;\n</code></pre>\n\n",
      "PostDate": "2018-12-18T08:27:49.8749434Z",
      "LastEditDate": "2018-12-22T17:09:16.9584891Z",
      "link": null
    },
    {
      "PostId": "fc06881f-dc45-4f3f-9d74-b46cd443d8ab",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Nice!",
      "EditableFormat": "markdown",
      "HTML": "<p>Nice!</p>\n\n",
      "PostDate": "2018-12-18T13:37:52.4859276Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "da5c90c2-fc8d-45e9-a57d-892c293580d8",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "http://i.imgur.com/d9UrZ6lb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "DavyB should see this!",
      "EditableFormat": "markdown",
      "HTML": "<p>DavyB should see this!</p>\n\n",
      "PostDate": "2018-12-18T16:14:23.1183611Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5d2df239-c36e-4349-9d20-8a7f29e67ee1",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I am experimenting with a JavaScript version of Quest, and have added a similar object - though you can tag words in the room description to have them as aliases of the background object.",
      "EditableFormat": "markdown",
      "HTML": "<p>I am experimenting with a JavaScript version of Quest, and have added a similar object - though you can tag words in the room description to have them as aliases of the background object.</p>\n\n",
      "PostDate": "2018-12-18T17:28:48.4020672Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5d2c0b04-e9fd-41de-86a5-be5d2d323242",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Okay mrangle, this looks very interesting and I'd like to try it out...so I create a dummy_scenery_object somewhere out of the way and put the above code into the start script, with the function in the usual place?\r\n\r\nTried that and Quest complains about invalid XML associated with the function...something about \"name cannot begin with '.'\" Don't understand enough to sort this out.",
      "EditableFormat": "markdown",
      "HTML": "<p>Okay mrangle, this looks very interesting and I'd like to try it out...so I create a dummy_scenery_object somewhere out of the way and put the above code into the start script, with the function in the usual place?</p>\n<p>Tried that and Quest complains about invalid XML associated with the function...something about \"name cannot begin with '.'\" Don't understand enough to sort this out.</p>\n\n",
      "PostDate": "2018-12-19T13:04:25.5527079Z",
      "LastEditDate": "2018-12-19T13:14:43.5097018Z",
      "link": null
    },
    {
      "PostId": "1890171c-3172-4ce8-9688-56525fe78569",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> put the above code into the start script\r\n\r\nNo, it was supposed to go in the backdrop scope script.\r\n\r\n> Quest complains about invalid XML\r\n\r\nOh, I forgot the CDATA tags. I'll fix that now.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>put the above code into the start script</p>\n</blockquote>\n<p>No, it was supposed to go in the backdrop scope script.</p>\n<blockquote>\n<p>Quest complains about invalid XML</p>\n</blockquote>\n<p>Oh, I forgot the CDATA tags. I'll fix that now.</p>\n\n",
      "PostDate": "2018-12-19T19:55:05.8635153Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "4ae99b79-61a2-432d-9867-82bc609cef01",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Sorry mrangle, there is still a problem with the code. I put it into an empty game, providing simple text for the room description. The result is:\r\n```\r\nYou are in an empty room. The floor, the walls, and the ceiling are all white.\r\n\r\nError running script: Error evaluating expression 'not (string = \"\") and IsRegexMatch (pattern, string)': parsing \"\\W+(?<.)\" - Invalid group name: Group names must begin with a word character.\r\nError running script: Cannot foreach over '' as it is not a list\r\nError running script: Error evaluating expression 'not (string = \"\") and IsRegexMatch (pattern, string)': parsing \"\\W+(?<.)\" - Invalid group name: Group names must begin with a word character.\r\nError running script: Cannot foreach over '' as it is not a list\"\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>Sorry mrangle, there is still a problem with the code. I put it into an empty game, providing simple text for the room description. The result is:</p>\n<pre><code>You are in an empty room. The floor, the walls, and the ceiling are all white.\n\nError running script: Error evaluating expression 'not (string = \"\") and IsRegexMatch (pattern, string)': parsing \"\\W+(?&lt;.)\" - Invalid group name: Group names must begin with a word character.\nError running script: Cannot foreach over '' as it is not a list\nError running script: Error evaluating expression 'not (string = \"\") and IsRegexMatch (pattern, string)': parsing \"\\W+(?&lt;.)\" - Invalid group name: Group names must begin with a word character.\nError running script: Cannot foreach over '' as it is not a list\"\n</code></pre>\n\n",
      "PostDate": "2018-12-22T16:47:17.4754245Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "4775bd2e-12e3-4b76-94d4-fb7a8777c855",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Typo fix'd. `\"(?<.)\"` should be `\"(?<!.)\"` (which matches \"not the beginning of the string\" - not relevant in this case, but a general RegexSplit function needs to avoid going into an infinite loop if you pass it a pattern which can match the empty string).\r\n\r\nIn this case, the expression I'm passing it is `\"\\\\W+\"`, which matches one or more characters of space or punctuation, giving us an easy way to break the description into words",
      "EditableFormat": "markdown",
      "HTML": "<p>Typo fix'd. <code>\"(?&lt;.)\"</code> should be <code>\"(?&lt;!.)\"</code> (which matches \"not the beginning of the string\" - not relevant in this case, but a general RegexSplit function needs to avoid going into an infinite loop if you pass it a pattern which can match the empty string).</p>\n<p>In this case, the expression I'm passing it is <code>\"\\\\W+\"</code>, which matches one or more characters of space or punctuation, giving us an easy way to break the description into words</p>\n\n",
      "PostDate": "2018-12-22T17:12:06.7963741Z",
      "LastEditDate": "2018-12-22T17:23:29.8824876Z",
      "link": null
    },
    {
      "PostId": "15dd403d-c7e6-4e37-bbb4-2e960f282e28",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Error message has changed to:\r\n```\r\nYou are in an empty room. The floor, the walls, and the ceiling are all white.\r\n\r\nError running script: Unrecognised list type\r\nError running script: Cannot foreach over '' as it is not a list\r\nError running script: Unrecognised list type\r\nError running script: Cannot foreach over '' as it is not a list\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>Error message has changed to:</p>\n<pre><code>You are in an empty room. The floor, the walls, and the ceiling are all white.\n\nError running script: Unrecognised list type\nError running script: Cannot foreach over '' as it is not a list\nError running script: Unrecognised list type\nError running script: Cannot foreach over '' as it is not a list\n</code></pre>\n\n",
      "PostDate": "2018-12-22T19:32:38.3908656Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
