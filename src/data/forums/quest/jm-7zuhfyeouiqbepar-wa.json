{
  "Topic": {
    "TopicId": "jm-7zuhfyeouiqbepar-wa",
    "ForumId": "10",
    "Title": "How to have monsters regenerate when you enter a room",
    "LastUpdated": "2018-04-04T02:03:58.9166851Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "ca17a634-f002-4289-942d-ee30eaa8f3e7",
      "UserId": 262169,
      "Username": "Laraqua",
      "AvatarUrl": "https://secure.gravatar.com/avatar/62e7b4391dc6f205a4820699c027a564?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "The below is an example of one of the monsters.  Basically what I want is for the zombies to return to full health once players pass through a particular exit / enter a room.  I tried doing Set Attribute if Player Has Flag or if Player Is In Room but that didn't seem to work.  I think because the attribute is only at that number WHILE they're in that room so the moment they leave the enemy returns to its uninjured state.  So, how could I reset the monster?\r\n\r\n\r\n``` \r\n      <object name=\"ZedStrainI\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"surface\" />\r\n      <displayverbs type=\"stringlist\">\r\n        <value>Look at</value>\r\n        <value>Attack</value>\r\n      </displayverbs>\r\n      <feature_startscript />\r\n      <alias>well-dressed zed</alias>\r\n      <dead type=\"boolean\">false</dead>\r\n      <feature_container />\r\n      <contentsprefix>in whose pocket there is</contentsprefix>\r\n      <inroomdescription>You can see a well-dressed fellow in a suit standing at the other end of the corridor, swaying slightly.  He twitches, then lurches around to face you.</inroomdescription>\r\n      <attr name=\"_initialise_\" type=\"script\"><![CDATA[\r\n        this.listalias = CapFirst(this.alias)\r\n        this.damage = 1\r\n        this.attack = 0\r\n        this.defence = 0\r\n        this.armour = 0\r\n        this.critdesc = \"{random:You blank out a moment from the force of the #attacker#'s blow.  Luckily, you don't fall:Damnit!  You've been hit hard by the #attacker#:The #attacker# launches itself at you.  Its desperate strikes sends you reeling:The #attacker# slams into you, knocking you into a wall so hard your head rings:The #attacker# screams in your ear as it batters you with its weapon:Your rib cracks under the force of the #attacker#'s blow.} (#hits# hits).\"\r\n        this.attackdesc = \"{random:#Attacker# batters you with its fist:#Attacker# wallops you in the side of the head with its weapon:#Attacker# smacks you across the shoulders with its weapon:You cop a hit to the knee as #attacker# rushes at you} (#hits# hits).\"\r\n        this.missdesc = \"{random:#Attacker# misses you by mere inches:#Attacker#'s blow is too weak to hurt:You side-step #attacker#'s strike:#Attacker# stumbles into furniture or a wall and misses you}.\"\r\n        this.changedhitpoints => {\r\n          if (this.hitpoints < 1) {\r\n            msg (\"It is dead!\")\r\n            this.dead = true\r\n          }\r\n        }\r\n      ]]></attr>\r\n      <search type=\"script\">\r\n        MakeObjectVisible (half chewed pencil)\r\n        msg (\"You find a half chewed pencil in it's top pocket.\")\r\n      </search>\r\n      <harvest type=\"script\">\r\n        msg (\"You surgically remove its wastelander gland.  A good source of blood and DNA.\")\r\n        CloneObjectAndMove (ZedStrainIglands, ZedStrain1)\r\n      </harvest>\r\n      <loot type=\"script\">\r\n        MakeObjectVisible (half chewed pencil)\r\n        msg (\"You find a half chewed pencil in it's top pocket.\")\r\n      </loot>\r\n      <look type=\"script\"><![CDATA[\r\n        if (ZedStrainI.dead = false) {\r\n          msg (\"The wild look in the creature's eyes chills you to the core.\")\r\n        }\r\n        else {\r\n          msg (\"It's a corpse on the ground.  You can <b>loot</b> it and physicians / scientists can <b>harvest</b> it.\")\r\n        }\r\n      ]]></look>\r\n      <hitpoints type=\"int\">3</hitpoints>\r\n      <changedhitpoints type=\"script\">\r\n        if (game.pov = ) {\r\n          ZedStrainI.hitpoints = ZedStrainI.hitpoints = 7\r\n        }\r\n      </changedhitpoints>\r\n      <object name=\"half chewed pencil1\">\r\n        <inherit name=\"editor_object\" />\r\n        <visible type=\"boolean\">false</visible>\r\n      </object>\r\n    </object>",
      "EditableFormat": "markdown",
      "HTML": "<p>The below is an example of one of the monsters.  Basically what I want is for the zombies to return to full health once players pass through a particular exit / enter a room.  I tried doing Set Attribute if Player Has Flag or if Player Is In Room but that didn't seem to work.  I think because the attribute is only at that number WHILE they're in that room so the moment they leave the enemy returns to its uninjured state.  So, how could I reset the monster?</p>\n<pre><code>      &lt;object name=\"ZedStrainI\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"surface\" /&gt;\n      &lt;displayverbs type=\"stringlist\"&gt;\n        &lt;value&gt;Look at&lt;/value&gt;\n        &lt;value&gt;Attack&lt;/value&gt;\n      &lt;/displayverbs&gt;\n      &lt;feature_startscript /&gt;\n      &lt;alias&gt;well-dressed zed&lt;/alias&gt;\n      &lt;dead type=\"boolean\"&gt;false&lt;/dead&gt;\n      &lt;feature_container /&gt;\n      &lt;contentsprefix&gt;in whose pocket there is&lt;/contentsprefix&gt;\n      &lt;inroomdescription&gt;You can see a well-dressed fellow in a suit standing at the other end of the corridor, swaying slightly.  He twitches, then lurches around to face you.&lt;/inroomdescription&gt;\n      &lt;attr name=\"_initialise_\" type=\"script\"&gt;&lt;![CDATA[\n        this.listalias = CapFirst(this.alias)\n        this.damage = 1\n        this.attack = 0\n        this.defence = 0\n        this.armour = 0\n        this.critdesc = \"{random:You blank out a moment from the force of the #attacker#'s blow.  Luckily, you don't fall:Damnit!  You've been hit hard by the #attacker#:The #attacker# launches itself at you.  Its desperate strikes sends you reeling:The #attacker# slams into you, knocking you into a wall so hard your head rings:The #attacker# screams in your ear as it batters you with its weapon:Your rib cracks under the force of the #attacker#'s blow.} (#hits# hits).\"\n        this.attackdesc = \"{random:#Attacker# batters you with its fist:#Attacker# wallops you in the side of the head with its weapon:#Attacker# smacks you across the shoulders with its weapon:You cop a hit to the knee as #attacker# rushes at you} (#hits# hits).\"\n        this.missdesc = \"{random:#Attacker# misses you by mere inches:#Attacker#'s blow is too weak to hurt:You side-step #attacker#'s strike:#Attacker# stumbles into furniture or a wall and misses you}.\"\n        this.changedhitpoints =&gt; {\n          if (this.hitpoints &lt; 1) {\n            msg (\"It is dead!\")\n            this.dead = true\n          }\n        }\n      ]]&gt;&lt;/attr&gt;\n      &lt;search type=\"script\"&gt;\n        MakeObjectVisible (half chewed pencil)\n        msg (\"You find a half chewed pencil in it's top pocket.\")\n      &lt;/search&gt;\n      &lt;harvest type=\"script\"&gt;\n        msg (\"You surgically remove its wastelander gland.  A good source of blood and DNA.\")\n        CloneObjectAndMove (ZedStrainIglands, ZedStrain1)\n      &lt;/harvest&gt;\n      &lt;loot type=\"script\"&gt;\n        MakeObjectVisible (half chewed pencil)\n        msg (\"You find a half chewed pencil in it's top pocket.\")\n      &lt;/loot&gt;\n      &lt;look type=\"script\"&gt;&lt;![CDATA[\n        if (ZedStrainI.dead = false) {\n          msg (\"The wild look in the creature's eyes chills you to the core.\")\n        }\n        else {\n          msg (\"It's a corpse on the ground.  You can &lt;b&gt;loot&lt;/b&gt; it and physicians / scientists can &lt;b&gt;harvest&lt;/b&gt; it.\")\n        }\n      ]]&gt;&lt;/look&gt;\n      &lt;hitpoints type=\"int\"&gt;3&lt;/hitpoints&gt;\n      &lt;changedhitpoints type=\"script\"&gt;\n        if (game.pov = ) {\n          ZedStrainI.hitpoints = ZedStrainI.hitpoints = 7\n        }\n      &lt;/changedhitpoints&gt;\n      &lt;object name=\"half chewed pencil1\"&gt;\n        &lt;inherit name=\"editor_object\" /&gt;\n        &lt;visible type=\"boolean\"&gt;false&lt;/visible&gt;\n      &lt;/object&gt;\n    &lt;/object&gt;\n</code></pre>\n\n",
      "PostDate": "2018-04-04T02:03:58.9166851Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "8dc498f4-8987-4268-adbd-89c386c4a736",
      "UserId": 260569,
      "Username": "DarkLizerd",
      "AvatarUrl": "https://i.imgur.com/vjdH3t6b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "One way would use a turn script, and heal each creature 1 HP per turn, up to their max...\r\nBut you need to prevent this during combat.\r\nThen, if you return to a room shortly after the battle, you would not face a fully healed creature...\r\nMaybe one partly healed...\r\nOr... maybe what you want looks like this...\r\nRoom 1: start room\r\nRoom 2: empty\r\nRoom 3: zombie (fight and kill)\r\nRoom 4: nothing (zombie still dead)\r\nRoom 5: Big bat (fight and kill)\r\nRoom 6: Zombie regenerates, fight it if you go back there\r\nRoom 7: empty\r\nRoom 8: Bat regenerates\r\nAnd so on...\r\nCould add\r\nRoom 2: empty, Bat regenerates if killed.\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>One way would use a turn script, and heal each creature 1 HP per turn, up to their max...<br>\nBut you need to prevent this during combat.<br>\nThen, if you return to a room shortly after the battle, you would not face a fully healed creature...<br>\nMaybe one partly healed...<br>\nOr... maybe what you want looks like this...<br>\nRoom 1: start room<br>\nRoom 2: empty<br>\nRoom 3: zombie (fight and kill)<br>\nRoom 4: nothing (zombie still dead)<br>\nRoom 5: Big bat (fight and kill)<br>\nRoom 6: Zombie regenerates, fight it if you go back there<br>\nRoom 7: empty<br>\nRoom 8: Bat regenerates<br>\nAnd so on...<br>\nCould add<br>\nRoom 2: empty, Bat regenerates if killed.</p>\n\n",
      "PostDate": "2018-04-04T04:26:42.6537646Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2ffa39cf-212d-4fce-9d67-7bfaeb4218b1",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> Basically what I want is for the zombies to return to full health once players pass through a particular exit / enter a room\r\n\r\nExits can have a script that runs when the player clicks them. Rooms can have a script that runs when the player enters or leaves them.\r\nSet one of these scripts (on the \"scripts\" tag for the exit or room) and just make it set the zombie's health to full. For example:\r\n```\r\nZedStrainI.hitpoints = 100\r\nZedStrainI.dead = false\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>Basically what I want is for the zombies to return to full health once players pass through a particular exit / enter a room</p>\n</blockquote>\n<p>Exits can have a script that runs when the player clicks them. Rooms can have a script that runs when the player enters or leaves them.<br>\nSet one of these scripts (on the \"scripts\" tag for the exit or room) and just make it set the zombie's health to full. For example:</p>\n<pre><code>ZedStrainI.hitpoints = 100\nZedStrainI.dead = false\n</code></pre>\n\n",
      "PostDate": "2018-04-04T12:42:28.9768023Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a44b7481-a942-4673-a62d-7beb572006a5",
      "UserId": 262169,
      "Username": "Laraqua",
      "AvatarUrl": "https://secure.gravatar.com/avatar/62e7b4391dc6f205a4820699c027a564?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I'd need to set that for each individual creature it applies to, right?  That's fine, just want to know.  :)",
      "EditableFormat": "markdown",
      "HTML": "<p>I'd need to set that for each individual creature it applies to, right?  That's fine, just want to know.  :)</p>\n\n",
      "PostDate": "2018-04-05T03:36:23.484289Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "bb123cdc-2982-452f-87d3-89da193a7d3f",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "If you want to make it apply to multiple creatures, you can do that. You just need to have some way for Quest to know which ones you want to restore.\r\n\r\nScript to restore all enemies (well, everything with \"hitpoints\" and \"dead\" attributes) to 10 HP:\r\n```\r\nforeach (obj, AllObjects()) {\r\n  // Make sure we don't include the player, if he has hitpoints too\r\n  if (not obj = game.pov) {\r\n    if (HasBoolean(obj, \"dead\") and HasInt(obj, \"hitpoints\")) {\r\n      obj.hitpoints = 10\r\n      obj.dead = false\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nIf you give them a `maxhitpoints` attribute, we can use that to decide what to reset their HP to. This is better if you have some enemies with different HP totals. Enemies without a maxhitpoints wouldn't be restored:\r\n```\r\nforeach (obj, AllObjects()) {\r\n  if (HasInt(obj, \"maxhitpoints\")) {\r\n    obj.hitpoints = obj.maxhitpoints\r\n    obj.dead = false\r\n  }\r\n}\r\n```\r\n\r\nIf you want to restore them, but not fully:\r\n```\r\nforeach (obj, AllObjects()) {\r\n  if (HasInt(obj, \"maxhitpoints\")) {\r\n    obj.dead = false\r\n    if (obj.hitpoints < obj.maxhitpoints) {\r\n      obj.hitpoints = obj.hitpoints + 1\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nIf you just want to heal the ones in a certain room:\r\n```\r\nforeach (obj, GetAllChildObjects(master bedroom)) {\r\n  if (HasInt(obj, \"maxhitpoints\")) {\r\n    obj.hitpoints = obj.maxhitpoints\r\n    obj.dead = false\r\n  }\r\n}\r\n```\r\n(if you want to heal all the enemies in a particular building or area, you can create a room for the building and put all the rooms inside it. The player never sees it, but it makes stuff like this easier)\r\n\r\nIf you only want to respawn the dead zombies:\r\n```\r\nforeach (obj, FilterByAttribute(AllObjects(), \"dead\", true)) {\r\n  if (HasInt(obj, \"maxhitpoints\")) {\r\n    obj.hitpoints = obj.maxhitpoints\r\n    obj.dead = false\r\n  }\r\n}\r\n```\r\n(or to heal any that have been injured but not killed, change 'true' to 'false')\r\n\r\nIf you're after healing all clones of a particular zombie, or all zombies of a particular type (assuming you have an original and create clones of it in different places):\r\n```\r\nforeach (obj, FilterByAttribute(AllObjects(), \"prototype\", Original Zombie)) {\r\n  obj.hitpoints = obj.maxhitpoints\r\n  obj.dead = false\r\n}\r\n```\r\n\r\nThose are the most likely options I can think of. But if there's some other situation you can think of, I'm sure it can be done.",
      "EditableFormat": "markdown",
      "HTML": "<p>If you want to make it apply to multiple creatures, you can do that. You just need to have some way for Quest to know which ones you want to restore.</p>\n<p>Script to restore all enemies (well, everything with \"hitpoints\" and \"dead\" attributes) to 10 HP:</p>\n<pre><code>foreach (obj, AllObjects()) {\n  // Make sure we don't include the player, if he has hitpoints too\n  if (not obj = game.pov) {\n    if (HasBoolean(obj, \"dead\") and HasInt(obj, \"hitpoints\")) {\n      obj.hitpoints = 10\n      obj.dead = false\n    }\n  }\n}\n</code></pre>\n<p>If you give them a <code>maxhitpoints</code> attribute, we can use that to decide what to reset their HP to. This is better if you have some enemies with different HP totals. Enemies without a maxhitpoints wouldn't be restored:</p>\n<pre><code>foreach (obj, AllObjects()) {\n  if (HasInt(obj, \"maxhitpoints\")) {\n    obj.hitpoints = obj.maxhitpoints\n    obj.dead = false\n  }\n}\n</code></pre>\n<p>If you want to restore them, but not fully:</p>\n<pre><code>foreach (obj, AllObjects()) {\n  if (HasInt(obj, \"maxhitpoints\")) {\n    obj.dead = false\n    if (obj.hitpoints &lt; obj.maxhitpoints) {\n      obj.hitpoints = obj.hitpoints + 1\n    }\n  }\n}\n</code></pre>\n<p>If you just want to heal the ones in a certain room:</p>\n<pre><code>foreach (obj, GetAllChildObjects(master bedroom)) {\n  if (HasInt(obj, \"maxhitpoints\")) {\n    obj.hitpoints = obj.maxhitpoints\n    obj.dead = false\n  }\n}\n</code></pre>\n<p>(if you want to heal all the enemies in a particular building or area, you can create a room for the building and put all the rooms inside it. The player never sees it, but it makes stuff like this easier)</p>\n<p>If you only want to respawn the dead zombies:</p>\n<pre><code>foreach (obj, FilterByAttribute(AllObjects(), \"dead\", true)) {\n  if (HasInt(obj, \"maxhitpoints\")) {\n    obj.hitpoints = obj.maxhitpoints\n    obj.dead = false\n  }\n}\n</code></pre>\n<p>(or to heal any that have been injured but not killed, change 'true' to 'false')</p>\n<p>If you're after healing all clones of a particular zombie, or all zombies of a particular type (assuming you have an original and create clones of it in different places):</p>\n<pre><code>foreach (obj, FilterByAttribute(AllObjects(), \"prototype\", Original Zombie)) {\n  obj.hitpoints = obj.maxhitpoints\n  obj.dead = false\n}\n</code></pre>\n<p>Those are the most likely options I can think of. But if there's some other situation you can think of, I'm sure it can be done.</p>\n\n",
      "PostDate": "2018-04-05T10:03:36.7451234Z",
      "LastEditDate": "2018-04-05T10:06:36.1225028Z",
      "link": null
    }
  ]
}
