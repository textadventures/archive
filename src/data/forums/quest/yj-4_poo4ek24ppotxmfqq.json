{
  "Topic": {
    "TopicId": "yj-4_poo4ek24ppotxmfqq",
    "ForumId": "10",
    "Title": "One door closes and another opens in your face...",
    "LastUpdated": "2018-05-20T09:06:13.1302253Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "80a08e13-f61e-4107-b592-3765534c0419",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I was testing out KV's fix for container items listed in the Inventory pane when I came upon this anomaly. The set up is as follows:\r\n\r\nI am standing beside a beanstalk, holding a beanstalk kit, which is an open box containing a bean and two other items. \r\nI type TAKE BEAN\r\nQuestion: what happens next? Is it\r\nA: I take the bean out of the box\r\nB: Quest complains that I am already holding the beanstalk kit\r\nC: I climb the beanstalk (which is the script attached to 'take')\r\nD: I am offered a menu asking which 'bean' did I mean?\r\n\r\nThe response is Option C, which was a surprise!\r\n[Demo no longer available]",
      "EditableFormat": "markdown",
      "HTML": "<p>I was testing out KV's fix for container items listed in the Inventory pane when I came upon this anomaly. The set up is as follows:</p>\n<p>I am standing beside a beanstalk, holding a beanstalk kit, which is an open box containing a bean and two other items.<br>\nI type TAKE BEAN<br>\nQuestion: what happens next? Is it<br>\nA: I take the bean out of the box<br>\nB: Quest complains that I am already holding the beanstalk kit<br>\nC: I climb the beanstalk (which is the script attached to 'take')<br>\nD: I am offered a menu asking which 'bean' did I mean?</p>\n<p>The response is Option C, which was a surprise!<br>\n[Demo no longer available]</p>\n\n",
      "PostDate": "2018-05-20T09:06:13.1302253Z",
      "LastEditDate": "2018-05-21T07:50:49.1190623Z",
      "link": null
    },
    {
      "PostId": "993dfc4b-5115-4ef1-8ec5-2758a4c5fee9",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I don't think it's that surprising.\r\n\r\nThe scope of \"take\" is `notheld` last time I checked. An object you're holding isn't in scope. So there is only one object in scope that matches the pattern 'bean', and it takes that.\r\n\r\nMaybe it would be better if the scope for the \"take\" command was changed to `notheld,contents`?\r\nOr possibly change ResolveNameInternal so that if the player types the exact alias of a visible object, that object is considered to be in scope by default (which isn't _useful_ in most cases, but may line up better with what the player _expects_).\r\n\r\nMaybe something like:\r\n```\r\n  <function name=\"ResolveNameInternal\" parameters=\"variable, value, objtype\" type=\"object\">\r\n    <![CDATA[\r\n    game.pov.currentcommandmultiobjectpending = false\r\n\r\n    scope = GetScope(variable, value, objtype)\r\n    if (HasString(game.pov.currentcommandpattern, \"scope\")) {\r\n      secondaryscope = ScopeVisible()\r\n      // If the player types the exact alias of an object, assume they meant that object\r\n      // even if it's out of scope. Not useful, but intuitive.\r\n      foreach (o, secondaryscope) {\r\n        if ((LCase(GetDisplayAlias(o)) = LCase(value)) and not ListContains (scope, o)) {\r\n          list add (scope, o)\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      secondaryscope = null\r\n    }\r\n   \r\n    return (ResolveNameFromList(variable, value, objtype, scope, secondaryscope))\r\n    ]]>\r\n  </function>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>I don't think it's that surprising.</p>\n<p>The scope of \"take\" is <code>notheld</code> last time I checked. An object you're holding isn't in scope. So there is only one object in scope that matches the pattern 'bean', and it takes that.</p>\n<p>Maybe it would be better if the scope for the \"take\" command was changed to <code>notheld,contents</code>?<br>\nOr possibly change ResolveNameInternal so that if the player types the exact alias of a visible object, that object is considered to be in scope by default (which isn't <em>useful</em> in most cases, but may line up better with what the player <em>expects</em>).</p>\n<p>Maybe something like:</p>\n<pre><code>  &lt;function name=\"ResolveNameInternal\" parameters=\"variable, value, objtype\" type=\"object\"&gt;\n    &lt;![CDATA[\n    game.pov.currentcommandmultiobjectpending = false\n\n    scope = GetScope(variable, value, objtype)\n    if (HasString(game.pov.currentcommandpattern, \"scope\")) {\n      secondaryscope = ScopeVisible()\n      // If the player types the exact alias of an object, assume they meant that object\n      // even if it's out of scope. Not useful, but intuitive.\n      foreach (o, secondaryscope) {\n        if ((LCase(GetDisplayAlias(o)) = LCase(value)) and not ListContains (scope, o)) {\n          list add (scope, o)\n        }\n      }\n    }\n    else {\n      secondaryscope = null\n    }\n   \n    return (ResolveNameFromList(variable, value, objtype, scope, secondaryscope))\n    ]]&gt;\n  &lt;/function&gt;\n</code></pre>\n\n",
      "PostDate": "2018-05-20T09:42:12.0736462Z",
      "LastEditDate": "2018-05-20T12:33:58.2314824Z",
      "link": null
    },
    {
      "PostId": "0141425d-1f45-4407-8e1f-b81f865f4749",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "When I tried to force a menu by not giving the full name, this happened:\r\n> take bea\r\nPlease choose which 'bea' you mean:\r\n1: Beanstalk Kit\r\n2: bean\r\n\r\nwhich is also surprising (to me!) ...now the beanstalk isn't even mentioned? From a user perspective, I would expect precise spelling to be taken first; and otherwise offered all options in a menu.",
      "EditableFormat": "markdown",
      "HTML": "<p>When I tried to force a menu by not giving the full name, this happened:</p>\n<blockquote>\n<p>take bea<br>\nPlease choose which 'bea' you mean:<br>\n1: Beanstalk Kit<br>\n2: bean</p>\n</blockquote>\n<p>which is also surprising (to me!) ...now the beanstalk isn't even mentioned? From a user perspective, I would expect precise spelling to be taken first; and otherwise offered all options in a menu.</p>\n\n",
      "PostDate": "2018-05-20T10:15:22.1419946Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "8b2f4e97-1636-47d0-a07d-f1fa23f9a500",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> When I tried to force a menu by not giving the full name, this happened:\r\n\r\nIs that after making some changes? In the game you linked above, \"take bea\" still climbs the beanstalk for me.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>When I tried to force a menu by not giving the full name, this happened:</p>\n</blockquote>\n<p>Is that after making some changes? In the game you linked above, \"take bea\" still climbs the beanstalk for me.</p>\n\n",
      "PostDate": "2018-05-20T11:41:25.7214162Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5fbab5fc-eec6-4e04-b788-d462c621fe42",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Apologies, ignore the example, I must have moved the player out of the garden before I attempted 'take bea'. \r\n\r\nThe basic point still applies, however: _most would expect precise spelling to be considered first; then, if no match, be presented with all reachable alternatives having the same substring._\r\n\r\n'take bean', when away from the beanstalk has the desired effect of taking the bean out of the box, without worrying about a name conflict with 'beanstalk kit', and 'take bea' offering a prompt. Perhaps this issue is a result of the last release attempting to reduce the use of the prompt menu?",
      "EditableFormat": "markdown",
      "HTML": "<p>Apologies, ignore the example, I must have moved the player out of the garden before I attempted 'take bea'.</p>\n<p>The basic point still applies, however: <em>most would expect precise spelling to be considered first; then, if no match, be presented with all reachable alternatives having the same substring.</em></p>\n<p>'take bean', when away from the beanstalk has the desired effect of taking the bean out of the box, without worrying about a name conflict with 'beanstalk kit', and 'take bea' offering a prompt. Perhaps this issue is a result of the last release attempting to reduce the use of the prompt menu?</p>\n\n",
      "PostDate": "2018-05-20T12:52:58.1374625Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "831f373c-9e75-4ed5-9fe7-3da838b447e7",
      "UserId": 32920,
      "Username": "Father",
      "AvatarUrl": "http://i.imgur.com/ogRXH9lb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I tried it and it just said that you had taken the bean. The bean was in inventory and could be looked at??\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>I tried it and it just said that you had taken the bean. The bean was in inventory and could be looked at??</p>\n\n",
      "PostDate": "2018-05-20T13:03:21.815147Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "992629ea-b149-489d-9f49-0d4faeaac6dc",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> The basic point still applies, however: _most would expect precise spelling to be considered first; then, if no match, be presented with all reachable alternatives having the same substring._\r\n\r\nThat's what the modified ResolveNameInternal I posted above was supposed to achieve.\r\n\r\nAlthough \"all reachable objects\", I'd disagree with. If you say \"drop bea\", it should only present a menu of objects you're holding, because they're the ones for which \"drop\" is meaningful. If I'm in a room with a yellow lamp, a green lamp, and a blue lamp (turned on), and I type \"turn off lamp\", it's obvious which one I mean.\r\n\r\n> Perhaps this issue is a result of the last release attempting to reduce the use of the prompt menu?\r\n\r\nDon't think so. It's been like that as long as I've been poking Quest. It's just that the \"check if you typed an exact alias\" bit of code only considers objects in scope; the special behaviour doesn't apply to \"take bean\" if you're already holding it, or \"drop bean\" when it's on the ground.\r\n\r\nThinking about it, the code above is an ugly bodge. Really, this should be done in `ResolveNameFromList`.\r\nMy thought would be changing\r\n```\r\n    if (ListCount(fullmatches) = 0 and ListCount(partialmatches) = 0 and not secondaryscope = null) {\r\n      foreach (obj, secondaryscope) {\r\n        name = LCase(GetDisplayAlias(obj))\r\n        CompareNames (name, value, obj, fullmatches, partialmatches)\r\n        if (obj.alt <> null) {\r\n          foreach (altname, obj.alt) {\r\n            CompareNames (LCase(altname), value, obj, fullmatches, partialmatches)\r\n          }\r\n        }\r\n      }\r\n    }   \r\n```\r\nto…\r\n```\r\n    if (ListCount(fullmatches) = 0 and not secondaryscope = null) {\r\n      secondarymatches = NewObjectList()\r\n      foreach (obj, secondaryscope) {\r\n        name = LCase(GetDisplayAlias(obj))\r\n        CompareNames (name, value, obj, fullmatches, secondarymatches)\r\n        if (obj.alt <> null) {\r\n          foreach (altname, obj.alt) {\r\n            CompareNames (LCase(altname), value, obj, fullmatches, secondarymatches)\r\n          }\r\n        }\r\n      }\r\n      if (ListCount(partialmatches) = 0) {\r\n        partialmatches = secondarymatches\r\n      }\r\n    }\r\n```\r\nIf I'm understanding the structure of the existing code right.\r\n\r\nThat should mean the order of checking would be is:\r\n1. Exact match for objects in scope\r\n2. \"him\", \"her\", \"it\" special cases\r\n3. Exact match for other visible objects\r\n4. Partial match for objects in scope\r\n5. Partial match for other visible objects\r\n\r\nAt each step, if there's exactly one object found it runs the command, if there's more than one it displays a menu, and if there's none it goes on to check the next set.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>The basic point still applies, however: <em>most would expect precise spelling to be considered first; then, if no match, be presented with all reachable alternatives having the same substring.</em></p>\n</blockquote>\n<p>That's what the modified ResolveNameInternal I posted above was supposed to achieve.</p>\n<p>Although \"all reachable objects\", I'd disagree with. If you say \"drop bea\", it should only present a menu of objects you're holding, because they're the ones for which \"drop\" is meaningful. If I'm in a room with a yellow lamp, a green lamp, and a blue lamp (turned on), and I type \"turn off lamp\", it's obvious which one I mean.</p>\n<blockquote>\n<p>Perhaps this issue is a result of the last release attempting to reduce the use of the prompt menu?</p>\n</blockquote>\n<p>Don't think so. It's been like that as long as I've been poking Quest. It's just that the \"check if you typed an exact alias\" bit of code only considers objects in scope; the special behaviour doesn't apply to \"take bean\" if you're already holding it, or \"drop bean\" when it's on the ground.</p>\n<p>Thinking about it, the code above is an ugly bodge. Really, this should be done in <code>ResolveNameFromList</code>.<br>\nMy thought would be changing</p>\n<pre><code>    if (ListCount(fullmatches) = 0 and ListCount(partialmatches) = 0 and not secondaryscope = null) {\n      foreach (obj, secondaryscope) {\n        name = LCase(GetDisplayAlias(obj))\n        CompareNames (name, value, obj, fullmatches, partialmatches)\n        if (obj.alt &lt;&gt; null) {\n          foreach (altname, obj.alt) {\n            CompareNames (LCase(altname), value, obj, fullmatches, partialmatches)\n          }\n        }\n      }\n    }   \n</code></pre>\n<p>to…</p>\n<pre><code>    if (ListCount(fullmatches) = 0 and not secondaryscope = null) {\n      secondarymatches = NewObjectList()\n      foreach (obj, secondaryscope) {\n        name = LCase(GetDisplayAlias(obj))\n        CompareNames (name, value, obj, fullmatches, secondarymatches)\n        if (obj.alt &lt;&gt; null) {\n          foreach (altname, obj.alt) {\n            CompareNames (LCase(altname), value, obj, fullmatches, secondarymatches)\n          }\n        }\n      }\n      if (ListCount(partialmatches) = 0) {\n        partialmatches = secondarymatches\n      }\n    }\n</code></pre>\n<p>If I'm understanding the structure of the existing code right.</p>\n<p>That should mean the order of checking would be is:</p>\n<ol>\n<li>Exact match for objects in scope</li>\n<li>\"him\", \"her\", \"it\" special cases</li>\n<li>Exact match for other visible objects</li>\n<li>Partial match for objects in scope</li>\n<li>Partial match for other visible objects</li>\n</ol>\n<p>At each step, if there's exactly one object found it runs the command, if there's more than one it displays a menu, and if there's none it goes on to check the next set.</p>\n\n",
      "PostDate": "2018-05-20T13:30:27.9858572Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "d52c9cce-3b3e-4cd6-91cf-834771a2010c",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> I tried it and it just said that you had taken the bean. The bean was in inventory and could be looked at??\r\n\r\nHi Father, did you move out of the garden by any chance? The sequence should be PANES, BEANTEST, OPEN KIT, TAKE BEAN.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I tried it and it just said that you had taken the bean. The bean was in inventory and could be looked at??</p>\n</blockquote>\n<p>Hi Father, did you move out of the garden by any chance? The sequence should be PANES, BEANTEST, OPEN KIT, TAKE BEAN.</p>\n\n",
      "PostDate": "2018-05-20T15:13:42.2975214Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "7ef46014-a53c-40ed-ae13-c3ff5fd844b5",
      "UserId": 32920,
      "Username": "Father",
      "AvatarUrl": "http://i.imgur.com/ogRXH9lb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I moved into the house, but even so bean kit did not appear as an option.",
      "EditableFormat": "markdown",
      "HTML": "<p>I moved into the house, but even so bean kit did not appear as an option.</p>\n\n",
      "PostDate": "2018-05-20T15:26:07.2474374Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "cdf303f3-761b-47b2-87ec-152906611a42",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">Although \"all reachable objects\", I'd disagree with. If you say \"drop bea\", it should only present a menu of objects you're holding, because they're the ones for which \"drop\" is meaningful. \r\n\r\nI was really just thinking about 'take' but your general point is right. On top of (i) exact match; (ii) all reachable with string subset, there should be adjustments according to context. So, in relation to 'take', it can exclude all items in the inventory at the top level though not within containers. Similarly 'drop' can exclude anything not held. For other verbs, such as 'use' there is probably no optimisation possible. Interestingly though, 'use bean' seems to pick the 'bean' in the box, as I'm guessing preference is given to objects held. Someone must know the current algorithm?",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>Although \"all reachable objects\", I'd disagree with. If you say \"drop bea\", it should only present a menu of objects you're holding, because they're the ones for which \"drop\" is meaningful.</p>\n</blockquote>\n<p>I was really just thinking about 'take' but your general point is right. On top of (i) exact match; (ii) all reachable with string subset, there should be adjustments according to context. So, in relation to 'take', it can exclude all items in the inventory at the top level though not within containers. Similarly 'drop' can exclude anything not held. For other verbs, such as 'use' there is probably no optimisation possible. Interestingly though, 'use bean' seems to pick the 'bean' in the box, as I'm guessing preference is given to objects held. Someone must know the current algorithm?</p>\n\n",
      "PostDate": "2018-05-20T15:34:22.7719228Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5830455a-e297-4549-9f0e-0a4a701c1f9b",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">I moved into the house, but even so bean kit did not appear as an option.\r\n\r\nYou need to stay beside the beanstalk.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I moved into the house, but even so bean kit did not appear as an option.</p>\n</blockquote>\n<p>You need to stay beside the beanstalk.</p>\n\n",
      "PostDate": "2018-05-20T15:36:02.9546446Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "04412e7e-4a1f-4ce7-be38-eaaa94c287b2",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "...here is another issue...drop the Beanstalk Kit in the garden and then type 'take all'. ",
      "EditableFormat": "markdown",
      "HTML": "<p>...here is another issue...drop the Beanstalk Kit in the garden and then type 'take all'.</p>\n\n",
      "PostDate": "2018-05-20T15:46:56.9604484Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "325bd9e5-5f22-421b-bec7-9510fd96381f",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "What would you like to do? Type instructions in the space below.\r\nType help for play options and more information.\r\n\r\n\r\n\\> panes\r\nThe game panes are now visible on the right. Type panes again to hide them.\r\n\r\n\\> beantest\r\n\r\n\\> open kit\r\nYou open it.\r\nIt contains a bean, a compliments slip (on which there is dust) and growing instructions.\r\n\r\n\\> get bean\r\nYou make your way slowly up the outside foliage.\r\n\r\nYou are in the middle of the beanstalk, breathing heavily.",
      "EditableFormat": "markdown",
      "HTML": "<p>What would you like to do? Type instructions in the space below.<br>\nType help for play options and more information.</p>\n<p>&gt; panes<br>\nThe game panes are now visible on the right. Type panes again to hide them.</p>\n<p>&gt; beantest</p>\n<p>&gt; open kit<br>\nYou open it.<br>\nIt contains a bean, a compliments slip (on which there is dust) and growing instructions.</p>\n<p>&gt; get bean<br>\nYou make your way slowly up the outside foliage.</p>\n<p>You are in the middle of the beanstalk, breathing heavily.</p>\n\n",
      "PostDate": "2018-05-20T15:47:26.0329592Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "dc429a97-9fe5-41c1-b2cb-b831e12126bc",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> drop the Beanstalk Kit in the garden and then type 'take all'.\r\n\r\nAre you moving me to the beanstalk when I try to take it???",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>drop the Beanstalk Kit in the garden and then type 'take all'.</p>\n</blockquote>\n<p>Are you moving me to the beanstalk when I try to take it???</p>\n\n",
      "PostDate": "2018-05-20T15:49:49.5043356Z",
      "LastEditDate": "2018-05-20T16:04:44.2223115Z",
      "link": null
    },
    {
      "PostId": "e9797b78-93e5-44e3-b666-62ead383603c",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "TAKE BEANSTALK is the same as CLIMB BEANSTALK\r\n\r\nThis is a problem in this scene (although I have done it with stairs in my game, there was no worry about similarly named items in the rooms with the stairs).\r\n\r\n---\r\n\\> take all\r\ngiant beanstalk: You are in the middle of the beanstalk, breathing heavily.\r\nBeanstalk Kit: Garden is not open.\r\n\r\n\r\n---\r\nFirst it takes the beanstalk, which moves me to the beanstalk.\r\n\r\nThen, it tries to take the rest of ALL, but you moved me when I took the beanstalk, so I am now inside of the beanstalk container and I can't reach outside of it to grab the beanstalk kit.",
      "EditableFormat": "markdown",
      "HTML": "<p>TAKE BEANSTALK is the same as CLIMB BEANSTALK</p>\n<p>This is a problem in this scene (although I have done it with stairs in my game, there was no worry about similarly named items in the rooms with the stairs).</p>\n<hr>\n<p>&gt; take all<br>\ngiant beanstalk: You are in the middle of the beanstalk, breathing heavily.<br>\nBeanstalk Kit: Garden is not open.</p>\n<hr>\n<p>First it takes the beanstalk, which moves me to the beanstalk.</p>\n<p>Then, it tries to take the rest of ALL, but you moved me when I took the beanstalk, so I am now inside of the beanstalk container and I can't reach outside of it to grab the beanstalk kit.</p>\n\n",
      "PostDate": "2018-05-20T16:03:38.9737175Z",
      "LastEditDate": "2018-05-20T16:04:08.7169254Z",
      "link": null
    },
    {
      "PostId": "444c3a4a-dcd2-42fb-8f6e-ccd9e76a64ce",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "There is a fix for this in Quest 5.8.\r\n\r\nSet ```not_all``` to true on the beanstalk.\r\n\r\nThat would make this happen:\r\n```\r\nWhat would you like to do? Type instructions in the space below.\r\nType help for play options and more information.\r\n\r\n\r\n> panes\r\nThe game panes are now visible on the right. Type panes again to hide them.\r\n\r\n> beantest\r\n\r\n> drop kit\r\nYou drop it.\r\n\r\n> get all\r\nBeanstalk Kit: You pick it up.\r\n```\r\n\r\n---\r\nYou can add this to your game in full code view to make this work with your stuff:\r\n\r\n```\r\n  <command name=\"take\">\r\n    <pattern>take #object#; get #object#; pick up #object#</pattern>\r\n    <multiple>\r\n      takeList = NewObjectList()\r\n      foreach (obj, ListExclude(ScopeVisibleNotHeldNotScenery(), game.pov)) {\r\n        if (obj.parent = game.pov.parent) {\r\n          list add (takeList, obj)\r\n        }\r\n      }\r\n      return (takeList)\r\n    </multiple>\r\n    <scope>notheld</scope>\r\n    <multipleobjects type=\"script\">\r\n      game.pov.currentcommandpendingobjectscope = NewObjectList()\r\n      objlist = ListExclude(ScopeVisibleNotHeldNotScenery(), game.pov)\r\n      objlist = ListExclude(objlist, FilterByAttribute(objlist,\"not_all\",true))\r\n      foreach (obj, objlist) {\r\n        if (obj.parent = game.pov.parent and not DoesInherit(obj, \"npc_type\")) {\r\n          list add (game.pov.currentcommandpendingobjectscope, obj)\r\n        }\r\n      }\r\n    </multipleobjects>\r\n    <script>\r\n      if (multiple and ListCount(object) = 0) {\r\n        msg (\"Nothing here to take.\")\r\n      }\r\n      else {\r\n        foreach (obj, object) {\r\n          DoTake (obj, multiple)\r\n        }\r\n      }\r\n    </script>\r\n  </command>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>There is a fix for this in Quest 5.8.</p>\n<p>Set <code>not_all</code> to true on the beanstalk.</p>\n<p>That would make this happen:</p>\n<pre><code>What would you like to do? Type instructions in the space below.\nType help for play options and more information.\n\n\n&gt; panes\nThe game panes are now visible on the right. Type panes again to hide them.\n\n&gt; beantest\n\n&gt; drop kit\nYou drop it.\n\n&gt; get all\nBeanstalk Kit: You pick it up.\n</code></pre>\n<hr>\n<p>You can add this to your game in full code view to make this work with your stuff:</p>\n<pre><code>  &lt;command name=\"take\"&gt;\n    &lt;pattern&gt;take #object#; get #object#; pick up #object#&lt;/pattern&gt;\n    &lt;multiple&gt;\n      takeList = NewObjectList()\n      foreach (obj, ListExclude(ScopeVisibleNotHeldNotScenery(), game.pov)) {\n        if (obj.parent = game.pov.parent) {\n          list add (takeList, obj)\n        }\n      }\n      return (takeList)\n    &lt;/multiple&gt;\n    &lt;scope&gt;notheld&lt;/scope&gt;\n    &lt;multipleobjects type=\"script\"&gt;\n      game.pov.currentcommandpendingobjectscope = NewObjectList()\n      objlist = ListExclude(ScopeVisibleNotHeldNotScenery(), game.pov)\n      objlist = ListExclude(objlist, FilterByAttribute(objlist,\"not_all\",true))\n      foreach (obj, objlist) {\n        if (obj.parent = game.pov.parent and not DoesInherit(obj, \"npc_type\")) {\n          list add (game.pov.currentcommandpendingobjectscope, obj)\n        }\n      }\n    &lt;/multipleobjects&gt;\n    &lt;script&gt;\n      if (multiple and ListCount(object) = 0) {\n        msg (\"Nothing here to take.\")\n      }\n      else {\n        foreach (obj, object) {\n          DoTake (obj, multiple)\n        }\n      }\n    &lt;/script&gt;\n  &lt;/command&gt;\n</code></pre>\n\n",
      "PostDate": "2018-05-20T16:05:38.5872448Z",
      "LastEditDate": "2018-05-20T16:11:44.2936475Z",
      "link": null
    },
    {
      "PostId": "ad8d5e8b-67dc-4910-8c85-74a6628ec5ac",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> On top of (i) exact match; (ii) all reachable with string subset, there should be adjustments according to context.\r\n\r\nThis is done by the `scope` attribute of a command.\r\n\r\n> So, in relation to 'take', it can exclude all items in the inventory at the top level though not within containers.\r\n\r\nAt the moment, the take command's `scope` attribute is `\"notheld\"`. In my first post in this thread, I suggested that it should be changed to `\"notheld,contents\"` in order to correctly handle taking items out of containers.\r\n\r\n> Similarly 'drop' can exclude anything not held.\r\n\r\nThe drop command's scope is `inventory`.\r\n\r\n> For other verbs, such as 'use' there is probably no optimisation possible. Interestingly though, 'use bean' seems to pick the 'bean' in the box, as I'm guessing preference is given to objects held.\r\n\r\nThe use command doesn't have a scope, which is equivalent to `\"all\"`. In this case, the bean is chosen because it's the only exact match for what you typed.\r\n\r\n> Someone must know the current algorithm?\r\n\r\nThe \"current algorithm\" is:\r\n1. Objects selected by the command's scope that *exactly* match what the player typed.\r\n2. The special cases \"him\", \"her\", and \"it\"\r\n3. Objects selected by the command's scope that have the player's input as a substring\r\n4. Other visible objects that have the player's input as a substring\r\n\r\nSo the problem you found in your first post is actually 2 problems. The \"take\" command's scope should be `\"notheld,contents\"`, and this algorithm doesn't include a check for objects that exactly match your input but aren't in scope (which should be fixed by the last chunk of code I posted)\r\n\r\n(with regard to the \"take all\" issue, I think I posted a suggestion for how to fix that in another thread a while back. But the `not_all` attribute as KV suggests is a decent workaround)",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>On top of (i) exact match; (ii) all reachable with string subset, there should be adjustments according to context.</p>\n</blockquote>\n<p>This is done by the <code>scope</code> attribute of a command.</p>\n<blockquote>\n<p>So, in relation to 'take', it can exclude all items in the inventory at the top level though not within containers.</p>\n</blockquote>\n<p>At the moment, the take command's <code>scope</code> attribute is <code>\"notheld\"</code>. In my first post in this thread, I suggested that it should be changed to <code>\"notheld,contents\"</code> in order to correctly handle taking items out of containers.</p>\n<blockquote>\n<p>Similarly 'drop' can exclude anything not held.</p>\n</blockquote>\n<p>The drop command's scope is <code>inventory</code>.</p>\n<blockquote>\n<p>For other verbs, such as 'use' there is probably no optimisation possible. Interestingly though, 'use bean' seems to pick the 'bean' in the box, as I'm guessing preference is given to objects held.</p>\n</blockquote>\n<p>The use command doesn't have a scope, which is equivalent to <code>\"all\"</code>. In this case, the bean is chosen because it's the only exact match for what you typed.</p>\n<blockquote>\n<p>Someone must know the current algorithm?</p>\n</blockquote>\n<p>The \"current algorithm\" is:</p>\n<ol>\n<li>Objects selected by the command's scope that <em>exactly</em> match what the player typed.</li>\n<li>The special cases \"him\", \"her\", and \"it\"</li>\n<li>Objects selected by the command's scope that have the player's input as a substring</li>\n<li>Other visible objects that have the player's input as a substring</li>\n</ol>\n<p>So the problem you found in your first post is actually 2 problems. The \"take\" command's scope should be <code>\"notheld,contents\"</code>, and this algorithm doesn't include a check for objects that exactly match your input but aren't in scope (which should be fixed by the last chunk of code I posted)</p>\n<p>(with regard to the \"take all\" issue, I think I posted a suggestion for how to fix that in another thread a while back. But the <code>not_all</code> attribute as KV suggests is a decent workaround)</p>\n\n",
      "PostDate": "2018-05-20T17:29:03.4119354Z",
      "LastEditDate": "2018-05-20T17:39:38.2336693Z",
      "link": null
    },
    {
      "PostId": "baed96ae-bcea-4e70-9db1-f9fa5fedb7ca",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "KV and mrangel, by way of background, in a previous update I added objects for path and road and implemented 'take' to mean 'follow path' or 'follow road'. When I got to the beanstalk I did the same as it is a route up to the castle in the clouds.\r\n\r\nI have no strong feelings about this and am really just flagging it as something that would be nice to sort out in the next release rather than feeling the need to patch my game now. I understood that the 'take all' was failing because the first operation moved the player and glad that the next version of Quest deals with it. If the take order had been different, with the beanstalk last, I would never have noticed!\r\n\r\nThanks for your help as always.",
      "EditableFormat": "markdown",
      "HTML": "<p>KV and mrangel, by way of background, in a previous update I added objects for path and road and implemented 'take' to mean 'follow path' or 'follow road'. When I got to the beanstalk I did the same as it is a route up to the castle in the clouds.</p>\n<p>I have no strong feelings about this and am really just flagging it as something that would be nice to sort out in the next release rather than feeling the need to patch my game now. I understood that the 'take all' was failing because the first operation moved the player and glad that the next version of Quest deals with it. If the take order had been different, with the beanstalk last, I would never have noticed!</p>\n<p>Thanks for your help as always.</p>\n\n",
      "PostDate": "2018-05-20T17:50:37.7758288Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "dd1dc734-054f-47bb-9e65-807cd3065bc5",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "It is already sorted out in the next release, but you'd still have to edit your game and add the attribute ```not_all``` to those objects and set it to true.  You also need to be sure you haven't overridden the ```take``` command, otherwise the changes in Quest 5.8 still won't effect your game.\r\n\r\n...and then you'd have to apply the wearables fix, if applicable.\r\n\r\nIf you cover all of those bases, TAKE ALL will ignore those objects.\r\n\r\n---\r\nTo add that functionality to your current game now, you can follow these simple steps (I tested this on your game):\r\n\r\n\r\nhttp://textadventures.co.uk/forum/quest/topic/yj-4_poo4ek24ppotxmfqq/one-door-closes-and-another-opens-in-your-face#444c3a4a-dcd2-42fb-8f6e-ccd9e76a64ce\r\n\r\n---\r\nNOTE:\r\n\r\nAny changes in the next release of Quest will not effect published games.  Published games include all of the code from the time they were published, except for C# stuff, playercore.js, desktopplayer.js, player.js, or webplayer.js.",
      "EditableFormat": "markdown",
      "HTML": "<p>It is already sorted out in the next release, but you'd still have to edit your game and add the attribute <code>not_all</code> to those objects and set it to true.  You also need to be sure you haven't overridden the <code>take</code> command, otherwise the changes in Quest 5.8 still won't effect your game.</p>\n<p>...and then you'd have to apply the wearables fix, if applicable.</p>\n<p>If you cover all of those bases, TAKE ALL will ignore those objects.</p>\n<hr>\n<p>To add that functionality to your current game now, you can follow these simple steps (I tested this on your game):</p>\n<p>http://textadventures.co.uk/forum/quest/topic/yj-4_poo4ek24ppotxmfqq/one-door-closes-and-another-opens-in-your-face#444c3a4a-dcd2-42fb-8f6e-ccd9e76a64ce</p>\n<hr>\n<p>NOTE:</p>\n<p>Any changes in the next release of Quest will not effect published games.  Published games include all of the code from the time they were published, except for C# stuff, playercore.js, desktopplayer.js, player.js, or webplayer.js.</p>\n\n",
      "PostDate": "2018-05-20T20:34:00.2028165Z",
      "LastEditDate": "2018-05-20T22:21:53.0442704Z",
      "link": null
    },
    {
      "PostId": "22670663-133b-4e24-936b-927995b3e8eb",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "DavyB,\r\n\r\nI always add a TAKE verb to stairs and paths, too.\r\n\r\nI approve of that verb in those contexts, if that's any consolation to ya'.\r\n\r\nI've been using the ```not_all``` method for quite a few months, and it seems to be the bee's knees.",
      "EditableFormat": "markdown",
      "HTML": "<p>DavyB,</p>\n<p>I always add a TAKE verb to stairs and paths, too.</p>\n<p>I approve of that verb in those contexts, if that's any consolation to ya'.</p>\n<p>I've been using the <code>not_all</code> method for quite a few months, and it seems to be the bee's knees.</p>\n\n",
      "PostDate": "2018-05-20T22:12:47.5824265Z",
      "LastEditDate": "2018-05-23T04:15:30.9988863Z",
      "link": null
    },
    {
      "PostId": "2976697a-a61a-4ac7-8311-b78061f3902b",
      "UserId": 329383,
      "Username": "J_J",
      "AvatarUrl": "https://secure.gravatar.com/avatar/d6dcf2651a8e3cfe546c1fe096981552?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I don't know. You take stairs, but you don't take a ladder, or take a tree. You climb items like these. Changing the verb is an easy fix. If you want to keep take for the beanstock... I'm curious. Are you using the take inventory tab for the beanstock, or do you have you made a separate \"take\" command. I'm assuming that you have it as a command (because of the menu not showing up and because it is overriding the built in take of the bean). To fix this, you just have to add bean as one of the object options in the command. ",
      "EditableFormat": "markdown",
      "HTML": "<p>I don't know. You take stairs, but you don't take a ladder, or take a tree. You climb items like these. Changing the verb is an easy fix. If you want to keep take for the beanstock... I'm curious. Are you using the take inventory tab for the beanstock, or do you have you made a separate \"take\" command. I'm assuming that you have it as a command (because of the menu not showing up and because it is overriding the built in take of the bean). To fix this, you just have to add bean as one of the object options in the command.</p>\n\n",
      "PostDate": "2018-05-21T02:14:43.5410964Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "444b2fa7-ea84-42fd-9f27-0076fd7335e5",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> You take stairs, but you don't take a ladder, or take a tree. You climb items like these.\r\n\r\nWhich is why I only use it for things such as stairs or paths.  (Ha-ha!)",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>You take stairs, but you don't take a ladder, or take a tree. You climb items like these.</p>\n</blockquote>\n<p>Which is why I only use it for things such as stairs or paths.  (Ha-ha!)</p>\n\n",
      "PostDate": "2018-05-21T02:31:11.7183851Z",
      "LastEditDate": "2018-05-21T02:58:28.4408675Z",
      "link": null
    },
    {
      "PostId": "ef6ec5d4-1d29-40fb-aedb-789f199e0182",
      "UserId": 329383,
      "Username": "J_J",
      "AvatarUrl": "https://secure.gravatar.com/avatar/d6dcf2651a8e3cfe546c1fe096981552?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I didn't mean that to sound so pointedly at your comment K.V. \r\nHa.",
      "EditableFormat": "markdown",
      "HTML": "<p>I didn't mean that to sound so pointedly at your comment K.V.<br>\nHa.</p>\n\n",
      "PostDate": "2018-05-21T03:11:50.476653Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2ab1ffe7-ae7e-4641-81e5-03dce07c2d3b",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Oh, no...  I was laughing.",
      "EditableFormat": "markdown",
      "HTML": "<p>Oh, no...  I was laughing.</p>\n\n",
      "PostDate": "2018-05-21T03:29:21.3542674Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a4cd671f-5a51-4967-b845-a93689e1bd96",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Guys, don't let the effect of 'take beanstalk' distract you! If I just indicate that the beanstalk can't be taken with the message \"Are you serious?\" the following probably illustrates the problem more clearly:\r\n```\r\n>open Beanstalk Kit\r\nYou open it.\r\nIt contains a bean, a compliments slip and growing instructions.\r\n\r\n> x bean\r\nIt looks like an ordinary broad bean.\r\n\r\n> take bean\r\nAre you serious?\r\n```\r\nThe issue is Quest selecting the nearby beanstalk rather than the  item I have in a container I've just opened, for which I have given the precise spelling.",
      "EditableFormat": "markdown",
      "HTML": "<p>Guys, don't let the effect of 'take beanstalk' distract you! If I just indicate that the beanstalk can't be taken with the message \"Are you serious?\" the following probably illustrates the problem more clearly:</p>\n<pre><code>&gt;open Beanstalk Kit\nYou open it.\nIt contains a bean, a compliments slip and growing instructions.\n\n&gt; x bean\nIt looks like an ordinary broad bean.\n\n&gt; take bean\nAre you serious?\n</code></pre>\n<p>The issue is Quest selecting the nearby beanstalk rather than the  item I have in a container I've just opened, for which I have given the precise spelling.</p>\n\n",
      "PostDate": "2018-05-21T05:58:45.3519162Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "b19271dc-f557-4c7e-a145-819c39a924fa",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "There is something weird there. I just tried a quick test, and it works as expected for me (even with bean set to scenery). When I set the alias of bean to \"broad bean\" I got asked which bean I wanted to take, so cannot imagine what is going on there.",
      "EditableFormat": "markdown",
      "HTML": "<p>There is something weird there. I just tried a quick test, and it works as expected for me (even with bean set to scenery). When I set the alias of bean to \"broad bean\" I got asked which bean I wanted to take, so cannot imagine what is going on there.</p>\n\n",
      "PostDate": "2018-05-21T10:01:36.523281Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "32ada3c5-7e0c-4afc-b45f-389eb50c1321",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "You have the kit. The bean is in the kit (held).\r\n\r\nYou say take bean. Quest looks for notheld, finds beanstalk.",
      "EditableFormat": "markdown",
      "HTML": "<p>You have the kit. The bean is in the kit (held).</p>\n<p>You say take bean. Quest looks for notheld, finds beanstalk.</p>\n\n",
      "PostDate": "2018-05-21T11:03:35.8353724Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
