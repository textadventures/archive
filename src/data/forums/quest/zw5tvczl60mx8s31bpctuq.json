{
  "Topic": {
    "TopicId": "zw5tvczl60mx8s31bpctuq",
    "ForumId": "10",
    "Title": "Turn Script to spawn monsters",
    "LastUpdated": "2017-10-26T13:32:50.6988516Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "2231ad47-399b-4370-8755-bd08cf93ceee",
      "UserId": 267336,
      "Username": "jmnevil54",
      "AvatarUrl": "https://secure.gravatar.com/avatar/5d73d7ec1dbe20a5cb46f02a6d53f187?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "So I need help with this.\r\n\r\nThis is my turn script.\r\n\r\n```\r\nmsg (\"You did something.\")\r\nif (game.spawn = true) {\r\n  game.spawncount = game.spawncount + 1\r\n}\r\nif (game.spawncount >= 5) {\r\n  OnEnterRoom (SpawnZombie (this))\r\n}\r\n```\r\nI suppose I would need to make a new turn script for each monster that spawns in a room.\r\n\r\nI don't know how to make this spawn a monster in every room.\r\n\r\nBasically what I'm trying to do is, to make the monster spawn after 5 turns pass, the player enters the room, and  game.spawn = false.\r\n\r\ngame.spawncount counts the turns, in this case 5.\r\n\r\ngame.spawn is used to make sure the player isn't stuck in an infinite monster loop, since I teleport the player to a different room for the battle.\r\n\r\nSpawnZombie (this) is the function to spawn a monster, and the parameter is this.",
      "EditableFormat": "markdown",
      "HTML": "<p>So I need help with this.</p>\n<p>This is my turn script.</p>\n<pre><code>msg (\"You did something.\")\nif (game.spawn = true) {\n  game.spawncount = game.spawncount + 1\n}\nif (game.spawncount &gt;= 5) {\n  OnEnterRoom (SpawnZombie (this))\n}\n</code></pre>\n<p>I suppose I would need to make a new turn script for each monster that spawns in a room.</p>\n<p>I don't know how to make this spawn a monster in every room.</p>\n<p>Basically what I'm trying to do is, to make the monster spawn after 5 turns pass, the player enters the room, and  game.spawn = false.</p>\n<p>game.spawncount counts the turns, in this case 5.</p>\n<p>game.spawn is used to make sure the player isn't stuck in an infinite monster loop, since I teleport the player to a different room for the battle.</p>\n<p>SpawnZombie (this) is the function to spawn a monster, and the parameter is this.</p>\n\n",
      "PostDate": "2017-10-26T13:32:50.6988516Z",
      "LastEditDate": "2017-10-26T13:33:21.4884456Z",
      "link": null
    },
    {
      "PostId": "f02d4564-3c71-407a-98fc-25d0fffbdbd2",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "OK... tying to work out how this works.\r\n\r\nIf you've reached 5 turns, your script:\r\n1. Runs the function `SpawnZombie`, passing it a single parameter (the turnscript object)\r\n2. Runs the \"on exit\" script for the room returned by SpawnZombie\r\n3. Runs the \"on enter\" scripts, and shows the description for, the room the player is currently in\r\n\r\nIs that what it's supposed to do?\r\n\r\nI can think of a few things you might want the turnscript to do. I think from when I looked at your code previously, you've got a room's onenter script teleporting them to a battle room to fight. So I assume you want the turnscript to set that onenter script on some room. But which room?\r\n\r\n* The room the player is currently in?\r\n* The next room they enter?\r\n* Every room?\r\n* Every room with a certain attribute?\r\n* A randomly selected room?\r\n* A randomly selected room with a certain attribute?",
      "EditableFormat": "markdown",
      "HTML": "<p>OK... tying to work out how this works.</p>\n<p>If you've reached 5 turns, your script:</p>\n<ol>\n<li>Runs the function <code>SpawnZombie</code>, passing it a single parameter (the turnscript object)</li>\n<li>Runs the \"on exit\" script for the room returned by SpawnZombie</li>\n<li>Runs the \"on enter\" scripts, and shows the description for, the room the player is currently in</li>\n</ol>\n<p>Is that what it's supposed to do?</p>\n<p>I can think of a few things you might want the turnscript to do. I think from when I looked at your code previously, you've got a room's onenter script teleporting them to a battle room to fight. So I assume you want the turnscript to set that onenter script on some room. But which room?</p>\n<ul>\n<li>The room the player is currently in?</li>\n<li>The next room they enter?</li>\n<li>Every room?</li>\n<li>Every room with a certain attribute?</li>\n<li>A randomly selected room?</li>\n<li>A randomly selected room with a certain attribute?</li>\n</ul>\n\n",
      "PostDate": "2017-10-26T14:23:57.9418777Z",
      "LastEditDate": "2017-10-26T14:35:53.7651394Z",
      "link": null
    },
    {
      "PostId": "7aba9f61-d78e-47f7-9b68-00e713bf8d8d",
      "UserId": 267336,
      "Username": "jmnevil54",
      "AvatarUrl": "https://secure.gravatar.com/avatar/5d73d7ec1dbe20a5cb46f02a6d53f187?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I select the rooms. But you pretty much got the rest covered.",
      "EditableFormat": "markdown",
      "HTML": "<p>I select the rooms. But you pretty much got the rest covered.</p>\n\n",
      "PostDate": "2017-10-26T14:45:03.1134893Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "c1698219-e7e7-45bd-b992-6fc71b3b5af7",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "As an example (and looking at the last version of your game I've seen), this turnscript should spawn a zombie in a room picked randomly from a list:\r\n```\r\nmsg (\"You did something.\")\r\nif (game.spawn = true) {\r\n  game.spawncount = game.spawncount + 1\r\n  if ((game.spawncount % 5) = 0) {\r\n    // This line picks a random room from those listed; change it if that's not the behaviour you want\r\n    some_room = GetObject(PickOneString(Split(\"room;Hell 1;Hell 2;Fuck 3\",\";\")))\r\n    some_room.enter => {\r\n      SpawnZombie (this)\r\n      this.enter = null\r\n    }\r\n  }\r\n}\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>As an example (and looking at the last version of your game I've seen), this turnscript should spawn a zombie in a room picked randomly from a list:</p>\n<pre><code>msg (\"You did something.\")\nif (game.spawn = true) {\n  game.spawncount = game.spawncount + 1\n  if ((game.spawncount % 5) = 0) {\n    // This line picks a random room from those listed; change it if that's not the behaviour you want\n    some_room = GetObject(PickOneString(Split(\"room;Hell 1;Hell 2;Fuck 3\",\";\")))\n    some_room.enter =&gt; {\n      SpawnZombie (this)\n      this.enter = null\n    }\n  }\n}\n</code></pre>\n\n",
      "PostDate": "2017-10-26T14:53:25.0997046Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "9213a0b9-c179-49aa-bf6d-eb95f908c216",
      "UserId": 267336,
      "Username": "jmnevil54",
      "AvatarUrl": "https://secure.gravatar.com/avatar/5d73d7ec1dbe20a5cb46f02a6d53f187?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Well... I was thinking that the turn script would work for almost all the rooms, like Enpherdaen's.\r\n\r\nI asked if I could see his code, but he hasn't responded yet.",
      "EditableFormat": "markdown",
      "HTML": "<p>Well... I was thinking that the turn script would work for almost all the rooms, like Enpherdaen's.</p>\n<p>I asked if I could see his code, but he hasn't responded yet.</p>\n\n",
      "PostDate": "2017-10-26T14:56:24.4244255Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "4ae5b2d5-3b16-455e-8f79-c32d9b431c1f",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "So ... after 5 turns, a zombie spawns in every room? Or a room that contains a zombie spawns another one 5 turns after you kill the first?\r\n\r\n**option 1**: Every 5 turns, spawn a zombie in every room that doesn't have one (from a list in the turnscript):\r\n```\r\nif (HasObject (game.pov, \"currentcommandpattern\")) {\r\n  if (game.spawn = true) {\r\n    game.spawncount = game.spawncount + 1\r\n    if ((game.spawncount % 5) = 0) {\r\n      foreach (roomname, Split(\"room;Hell 1;Hell 2;Fuck 3\",\";\")) {\r\n        room = GetObject(roomname)\r\n        room.beforeenter => {\r\n          SpawnZombie (this)\r\n          this.beforeenter = null\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**option 2**: Spawn a zombie in each room 5 turns after you killed the last one. A simpler turnscript:\r\n```\r\nif (game.spawn = true) {\r\n  foreach (room, AllObjects()) {\r\n    if (HasInt(room, \"spawncount\")) {\r\n      room.spawncount = room.spawncount + 1\r\n    }\r\n  }\r\n}        \r\n```\r\nand the 'beforeenter' script for zombie rooms becomes:\r\n```\r\nfirsttime {\r\n  // There's already a zombie here the first time\r\n  this.spawncount = 5\r\n}\r\nif (this.spawncount >= 5) {\r\n  this.spawncount = 0\r\n  SpawnZombie (this)\r\n}\r\n```\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>So ... after 5 turns, a zombie spawns in every room? Or a room that contains a zombie spawns another one 5 turns after you kill the first?</p>\n<p><strong>option 1</strong>: Every 5 turns, spawn a zombie in every room that doesn't have one (from a list in the turnscript):</p>\n<pre><code>if (HasObject (game.pov, \"currentcommandpattern\")) {\n  if (game.spawn = true) {\n    game.spawncount = game.spawncount + 1\n    if ((game.spawncount % 5) = 0) {\n      foreach (roomname, Split(\"room;Hell 1;Hell 2;Fuck 3\",\";\")) {\n        room = GetObject(roomname)\n        room.beforeenter =&gt; {\n          SpawnZombie (this)\n          this.beforeenter = null\n        }\n      }\n    }\n  }\n}\n</code></pre>\n<p><strong>option 2</strong>: Spawn a zombie in each room 5 turns after you killed the last one. A simpler turnscript:</p>\n<pre><code>if (game.spawn = true) {\n  foreach (room, AllObjects()) {\n    if (HasInt(room, \"spawncount\")) {\n      room.spawncount = room.spawncount + 1\n    }\n  }\n}        \n</code></pre>\n<p>and the 'beforeenter' script for zombie rooms becomes:</p>\n<pre><code>firsttime {\n  // There's already a zombie here the first time\n  this.spawncount = 5\n}\nif (this.spawncount &gt;= 5) {\n  this.spawncount = 0\n  SpawnZombie (this)\n}\n</code></pre>\n\n",
      "PostDate": "2017-10-26T15:14:04.2989531Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "7ac44277-9a7d-4e56-8f5f-319c0f82ab2e",
      "UserId": 267336,
      "Username": "jmnevil54",
      "AvatarUrl": "https://secure.gravatar.com/avatar/5d73d7ec1dbe20a5cb46f02a6d53f187?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thanks! I'll try option 2!",
      "EditableFormat": "markdown",
      "HTML": "<p>Thanks! I'll try option 2!</p>\n\n",
      "PostDate": "2017-10-26T15:38:55.5450393Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "6de34eff-3cdd-4bf0-891f-610a0b60df99",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Like the one I did for Enpherdaen; the turnscript does the minimum work possible, just incrementing the counter so that each room's enter script can check the number. That means that you can adjust the number in each room, to make some rooms take longer than others to spawn; or have some rooms call a different function instead of SpawnZombie so that they spawn different monsters.\r\n\r\nIn the 'option 1' script I wrapped the turnscript up in `if (HasObject (game.pov, \"currentcommandpattern\")) {`, which should stop it from counting turns where the player made a typo or entered something Quest doesn't understand. Not sure if you want to include that or not.",
      "EditableFormat": "markdown",
      "HTML": "<p>Like the one I did for Enpherdaen; the turnscript does the minimum work possible, just incrementing the counter so that each room's enter script can check the number. That means that you can adjust the number in each room, to make some rooms take longer than others to spawn; or have some rooms call a different function instead of SpawnZombie so that they spawn different monsters.</p>\n<p>In the 'option 1' script I wrapped the turnscript up in <code>if (HasObject (game.pov, \"currentcommandpattern\")) {</code>, which should stop it from counting turns where the player made a typo or entered something Quest doesn't understand. Not sure if you want to include that or not.</p>\n\n",
      "PostDate": "2017-10-26T15:52:48.5947997Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
