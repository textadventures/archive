{
  "Topic": {
    "TopicId": "abpbhrmdnuumeqf3mvyrbg",
    "ForumId": "10",
    "Title": "[SOLVED] Room Description Scripts and inroomdescription problem",
    "LastUpdated": "2021-05-11T00:57:34.7160036Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "0e0767b6-c876-4701-b482-75290ddfe55f",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Yeah, I'm messing stuff up!  What up?  That's how I roll!  That's how I learn! Nawmean!?!?\r\n\r\nNow, I admittedly have numerous modified functions in this project, so it may be some of my code in some other part of the game messing with me. So, I'll ask this way:\r\n\r\nIs there something that causes Quest to bypass the ```inroomdescription``` stuff when the room has a ```description``` script rather than a string?\r\n\r\nOr have I messed something else up somewhere?",
      "EditableFormat": "markdown",
      "HTML": "<p>Yeah, I'm messing stuff up!  What up?  That's how I roll!  That's how I learn! Nawmean!?!?</p>\n<p>Now, I admittedly have numerous modified functions in this project, so it may be some of my code in some other part of the game messing with me. So, I'll ask this way:</p>\n<p>Is there something that causes Quest to bypass the <code>inroomdescription</code> stuff when the room has a <code>description</code> script rather than a string?</p>\n<p>Or have I messed something else up somewhere?</p>\n\n",
      "PostDate": "2021-05-11T00:57:34.7160036Z",
      "LastEditDate": "2021-05-11T02:16:32.3286484Z",
      "link": null
    },
    {
      "PostId": "4dc63f6a-b7da-4f90-b35e-a9437ef1351e",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I got it working (after much head-scratching).\r\n\r\nI don't know if it was my modified code or not. If not, I'll be back with the information.",
      "EditableFormat": "markdown",
      "HTML": "<p>I got it working (after much head-scratching).</p>\n<p>I don't know if it was my modified code or not. If not, I'll be back with the information.</p>\n\n",
      "PostDate": "2021-05-11T01:57:08.8568883Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "169b12fd-8dec-4c30-abb9-c6102bbb0fff",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "This works as expected. It doesn't say \"You can see...\" because the only object in the room is the doohickey, and it is scenery.\r\n\r\nIt also prints \"There is a strange doohickey here.\", as expected.\r\n\r\n```\r\n<!--Saved by Quest 5.8.7753.35184-->\r\n<asl version=\"580\">\r\n  <include ref=\"English.aslx\" />\r\n  <include ref=\"Core.aslx\" />\r\n  <game name=\"inroomdescription_vs_description_script\">\r\n    <gameid>2c52fb76-321c-4604-9472-cc63b832f071</gameid>\r\n    <version>1.0</version>\r\n    <firstpublished>2021</firstpublished>\r\n    <appendobjectdescription />\r\n  </game>\r\n  <object name=\"room\">\r\n    <inherit name=\"editor_room\" />\r\n    <isroom />\r\n    <description>The room has a BS description.</description>\r\n    <object name=\"player\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"editor_player\" />\r\n    </object>\r\n    <object name=\"doohickey\">\r\n      <inherit name=\"editor_object\" />\r\n      <take />\r\n      <inroomdescription><![CDATA[{if doohickey.scenery:<br/>There is a strange doohickey here.}]]></inroomdescription>\r\n      <scenery />\r\n    </object>\r\n  </object>\r\n</asl>\r\n```\r\n\r\n---\r\n![image](https://user-images.githubusercontent.com/30656341/117747272-768b7980-b1d3-11eb-8fed-7f2c2c05e2b6.png)\r\n\r\n---\r\n### BUT\r\n\r\nIf I change the room ```description``` to a script, it no longer prints the doohickey's ```inroomdescription```.\r\n\r\n```\r\n<!--Saved by Quest 5.8.7753.35184-->\r\n<asl version=\"580\">\r\n  <include ref=\"English.aslx\" />\r\n  <include ref=\"Core.aslx\" />\r\n  <game name=\"inroomdescription_vs_description_script\">\r\n    <gameid>2c52fb76-321c-4604-9472-cc63b832f071</gameid>\r\n    <version>1.0</version>\r\n    <firstpublished>2021</firstpublished>\r\n    <appendobjectdescription />\r\n  </game>\r\n  <object name=\"room\">\r\n    <inherit name=\"editor_room\" />\r\n    <isroom />\r\n    <description type=\"script\">\r\n      msg (\"This description sucks, and it is printed via description script.\")\r\n    </description>\r\n    <object name=\"player\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"editor_player\" />\r\n    </object>\r\n    <object name=\"doohickey\">\r\n      <inherit name=\"editor_object\" />\r\n      <take />\r\n      <inroomdescription><![CDATA[{if doohickey.scenery:<br/>There is a strange doohickey here.}]]></inroomdescription>\r\n      <scenery />\r\n    </object>\r\n  </object>\r\n</asl>\r\n```\r\n\r\n---\r\n![image](https://user-images.githubusercontent.com/30656341/117747433-c66a4080-b1d3-11eb-9a94-6fe08ab90590.png)",
      "EditableFormat": "markdown",
      "HTML": "<p>This works as expected. It doesn't say \"You can see...\" because the only object in the room is the doohickey, and it is scenery.</p>\n<p>It also prints \"There is a strange doohickey here.\", as expected.</p>\n<pre><code>&lt;!--Saved by Quest 5.8.7753.35184--&gt;\n&lt;asl version=\"580\"&gt;\n  &lt;include ref=\"English.aslx\" /&gt;\n  &lt;include ref=\"Core.aslx\" /&gt;\n  &lt;game name=\"inroomdescription_vs_description_script\"&gt;\n    &lt;gameid&gt;2c52fb76-321c-4604-9472-cc63b832f071&lt;/gameid&gt;\n    &lt;version&gt;1.0&lt;/version&gt;\n    &lt;firstpublished&gt;2021&lt;/firstpublished&gt;\n    &lt;appendobjectdescription /&gt;\n  &lt;/game&gt;\n  &lt;object name=\"room\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;isroom /&gt;\n    &lt;description&gt;The room has a BS description.&lt;/description&gt;\n    &lt;object name=\"player\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"editor_player\" /&gt;\n    &lt;/object&gt;\n    &lt;object name=\"doohickey\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;take /&gt;\n      &lt;inroomdescription&gt;&lt;![CDATA[{if doohickey.scenery:&lt;br/&gt;There is a strange doohickey here.}]]&gt;&lt;/inroomdescription&gt;\n      &lt;scenery /&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n&lt;/asl&gt;\n</code></pre>\n<hr>\n<p><img src=\"https://user-images.githubusercontent.com/30656341/117747272-768b7980-b1d3-11eb-8fed-7f2c2c05e2b6.png\" alt=\"image\"></p>\n<hr>\n<h3>BUT</h3>\n<p>If I change the room <code>description</code> to a script, it no longer prints the doohickey's <code>inroomdescription</code>.</p>\n<pre><code>&lt;!--Saved by Quest 5.8.7753.35184--&gt;\n&lt;asl version=\"580\"&gt;\n  &lt;include ref=\"English.aslx\" /&gt;\n  &lt;include ref=\"Core.aslx\" /&gt;\n  &lt;game name=\"inroomdescription_vs_description_script\"&gt;\n    &lt;gameid&gt;2c52fb76-321c-4604-9472-cc63b832f071&lt;/gameid&gt;\n    &lt;version&gt;1.0&lt;/version&gt;\n    &lt;firstpublished&gt;2021&lt;/firstpublished&gt;\n    &lt;appendobjectdescription /&gt;\n  &lt;/game&gt;\n  &lt;object name=\"room\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;isroom /&gt;\n    &lt;description type=\"script\"&gt;\n      msg (\"This description sucks, and it is printed via description script.\")\n    &lt;/description&gt;\n    &lt;object name=\"player\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"editor_player\" /&gt;\n    &lt;/object&gt;\n    &lt;object name=\"doohickey\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;take /&gt;\n      &lt;inroomdescription&gt;&lt;![CDATA[{if doohickey.scenery:&lt;br/&gt;There is a strange doohickey here.}]]&gt;&lt;/inroomdescription&gt;\n      &lt;scenery /&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n&lt;/asl&gt;\n</code></pre>\n<hr>\n<p><img src=\"https://user-images.githubusercontent.com/30656341/117747433-c66a4080-b1d3-11eb-9a94-6fe08ab90590.png\" alt=\"image\"></p>\n\n",
      "PostDate": "2021-05-11T02:08:11.3204208Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "9e69a38c-bd83-4fe4-a94f-2cadf96ed757",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "## The Fix\r\n\r\nNow, I don't know if everyone expects the in room descriptions on objects to print whether or not the room description is a string or a script attribute, but I expect them to print either way.\r\n\r\nSo, I modified ```ShowRoomDescription``` in two places, which I have comments above in this code:\r\n\r\n```\r\n<!--Saved by Quest 5.8.7753.35184-->\r\n<asl version=\"580\">\r\n  <include ref=\"English.aslx\" />\r\n  <include ref=\"Core.aslx\" />\r\n  <game name=\"inroomdescription_vs_description_script\">\r\n    <gameid>2c52fb76-321c-4604-9472-cc63b832f071</gameid>\r\n    <version>1.0</version>\r\n    <firstpublished>2021</firstpublished>\r\n    <appendobjectdescription />\r\n  </game>\r\n  <object name=\"room\">\r\n    <inherit name=\"editor_room\" />\r\n    <isroom />\r\n    <description type=\"script\">\r\n      OutputTextNoBr (\"This description sucks, and it is printed via description script.\")\r\n    </description>\r\n    <object name=\"player\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"editor_player\" />\r\n    </object>\r\n    <object name=\"doohickey\">\r\n      <inherit name=\"editor_object\" />\r\n      <take />\r\n      <inroomdescription><![CDATA[{if doohickey.scenery:<br/>There is a strange doohickey here.}]]></inroomdescription>\r\n      <scenery />\r\n    </object>\r\n  </object>\r\n  <function name=\"ShowRoomDescription\"><![CDATA[\r\n    isDark = CheckDarkness()\r\n    if (isDark) {\r\n      descriptionfield = \"darkroomdescription\"\r\n    }\r\n    else {\r\n      descriptionfield = \"description\"\r\n    }\r\n    if (game.autodescription) {\r\n      desc = \"\"\r\n      for (i, 1, 4) {\r\n        if (i = game.autodescription_youarein) {\r\n          if (game.autodescription_youarein_useprefix) {\r\n            youarein = game.pov.parent.descprefix\r\n            desc = AddDescriptionLine (desc, youarein + \" \" + GetDisplayName(game.pov.parent) + \".\")\r\n          }\r\n          else {\r\n            desc = AddDescriptionLine (desc, \"<b>\" + CapFirst(GetDisplayName(game.pov.parent)) + \"</b>\")\r\n          }\r\n          if (game.autodescription_youarein_newline) {\r\n            msg (desc + \"<br/>\")\r\n            desc = \"\"\r\n          }\r\n        }\r\n        if (i = game.autodescription_youcansee) {\r\n          objects = FormatObjectList(game.pov.parent.objectslistprefix, GetNonTransparentParent(game.pov.parent), Template(\"And\"), \".\")\r\n          desc = AddDescriptionLine(desc, objects)\r\n          if (game.autodescription_youcansee_newline) {\r\n            msg (desc + \"<br/>\")\r\n            desc = \"\"\r\n          }\r\n        }\r\n        if (i = game.autodescription_youcango) {\r\n          exits = FormatExitList(game.pov.parent.exitslistprefix, GetExitsList(), Template(\"Or\"), \".\")\r\n          desc = AddDescriptionLine(desc, exits)\r\n          if (game.autodescription_youcango_newline) {\r\n            msg (desc + \"<br/>\")\r\n            desc = \"\"\r\n          }\r\n        }\r\n        if (i = game.autodescription_description) {\r\n          if (HasScript(game.pov.parent, descriptionfield)) {\r\n            if (LengthOf(desc) > 0) {\r\n              msg (desc)\r\n              desc = \"\"\r\n            }\r\n            do (game.pov.parent, descriptionfield)\r\n            // NEXT LINE ADDED BY KV 2021.05.10\r\n            msg (GetRoomDescription())\r\n            if (game.autodescription_description_newline) {\r\n              msg (\"\")\r\n            }\r\n          }\r\n          else {\r\n            desc = AddDescriptionLine(desc, GetRoomDescription())\r\n            if (game.autodescription_description_newline) {\r\n              msg (desc + \"<br/>\")\r\n              desc = \"\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (LengthOf(desc) > 0) {\r\n        msg (desc)\r\n      }\r\n    }\r\n    else {\r\n      if (HasScript(game.pov.parent, descriptionfield)) {\r\n        do (game.pov.parent, descriptionfield)\r\n        // NEXT LINE ADDED BY KV 2021.05.10\r\n        msg (GetRoomDescription())\r\n      }\r\n      else {\r\n        fulldesc = GetRoomDescription()\r\n        if (LengthOf(fulldesc) > 0) {\r\n          msg (fulldesc)\r\n        }\r\n      }\r\n    }\r\n  ]]></function>\r\n</asl>\r\n```\r\n\r\n---\r\n![image](https://user-images.githubusercontent.com/30656341/117747984-cf0f4680-b1d4-11eb-9cf3-8a5ee51b2097.png)",
      "EditableFormat": "markdown",
      "HTML": "<h2>The Fix</h2>\n<p>Now, I don't know if everyone expects the in room descriptions on objects to print whether or not the room description is a string or a script attribute, but I expect them to print either way.</p>\n<p>So, I modified <code>ShowRoomDescription</code> in two places, which I have comments above in this code:</p>\n<pre><code>&lt;!--Saved by Quest 5.8.7753.35184--&gt;\n&lt;asl version=\"580\"&gt;\n  &lt;include ref=\"English.aslx\" /&gt;\n  &lt;include ref=\"Core.aslx\" /&gt;\n  &lt;game name=\"inroomdescription_vs_description_script\"&gt;\n    &lt;gameid&gt;2c52fb76-321c-4604-9472-cc63b832f071&lt;/gameid&gt;\n    &lt;version&gt;1.0&lt;/version&gt;\n    &lt;firstpublished&gt;2021&lt;/firstpublished&gt;\n    &lt;appendobjectdescription /&gt;\n  &lt;/game&gt;\n  &lt;object name=\"room\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;isroom /&gt;\n    &lt;description type=\"script\"&gt;\n      OutputTextNoBr (\"This description sucks, and it is printed via description script.\")\n    &lt;/description&gt;\n    &lt;object name=\"player\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"editor_player\" /&gt;\n    &lt;/object&gt;\n    &lt;object name=\"doohickey\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;take /&gt;\n      &lt;inroomdescription&gt;&lt;![CDATA[{if doohickey.scenery:&lt;br/&gt;There is a strange doohickey here.}]]&gt;&lt;/inroomdescription&gt;\n      &lt;scenery /&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n  &lt;function name=\"ShowRoomDescription\"&gt;&lt;![CDATA[\n    isDark = CheckDarkness()\n    if (isDark) {\n      descriptionfield = \"darkroomdescription\"\n    }\n    else {\n      descriptionfield = \"description\"\n    }\n    if (game.autodescription) {\n      desc = \"\"\n      for (i, 1, 4) {\n        if (i = game.autodescription_youarein) {\n          if (game.autodescription_youarein_useprefix) {\n            youarein = game.pov.parent.descprefix\n            desc = AddDescriptionLine (desc, youarein + \" \" + GetDisplayName(game.pov.parent) + \".\")\n          }\n          else {\n            desc = AddDescriptionLine (desc, \"&lt;b&gt;\" + CapFirst(GetDisplayName(game.pov.parent)) + \"&lt;/b&gt;\")\n          }\n          if (game.autodescription_youarein_newline) {\n            msg (desc + \"&lt;br/&gt;\")\n            desc = \"\"\n          }\n        }\n        if (i = game.autodescription_youcansee) {\n          objects = FormatObjectList(game.pov.parent.objectslistprefix, GetNonTransparentParent(game.pov.parent), Template(\"And\"), \".\")\n          desc = AddDescriptionLine(desc, objects)\n          if (game.autodescription_youcansee_newline) {\n            msg (desc + \"&lt;br/&gt;\")\n            desc = \"\"\n          }\n        }\n        if (i = game.autodescription_youcango) {\n          exits = FormatExitList(game.pov.parent.exitslistprefix, GetExitsList(), Template(\"Or\"), \".\")\n          desc = AddDescriptionLine(desc, exits)\n          if (game.autodescription_youcango_newline) {\n            msg (desc + \"&lt;br/&gt;\")\n            desc = \"\"\n          }\n        }\n        if (i = game.autodescription_description) {\n          if (HasScript(game.pov.parent, descriptionfield)) {\n            if (LengthOf(desc) &gt; 0) {\n              msg (desc)\n              desc = \"\"\n            }\n            do (game.pov.parent, descriptionfield)\n            // NEXT LINE ADDED BY KV 2021.05.10\n            msg (GetRoomDescription())\n            if (game.autodescription_description_newline) {\n              msg (\"\")\n            }\n          }\n          else {\n            desc = AddDescriptionLine(desc, GetRoomDescription())\n            if (game.autodescription_description_newline) {\n              msg (desc + \"&lt;br/&gt;\")\n              desc = \"\"\n            }\n          }\n        }\n      }\n      if (LengthOf(desc) &gt; 0) {\n        msg (desc)\n      }\n    }\n    else {\n      if (HasScript(game.pov.parent, descriptionfield)) {\n        do (game.pov.parent, descriptionfield)\n        // NEXT LINE ADDED BY KV 2021.05.10\n        msg (GetRoomDescription())\n      }\n      else {\n        fulldesc = GetRoomDescription()\n        if (LengthOf(fulldesc) &gt; 0) {\n          msg (fulldesc)\n        }\n      }\n    }\n  ]]&gt;&lt;/function&gt;\n&lt;/asl&gt;\n</code></pre>\n<hr>\n<p><img src=\"https://user-images.githubusercontent.com/30656341/117747984-cf0f4680-b1d4-11eb-9cf3-8a5ee51b2097.png\" alt=\"image\"></p>\n\n",
      "PostDate": "2021-05-11T02:15:34.6168383Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
