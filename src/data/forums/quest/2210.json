{
  "Topic": {
    "TopicId": "2210",
    "ForumId": "10",
    "Title": "advanced script command in case a player leaves a room",
    "LastUpdated": "2009-11-12T18:41:40+00:00",
    "ReplyCount": 5
  },
  "Posts": [
    {
      "PostId": "17107",
      "UserId": 0,
      "Username": "oblomov",
      "UserAvatar": null,
      "UserGravatar": "efd78610d1f12e694a045bb983ba2ff4",
      "EditableText": "its a pretty tiny thing, but anyway it would have helped me lots of times allready..\nit allready exists the possibility of an advanced script command in case the player &quot;enters&quot; the room. but there is no option for a script in case the player &quot;leaves&quot; the room..",
      "EditableFormat": "bbcode",
      "HTML": "its a pretty tiny thing, but anyway it would have helped me lots of times allready..<br/>it allready exists the possibility of an advanced script command in case the player &quot;enters&quot; the room. but there is no option for a script in case the player &quot;leaves&quot; the room..",
      "PostDate": "2009-11-11T22:21:39+00:00",
      "LastEditDate": null
    },
    {
      "PostId": "17108",
      "UserId": 0,
      "Username": "Wonderjudge",
      "UserAvatar": null,
      "UserGravatar": "29fd1b3b35ac2ca468be63961f946852",
      "EditableText": "Technically there is because you can script all your exits. Easy to to if you only have one exit, harder with lots.\nWonderjudge.",
      "EditableFormat": "bbcode",
      "HTML": "Technically there is because you can script all your exits. Easy to to if you only have one exit, harder with lots.<br/>Wonderjudge.",
      "PostDate": "2009-11-12T02:32:16+00:00",
      "LastEditDate": null
    },
    {
      "PostId": "17109",
      "UserId": 0,
      "Username": "Alex",
      "UserAvatar": null,
      "UserGravatar": "188b72c5e13327f4fde3989dca7d7d53",
      "EditableText": "An easier solution might be to create an &quot;afterturn&quot; script which sets an &quot;oldroom&quot; variable to the value of #quest.currentroom#.\nCompare these values at the start of your script, and if they're different, see if #oldroom# has a &quot;leaveroom&quot; action - if so, run it. Then you can create a &quot;leaveroom&quot; action for any room which will be run after the player has left it.",
      "EditableFormat": "bbcode",
      "HTML": "An easier solution might be to create an &quot;afterturn&quot; script which sets an &quot;oldroom&quot; variable to the value of #quest.currentroom#.<br/>Compare these values at the start of your script, and if they're different, see if #oldroom# has a &quot;leaveroom&quot; action - if so, run it. Then you can create a &quot;leaveroom&quot; action for any room which will be run after the player has left it.",
      "PostDate": "2009-11-12T13:21:44+00:00",
      "LastEditDate": null
    },
    {
      "PostId": "17110",
      "UserId": 0,
      "Username": "Overcat",
      "UserAvatar": null,
      "UserGravatar": "3958f867d73b44faed6e01f35e74c093",
      "EditableText": "There are three example game files to come.  The first is in this reply.  If anyone has suggestions on how to improve these methods, let us all know!\n\nAs per Alex's suggestion above:\n\n[code:3p6kdjdy]define options\t\n\tdebug on\n\tpanes disabled\nend define\n\ndefine game &lt;AfterLeave&gt;\n\n\tasl-version &lt;410&gt;\n\tgametype singleplayer\n\tstart &lt;Home&gt;\t\n\tgame version &lt;1&#46;0&gt;\n\tgame author &lt;J&#46; Dobson&gt;\n\tgame copyright &lt;© 2009 JDG Inc&#46;&gt;\n\t\n\tbackground &lt;black&gt;\n\tdefault fontname &lt;arial&gt;\n\tdefault fontsize &lt;10&gt;\n\tforeground &lt;White&gt;\n\t\n\t\n\t'Set your 'last room' variable here, equal to the start tag above&#46;\n\tstartscript {\n\t\n\t\tset string &lt;quest&#46;lastroom; Home&gt;\n\t}\n\t\n\t'This script implements the AfterLeave action on a room, if the\n\t'action exists on a room&#46;\n\tafterturn {\n\t\n\t\tif (#quest&#46;currentroom# &lt;&gt; #quest&#46;lastroom#) then {\n\t\t\n\t\t\tif action &lt;#quest&#46;lastroom#; AfterLeave&gt; then {\n\t\t\t\t\n\t\t\t\tdoaction &lt;#quest&#46;lastroom#; AfterLeave&gt;\n\t\t\t}\n\t\t\t\n\t\t\tset &lt;quest&#46;lastroom; #quest&#46;currentroom#&gt;\n\t\t}\n\t}\t\t\n\t\nend define\n\ndefine room &lt;Frontyard&gt;\n\t\n\talias &lt;Frontyard&gt;\n\tlook &lt;You're in your frontyard&#46;&gt;\t\n\t\n\tsouth &lt;Home&gt;\n\t\n\t'This overwrites the default AfterLeave script defined in the 'defaultroom'\n\t'type below&#46;\n\taction &lt;AfterLeave&gt; {\n\t\n\t\tmsg &lt;|n(Over-written AfterLeave script fired for $thisobject$&#46;)&gt;\n\t}\n\t\nend define\n\ndefine room &lt;Home&gt;\n\t\n\talias &lt;Home&gt;\n\tlook &lt;You're home&#46;&gt;\t\t\n\t\n\tnorth &lt;Frontyard&gt;\n\t\n\t'Even though this room does not have it's own AfterLeave action defined,\n\t'it will inherit one from the 'defaultroom' type&#46;  See below&#46;\n\t\nend define\n\n\n'This is the definition for 'defaultroom'&#46;  Anything you define here\n'will automatically be inherited by any other room in your game&#46;  Because\n'the AfterLeave action has been defined here, every room will now have this\n'action, even if you omit this action from any room particular room&#46;\n\ndefine type &lt;defaultroom&gt;\n\n\taction &lt;AfterLeave&gt; {\n\t\n\t\tmsg &lt;|n(Default AfterLeave script fired for $thisobject$)&gt;\n\t}\n\nend define[/code:3p6kdjdy]",
      "EditableFormat": "bbcode",
      "HTML": "There are three example game files to come.  The first is in this reply.  If anyone has suggestions on how to improve these methods, let us all know!<br/><br/>As per Alex's suggestion above:<br/><br/><pre><code>define options\t<br/>\tdebug on<br/>\tpanes disabled<br/>end define<br/><br/>define game &lt;AfterLeave&gt;<br/><br/>\tasl-version &lt;410&gt;<br/>\tgametype singleplayer<br/>\tstart &lt;Home&gt;\t<br/>\tgame version &lt;1&#46;0&gt;<br/>\tgame author &lt;J&#46; Dobson&gt;<br/>\tgame copyright &lt;© 2009 JDG Inc&#46;&gt;<br/>\t<br/>\tbackground &lt;black&gt;<br/>\tdefault fontname &lt;arial&gt;<br/>\tdefault fontsize &lt;10&gt;<br/>\tforeground &lt;White&gt;<br/>\t<br/>\t<br/>\t'Set your 'last room' variable here, equal to the start tag above&#46;<br/>\tstartscript {<br/>\t<br/>\t\tset string &lt;quest&#46;lastroom; Home&gt;<br/>\t}<br/>\t<br/>\t'This script implements the AfterLeave action on a room, if the<br/>\t'action exists on a room&#46;<br/>\tafterturn {<br/>\t<br/>\t\tif (#quest&#46;currentroom# &lt;&gt; #quest&#46;lastroom#) then {<br/>\t\t<br/>\t\t\tif action &lt;#quest&#46;lastroom#; AfterLeave&gt; then {<br/>\t\t\t\t<br/>\t\t\t\tdoaction &lt;#quest&#46;lastroom#; AfterLeave&gt;<br/>\t\t\t}<br/>\t\t\t<br/>\t\t\tset &lt;quest&#46;lastroom; #quest&#46;currentroom#&gt;<br/>\t\t}<br/>\t}\t\t<br/>\t<br/>end define<br/><br/>define room &lt;Frontyard&gt;<br/>\t<br/>\talias &lt;Frontyard&gt;<br/>\tlook &lt;You're in your frontyard&#46;&gt;\t<br/>\t<br/>\tsouth &lt;Home&gt;<br/>\t<br/>\t'This overwrites the default AfterLeave script defined in the 'defaultroom'<br/>\t'type below&#46;<br/>\taction &lt;AfterLeave&gt; {<br/>\t<br/>\t\tmsg &lt;|n(Over-written AfterLeave script fired for $thisobject$&#46;)&gt;<br/>\t}<br/>\t<br/>end define<br/><br/>define room &lt;Home&gt;<br/>\t<br/>\talias &lt;Home&gt;<br/>\tlook &lt;You're home&#46;&gt;\t\t<br/>\t<br/>\tnorth &lt;Frontyard&gt;<br/>\t<br/>\t'Even though this room does not have it's own AfterLeave action defined,<br/>\t'it will inherit one from the 'defaultroom' type&#46;  See below&#46;<br/>\t<br/>end define<br/><br/><br/>'This is the definition for 'defaultroom'&#46;  Anything you define here<br/>'will automatically be inherited by any other room in your game&#46;  Because<br/>'the AfterLeave action has been defined here, every room will now have this<br/>'action, even if you omit this action from any room particular room&#46;<br/><br/>define type &lt;defaultroom&gt;<br/><br/>\taction &lt;AfterLeave&gt; {<br/>\t<br/>\t\tmsg &lt;|n(Default AfterLeave script fired for $thisobject$)&gt;<br/>\t}<br/><br/>end define</code></pre><div><a href=\"/forumattachments/36/AfterLeave.asl\">AfterLeave.asl</a></div>",
      "PostDate": "2009-11-12T18:38:11+00:00",
      "LastEditDate": null
    },
    {
      "PostId": "17111",
      "UserId": 0,
      "Username": "Overcat",
      "UserAvatar": null,
      "UserGravatar": "3958f867d73b44faed6e01f35e74c093",
      "EditableText": "For an example with both BeforeLeave and AfterLeave functionality, see next.  It is assumed that one might want to restrict player movement with BeforeLeave, so it has been built to allow this.\n\n[code:10frhjln]define options\t\n\tdebug on\n\tpanes disabled\nend define\n\ndefine game &lt;BeforeAndAfterLeave&gt;\n\n\tasl-version &lt;410&gt;\n\tgametype singleplayer\n\tstart &lt;Home&gt;\t\n\tgame version &lt;1&#46;0&gt;\n\tgame author &lt;J&#46; Dobson&gt;\n\tgame copyright &lt;© 2009 JDG Inc&#46;&gt;\n\t\n\tbackground &lt;black&gt;\n\tdefault fontname &lt;arial&gt;\n\tdefault fontsize &lt;10&gt;\n\tforeground &lt;White&gt;\t\n\t\n\t'Set your 'last room' variable here, equal to the start tag above&#46;\n\tstartscript {\n\t\n\t\tset string &lt;quest&#46;lastroom; Home&gt;\n\t}\n\t\n\t'This script implements the AfterLeave action on a room\n\t\n\tafterturn {\n\t\n\t\tif (#quest&#46;currentroom# &lt;&gt; #quest&#46;lastroom#) then {\t\t\n\t\t\t\n\t\t\tdoaction &lt;#quest&#46;lastroom#; AfterLeave&gt;\t\t\t\n\t\t\tset &lt;quest&#46;lastroom; #quest&#46;currentroom#&gt;\n\t\t}\n\t}\n\t\n\t'This script implements the BeforeLeave action on a room&#46;\n\tbeforeturn {\n\t\n\t\tselect case &lt;#quest&#46;command#&gt; {\n\t\t\n\t\t\tcase &lt;north; south; west; east; up; down; northwest; northeast; southwest; southeast&gt; {\n\n\t\t\t\tdoaction &lt;#quest&#46;currentroom#; BeforeLeave&gt;\n\t\t\t\tif not property &lt;#quest&#46;currentroom#; isLeavable&gt; then dontprocess\t\t\n\t\t\t}\n\t\t}\t\t\n\t}\n\t\t\t\n\t\nend define\n\n'These synonyms are required in order to make the BeforeLeave functionality\n'effective, even though Quest already understands the short-forms for travel\n'directions&#46;\n\ndefine synonyms\n\n\tn = north\n\ts = south\n\te = east\n\tw = west\n\tu = up\n\td = down\n\tnw = northwest\n\tne = northeast\n\tsw = southwest\n\tse = southeast\n\t\nend define\n\ndefine room &lt;Home&gt;\n\t\n\talias &lt;home&gt;\n\tprefix &lt;your&gt;\n\tlook &lt;You're home&#46;&gt;\t\t\n\t\n\tnorth &lt;Frontyard&gt;\n\t\n\t'Even though this room does not have it's own AfterLeave action defined,\n\t'it will inherit one from the 'defaultroom' type&#46;  See below&#46;\n\t\n\t'Same goes for the BeforeLeave action, which is also inherited&#46;\n\t\nend define\n\ndefine room &lt;Frontyard&gt;\n\t\n\talias &lt;front yard&gt;\n\tprefix &lt;your&gt;\n\tlook &lt;You're in your frontyard&#46;  It's damn cold out here&#46;&gt;\t\n\t\n\tsouth &lt;Home&gt;\n\t\n\tdefine object &lt;apple&gt;\n\t\n\t\ttake\n\t\talias &lt;apple&gt;\n\t\tprefix &lt;an&gt;\n\t\tarticle &lt;it&gt;\n\t\tlook &lt;Yummy&#46;&gt;\n\t\t\n\tend define\n\t\n\t'This overwrites the default BeforeLeave script defined in the 'defaultroom'\n\t'type below&#46;\n\taction &lt;BeforeLeave&gt; {\n\t\n\t\tif here &lt;apple&gt; then {\n\t\t\t\n\t\t\tmsg &lt;You should take the apple before you leave&#46;&gt;\n\t\t\tproperty &lt;$thisobject$; not isLeavable&gt;\n\t\t}\n\t\telse {\n\t\t\tproperty &lt;$thisobject$; isLeavable&gt;\n\t\t}\n\t}\n\t\n\t'This overwrites the default AfterLeave script defined in the 'defaultroom'\n\t'type below&#46;\n\taction &lt;AfterLeave&gt; {\n\t\n\t\tset string &lt;this; $thisobject$&gt;\n\t\tmsg &lt;|n(You've just left #(this)&#58;prefix# #@this#, and thank goodness - it was cold out there!)&gt;\n\t}\n\t\nend define\n\n\n'*****THE DEFAULTROOM TYPE********\n\n\n'This is the definition for 'defaultroom'&#46;  Anything you define here\n'will automatically be inherited by every other room in your game&#46;  For instance,\n'because the AfterLeave action has been defined here, every room will now have \n'this action, even if you do not define this action in any particular room&#46;\n\ndefine type &lt;defaultroom&gt;\n\n\t'isLeavable\n\t\n\taction &lt;BeforeLeave&gt; {\n\t\n\t\tproperty &lt;$thisobject$; isLeavable&gt;\n\t}\n\t\n\taction &lt;AfterLeave&gt; {\n\t\n\t\tset string &lt;this; $thisobject$&gt;\n\t\tmsg &lt;|n(You've just left #(this)&#58;prefix# #@this#&#46;)&gt;\n\t}\n\nend define[/code:10frhjln]",
      "EditableFormat": "bbcode",
      "HTML": "For an example with both BeforeLeave and AfterLeave functionality, see next.  It is assumed that one might want to restrict player movement with BeforeLeave, so it has been built to allow this.<br/><br/><pre><code>define options\t<br/>\tdebug on<br/>\tpanes disabled<br/>end define<br/><br/>define game &lt;BeforeAndAfterLeave&gt;<br/><br/>\tasl-version &lt;410&gt;<br/>\tgametype singleplayer<br/>\tstart &lt;Home&gt;\t<br/>\tgame version &lt;1&#46;0&gt;<br/>\tgame author &lt;J&#46; Dobson&gt;<br/>\tgame copyright &lt;© 2009 JDG Inc&#46;&gt;<br/>\t<br/>\tbackground &lt;black&gt;<br/>\tdefault fontname &lt;arial&gt;<br/>\tdefault fontsize &lt;10&gt;<br/>\tforeground &lt;White&gt;\t<br/>\t<br/>\t'Set your 'last room' variable here, equal to the start tag above&#46;<br/>\tstartscript {<br/>\t<br/>\t\tset string &lt;quest&#46;lastroom; Home&gt;<br/>\t}<br/>\t<br/>\t'This script implements the AfterLeave action on a room<br/>\t<br/>\tafterturn {<br/>\t<br/>\t\tif (#quest&#46;currentroom# &lt;&gt; #quest&#46;lastroom#) then {\t\t<br/>\t\t\t<br/>\t\t\tdoaction &lt;#quest&#46;lastroom#; AfterLeave&gt;\t\t\t<br/>\t\t\tset &lt;quest&#46;lastroom; #quest&#46;currentroom#&gt;<br/>\t\t}<br/>\t}<br/>\t<br/>\t'This script implements the BeforeLeave action on a room&#46;<br/>\tbeforeturn {<br/>\t<br/>\t\tselect case &lt;#quest&#46;command#&gt; {<br/>\t\t<br/>\t\t\tcase &lt;north; south; west; east; up; down; northwest; northeast; southwest; southeast&gt; {<br/><br/>\t\t\t\tdoaction &lt;#quest&#46;currentroom#; BeforeLeave&gt;<br/>\t\t\t\tif not property &lt;#quest&#46;currentroom#; isLeavable&gt; then dontprocess\t\t<br/>\t\t\t}<br/>\t\t}\t\t<br/>\t}<br/>\t\t\t<br/>\t<br/>end define<br/><br/>'These synonyms are required in order to make the BeforeLeave functionality<br/>'effective, even though Quest already understands the short-forms for travel<br/>'directions&#46;<br/><br/>define synonyms<br/><br/>\tn = north<br/>\ts = south<br/>\te = east<br/>\tw = west<br/>\tu = up<br/>\td = down<br/>\tnw = northwest<br/>\tne = northeast<br/>\tsw = southwest<br/>\tse = southeast<br/>\t<br/>end define<br/><br/>define room &lt;Home&gt;<br/>\t<br/>\talias &lt;home&gt;<br/>\tprefix &lt;your&gt;<br/>\tlook &lt;You're home&#46;&gt;\t\t<br/>\t<br/>\tnorth &lt;Frontyard&gt;<br/>\t<br/>\t'Even though this room does not have it's own AfterLeave action defined,<br/>\t'it will inherit one from the 'defaultroom' type&#46;  See below&#46;<br/>\t<br/>\t'Same goes for the BeforeLeave action, which is also inherited&#46;<br/>\t<br/>end define<br/><br/>define room &lt;Frontyard&gt;<br/>\t<br/>\talias &lt;front yard&gt;<br/>\tprefix &lt;your&gt;<br/>\tlook &lt;You're in your frontyard&#46;  It's damn cold out here&#46;&gt;\t<br/>\t<br/>\tsouth &lt;Home&gt;<br/>\t<br/>\tdefine object &lt;apple&gt;<br/>\t<br/>\t\ttake<br/>\t\talias &lt;apple&gt;<br/>\t\tprefix &lt;an&gt;<br/>\t\tarticle &lt;it&gt;<br/>\t\tlook &lt;Yummy&#46;&gt;<br/>\t\t<br/>\tend define<br/>\t<br/>\t'This overwrites the default BeforeLeave script defined in the 'defaultroom'<br/>\t'type below&#46;<br/>\taction &lt;BeforeLeave&gt; {<br/>\t<br/>\t\tif here &lt;apple&gt; then {<br/>\t\t\t<br/>\t\t\tmsg &lt;You should take the apple before you leave&#46;&gt;<br/>\t\t\tproperty &lt;$thisobject$; not isLeavable&gt;<br/>\t\t}<br/>\t\telse {<br/>\t\t\tproperty &lt;$thisobject$; isLeavable&gt;<br/>\t\t}<br/>\t}<br/>\t<br/>\t'This overwrites the default AfterLeave script defined in the 'defaultroom'<br/>\t'type below&#46;<br/>\taction &lt;AfterLeave&gt; {<br/>\t<br/>\t\tset string &lt;this; $thisobject$&gt;<br/>\t\tmsg &lt;|n(You've just left #(this)&#58;prefix# #@this#, and thank goodness - it was cold out there!)&gt;<br/>\t}<br/>\t<br/>end define<br/><br/><br/>'*****THE DEFAULTROOM TYPE********<br/><br/><br/>'This is the definition for 'defaultroom'&#46;  Anything you define here<br/>'will automatically be inherited by every other room in your game&#46;  For instance,<br/>'because the AfterLeave action has been defined here, every room will now have <br/>'this action, even if you do not define this action in any particular room&#46;<br/><br/>define type &lt;defaultroom&gt;<br/><br/>\t'isLeavable<br/>\t<br/>\taction &lt;BeforeLeave&gt; {<br/>\t<br/>\t\tproperty &lt;$thisobject$; isLeavable&gt;<br/>\t}<br/>\t<br/>\taction &lt;AfterLeave&gt; {<br/>\t<br/>\t\tset string &lt;this; $thisobject$&gt;<br/>\t\tmsg &lt;|n(You've just left #(this)&#58;prefix# #@this#&#46;)&gt;<br/>\t}<br/><br/>end define</code></pre><div><a href=\"/forumattachments/40/BeforeAndAfterLeave.asl\">BeforeAndAfterLeave.asl</a></div>",
      "PostDate": "2009-11-12T18:40:00+00:00",
      "LastEditDate": null
    },
    {
      "PostId": "17112",
      "UserId": 0,
      "Username": "Overcat",
      "UserAvatar": null,
      "UserGravatar": "3958f867d73b44faed6e01f35e74c093",
      "EditableText": "And then, because you might as well extend this to the inevitable, see next for an example that gives you BeforeLeave, AfterLeave, BeforeEnter, and AfterEnter functionality.  BeforeEnter has also been built to allow the blocking of player movement, if the game author so wishes.\n\n[code:3sp6p3h8]define options\t\n\tdebug on\n\tpanes disabled\nend define\n\ndefine game &lt;BeforeAndAfterLeave&gt;\n\n\tasl-version &lt;410&gt;\n\tgametype singleplayer\n\tstart &lt;Home&gt;\t\n\tgame version &lt;1&#46;0&gt;\n\tgame author &lt;J&#46; Dobson&gt;\n\tgame copyright &lt;© 2009 JDG Inc&#46;&gt;\n\t\n\tbackground &lt;black&gt;\n\tdefault fontname &lt;arial&gt;\n\tdefault fontsize &lt;10&gt;\n\tforeground &lt;White&gt;\t\n\t\n\t'Initialize your 'last room' variable here, equal to the start tag above&#46;\n\tstartscript {\n\t\n\t\tset string &lt;quest&#46;lastroom; Home&gt;\t\t\n\t}\n\t\n\t'This script implements our own room description formatting, and\n\t'the BeforeEnter, AfterEnter, and AfterLeave actions of a room&#46;\n\tdescription {\n\t\n\t\tif (#quest&#46;lastroom# &lt;&gt; #quest&#46;currentroom#) then {\n\t\t\n\t\t\tdoaction &lt;#quest&#46;currentroom#; BeforeEnter&gt;\n\t\t\tif not property &lt;#quest&#46;currentroom#; isEnterable&gt; then {\n\n\t\t\t\toutputoff\n\t\t\t\tgoto &lt;#quest&#46;lastroom#&gt;\n\t\t\t\toutputon\n\t\t\t}\n\t\t\telse {\t\t\n\t\t\t\n\t\t\t\tdoaction &lt;#quest&#46;lastroom#; AfterLeave&gt;\t\t\t\t\n\t\t\t\tdo &lt;RoomDescription&gt;\t\t\t\t\n\t\t\t\tdoaction &lt;#quest&#46;currentroom#; AfterEnter&gt;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\n\t\t\tdo &lt;RoomDescription&gt;\n\t\t}\n\t}\t\n\t\n\t'This script implements the BeforeLeave action on a room&#46;\n\tbeforeturn {\n\t\n\t\tselect case &lt;#quest&#46;command#&gt; {\n\t\t\n\t\t\tcase &lt;north; south; west; east; up; down; northwest; northeast; southwest; southeast&gt; {\n\n\t\t\t\tdoaction &lt;#quest&#46;currentroom#; BeforeLeave&gt;\n\t\t\t\tif not property &lt;#quest&#46;currentroom#; isLeavable&gt; then dontprocess\t\t\t\t\n\t\t\t}\n\t\t}\t\t\n\t}\n\t\t\t\n\t\nend define\n\n'A procedure to describe rooms&#46;\ndefine procedure &lt;RoomDescription&gt;\n\n\tset &lt;quest&#46;lastroom; #quest&#46;currentroom#&gt;\n\t\t\t\t\n\tmsg &lt;|b|cr$capfirst(#(quest&#46;currentroom)&#58;prefix#)$ $capfirst(#(quest&#46;currentroom)&#58;alias#)$|xb|cb&gt;\t\n\tmsg &lt;&gt;\n\tmsg &lt;#quest&#46;lookdesc#  |xn&gt;\n\t\n\tif ($lengthof(#quest&#46;doorways#)$ &gt; 0) then {\n\t\t\n\t\tmsg &lt;You can go #quest&#46;doorways#&#46;&gt;\n\t}\n\telse {\n\t\tmsg &lt;&gt;\n\t}\n\t\n\tif ($lengthof(#quest&#46;formatobjects#)$ &gt; 0) then {\n\n\t\tmsg &lt;&gt;\n\t\tmsg &lt;You can see #quest&#46;formatobjects#&#46;&gt;\n\t}\n\nend define\n\n'These synonyms are required in order to make the BeforeLeave functionality\n'effective, even though Quest already understands the short-forms for travel\n'directions&#46;\ndefine synonyms\n\n\tn = north\n\ts = south\n\te = east\n\tw = west\n\tu = up\n\td = down\n\tnw = northwest\n\tne = northeast\n\tsw = southwest\n\tse = southeast\n\t\nend define\n\ndefine room &lt;Home&gt;\n\t\n\talias &lt;home&gt;\n\tprefix &lt;your&gt;\n\tlook &lt;You're in the warm comfort of your house&#46;&gt;\t\t\n\t\n\tnorth &lt;Frontyard&gt;\n\t\n\t'Even though this room does not have it's own AfterLeave action defined,\n\t'it will inherit one from the 'defaultroom' type&#46;  See below&#46;\n\t\n\t'Same goes for the BeforeLeave, BeforeEnter, and AfterEnter actions&#46;\n\t\nend define\n\ndefine room &lt;Frontyard&gt;\n\t\n\talias &lt;front yard&gt;\n\tprefix &lt;your&gt;\n\tlook &lt;You're in your frontyard&#46;&gt;\t\n\t\n\tsouth &lt;Home&gt;\n\tnorth &lt;Street&gt;\n\t\n\tdefine object &lt;apple&gt;\n\t\n\t\ttake\n\t\talias &lt;apple&gt;\n\t\tprefix &lt;an&gt;\n\t\tarticle &lt;it&gt;\n\t\tlook &lt;Yummy&#46;&gt;\n\t\t\n\tend define\n\t\n\t'This overwrites the default BeforeEnter script defined in the 'defaultroom'\n\t'type below&#46;\n\taction &lt;BeforeEnter&gt; {\n\n\t\t'If the player has the apple, remove the 'isEnterable' property from this\n\t\t'room, thereby making it non-enterable&#46;  You should message the player\n\t\t'something relevant in this case&#46;\n\t\tif got &lt;apple&gt; then {\n\n\t\t\tmsg &lt;You should leave the apple behind before you go to the front yard&#46;&gt;\n\t\t\tproperty &lt;$thisobject$; not isEnterable&gt;\n\t\t}\n\t\telse {\n\t\t\tproperty &lt;$thisobject$; isEnterable&gt;\n\t\t}\n\t}\n\t\n\t'This overwrites the default AfterEnter script defined in the 'defaultroom'\n\t'type below&#46;\n\taction &lt;AfterEnter&gt; {\n\t\n\t\tmsg &lt;Gosh, it's cold out here&#46;&gt;\n\t}\n\t\n\t'This overwrites the default BeforeLeave script defined in the 'defaultroom'\n\t'type below&#46;\n\taction &lt;BeforeLeave&gt; {\n\t\n\t\t'If the apple here, remove the 'isLeavable' property from this room,\n\t\t'thereby making it non-leave-able&#46;  You should message the player\n\t\t'something relevant in this case&#46;\n\t\tif here &lt;apple&gt; then {\n\t\t\t\n\t\t\tmsg &lt;You should take the apple before you leave&#46;&gt;\n\t\t\tproperty &lt;$thisobject$; not isLeavable&gt;\n\t\t}\n\t\telse {\n\t\t\tproperty &lt;$thisobject$; isLeavable&gt;\n\t\t}\n\t}\n\t\n\t'This overwrites the default AfterLeave script defined in the 'defaultroom'\n\t'type below&#46;\n\taction &lt;AfterLeave&gt; {\n\t\n\t\tset string &lt;this; $thisobject$&gt;\n\t\tmsg &lt;|n(You've just left #(this)&#58;prefix# #@this#, and thank goodness - for it is not a very pretty front yard, and it offends your eyes&#46;)&gt;\n\t}\n\t\nend define\n\ndefine room &lt;Street&gt;\n\n\talias &lt;street&gt;\n\tprefix &lt;the&gt;\n\tlook &lt;You're standing on a barren street&#46;&gt;\t\n\t\n\tsouth &lt;Frontyard&gt;\n\t\n\t'Just like the Home room, this room inherits all of the stuff\n\t'from the 'defaultroom' type definition, directly below&#46;\n\nend define\t\n\n'*****THE DEFAULTROOM TYPE********\n\n\n'This is the definition for 'defaultroom'&#46;  Anything you define here\n'will automatically be inherited by every other room in your game&#46;  For instance,\n'because the AfterLeave action has been defined here, every room will now have \n'this action, even if you do not define this action in any particular room&#46;\n\ndefine type &lt;defaultroom&gt;\n\n\taction &lt;BeforeEnter&gt; {\n\t\n\t\t'The property 'isEnterable' is set on a room by default to indicate\n\t\t'that it is, indeed, enterable&#46;\n\t\tproperty &lt;$thisobject$; isEnterable&gt;\n\t}\n\t\n\taction &lt;AfterEnter&gt; {\n\t\t\n\t\tset string &lt;this; $thisobject$&gt;\n\t\tmsg &lt;|n(You've just entered #(this)&#58;prefix# #@this#&#46;)&gt;\n\t}\n\t\n\taction &lt;BeforeLeave&gt; {\n\t\n\t\t'The property 'isLeavable' is set on a room by default to indicate\n\t\t'that it is, indeed, leave-able&#46;\n\t\tproperty &lt;$thisobject$; isLeavable&gt;\n\t}\n\t\n\taction &lt;AfterLeave&gt; {\n\t\n\t\tset string &lt;this; $thisobject$&gt;\n\t\tmsg &lt;|n(You've just left #(this)&#58;prefix# #@this#&#46;)&gt;\n\t}\n\nend define[/code:3sp6p3h8]",
      "EditableFormat": "bbcode",
      "HTML": "And then, because you might as well extend this to the inevitable, see next for an example that gives you BeforeLeave, AfterLeave, BeforeEnter, and AfterEnter functionality.  BeforeEnter has also been built to allow the blocking of player movement, if the game author so wishes.<br/><br/><pre><code>define options\t<br/>\tdebug on<br/>\tpanes disabled<br/>end define<br/><br/>define game &lt;BeforeAndAfterLeave&gt;<br/><br/>\tasl-version &lt;410&gt;<br/>\tgametype singleplayer<br/>\tstart &lt;Home&gt;\t<br/>\tgame version &lt;1&#46;0&gt;<br/>\tgame author &lt;J&#46; Dobson&gt;<br/>\tgame copyright &lt;© 2009 JDG Inc&#46;&gt;<br/>\t<br/>\tbackground &lt;black&gt;<br/>\tdefault fontname &lt;arial&gt;<br/>\tdefault fontsize &lt;10&gt;<br/>\tforeground &lt;White&gt;\t<br/>\t<br/>\t'Initialize your 'last room' variable here, equal to the start tag above&#46;<br/>\tstartscript {<br/>\t<br/>\t\tset string &lt;quest&#46;lastroom; Home&gt;\t\t<br/>\t}<br/>\t<br/>\t'This script implements our own room description formatting, and<br/>\t'the BeforeEnter, AfterEnter, and AfterLeave actions of a room&#46;<br/>\tdescription {<br/>\t<br/>\t\tif (#quest&#46;lastroom# &lt;&gt; #quest&#46;currentroom#) then {<br/>\t\t<br/>\t\t\tdoaction &lt;#quest&#46;currentroom#; BeforeEnter&gt;<br/>\t\t\tif not property &lt;#quest&#46;currentroom#; isEnterable&gt; then {<br/><br/>\t\t\t\toutputoff<br/>\t\t\t\tgoto &lt;#quest&#46;lastroom#&gt;<br/>\t\t\t\toutputon<br/>\t\t\t}<br/>\t\t\telse {\t\t<br/>\t\t\t<br/>\t\t\t\tdoaction &lt;#quest&#46;lastroom#; AfterLeave&gt;\t\t\t\t<br/>\t\t\t\tdo &lt;RoomDescription&gt;\t\t\t\t<br/>\t\t\t\tdoaction &lt;#quest&#46;currentroom#; AfterEnter&gt;<br/>\t\t\t}<br/>\t\t}<br/>\t\telse {<br/>\t\t<br/>\t\t\tdo &lt;RoomDescription&gt;<br/>\t\t}<br/>\t}\t<br/>\t<br/>\t'This script implements the BeforeLeave action on a room&#46;<br/>\tbeforeturn {<br/>\t<br/>\t\tselect case &lt;#quest&#46;command#&gt; {<br/>\t\t<br/>\t\t\tcase &lt;north; south; west; east; up; down; northwest; northeast; southwest; southeast&gt; {<br/><br/>\t\t\t\tdoaction &lt;#quest&#46;currentroom#; BeforeLeave&gt;<br/>\t\t\t\tif not property &lt;#quest&#46;currentroom#; isLeavable&gt; then dontprocess\t\t\t\t<br/>\t\t\t}<br/>\t\t}\t\t<br/>\t}<br/>\t\t\t<br/>\t<br/>end define<br/><br/>'A procedure to describe rooms&#46;<br/>define procedure &lt;RoomDescription&gt;<br/><br/>\tset &lt;quest&#46;lastroom; #quest&#46;currentroom#&gt;<br/>\t\t\t\t<br/>\tmsg &lt;|b|cr$capfirst(#(quest&#46;currentroom)&#58;prefix#)$ $capfirst(#(quest&#46;currentroom)&#58;alias#)$|xb|cb&gt;\t<br/>\tmsg &lt;&gt;<br/>\tmsg &lt;#quest&#46;lookdesc#  |xn&gt;<br/>\t<br/>\tif ($lengthof(#quest&#46;doorways#)$ &gt; 0) then {<br/>\t\t<br/>\t\tmsg &lt;You can go #quest&#46;doorways#&#46;&gt;<br/>\t}<br/>\telse {<br/>\t\tmsg &lt;&gt;<br/>\t}<br/>\t<br/>\tif ($lengthof(#quest&#46;formatobjects#)$ &gt; 0) then {<br/><br/>\t\tmsg &lt;&gt;<br/>\t\tmsg &lt;You can see #quest&#46;formatobjects#&#46;&gt;<br/>\t}<br/><br/>end define<br/><br/>'These synonyms are required in order to make the BeforeLeave functionality<br/>'effective, even though Quest already understands the short-forms for travel<br/>'directions&#46;<br/>define synonyms<br/><br/>\tn = north<br/>\ts = south<br/>\te = east<br/>\tw = west<br/>\tu = up<br/>\td = down<br/>\tnw = northwest<br/>\tne = northeast<br/>\tsw = southwest<br/>\tse = southeast<br/>\t<br/>end define<br/><br/>define room &lt;Home&gt;<br/>\t<br/>\talias &lt;home&gt;<br/>\tprefix &lt;your&gt;<br/>\tlook &lt;You're in the warm comfort of your house&#46;&gt;\t\t<br/>\t<br/>\tnorth &lt;Frontyard&gt;<br/>\t<br/>\t'Even though this room does not have it's own AfterLeave action defined,<br/>\t'it will inherit one from the 'defaultroom' type&#46;  See below&#46;<br/>\t<br/>\t'Same goes for the BeforeLeave, BeforeEnter, and AfterEnter actions&#46;<br/>\t<br/>end define<br/><br/>define room &lt;Frontyard&gt;<br/>\t<br/>\talias &lt;front yard&gt;<br/>\tprefix &lt;your&gt;<br/>\tlook &lt;You're in your frontyard&#46;&gt;\t<br/>\t<br/>\tsouth &lt;Home&gt;<br/>\tnorth &lt;Street&gt;<br/>\t<br/>\tdefine object &lt;apple&gt;<br/>\t<br/>\t\ttake<br/>\t\talias &lt;apple&gt;<br/>\t\tprefix &lt;an&gt;<br/>\t\tarticle &lt;it&gt;<br/>\t\tlook &lt;Yummy&#46;&gt;<br/>\t\t<br/>\tend define<br/>\t<br/>\t'This overwrites the default BeforeEnter script defined in the 'defaultroom'<br/>\t'type below&#46;<br/>\taction &lt;BeforeEnter&gt; {<br/><br/>\t\t'If the player has the apple, remove the 'isEnterable' property from this<br/>\t\t'room, thereby making it non-enterable&#46;  You should message the player<br/>\t\t'something relevant in this case&#46;<br/>\t\tif got &lt;apple&gt; then {<br/><br/>\t\t\tmsg &lt;You should leave the apple behind before you go to the front yard&#46;&gt;<br/>\t\t\tproperty &lt;$thisobject$; not isEnterable&gt;<br/>\t\t}<br/>\t\telse {<br/>\t\t\tproperty &lt;$thisobject$; isEnterable&gt;<br/>\t\t}<br/>\t}<br/>\t<br/>\t'This overwrites the default AfterEnter script defined in the 'defaultroom'<br/>\t'type below&#46;<br/>\taction &lt;AfterEnter&gt; {<br/>\t<br/>\t\tmsg &lt;Gosh, it's cold out here&#46;&gt;<br/>\t}<br/>\t<br/>\t'This overwrites the default BeforeLeave script defined in the 'defaultroom'<br/>\t'type below&#46;<br/>\taction &lt;BeforeLeave&gt; {<br/>\t<br/>\t\t'If the apple here, remove the 'isLeavable' property from this room,<br/>\t\t'thereby making it non-leave-able&#46;  You should message the player<br/>\t\t'something relevant in this case&#46;<br/>\t\tif here &lt;apple&gt; then {<br/>\t\t\t<br/>\t\t\tmsg &lt;You should take the apple before you leave&#46;&gt;<br/>\t\t\tproperty &lt;$thisobject$; not isLeavable&gt;<br/>\t\t}<br/>\t\telse {<br/>\t\t\tproperty &lt;$thisobject$; isLeavable&gt;<br/>\t\t}<br/>\t}<br/>\t<br/>\t'This overwrites the default AfterLeave script defined in the 'defaultroom'<br/>\t'type below&#46;<br/>\taction &lt;AfterLeave&gt; {<br/>\t<br/>\t\tset string &lt;this; $thisobject$&gt;<br/>\t\tmsg &lt;|n(You've just left #(this)&#58;prefix# #@this#, and thank goodness - for it is not a very pretty front yard, and it offends your eyes&#46;)&gt;<br/>\t}<br/>\t<br/>end define<br/><br/>define room &lt;Street&gt;<br/><br/>\talias &lt;street&gt;<br/>\tprefix &lt;the&gt;<br/>\tlook &lt;You're standing on a barren street&#46;&gt;\t<br/>\t<br/>\tsouth &lt;Frontyard&gt;<br/>\t<br/>\t'Just like the Home room, this room inherits all of the stuff<br/>\t'from the 'defaultroom' type definition, directly below&#46;<br/><br/>end define\t<br/><br/>'*****THE DEFAULTROOM TYPE********<br/><br/><br/>'This is the definition for 'defaultroom'&#46;  Anything you define here<br/>'will automatically be inherited by every other room in your game&#46;  For instance,<br/>'because the AfterLeave action has been defined here, every room will now have <br/>'this action, even if you do not define this action in any particular room&#46;<br/><br/>define type &lt;defaultroom&gt;<br/><br/>\taction &lt;BeforeEnter&gt; {<br/>\t<br/>\t\t'The property 'isEnterable' is set on a room by default to indicate<br/>\t\t'that it is, indeed, enterable&#46;<br/>\t\tproperty &lt;$thisobject$; isEnterable&gt;<br/>\t}<br/>\t<br/>\taction &lt;AfterEnter&gt; {<br/>\t\t<br/>\t\tset string &lt;this; $thisobject$&gt;<br/>\t\tmsg &lt;|n(You've just entered #(this)&#58;prefix# #@this#&#46;)&gt;<br/>\t}<br/>\t<br/>\taction &lt;BeforeLeave&gt; {<br/>\t<br/>\t\t'The property 'isLeavable' is set on a room by default to indicate<br/>\t\t'that it is, indeed, leave-able&#46;<br/>\t\tproperty &lt;$thisobject$; isLeavable&gt;<br/>\t}<br/>\t<br/>\taction &lt;AfterLeave&gt; {<br/>\t<br/>\t\tset string &lt;this; $thisobject$&gt;<br/>\t\tmsg &lt;|n(You've just left #(this)&#58;prefix# #@this#&#46;)&gt;<br/>\t}<br/><br/>end define</code></pre><div><a href=\"/forumattachments/39/BeforeAndAfterEnterAndLeave.asl\">BeforeAndAfterEnterAndLeave.asl</a></div>",
      "PostDate": "2009-11-12T18:41:40+00:00",
      "LastEditDate": null
    }
  ]
}