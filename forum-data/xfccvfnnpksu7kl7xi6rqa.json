{
  "Topic": {
    "TopicId": "xfccvfnnpksu7kl7xi6rqa",
    "ForumId": "10",
    "Title": "Error, Index was out of range",
    "LastUpdated": "2024-11-23T18:49:41.3517764Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "f6b639c8-30d6-400a-9ed6-e851f8a06a26",
      "UserId": 200638,
      "Username": "Bttflover5566",
      "AvatarUrl": "https://i.imgur.com/vfnd4Bhb.jpeg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi, so I have been making a custom function for npcs by giving them an npc score. After doing that, I decided I wanted to add flags depending on how high or low the score is. Since my first function returns the score as npc.score/npc.maxscore, I couldn't have the code recognize the integer so my solution for this was making a copy of the function NpcScore and making a NpcVScore which does the same thing except the return value is an integer. But the problem with that is when I run it, it now gives me this error:\r\n\r\n```Error evaluating expression 'NpcScoreV(Tiffany)': Index was out of range. Must be non-negative and less than the size of the collection.Parameter name: index```\r\n\r\nIt will also be noted I am using the conlib library in this code. \r\n\r\nThe two functions are here:\r\n\r\n```\r\n<function name=\"NpcScore\" parameters=\"npc, change\" type=\"string\"><![CDATA[\r\n    if (not HasInt (npc, \"score\")) {\r\n      npc.score = 10\r\n      npc.maxscore = 20\r\n    }\r\n    if (IsDefined (\"change\")) {\r\n      npc.score = npc.score + change\r\n      if (npc.score > npc.maxscore) {\r\n        npc.score = npc.maxscore\r\n      }\r\n    }\r\n    return (npc.score + \"/\" + npc.maxscore)\r\n    if (npc.score > 20) {\r\n      npc.score = 20\r\n    }\r\n```\r\n```\r\n  <function name=\"NpcScoreV\" type=\"int\"><![CDATA[\r\n    if (not HasInt (npc, \"score\")) {\r\n      npc.score = 10\r\n      npc.maxscore = 20\r\n    }\r\n    if (IsDefined (\"change\")) {\r\n      npc.score = npc.score + change\r\n      if (npc.score > npc.maxscore) {\r\n        npc.score = npc.maxscore\r\n      }\r\n    }\r\n    return (npc.score)\r\n    if (npc.score > 20) {\r\n      npc.score = 20\r\n    }\r\n    else if (npc.score = 20) {\r\n      SetObjectFlagOn (npc, \"love\")\r\n      SetObjectFlagOff (npc, \"strongly like\")\r\n      SetObjectFlagOff (npc, \"like\")\r\n      SetObjectFlagOff (npc, \"neutral\")\r\n      SetObjectFlagOff (npc, \"dislike\")\r\n      SetObjectFlagOff (npc, \"strongly dislike\")\r\n      SetObjectFlagOff (npc, \"hate\")\r\n      SetObjectFlagOff (npc, \"despise\")\r\n      SetObjectFlagOff (npc, \"loathe\")\r\n    }\r\n    else if (npc.score > 15) {\r\n      SetObjectFlagOn (npc, \"strongly like\")\r\n      SetObjectFlagOff (npc, \"love\")\r\n      SetObjectFlagOff (npc, \"like\")\r\n      SetObjectFlagOff (npc, \"neutral\")\r\n      SetObjectFlagOff (npc, \"dislike\")\r\n      SetObjectFlagOff (npc, \"strongly dislike\")\r\n      SetObjectFlagOff (npc, \"hate\")\r\n      SetObjectFlagOff (npc, \"despise\")\r\n      SetObjectFlagOff (npc, \"loathe\")\r\n    }\r\n    else if (npc.score > 10) {\r\n      SetObjectFlagOn (npc, \"like\")\r\n      SetObjectFlagOff (npc, \"strongly like\")\r\n      SetObjectFlagOff (npc, \"love\")\r\n      SetObjectFlagOff (npc, \"neutral\")\r\n      SetObjectFlagOff (npc, \"dislike\")\r\n      SetObjectFlagOff (npc, \"strongly dislike\")\r\n      SetObjectFlagOff (npc, \"hate\")\r\n      SetObjectFlagOff (npc, \"despise\")\r\n      SetObjectFlagOff (npc, \"loathe\")\r\n    }\r\n    else if (npc.score = 10) {\r\n      SetObjectFlagOn (npc, \"neutral\")\r\n      SetObjectFlagOff (npc, \"strongly like\")\r\n      SetObjectFlagOff (npc, \"like\")\r\n      SetObjectFlagOff (npc, \"love\")\r\n      SetObjectFlagOff (npc, \"dislike\")\r\n      SetObjectFlagOff (npc, \"strongly dislike\")\r\n      SetObjectFlagOff (npc, \"hate\")\r\n      SetObjectFlagOff (npc, \"despise\")\r\n      SetObjectFlagOff (npc, \"loathe\")\r\n    }\r\n    else if (npc.score > 5) {\r\n      SetObjectFlagOn (npc, \"dislike\")\r\n      SetObjectFlagOff (npc, \"strongly like\")\r\n      SetObjectFlagOff (npc, \"like\")\r\n      SetObjectFlagOff (npc, \"neutral\")\r\n      SetObjectFlagOff (npc, \"love\")\r\n      SetObjectFlagOff (npc, \"strongly dislike\")\r\n      SetObjectFlagOff (npc, \"hate\")\r\n      SetObjectFlagOff (npc, \"despise\")\r\n      SetObjectFlagOff (npc, \"loathe\")\r\n    }\r\n    else if (npc.score < 5) {\r\n      SetObjectFlagOn (npc, \"strongly dislike\")\r\n      SetObjectFlagOff (npc, \"strongly like\")\r\n      SetObjectFlagOff (npc, \"like\")\r\n      SetObjectFlagOff (npc, \"neutral\")\r\n      SetObjectFlagOff (npc, \"dislike\")\r\n      SetObjectFlagOff (npc, \"love\")\r\n      SetObjectFlagOff (npc, \"hate\")\r\n      SetObjectFlagOff (npc, \"despise\")\r\n      SetObjectFlagOff (npc, \"loathe\")\r\n    }\r\n    else if (npc.score < 0) {\r\n      SetObjectFlagOn (npc, \"hate\")\r\n      SetObjectFlagOff (npc, \"strongly like\")\r\n      SetObjectFlagOff (npc, \"like\")\r\n      SetObjectFlagOff (npc, \"neutral\")\r\n      SetObjectFlagOff (npc, \"dislike\")\r\n      SetObjectFlagOff (npc, \"strongly dislike\")\r\n      SetObjectFlagOff (npc, \"love\")\r\n      SetObjectFlagOff (npc, \"despise\")\r\n      SetObjectFlagOff (npc, \"loathe\")\r\n    }\r\n    else if (npc.score > -5) {\r\n      SetObjectFlagOn (npc, \"despise\")\r\n      SetObjectFlagOff (npc, \"strongly like\")\r\n      SetObjectFlagOff (npc, \"like\")\r\n      SetObjectFlagOff (npc, \"neutral\")\r\n      SetObjectFlagOff (npc, \"dislike\")\r\n      SetObjectFlagOff (npc, \"strongly dislike\")\r\n      SetObjectFlagOff (npc, \"hate\")\r\n      SetObjectFlagOff (npc, \"love\")\r\n      SetObjectFlagOff (npc, \"loathe\")\r\n    }\r\n    else if (npc.score > -10) {\r\n      SetObjectFlagOn (npc, \"loathe\")\r\n      SetObjectFlagOff (npc, \"strongly like\")\r\n      SetObjectFlagOff (npc, \"like\")\r\n      SetObjectFlagOff (npc, \"neutral\")\r\n      SetObjectFlagOff (npc, \"dislike\")\r\n      SetObjectFlagOff (npc, \"strongly dislike\")\r\n      SetObjectFlagOff (npc, \"hate\")\r\n      SetObjectFlagOff (npc, \"despise\")\r\n      SetObjectFlagOff (npc, \"love\")\r\n    }\r\n    else if (npc.score > -20) {\r\n      npc.score = -20\r\n    }\r\n  ]]></function>\r\n```\r\nAnd the code that calls said function is here:\r\n```\r\nnscore = NpcScoreV(Tiffany)\r\nnscore = ToInt (nscore)\r\nif (nscore < 10) {\r\n  HideTopic (Fight with Aphrodite)\r\n  HideTopic (Bake Sale)\r\n  HideTopic (Yellow Envelope)\r\n}\r\nelse {\r\n  msg (\"\\\"What do you want? I'm busy.\\\"\")\r\n}\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi, so I have been making a custom function for npcs by giving them an npc score. After doing that, I decided I wanted to add flags depending on how high or low the score is. Since my first function returns the score as npc.score/npc.maxscore, I couldn't have the code recognize the integer so my solution for this was making a copy of the function NpcScore and making a NpcVScore which does the same thing except the return value is an integer. But the problem with that is when I run it, it now gives me this error:</p>\n<p><code>Error evaluating expression 'NpcScoreV(Tiffany)': Index was out of range. Must be non-negative and less than the size of the collection.Parameter name: index</code></p>\n<p>It will also be noted I am using the conlib library in this code.</p>\n<p>The two functions are here:</p>\n<pre><code>&lt;function name=\"NpcScore\" parameters=\"npc, change\" type=\"string\"&gt;&lt;![CDATA[\n    if (not HasInt (npc, \"score\")) {\n      npc.score = 10\n      npc.maxscore = 20\n    }\n    if (IsDefined (\"change\")) {\n      npc.score = npc.score + change\n      if (npc.score &gt; npc.maxscore) {\n        npc.score = npc.maxscore\n      }\n    }\n    return (npc.score + \"/\" + npc.maxscore)\n    if (npc.score &gt; 20) {\n      npc.score = 20\n    }\n</code></pre>\n<pre><code>  &lt;function name=\"NpcScoreV\" type=\"int\"&gt;&lt;![CDATA[\n    if (not HasInt (npc, \"score\")) {\n      npc.score = 10\n      npc.maxscore = 20\n    }\n    if (IsDefined (\"change\")) {\n      npc.score = npc.score + change\n      if (npc.score &gt; npc.maxscore) {\n        npc.score = npc.maxscore\n      }\n    }\n    return (npc.score)\n    if (npc.score &gt; 20) {\n      npc.score = 20\n    }\n    else if (npc.score = 20) {\n      SetObjectFlagOn (npc, \"love\")\n      SetObjectFlagOff (npc, \"strongly like\")\n      SetObjectFlagOff (npc, \"like\")\n      SetObjectFlagOff (npc, \"neutral\")\n      SetObjectFlagOff (npc, \"dislike\")\n      SetObjectFlagOff (npc, \"strongly dislike\")\n      SetObjectFlagOff (npc, \"hate\")\n      SetObjectFlagOff (npc, \"despise\")\n      SetObjectFlagOff (npc, \"loathe\")\n    }\n    else if (npc.score &gt; 15) {\n      SetObjectFlagOn (npc, \"strongly like\")\n      SetObjectFlagOff (npc, \"love\")\n      SetObjectFlagOff (npc, \"like\")\n      SetObjectFlagOff (npc, \"neutral\")\n      SetObjectFlagOff (npc, \"dislike\")\n      SetObjectFlagOff (npc, \"strongly dislike\")\n      SetObjectFlagOff (npc, \"hate\")\n      SetObjectFlagOff (npc, \"despise\")\n      SetObjectFlagOff (npc, \"loathe\")\n    }\n    else if (npc.score &gt; 10) {\n      SetObjectFlagOn (npc, \"like\")\n      SetObjectFlagOff (npc, \"strongly like\")\n      SetObjectFlagOff (npc, \"love\")\n      SetObjectFlagOff (npc, \"neutral\")\n      SetObjectFlagOff (npc, \"dislike\")\n      SetObjectFlagOff (npc, \"strongly dislike\")\n      SetObjectFlagOff (npc, \"hate\")\n      SetObjectFlagOff (npc, \"despise\")\n      SetObjectFlagOff (npc, \"loathe\")\n    }\n    else if (npc.score = 10) {\n      SetObjectFlagOn (npc, \"neutral\")\n      SetObjectFlagOff (npc, \"strongly like\")\n      SetObjectFlagOff (npc, \"like\")\n      SetObjectFlagOff (npc, \"love\")\n      SetObjectFlagOff (npc, \"dislike\")\n      SetObjectFlagOff (npc, \"strongly dislike\")\n      SetObjectFlagOff (npc, \"hate\")\n      SetObjectFlagOff (npc, \"despise\")\n      SetObjectFlagOff (npc, \"loathe\")\n    }\n    else if (npc.score &gt; 5) {\n      SetObjectFlagOn (npc, \"dislike\")\n      SetObjectFlagOff (npc, \"strongly like\")\n      SetObjectFlagOff (npc, \"like\")\n      SetObjectFlagOff (npc, \"neutral\")\n      SetObjectFlagOff (npc, \"love\")\n      SetObjectFlagOff (npc, \"strongly dislike\")\n      SetObjectFlagOff (npc, \"hate\")\n      SetObjectFlagOff (npc, \"despise\")\n      SetObjectFlagOff (npc, \"loathe\")\n    }\n    else if (npc.score &lt; 5) {\n      SetObjectFlagOn (npc, \"strongly dislike\")\n      SetObjectFlagOff (npc, \"strongly like\")\n      SetObjectFlagOff (npc, \"like\")\n      SetObjectFlagOff (npc, \"neutral\")\n      SetObjectFlagOff (npc, \"dislike\")\n      SetObjectFlagOff (npc, \"love\")\n      SetObjectFlagOff (npc, \"hate\")\n      SetObjectFlagOff (npc, \"despise\")\n      SetObjectFlagOff (npc, \"loathe\")\n    }\n    else if (npc.score &lt; 0) {\n      SetObjectFlagOn (npc, \"hate\")\n      SetObjectFlagOff (npc, \"strongly like\")\n      SetObjectFlagOff (npc, \"like\")\n      SetObjectFlagOff (npc, \"neutral\")\n      SetObjectFlagOff (npc, \"dislike\")\n      SetObjectFlagOff (npc, \"strongly dislike\")\n      SetObjectFlagOff (npc, \"love\")\n      SetObjectFlagOff (npc, \"despise\")\n      SetObjectFlagOff (npc, \"loathe\")\n    }\n    else if (npc.score &gt; -5) {\n      SetObjectFlagOn (npc, \"despise\")\n      SetObjectFlagOff (npc, \"strongly like\")\n      SetObjectFlagOff (npc, \"like\")\n      SetObjectFlagOff (npc, \"neutral\")\n      SetObjectFlagOff (npc, \"dislike\")\n      SetObjectFlagOff (npc, \"strongly dislike\")\n      SetObjectFlagOff (npc, \"hate\")\n      SetObjectFlagOff (npc, \"love\")\n      SetObjectFlagOff (npc, \"loathe\")\n    }\n    else if (npc.score &gt; -10) {\n      SetObjectFlagOn (npc, \"loathe\")\n      SetObjectFlagOff (npc, \"strongly like\")\n      SetObjectFlagOff (npc, \"like\")\n      SetObjectFlagOff (npc, \"neutral\")\n      SetObjectFlagOff (npc, \"dislike\")\n      SetObjectFlagOff (npc, \"strongly dislike\")\n      SetObjectFlagOff (npc, \"hate\")\n      SetObjectFlagOff (npc, \"despise\")\n      SetObjectFlagOff (npc, \"love\")\n    }\n    else if (npc.score &gt; -20) {\n      npc.score = -20\n    }\n  ]]&gt;&lt;/function&gt;\n</code></pre>\n<p>And the code that calls said function is here:</p>\n<pre><code>nscore = NpcScoreV(Tiffany)\nnscore = ToInt (nscore)\nif (nscore &lt; 10) {\n  HideTopic (Fight with Aphrodite)\n  HideTopic (Bake Sale)\n  HideTopic (Yellow Envelope)\n}\nelse {\n  msg (\"\\\"What do you want? I'm busy.\\\"\")\n}\n</code></pre>\n\n",
      "PostDate": "2024-11-23T18:49:41.3517764Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "e950aad6-2dc0-4624-82e9-d1c4834acfca",
      "UserId": 200638,
      "Username": "Bttflover5566",
      "AvatarUrl": "https://i.imgur.com/vfnd4Bhb.jpeg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I noticed I forgot to add the parameters so I did do that and I got this error instead.\r\n\r\n```Error running script: Error compiling expression 'ToInt (nscore)': FunctionCallElement: Could find not function 'ToInt(Int32)'```\r\n\r\nSo I removed the piece of code that was trying to convert the integer to an integer and I stopped getting errors but now the topics I want hidden aren't hidden and the conversation continues. I want it to end the conversation and have it so that Tiffany won't speak to the player",
      "EditableFormat": "markdown",
      "HTML": "<p>I noticed I forgot to add the parameters so I did do that and I got this error instead.</p>\n<p><code>Error running script: Error compiling expression 'ToInt (nscore)': FunctionCallElement: Could find not function 'ToInt(Int32)'</code></p>\n<p>So I removed the piece of code that was trying to convert the integer to an integer and I stopped getting errors but now the topics I want hidden aren't hidden and the conversation continues. I want it to end the conversation and have it so that Tiffany won't speak to the player</p>\n\n",
      "PostDate": "2024-11-23T19:05:16.8179571Z",
      "LastEditDate": "2024-11-23T19:24:34.3931717Z",
      "link": null
    },
    {
      "PostId": "8a338563-ee4b-4b53-a01b-5f3e176910ff",
      "UserId": 703786,
      "Username": "TextMisadventures",
      "AvatarUrl": "https://i.imgur.com/HoT06tvb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "It looks like `nscore` is already an integer.\r\n\r\nDoes it work if you remove the following line (the 2nd line in that last block you posted)?\r\n\r\n```\r\nnscore = ToInt (nscore)\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>It looks like <code>nscore</code> is already an integer.</p>\n<p>Does it work if you remove the following line (the 2nd line in that last block you posted)?</p>\n<pre><code>nscore = ToInt (nscore)\n</code></pre>\n\n",
      "PostDate": "2024-11-23T19:25:39.1190033Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5cd84f2f-3d15-4796-90d2-0c3e2d88d50b",
      "UserId": 200638,
      "Username": "Bttflover5566",
      "AvatarUrl": "https://i.imgur.com/vfnd4Bhb.jpeg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Yes it did and I fixed it, and it looks like I just didn't refer to the topic correctly, now it is working fine",
      "EditableFormat": "markdown",
      "HTML": "<p>Yes it did and I fixed it, and it looks like I just didn't refer to the topic correctly, now it is working fine</p>\n\n",
      "PostDate": "2024-11-23T19:36:56.0605515Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "41d25563-0f37-42eb-bd9d-011e42f880ac",
      "UserId": 703786,
      "Username": "TextMisadventures",
      "AvatarUrl": "https://i.imgur.com/HoT06tvb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "It looks like your making tons of progress, by the way!",
      "EditableFormat": "markdown",
      "HTML": "<p>It looks like your making tons of progress, by the way!</p>\n\n",
      "PostDate": "2024-11-23T20:43:22.3006036Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "52e803b4-fbca-4ae0-8fe0-ccb8b87389b6",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "A function ends when it reaches a `return` statement. That means that you can use `return` to end a loop early; but it also means that you need to put the `return` line at the end of your function if there's other stuff you want to do.\r\n\r\nHowever, I'm not sure why you need a second function here. Do yiu only want to set all those flags if you use `NpcScoreV`?\r\n\r\nIf you're just using it to return the score, there's no need for that. You could do:\r\n```\r\nnscore = NpcScore(Tiffany)\r\nif (Tiffany.score < 10) {\r\n  HideTopic (Fight with Aphrodite)\r\n  HideTopic (Bake Sale)\r\n  HideTopic (Yellow Envelope)\r\n}\r\nelse {\r\n  msg (\"\\\"What do you want? I'm busy.\\\"\")\r\n}\r\n```\r\n(in this example, the return value is still `nscore`, even if you don't need it… because you already have the numeric value `Tiffany.score`. Having only one function to do a thing is usually best practice, because with so many flags being turned on and off, it would be easy to accidentally introduce an error or discrepancy in one of the functions without realising)\r\n\r\nHope that makes sense, if I'm understanding correctly what you want to do.",
      "EditableFormat": "markdown",
      "HTML": "<p>A function ends when it reaches a <code>return</code> statement. That means that you can use <code>return</code> to end a loop early; but it also means that you need to put the <code>return</code> line at the end of your function if there's other stuff you want to do.</p>\n<p>However, I'm not sure why you need a second function here. Do yiu only want to set all those flags if you use <code>NpcScoreV</code>?</p>\n<p>If you're just using it to return the score, there's no need for that. You could do:</p>\n<pre><code>nscore = NpcScore(Tiffany)\nif (Tiffany.score &lt; 10) {\n  HideTopic (Fight with Aphrodite)\n  HideTopic (Bake Sale)\n  HideTopic (Yellow Envelope)\n}\nelse {\n  msg (\"\\\"What do you want? I'm busy.\\\"\")\n}\n</code></pre>\n<p>(in this example, the return value is still <code>nscore</code>, even if you don't need it… because you already have the numeric value <code>Tiffany.score</code>. Having only one function to do a thing is usually best practice, because with so many flags being turned on and off, it would be easy to accidentally introduce an error or discrepancy in one of the functions without realising)</p>\n<p>Hope that makes sense, if I'm understanding correctly what you want to do.</p>\n\n",
      "PostDate": "2024-11-23T22:10:24.3678387Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
