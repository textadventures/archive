{
  "Topic": {
    "TopicId": "z8fhvpbgp0orpy8m_ticla",
    "ForumId": "10",
    "Title": "saving issue regarding scripts run in place of text room descriptions",
    "LastUpdated": "2024-09-22T20:16:09.4336539Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "ab9eb889-ec4e-4d9f-a1fb-4128e90225e1",
      "UserId": 518233,
      "Username": "Vurt834",
      "AvatarUrl": "https://secure.gravatar.com/avatar/eba9253a96bb6b0a227a5c7bd72ffb72?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I am having an issue regarding restoring game states online. All my room descriptions are scripts, and I use HTML to play music as well. When a game is saved in a room and then restored, there's nothing but a blank screen with no sound. I'm aware of why this might be, but I am looking for a solution. I tried remedying it by running the ShowRoomDescription function in the initialization script (only on restores, not on new games) via a boolean variable. I also attempted using a variable change script, where a counter in the player object is increased by one in the initialization script, and then the corresponding change script runs ShowRoomDescription.\r\n\r\nI thought about trying a turn script that runs ShowRoomDescription and then suppresses turn scripts afterward, but if that doesn't work, I'm not entirely sure what the solution may be. Any ideas? I'm sure others have run into this problem. If you use text descriptions instead of scripts, the issue seems to disappear. When restoring save files on the desktop version, the issue is non-existent; the sound and room description restore without any problems.",
      "EditableFormat": "markdown",
      "HTML": "<p>I am having an issue regarding restoring game states online. All my room descriptions are scripts, and I use HTML to play music as well. When a game is saved in a room and then restored, there's nothing but a blank screen with no sound. I'm aware of why this might be, but I am looking for a solution. I tried remedying it by running the ShowRoomDescription function in the initialization script (only on restores, not on new games) via a boolean variable. I also attempted using a variable change script, where a counter in the player object is increased by one in the initialization script, and then the corresponding change script runs ShowRoomDescription.</p>\n<p>I thought about trying a turn script that runs ShowRoomDescription and then suppresses turn scripts afterward, but if that doesn't work, I'm not entirely sure what the solution may be. Any ideas? I'm sure others have run into this problem. If you use text descriptions instead of scripts, the issue seems to disappear. When restoring save files on the desktop version, the issue is non-existent; the sound and room description restore without any problems.</p>\n\n",
      "PostDate": "2024-09-22T20:16:09.4336539Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "fb093652-f141-4870-a946-9f938b6b6dd3",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hello.\r\n\r\nThis test game restores the text when playing online.\r\n\r\nhttps://textadventures.co.uk/games/view/qj_s6-ceq0e5kkge1puztg/restore-text-after-save-online\r\n\r\n---\r\nHere is the same game, without the **game.inituserinterface** script that applies the fix:\r\n\r\nhttps://textadventures.co.uk/games/view/lqfhxymqieeudkt8ywij7w/will-this-restore-text-after-save-online\r\n\r\n---\r\nThe important bits are:\r\n\r\n**game.inituserinterface**\r\n\r\n```\r\n      JS.eval (\"function doSave() {ASLEvent(\\\"BackupDivOutput\\\", $(\\\"#divOutput\\\").html()); UIEvent(\\\"Save\\\", $(\\\"#divOutput\\\").html());}\")\r\n      if (HasAttribute(game, \"saveddivoutput\")) {\r\n        JS.eval (\"setTimeout(function(){$(\\\"#divOutput\\\").append(\\\"\" + game.saveddivoutput + \"\\\");}, 500); oldDivOutput = '\" + game.saveddivoutput + \"';\")\r\n      }\r\n```\r\n\r\n---\r\n\r\n```\r\n  <function name=\"BackupDivOutput\" parameters=\"s\">\r\n    game.saveddivoutput = s\r\n  </function>\r\n```\r\n\r\n---\r\nThe test game's code:\r\n\r\n\r\n<details><summary><b>>CLICK HERE to view the code.</b></summary>\r\n\r\n\r\n```\r\n<!--Saved by Quest 5.8.7753.35184-->\r\n<asl version=\"580\">\r\n  <include ref=\"English.aslx\" />\r\n  <include ref=\"Core.aslx\" />\r\n  <game name=\"Restore Text After Save Online\">\r\n    <gameid>2aca063f-0a79-43d3-95de-1e3c77f42a37</gameid>\r\n    <version>1.0.3</version>\r\n    <firstpublished>2024</firstpublished>\r\n    <feature_advancedscripts />\r\n    <inituserinterface type=\"script\">\r\n      JS.eval (\"function doSave() {ASLEvent(\\\"BackupDivOutput\\\", $(\\\"#divOutput\\\").html()); UIEvent(\\\"Save\\\", $(\\\"#divOutput\\\").html());}\")\r\n      if (HasAttribute(game, \"saveddivoutput\")) {\r\n        JS.eval (\"setTimeout(function(){$(\\\"#divOutput\\\").append(\\\"\" + game.saveddivoutput + \"\\\");}, 500); oldDivOutput = '\" + game.saveddivoutput + \"';\")\r\n      }\r\n    </inituserinterface>\r\n    <author>KV</author>\r\n  </game>\r\n  <object name=\"room\">\r\n    <inherit name=\"editor_room\" />\r\n    <isroom />\r\n    <description type=\"script\"><![CDATA[\r\n      msg (\"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<br/><br/>{command:LOOK}\")\r\n    ]]></description>\r\n    <object name=\"player\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"editor_player\" />\r\n    </object>\r\n  </object>\r\n  <function name=\"BackupDivOutput\" parameters=\"s\">\r\n    game.saveddivoutput = s\r\n  </function>\r\n</asl>\r\n```\r\n\r\n</details>\r\n\r\n---\r\n>  If you use text descriptions instead of scripts, the issue seems to disappear. When restoring save files on the desktop version, the issue is non-existent; the sound and room description restore without any problems.\r\n\r\nI was looking at this issue yesterday, and the problem seems to be the displayed text is saved to the game file as a walkthrough when you save the game.\r\n\r\nThe desktop player loads that old text from the walkthrough when it loads the saved game, but the online player can't run a walkthrough.\r\n\r\nI just uploaded a third test game, using a text room description rather than a script, and it still doesn't restore the text when I load a saved game. So, I couldn't recreate what you describe in that bit.\r\n\r\n---\r\n>  I tried remedying it by running the ShowRoomDescription function in the initialization script (only on restores, not on new games) via a boolean variable. \r\n\r\nI bet that didn't work because the page wasn't loaded yet (maybe?).\r\n\r\nI had to put a 500ms `setTimeout()` in the script before it worked for me, and someone has slower internet than me (which would be sad), that might not be long enough.\r\n\r\nI don't know, though. Just guessing.",
      "EditableFormat": "markdown",
      "HTML": "<p>Hello.</p>\n<p>This test game restores the text when playing online.</p>\n<p>https://textadventures.co.uk/games/view/qj_s6-ceq0e5kkge1puztg/restore-text-after-save-online</p>\n<hr>\n<p>Here is the same game, without the <strong>game.inituserinterface</strong> script that applies the fix:</p>\n<p>https://textadventures.co.uk/games/view/lqfhxymqieeudkt8ywij7w/will-this-restore-text-after-save-online</p>\n<hr>\n<p>The important bits are:</p>\n<p><strong>game.inituserinterface</strong></p>\n<pre><code>      JS.eval (\"function doSave() {ASLEvent(\\\"BackupDivOutput\\\", $(\\\"#divOutput\\\").html()); UIEvent(\\\"Save\\\", $(\\\"#divOutput\\\").html());}\")\n      if (HasAttribute(game, \"saveddivoutput\")) {\n        JS.eval (\"setTimeout(function(){$(\\\"#divOutput\\\").append(\\\"\" + game.saveddivoutput + \"\\\");}, 500); oldDivOutput = '\" + game.saveddivoutput + \"';\")\n      }\n</code></pre>\n<hr>\n<pre><code>  &lt;function name=\"BackupDivOutput\" parameters=\"s\"&gt;\n    game.saveddivoutput = s\n  &lt;/function&gt;\n</code></pre>\n<hr>\n<p>The test game's code:</p>\n<details><summary><b>&gt;CLICK HERE to view the code.</b></summary>\n<pre><code>&lt;!--Saved by Quest 5.8.7753.35184--&gt;\n&lt;asl version=\"580\"&gt;\n  &lt;include ref=\"English.aslx\" /&gt;\n  &lt;include ref=\"Core.aslx\" /&gt;\n  &lt;game name=\"Restore Text After Save Online\"&gt;\n    &lt;gameid&gt;2aca063f-0a79-43d3-95de-1e3c77f42a37&lt;/gameid&gt;\n    &lt;version&gt;1.0.3&lt;/version&gt;\n    &lt;firstpublished&gt;2024&lt;/firstpublished&gt;\n    &lt;feature_advancedscripts /&gt;\n    &lt;inituserinterface type=\"script\"&gt;\n      JS.eval (\"function doSave() {ASLEvent(\\\"BackupDivOutput\\\", $(\\\"#divOutput\\\").html()); UIEvent(\\\"Save\\\", $(\\\"#divOutput\\\").html());}\")\n      if (HasAttribute(game, \"saveddivoutput\")) {\n        JS.eval (\"setTimeout(function(){$(\\\"#divOutput\\\").append(\\\"\" + game.saveddivoutput + \"\\\");}, 500); oldDivOutput = '\" + game.saveddivoutput + \"';\")\n      }\n    &lt;/inituserinterface&gt;\n    &lt;author&gt;KV&lt;/author&gt;\n  &lt;/game&gt;\n  &lt;object name=\"room\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;isroom /&gt;\n    &lt;description type=\"script\"&gt;&lt;![CDATA[\n      msg (\"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&lt;br/&gt;&lt;br/&gt;{command:LOOK}\")\n    ]]&gt;&lt;/description&gt;\n    &lt;object name=\"player\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"editor_player\" /&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n  &lt;function name=\"BackupDivOutput\" parameters=\"s\"&gt;\n    game.saveddivoutput = s\n  &lt;/function&gt;\n&lt;/asl&gt;\n</code></pre>\n</details>\n<hr>\n<blockquote>\n<p>If you use text descriptions instead of scripts, the issue seems to disappear. When restoring save files on the desktop version, the issue is non-existent; the sound and room description restore without any problems.</p>\n</blockquote>\n<p>I was looking at this issue yesterday, and the problem seems to be the displayed text is saved to the game file as a walkthrough when you save the game.</p>\n<p>The desktop player loads that old text from the walkthrough when it loads the saved game, but the online player can't run a walkthrough.</p>\n<p>I just uploaded a third test game, using a text room description rather than a script, and it still doesn't restore the text when I load a saved game. So, I couldn't recreate what you describe in that bit.</p>\n<hr>\n<blockquote>\n<p>I tried remedying it by running the ShowRoomDescription function in the initialization script (only on restores, not on new games) via a boolean variable.</p>\n</blockquote>\n<p>I bet that didn't work because the page wasn't loaded yet (maybe?).</p>\n<p>I had to put a 500ms <code>setTimeout()</code> in the script before it worked for me, and someone has slower internet than me (which would be sad), that might not be long enough.</p>\n<p>I don't know, though. Just guessing.</p>\n\n",
      "PostDate": "2024-09-23T01:55:21.5307036Z",
      "LastEditDate": "2024-09-23T02:26:38.9772166Z",
      "link": null
    },
    {
      "PostId": "f9f00d46-a546-4f65-9c3d-af4687881149",
      "UserId": 924,
      "Username": "Pertex",
      "AvatarUrl": "https://secure.gravatar.com/avatar/4cc1e52f99452e841ecf4cbee9eadde9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "So you did you call ShowRoomDescription in the function InitUserInterface? What happened then?",
      "EditableFormat": "markdown",
      "HTML": "<p>So you did you call ShowRoomDescription in the function InitUserInterface? What happened then?</p>\n\n",
      "PostDate": "2024-09-23T05:00:20.6701393Z",
      "LastEditDate": "2024-09-23T05:04:00.6826174Z",
      "link": null
    }
  ]
}
