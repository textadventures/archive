{
  "Topic": {
    "TopicId": "wthoxs-svecb7cbqx3kvjq",
    "ForumId": "10",
    "Title": "[Solved] ClearScreen White Space Issue (was UNDO Issue)",
    "LastUpdated": "2020-12-31T10:03:25.4474532Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "6c68a263-bd25-4fdb-b54c-859dcc222f9a",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "This is really a continuation of the now closed topic from October:\r\nhttp://textadventures.co.uk/forum/quest/topic/gxxws68qyko6hqwkf9q2ua/unexpected-undo-problem-resolved-again\r\n\r\nI assume that any operation that uses ClearScreen can't be fully undone if any text has been cleared but is it possible to detect that this has happened within UNDO and give a warning?\r\n\r\n**Update**\r\n...now also noticed that there is a 'white space' problem when undoing past an operation that uses ClearScreen, as the space for the text is restored but not the text itself!",
      "EditableFormat": "markdown",
      "HTML": "<p>This is really a continuation of the now closed topic from October:<br>\nhttp://textadventures.co.uk/forum/quest/topic/gxxws68qyko6hqwkf9q2ua/unexpected-undo-problem-resolved-again</p>\n<p>I assume that any operation that uses ClearScreen can't be fully undone if any text has been cleared but is it possible to detect that this has happened within UNDO and give a warning?</p>\n<p><strong>Update</strong><br>\n...now also noticed that there is a 'white space' problem when undoing past an operation that uses ClearScreen, as the space for the text is restored but not the text itself!</p>\n\n",
      "PostDate": "2020-12-31T10:03:25.4474532Z",
      "LastEditDate": "2021-01-02T16:15:33.8162699Z",
      "link": null
    },
    {
      "PostId": "9848c2ec-0385-47c1-a7cd-f67fd9a585f3",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hello.\r\n\r\n---\r\n> I assume that any operation that uses ```ClearScreen``` can't be fully undone if any text has been cleared\r\n\r\nThat depends on how you define \"fully undone\".\r\n\r\n There are a few people around here who will probably say making cleared text reappear is not UNDO's job. ( I'm not particularly saying that, but I don't have much of an argument against it, either.)\r\n\r\nRegardless of that, I think there's probably a way to undo screen clearing. (I'm thinking about the way the transcript stuff works, but I can't think about it clearly enough to effect a solution right now.  (I've been fooling around with the next Quest, and I just realized I've forgotten quite a bit of old Quest-ese.))\r\n\r\nI don't want to sound negative, but I wouldn't bet that such functionality would ever be added to Quest 5 (although I may be mistaken).  If you find a solution to this, you would probably have to include the code in each of your games.\r\n\r\n---\r\n>  is it possible to detect that this has happened within UNDO and give a warning?\r\n\r\nI don't fully understand this question.\r\n\r\nDo you mean that the screen clears after entering UNDO?  If yes, this probably depends on the script that invokes ```ClearScreen```, but I *think* you could code that script to check the current command before clearing the screen.\r\n\r\n---\r\n> now also noticed that there is a 'white space' problem when undoing past an operation that uses ClearScreen, as the space for the text is restored but not the text itself!\r\n\r\nIt seems like I remember someone mentioning this previously? ( I <s>might be</s> am crazy, though.)\r\n\r\n---\r\n### Opinion(s)\r\n\r\nI am quite fond of UNDO (and making it fully functional), but, now that I've thought about it, I wouldn't call this thing with ```ClearScreen``` an UNDO issue.  I would opine that this is something which should be handled by any author who chooses to clear the screen with ```ClearScreen``` during play -- an offense of which I have been guilty on numerous occasions.\r\n\r\nInstead of using ```ClearScreen``` in a parser (especially a parser that has the UNDO feature), perhaps it would be better to print out a blank div which is the height of the output element.  This is how the old text adventures did it (I think).  It has the same effect, but the player can always scroll up to view everything printed during play.\r\n\r\nI'm pretty sure this would look odd in Quest, though.\r\n\r\n**EDIT**\r\n\r\nI'm pretty sure this will do that (\"that\" meaning: create a screen full of whitespace):\r\n\r\n```\r\nmsg (\"<div style='min-height:100vh;'></div>\")\r\nmsg (\"Your screen just got cleared the old way!\")\r\n```\r\n\r\n**EDIT 2** \r\n\r\nTested and approved (although it does act a little funny).",
      "EditableFormat": "markdown",
      "HTML": "<p>Hello.</p>\n<hr>\n<blockquote>\n<p>I assume that any operation that uses <code>ClearScreen</code> can't be fully undone if any text has been cleared</p>\n</blockquote>\n<p>That depends on how you define \"fully undone\".</p>\n<p>There are a few people around here who will probably say making cleared text reappear is not UNDO's job. ( I'm not particularly saying that, but I don't have much of an argument against it, either.)</p>\n<p>Regardless of that, I think there's probably a way to undo screen clearing. (I'm thinking about the way the transcript stuff works, but I can't think about it clearly enough to effect a solution right now.  (I've been fooling around with the next Quest, and I just realized I've forgotten quite a bit of old Quest-ese.))</p>\n<p>I don't want to sound negative, but I wouldn't bet that such functionality would ever be added to Quest 5 (although I may be mistaken).  If you find a solution to this, you would probably have to include the code in each of your games.</p>\n<hr>\n<blockquote>\n<p>is it possible to detect that this has happened within UNDO and give a warning?</p>\n</blockquote>\n<p>I don't fully understand this question.</p>\n<p>Do you mean that the screen clears after entering UNDO?  If yes, this probably depends on the script that invokes <code>ClearScreen</code>, but I <em>think</em> you could code that script to check the current command before clearing the screen.</p>\n<hr>\n<blockquote>\n<p>now also noticed that there is a 'white space' problem when undoing past an operation that uses ClearScreen, as the space for the text is restored but not the text itself!</p>\n</blockquote>\n<p>It seems like I remember someone mentioning this previously? ( I <s>might be</s> am crazy, though.)</p>\n<hr>\n<h3>Opinion(s)</h3>\n<p>I am quite fond of UNDO (and making it fully functional), but, now that I've thought about it, I wouldn't call this thing with <code>ClearScreen</code> an UNDO issue.  I would opine that this is something which should be handled by any author who chooses to clear the screen with <code>ClearScreen</code> during play -- an offense of which I have been guilty on numerous occasions.</p>\n<p>Instead of using <code>ClearScreen</code> in a parser (especially a parser that has the UNDO feature), perhaps it would be better to print out a blank div which is the height of the output element.  This is how the old text adventures did it (I think).  It has the same effect, but the player can always scroll up to view everything printed during play.</p>\n<p>I'm pretty sure this would look odd in Quest, though.</p>\n<p><strong>EDIT</strong></p>\n<p>I'm pretty sure this will do that (\"that\" meaning: create a screen full of whitespace):</p>\n<pre><code>msg (\"&lt;div style='min-height:100vh;'&gt;&lt;/div&gt;\")\nmsg (\"Your screen just got cleared the old way!\")\n</code></pre>\n<p><strong>EDIT 2</strong></p>\n<p>Tested and approved (although it does act a little funny).</p>\n\n",
      "PostDate": "2021-01-02T00:52:30.4168057Z",
      "LastEditDate": "2021-01-02T01:28:39.4492056Z",
      "link": null
    },
    {
      "PostId": "d44b36a9-35a3-4210-a40c-ed840ab87b81",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I played around with this for a few minutes.\r\n\r\nI don't think UNDO should have anything to do with what text has printed or what text has been cleared.  Otherwise, logic would dictate that UNDO should clear the text printed out in response to each action being undone and restore any text cleared due each action, and that would be illogical.",
      "EditableFormat": "markdown",
      "HTML": "<p>I played around with this for a few minutes.</p>\n<p>I don't think UNDO should have anything to do with what text has printed or what text has been cleared.  Otherwise, logic would dictate that UNDO should clear the text printed out in response to each action being undone and restore any text cleared due each action, and that would be illogical.</p>\n\n",
      "PostDate": "2021-01-02T01:21:59.2694591Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1bcfb967-0ae8-4c05-855e-f752709438fc",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi K.V., Happy New Year!\r\nSorry, my posting was lazy! I should have provided code. I've now done that in the game where I noticed the problem:\r\nhttps://textadventures.co.uk/games/view/e4hrqb_vpeo4np1a0jel9g/l-too-another-mathemagical-adventure\r\n\r\nTo see the issue: \r\n1. run the game online and type ABOUT to bring up a couple of pages of text\r\n2. type CLEAR, which just uses ClearScreen to remove the text\r\n3. type UNDO, which seems to insert the white space occupied by the text as a side effect of undoing CLEAR?\r\n\r\n**UPDATE**\r\nThe problem seems to be in the code I use to restore the state of the game after UNDO, rather than UNDO itself, linked to code you gave me to deal with white space appearing when game panes are swapped out:\r\nhttps://textadventures.co.uk/forum/quest/topic/w7mtakf7ykixomwl09kjfw/pain-with-panes-issue-3-expanding-whitespace\r\n\r\nI'll experiment further!\r\n\r\n**UPDATE 2**\r\nYou gave me the following code in 2018 to tidy up white space when taking out game panes:\r\n```\r\nJS.eval (\"var reHeight = 0;  $('#divOutput').children().each(function(){reHeight += $(this).height();});  $('#divOutput').css('min-height',reHeight);\")\r\n```\r\nUnfortunately that seems to fail after the use of ClearScreen. For example, in the posted game:\r\n1. Type PANES twice to move panes in and out, showing all is fine\r\n2. Type CLEAR\r\n3. Type PANES twice again\r\n\r\nOn the second use, when removing the panes, white space appears. My easy workaround is to remove the use of ClearScreen but I'd love to know what was causing the problem?",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi K.V., Happy New Year!<br>\nSorry, my posting was lazy! I should have provided code. I've now done that in the game where I noticed the problem:<br>\nhttps://textadventures.co.uk/games/view/e4hrqb_vpeo4np1a0jel9g/l-too-another-mathemagical-adventure</p>\n<p>To see the issue:</p>\n<ol>\n<li>run the game online and type ABOUT to bring up a couple of pages of text</li>\n<li>type CLEAR, which just uses ClearScreen to remove the text</li>\n<li>type UNDO, which seems to insert the white space occupied by the text as a side effect of undoing CLEAR?</li>\n</ol>\n<p><strong>UPDATE</strong><br>\nThe problem seems to be in the code I use to restore the state of the game after UNDO, rather than UNDO itself, linked to code you gave me to deal with white space appearing when game panes are swapped out:<br>\nhttps://textadventures.co.uk/forum/quest/topic/w7mtakf7ykixomwl09kjfw/pain-with-panes-issue-3-expanding-whitespace</p>\n<p>I'll experiment further!</p>\n<p><strong>UPDATE 2</strong><br>\nYou gave me the following code in 2018 to tidy up white space when taking out game panes:</p>\n<pre><code>JS.eval (\"var reHeight = 0;  $('#divOutput').children().each(function(){reHeight += $(this).height();});  $('#divOutput').css('min-height',reHeight);\")\n</code></pre>\n<p>Unfortunately that seems to fail after the use of ClearScreen. For example, in the posted game:</p>\n<ol>\n<li>Type PANES twice to move panes in and out, showing all is fine</li>\n<li>Type CLEAR</li>\n<li>Type PANES twice again</li>\n</ol>\n<p>On the second use, when removing the panes, white space appears. My easy workaround is to remove the use of ClearScreen but I'd love to know what was causing the problem?</p>\n\n",
      "PostDate": "2021-01-02T08:29:32.70665Z",
      "LastEditDate": "2021-01-02T11:36:53.7983617Z",
      "link": null
    },
    {
      "PostId": "7c20335d-b072-4db5-88ce-8a7a8f2fbd74",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Man, I really wish I remembered doing all this.  I have no clue where I came up with that code in UPDATE 2.\r\n\r\nAnyway, it has something to do the ```min-height``` of the \"divOutput\" element. \r\n\r\nRunning this in the console after the undo makes the whitespace go away:\r\n\r\n```document.getElementById('divOutput').style.minHeight = null```\r\n\r\n---\r\nSo, try adding this line at the end of your undo script:\r\n\r\n```\r\n     JS.eval(\"document.getElementById('divOutput').style.minHeight = null\")\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>Man, I really wish I remembered doing all this.  I have no clue where I came up with that code in UPDATE 2.</p>\n<p>Anyway, it has something to do the <code>min-height</code> of the \"divOutput\" element.</p>\n<p>Running this in the console after the undo makes the whitespace go away:</p>\n<p><code>document.getElementById('divOutput').style.minHeight = null</code></p>\n<hr>\n<p>So, try adding this line at the end of your undo script:</p>\n<pre><code>     JS.eval(\"document.getElementById('divOutput').style.minHeight = null\")\n</code></pre>\n\n",
      "PostDate": "2021-01-02T14:21:44.1343696Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a711ddb0-4790-41d7-87ee-5f1e4ec5837f",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Many thanks K.V. I've used your new code in place of the old, tying it specifically to tidying up after panes are removed, and everything now looks perfect. I've uploaded a new version of the game and it seems to be coping with every sequence I throw at it. I'll try playing through to just before the end and then undoing back to the beginning. It'll take a while!",
      "EditableFormat": "markdown",
      "HTML": "<p>Many thanks K.V. I've used your new code in place of the old, tying it specifically to tidying up after panes are removed, and everything now looks perfect. I've uploaded a new version of the game and it seems to be coping with every sequence I throw at it. I'll try playing through to just before the end and then undoing back to the beginning. It'll take a while!</p>\n\n",
      "PostDate": "2021-01-02T15:06:17.9530634Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "f431ab3c-22ef-479c-8309-d184c725a5af",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hurray!\r\n\r\nAfter reading through mrangel's posts in that old thread, that seemed like the fix.\r\n\r\nSo, mrangel technically solved this one.",
      "EditableFormat": "markdown",
      "HTML": "<p>Hurray!</p>\n<p>After reading through mrangel's posts in that old thread, that seemed like the fix.</p>\n<p>So, mrangel technically solved this one.</p>\n\n",
      "PostDate": "2021-01-02T15:33:02.2692092Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "ea03f119-7f3f-4ae0-a880-91b2fa65b11c",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thanks K.V. I'd call it a joint effort but I still plan to buy another book from mrangel when I've finished the three I've downloaded already. I'm not currently working on any games so hopefully I won't be bothering the forum for a while.",
      "EditableFormat": "markdown",
      "HTML": "<p>Thanks K.V. I'd call it a joint effort but I still plan to buy another book from mrangel when I've finished the three I've downloaded already. I'm not currently working on any games so hopefully I won't be bothering the forum for a while.</p>\n\n",
      "PostDate": "2021-01-02T16:11:58.6860791Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "8e862faf-e596-43a4-9513-7ea406840042",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I have no idea why Quest keeps setting the document's min-height to the height of its contents. That should have no effect at all, except introducing pointless white space.\r\n\r\nYou might as well do something like `$('head style').last().append('#divOutput {min-height: initial !important}')` in your init script, and not have to keep fiddling with edge cases.",
      "EditableFormat": "markdown",
      "HTML": "<p>I have no idea why Quest keeps setting the document's min-height to the height of its contents. That should have no effect at all, except introducing pointless white space.</p>\n<p>You might as well do something like <code>$('head style').last().append('#divOutput {min-height: initial !important}')</code> in your init script, and not have to keep fiddling with edge cases.</p>\n\n",
      "PostDate": "2021-01-02T18:31:16.0096387Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "acca943f-e758-4338-a30e-8bab65003452",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "@mrangel, many thanks for the simplified code. I've tried it out on the cases that were failing and all seems perfect. I'll use a longer test tomorrow.",
      "EditableFormat": "markdown",
      "HTML": "<p>@mrangel, many thanks for the simplified code. I've tried it out on the cases that were failing and all seems perfect. I'll use a longer test tomorrow.</p>\n\n",
      "PostDate": "2021-01-02T19:22:41.6807305Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "3e0c1fd8-9159-4b04-abb7-783aad850b08",
      "UserId": 199273,
      "Username": "DavyB",
      "AvatarUrl": "http://i.imgur.com/8BcaZCyb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Apologies mrangel, in my rush to test your code yesterday I must have left in K.V.s code as well because tests this morning show white space returning. K.V.'s solution is reasonably specific anyway as it is only used when panes are removed and I have given it a thorough check (I think!)",
      "EditableFormat": "markdown",
      "HTML": "<p>Apologies mrangel, in my rush to test your code yesterday I must have left in K.V.s code as well because tests this morning show white space returning. K.V.'s solution is reasonably specific anyway as it is only used when panes are removed and I have given it a thorough check (I think!)</p>\n\n",
      "PostDate": "2021-01-03T12:45:07.6698207Z",
      "LastEditDate": "2021-01-03T15:22:47.4221635Z",
      "link": null
    }
  ]
}
