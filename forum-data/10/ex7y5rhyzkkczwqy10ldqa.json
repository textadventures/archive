{
  "Topic": {
    "TopicId": "ex7y5rhyzkkczwqy10ldqa",
    "ForumId": "10",
    "Title": "What attribute is read by firsttime {} again?",
    "LastUpdated": "2019-10-04T19:31:18.125429Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "15c0d138-a811-4473-9519-01767213182c",
      "UserId": 418279,
      "Username": "Zesc",
      "AvatarUrl": "https://i.imgur.com/bGcfC7sb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Greetings fellow Quest users!\r\n\r\nI'm currently cleaning up my code, which mostly means defining function to do stuff more efficiently. In once instance, i could spare about 1200 lines of code (yes, indeed) by compressing an ```firsttime {} otherwise {}``` script that is used in over 200 pages in a single function.\r\n\r\nHowever, it turns out (as i was afraid) that ```firsttime[}``` is triggering only the frist time this script is called... If i recall correctly, ```firsttime {}``` does check for an attribute inherent to objects. Atleast i've read that in a different thread. Now i would like to know what this attribute is, and how i can call it from the object that calls the function, and not the function itself?\r\n\r\nThanks in advance, i really appreciate the people who help me in the forum!",
      "EditableFormat": "markdown",
      "HTML": "<p>Greetings fellow Quest users!</p>\n<p>I'm currently cleaning up my code, which mostly means defining function to do stuff more efficiently. In once instance, i could spare about 1200 lines of code (yes, indeed) by compressing an <code>firsttime {} otherwise {}</code> script that is used in over 200 pages in a single function.</p>\n<p>However, it turns out (as i was afraid) that <code>firsttime[}</code> is triggering only the frist time this script is called... If i recall correctly, <code>firsttime {}</code> does check for an attribute inherent to objects. Atleast i've read that in a different thread. Now i would like to know what this attribute is, and how i can call it from the object that calls the function, and not the function itself?</p>\n<p>Thanks in advance, i really appreciate the people who help me in the forum!</p>\n\n",
      "PostDate": "2019-10-04T19:31:18.125429Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "549c572b-a7e0-4d9e-b44e-14ac2b3c68b4",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> If i recall correctly, `firsttime {}` does check for an attribute inherent to objects.\r\n\r\nUnfortunately not. There is no way to check if a `firsttime` statement has been fired, because it changes an attribute which is not exposed by the underlying code on the backend.\r\n\r\nIf you save a game after running a `firsttime {}` block, then you will notice that the actual script has changed: the `firsttime {}` block is actually removed from the script, and the corresponding `otherwise`  is replaced by the code that was inside it. This change only happens when the game is saved, though.\r\n\r\nA room's \"on first enter\" scripts use the room's `visited` attribute. The text processor's `{once:` directive uses the dictionary `game.textprocessor_seen`. But the flag for `firsttime` is only visible to the C# code.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>If i recall correctly, <code>firsttime {}</code> does check for an attribute inherent to objects.</p>\n</blockquote>\n<p>Unfortunately not. There is no way to check if a <code>firsttime</code> statement has been fired, because it changes an attribute which is not exposed by the underlying code on the backend.</p>\n<p>If you save a game after running a <code>firsttime {}</code> block, then you will notice that the actual script has changed: the <code>firsttime {}</code> block is actually removed from the script, and the corresponding <code>otherwise</code>  is replaced by the code that was inside it. This change only happens when the game is saved, though.</p>\n<p>A room's \"on first enter\" scripts use the room's <code>visited</code> attribute. The text processor's <code>{once:</code> directive uses the dictionary <code>game.textprocessor_seen</code>. But the flag for <code>firsttime</code> is only visible to the C# code.</p>\n\n",
      "PostDate": "2019-10-04T20:42:36.9899274Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "07c41dcd-4f9a-4041-9db9-f58b00d481bf",
      "UserId": 418279,
      "Username": "Zesc",
      "AvatarUrl": "https://i.imgur.com/bGcfC7sb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "This makes me sad.\r\n\r\nI could use ```{notfirst:}``` nested inside of ```msg ()``` for the ```otherwise``` part, but i *really* need to nest actual script inside of ```firsttime {}``` in order for this to work.\r\n\r\nCan i check for ```visited```  in gamebook mode too? And if so, how to make sure it's checking the attribute of the page that calls the function, and not the function?",
      "EditableFormat": "markdown",
      "HTML": "<p>This makes me sad.</p>\n<p>I could use <code>{notfirst:}</code> nested inside of <code>msg ()</code> for the <code>otherwise</code> part, but i <em>really</em> need to nest actual script inside of <code>firsttime {}</code> in order for this to work.</p>\n<p>Can i check for <code>visited</code>  in gamebook mode too? And if so, how to make sure it's checking the attribute of the page that calls the function, and not the function?</p>\n\n",
      "PostDate": "2019-10-05T18:56:46.1438421Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "252568f5-b8da-46a6-97a9-2d92822d9650",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Would it be possible to have the script set a flag when it is run, and use the same flag to see if it's running for the first time?\r\nSlightly more complex than using `firsttime`, but I can't think of any situation where it wouldn't be possible.\r\n\r\nI think the gamebook mode has a different attribute equivalent to `visited`, but I'm not sure.\r\n\r\nEDIT: The attribute is still `visited`.\r\n\r\n> how to make sure it's checking the attribute of the page that calls the function, and not the function\r\n\r\nFunctions don't have attributes. You'd use `player.parent` to refer to the page the player is on.",
      "EditableFormat": "markdown",
      "HTML": "<p>Would it be possible to have the script set a flag when it is run, and use the same flag to see if it's running for the first time?<br>\nSlightly more complex than using <code>firsttime</code>, but I can't think of any situation where it wouldn't be possible.</p>\n<p>I think the gamebook mode has a different attribute equivalent to <code>visited</code>, but I'm not sure.</p>\n<p>EDIT: The attribute is still <code>visited</code>.</p>\n<blockquote>\n<p>how to make sure it's checking the attribute of the page that calls the function, and not the function</p>\n</blockquote>\n<p>Functions don't have attributes. You'd use <code>player.parent</code> to refer to the page the player is on.</p>\n\n",
      "PostDate": "2019-10-05T21:59:39.1152106Z",
      "LastEditDate": "2019-10-09T20:34:26.2150832Z",
      "link": null
    },
    {
      "PostId": "f016044a-79d1-476b-a6ed-b41a98cdfc72",
      "UserId": 418279,
      "Username": "Zesc",
      "AvatarUrl": "https://i.imgur.com/bGcfC7sb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Eh, i'll try sifting through the core libraries if i have time, trying to find out how it is called.\r\n\r\nMaking the script set a flag for each page, and then checking is one was set there seems... highly inefficient to me. I might save some time copy&pasting (let's be honest, performance and file size aren't a problem), but instead, the game will have to manage about 200 new booleans...\r\n\r\n\r\nEDIT: i just found out this forum has a reading mode in firefox when you press F9. Like... whoa...",
      "EditableFormat": "markdown",
      "HTML": "<p>Eh, i'll try sifting through the core libraries if i have time, trying to find out how it is called.</p>\n<p>Making the script set a flag for each page, and then checking is one was set there seems... highly inefficient to me. I might save some time copy&amp;pasting (let's be honest, performance and file size aren't a problem), but instead, the game will have to manage about 200 new booleans...</p>\n<p>EDIT: i just found out this forum has a reading mode in firefox when you press F9. Like... whoa...</p>\n\n",
      "PostDate": "2019-10-08T18:34:36.2075467Z",
      "LastEditDate": "2019-10-08T18:35:53.7708604Z",
      "link": null
    },
    {
      "PostId": "92e6401c-66f8-4b48-bf13-da7a7a1036f6",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "What are you trying to do that needs so many flags?\r\n\r\nIf you're looking at copy/pasting that much code, there's very likely an easier way to do it.",
      "EditableFormat": "markdown",
      "HTML": "<p>What are you trying to do that needs so many flags?</p>\n<p>If you're looking at copy/pasting that much code, there's very likely an easier way to do it.</p>\n\n",
      "PostDate": "2019-10-08T19:10:52.9942995Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "c8b74f62-bd94-408a-b45d-cfae49df4b45",
      "UserId": 418279,
      "Username": "Zesc",
      "AvatarUrl": "https://i.imgur.com/bGcfC7sb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Well, since my game is pretty much open ended in most parts, most pages have a simple script running so i can keep track of the player's progression. (It is also used for a completition percentage.) This is how it looks like: \r\n```\r\nfirsttime {\r\n  player.score = player.score+1\r\n}\r\notherwise {\r\n  msg (\"<i>You've already been here.</i><br>\")\r\n}\r\n```\r\nI probably can shorten the ```otherwise``` part with the aforementioned ```{notfirst:}```, but that won't help me with the actual code.\r\n\r\nAt the moment, this is standing at the beginning of over 200 pages. It is perfectly working, but you can see that this could be done more _soigné_ if i would use a function... but that doesn't work.",
      "EditableFormat": "markdown",
      "HTML": "<p>Well, since my game is pretty much open ended in most parts, most pages have a simple script running so i can keep track of the player's progression. (It is also used for a completition percentage.) This is how it looks like:</p>\n<pre><code>firsttime {\n  player.score = player.score+1\n}\notherwise {\n  msg (\"&lt;i&gt;You've already been here.&lt;/i&gt;&lt;br&gt;\")\n}\n</code></pre>\n<p>I probably can shorten the <code>otherwise</code> part with the aforementioned <code>{notfirst:}</code>, but that won't help me with the actual code.</p>\n<p>At the moment, this is standing at the beginning of over 200 pages. It is perfectly working, but you can see that this could be done more <em>soigné</em> if i would use a function... but that doesn't work.</p>\n\n",
      "PostDate": "2019-10-09T19:17:14.3735448Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "439d9a2b-47d4-476e-9b47-3acdd008e2c7",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> I probably can shorten the otherwise part with the aforementioned {notfirst:}, \r\n\r\nNot in that case. Because `{notfirst:` only checks if the game has tried to display *that particular message* before. So if the same message is on multiple pages, it would check if it's the first time the code has reached any of them.\r\n\r\n<hr />\r\n\r\nBut if your script is at the start of the page, not inside an `if` or `while` block, you can probably do:\r\n```\r\nif (HasSeenPage (player.parent)) {\r\n  msg (\"<i>You've already been here.</i><br>\")\r\n}\r\nelse {\r\n  player.score = player.score+1\r\n}\r\n```\r\nThat's not the same as using `firsttime {}` - that script only checks if they've been to the page before. `firsttime {}` checks if they've reached that part of the script before - so you can put `firsttime {}` inside an `if` block, and it will only trigger the first time the condition is met.\r\n\r\n(note - `HasSeenPage` tests if the player has *ended* their turn on a given page. So if a script on the page sends them somewhere else, it won't realise they've already been there)\r\n\r\n<hr />\r\n\r\nAlso, is this code on every page? And is it always 1 point per page?\r\n\r\nIf so, then you can put it in the `game.roomenter` script (\"Script when entering page\" on the \"Script\" tab of the game in the editor). That makes it run for every page without needing to copy/paste it.\r\n\r\n<hr />\r\n\r\n> Making the script set a flag for each page, and then checking is one was set there seems... highly inefficient to me. I might save some time copy&pasting (let's be honest, performance and file size aren't a problem), but instead, the game will have to manage about 200 new booleans...\r\n\r\nThe game is managing a boolean for every `firsttime` it sees anyway. They're just stored within the script object, and not accessible to Quest code.\r\n\r\nIf you can't use `HasSeenPage()`/`visited` for some reason (for example, because the function is called within an `if` block), then your most efficient solution would be a function that looks like:\r\n\r\n```\r\nif (GetBoolean (player.parent, \"score_counted\")) {\r\n  msg (\"<i>You've already been here.</i><br>\")\r\n}\r\nelse {\r\n  player.score = player.score+1\r\n}\r\nplayer.parent.score_counted = true\r\n```\r\n\r\nAn extra boolean is literally the smallest possible amount of storage space necessary to record whether or not something has happened.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I probably can shorten the otherwise part with the aforementioned {notfirst:},</p>\n</blockquote>\n<p>Not in that case. Because <code>{notfirst:</code> only checks if the game has tried to display <em>that particular message</em> before. So if the same message is on multiple pages, it would check if it's the first time the code has reached any of them.</p>\n<hr>\n<p>But if your script is at the start of the page, not inside an <code>if</code> or <code>while</code> block, you can probably do:</p>\n<pre><code>if (HasSeenPage (player.parent)) {\n  msg (\"&lt;i&gt;You've already been here.&lt;/i&gt;&lt;br&gt;\")\n}\nelse {\n  player.score = player.score+1\n}\n</code></pre>\n<p>That's not the same as using <code>firsttime {}</code> - that script only checks if they've been to the page before. <code>firsttime {}</code> checks if they've reached that part of the script before - so you can put <code>firsttime {}</code> inside an <code>if</code> block, and it will only trigger the first time the condition is met.</p>\n<p>(note - <code>HasSeenPage</code> tests if the player has <em>ended</em> their turn on a given page. So if a script on the page sends them somewhere else, it won't realise they've already been there)</p>\n<hr>\n<p>Also, is this code on every page? And is it always 1 point per page?</p>\n<p>If so, then you can put it in the <code>game.roomenter</code> script (\"Script when entering page\" on the \"Script\" tab of the game in the editor). That makes it run for every page without needing to copy/paste it.</p>\n<hr>\n<blockquote>\n<p>Making the script set a flag for each page, and then checking is one was set there seems... highly inefficient to me. I might save some time copy&amp;pasting (let's be honest, performance and file size aren't a problem), but instead, the game will have to manage about 200 new booleans...</p>\n</blockquote>\n<p>The game is managing a boolean for every <code>firsttime</code> it sees anyway. They're just stored within the script object, and not accessible to Quest code.</p>\n<p>If you can't use <code>HasSeenPage()</code>/<code>visited</code> for some reason (for example, because the function is called within an <code>if</code> block), then your most efficient solution would be a function that looks like:</p>\n<pre><code>if (GetBoolean (player.parent, \"score_counted\")) {\n  msg (\"&lt;i&gt;You've already been here.&lt;/i&gt;&lt;br&gt;\")\n}\nelse {\n  player.score = player.score+1\n}\nplayer.parent.score_counted = true\n</code></pre>\n<p>An extra boolean is literally the smallest possible amount of storage space necessary to record whether or not something has happened.</p>\n\n",
      "PostDate": "2019-10-09T20:41:41.1074907Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "eb18a370-4e36-4457-8ceb-80e5ffa12442",
      "UserId": 418279,
      "Username": "Zesc",
      "AvatarUrl": "https://i.imgur.com/bGcfC7sb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "```HasSeenPage()```... this is pretty much everything i've been asking for to get the script, now i can do the rest.\r\n\r\n>Also, is this code on every page? And is it always 1 point per page?\r\n\r\nNope. I know there is a script to be executed on every page, and already using that handy function. It is used on *most*, but not *all* pages... some are reserved for things like the main menu, scripts that redirect the player elsewhere, and other things that have no reason to count to the completition percentage.\r\n\r\n>An extra boolean is literally the smallest possible amount of storage space necessary to record whether or not something has happened.\r\n\r\nSo, technically you're right, but let me nitpick: In cases like these, where you have a whole bunch of booleans for a whole bunch of things, there are actually some ways to compress the storage size... not by much, but it certainly isn't practical, but i need to smart-arse my way through life. :P\r\n\r\nAnyway, thanks, this is very helpful.",
      "EditableFormat": "markdown",
      "HTML": "<p><code>HasSeenPage()</code>... this is pretty much everything i've been asking for to get the script, now i can do the rest.</p>\n<blockquote>\n<p>Also, is this code on every page? And is it always 1 point per page?</p>\n</blockquote>\n<p>Nope. I know there is a script to be executed on every page, and already using that handy function. It is used on <em>most</em>, but not <em>all</em> pages... some are reserved for things like the main menu, scripts that redirect the player elsewhere, and other things that have no reason to count to the completition percentage.</p>\n<blockquote>\n<p>An extra boolean is literally the smallest possible amount of storage space necessary to record whether or not something has happened.</p>\n</blockquote>\n<p>So, technically you're right, but let me nitpick: In cases like these, where you have a whole bunch of booleans for a whole bunch of things, there are actually some ways to compress the storage size... not by much, but it certainly isn't practical, but i need to smart-arse my way through life. :P</p>\n<p>Anyway, thanks, this is very helpful.</p>\n\n",
      "PostDate": "2019-10-10T16:07:33.591148Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
