{
  "Topic": {
    "TopicId": "4yzeob4clkw125dckngg-w",
    "ForumId": "10",
    "Title": "Timer that resets itself?",
    "LastUpdated": "2021-06-19T15:52:42.690082Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "82f2b108-b1f9-4151-9364-ce62a0b2cc82",
      "UserId": 374963,
      "Username": "Sara377544",
      "AvatarUrl": "https://i.imgur.com/YCtLz3Nb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "What I wanted is a timer that, after it finishes, it resets itself.\r\n\r\nFor example, lets say you get food every 60 seconds. Then you run a script to eat it. After you eat, I want more food to arrive in 60 seconds.\r\n\r\nThe problem seems to be that the event repeats itself multiple times without me finishing the script to 'eat it'. So you get multiple eating scripts.",
      "EditableFormat": "markdown",
      "HTML": "<p>What I wanted is a timer that, after it finishes, it resets itself.</p>\n<p>For example, lets say you get food every 60 seconds. Then you run a script to eat it. After you eat, I want more food to arrive in 60 seconds.</p>\n<p>The problem seems to be that the event repeats itself multiple times without me finishing the script to 'eat it'. So you get multiple eating scripts.</p>\n\n",
      "PostDate": "2021-06-19T15:52:42.690082Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2a2bac7a-cf64-4e20-89e8-09710b87623b",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hello.\r\n\r\n1. Are you making a Gamebook or a Text Adventure?\r\n\r\n2. Are you using the desktop version of Quest or the online version?\r\n\r\n3. Do you really want to use a 60 second timer, or would it be better if triggered on the following turn?\r\n\r\n4. Can you post the bit of code you have, to make it easier for us to help you in this specific instance?\r\n\r\n---\r\nBUGGY CODE REMOVED",
      "EditableFormat": "markdown",
      "HTML": "<p>Hello.</p>\n<ol>\n<li>\n<p>Are you making a Gamebook or a Text Adventure?</p>\n</li>\n<li>\n<p>Are you using the desktop version of Quest or the online version?</p>\n</li>\n<li>\n<p>Do you really want to use a 60 second timer, or would it be better if triggered on the following turn?</p>\n</li>\n<li>\n<p>Can you post the bit of code you have, to make it easier for us to help you in this specific instance?</p>\n</li>\n</ol>\n<hr>\n<p>BUGGY CODE REMOVED</p>\n\n",
      "PostDate": "2021-06-19T17:08:27.7617102Z",
      "LastEditDate": "2021-06-20T22:32:56.1974028Z",
      "link": null
    },
    {
      "PostId": "93922a74-c327-4499-9b2a-f6bde5a45f3a",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "BUGGY CODE REMOVED",
      "EditableFormat": "markdown",
      "HTML": "<p>BUGGY CODE REMOVED</p>\n\n",
      "PostDate": "2021-06-19T17:27:37.0429431Z",
      "LastEditDate": "2021-06-20T22:32:31.3991248Z",
      "link": null
    },
    {
      "PostId": "2b1a8a46-d775-4425-990b-5bdb6197633c",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Small bug. If you eat the food, leave the room, and return it will spawn food immediately. Then 60 seconds after the eating, it will print \"The waiter brings more food\" again even if there's food there.",
      "EditableFormat": "markdown",
      "HTML": "<p>Small bug. If you eat the food, leave the room, and return it will spawn food immediately. Then 60 seconds after the eating, it will print \"The waiter brings more food\" again even if there's food there.</p>\n\n",
      "PostDate": "2021-06-19T17:36:16.0179405Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "4751bb8b-3705-4530-86ec-8f1aa31a16dd",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> Small bug. \r\n\r\nI must have changed some code after you copied it to test it. I can't get it to do that.\r\n\r\nAll the code posted is updated now.\r\n\r\nAlso, I updated my example to only wait 5 seconds rather than 60 for sanity's sake during testing.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>Small bug.</p>\n</blockquote>\n<p>I must have changed some code after you copied it to test it. I can't get it to do that.</p>\n<p>All the code posted is updated now.</p>\n<p>Also, I updated my example to only wait 5 seconds rather than 60 for sanity's sake during testing.</p>\n\n",
      "PostDate": "2021-06-19T17:58:01.3603491Z",
      "LastEditDate": "2021-06-19T18:03:44.0119481Z",
      "link": null
    },
    {
      "PostId": "52e024c5-f442-4753-a05f-f901d876aa0a",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Looks valid. I'm probably just confused.\r\n\r\nAlthough I think it's odd that you can get food sooner by leaving and coming back.\r\nI'd probably do  something like:\r\n```\r\n<timer name=\"foodtimer\">\r\n  <interval>60</interval>\r\n  <script>\r\n    if (game.pov.parent = diner and not food.visible) {\r\n      food.visible = true\r\n      food.parent = diner\r\n      msg (\"The waiter brings you some {notfirst:more }{object:food}.\")\r\n    }\r\n    DisableTimer (this)\r\n  </script>\r\n</timer>\r\n\r\n<object name=\"diner\">\r\n  <enter>\r\n    if (GetBoolean (foodtimer, \"enabled\")) {\r\n      msg (\"As you return, the waiter calls that your food will be ready in a moment.\")\r\n    }\r\n    else if (not food.visible) {\r\n      msg (\"You ask for food, and the waiter takes your order.\")\r\n      EnableTimer (foodtimer)\r\n    }\r\n  </enter>\r\n\r\n  <object name=\"food\">\r\n    <eat type=\"script\">\r\n      msg (\"Yum!\")\r\n      msg (\"the waiter bustles over, clears away your plate, and says “I'll bring you more in a minute.”\")\r\n      this.visible = false\r\n      EnableTimer (foodtimer)\r\n    </eat>\r\n  </object>\r\n</object>\r\n```\r\nUsing a single timer rather than `SetTimeout` can be useful, because you can use `EnableTimer` to start it again, and it will always trigger 60 seconds after the last time it was enabled",
      "EditableFormat": "markdown",
      "HTML": "<p>Looks valid. I'm probably just confused.</p>\n<p>Although I think it's odd that you can get food sooner by leaving and coming back.<br>\nI'd probably do  something like:</p>\n<pre><code>&lt;timer name=\"foodtimer\"&gt;\n  &lt;interval&gt;60&lt;/interval&gt;\n  &lt;script&gt;\n    if (game.pov.parent = diner and not food.visible) {\n      food.visible = true\n      food.parent = diner\n      msg (\"The waiter brings you some {notfirst:more }{object:food}.\")\n    }\n    DisableTimer (this)\n  &lt;/script&gt;\n&lt;/timer&gt;\n\n&lt;object name=\"diner\"&gt;\n  &lt;enter&gt;\n    if (GetBoolean (foodtimer, \"enabled\")) {\n      msg (\"As you return, the waiter calls that your food will be ready in a moment.\")\n    }\n    else if (not food.visible) {\n      msg (\"You ask for food, and the waiter takes your order.\")\n      EnableTimer (foodtimer)\n    }\n  &lt;/enter&gt;\n\n  &lt;object name=\"food\"&gt;\n    &lt;eat type=\"script\"&gt;\n      msg (\"Yum!\")\n      msg (\"the waiter bustles over, clears away your plate, and says “I'll bring you more in a minute.”\")\n      this.visible = false\n      EnableTimer (foodtimer)\n    &lt;/eat&gt;\n  &lt;/object&gt;\n&lt;/object&gt;\n</code></pre>\n<p>Using a single timer rather than <code>SetTimeout</code> can be useful, because you can use <code>EnableTimer</code> to start it again, and it will always trigger 60 seconds after the last time it was enabled</p>\n\n",
      "PostDate": "2021-06-19T18:24:01.3159779Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "47f62475-b485-43b6-b7a0-42c31bc328d0",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> Although I think it's odd that you can get food sooner by leaving and coming back.\r\n\r\nOh. Ha ha!\r\n\r\nI guess it's an all you can eat joint? They bring you a plate as soon as you walk in, then check on you once a minute. :)",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>Although I think it's odd that you can get food sooner by leaving and coming back.</p>\n</blockquote>\n<p>Oh. Ha ha!</p>\n<p>I guess it's an all you can eat joint? They bring you a plate as soon as you walk in, then check on you once a minute. :)</p>\n\n",
      "PostDate": "2021-06-19T18:30:22.7919081Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "ae948b9e-87c8-4dfc-86ec-c096cbd318cf",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "PS\r\n\r\nI was going to test it again after I updated Arch Linux, but something in the update broke my Quest install under WINE.\r\n\r\n...and the web editor is not my friend; so, I don't play with it.\r\n\r\n---\r\nIf this code is messed up, or if you need any other help, or if this code isn't really what you wanted, just say the word. Someone will fix you up!",
      "EditableFormat": "markdown",
      "HTML": "<p>PS</p>\n<p>I was going to test it again after I updated Arch Linux, but something in the update broke my Quest install under WINE.</p>\n<p>...and the web editor is not my friend; so, I don't play with it.</p>\n<hr>\n<p>If this code is messed up, or if you need any other help, or if this code isn't really what you wanted, just say the word. Someone will fix you up!</p>\n\n",
      "PostDate": "2021-06-20T00:44:44.2883673Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "f74ebca1-427a-48f3-8630-af2510d7daa3",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Actually… I think there might still be a bug there, but it's a little less obvious.\r\n\r\nEat food, go out, go in (food is spawned), eat food (again). More food arrives 60 seconds after the first time you ate, which may be just a couple of seconds after you finished the other one depending on the player's typing speed.\r\n\r\nI suppose this could be realistic… maybe you got a different waiter the second time, and each of them looks to see if you have food every minute, without realising that someone else is serving you in between. It depends what you want to happen.\r\n\r\nBut I think that rather than checking the existence of the food before spawning it, I would rather check for a running timer.\r\n\r\nTo do this with SetTimeout you would need to set an ID, so that you can use `GetTimer` to check if it currently exists. Or, as in my code, you could have a timer that always exists and just set or check its `enabled` flag.",
      "EditableFormat": "markdown",
      "HTML": "<p>Actually… I think there might still be a bug there, but it's a little less obvious.</p>\n<p>Eat food, go out, go in (food is spawned), eat food (again). More food arrives 60 seconds after the first time you ate, which may be just a couple of seconds after you finished the other one depending on the player's typing speed.</p>\n<p>I suppose this could be realistic… maybe you got a different waiter the second time, and each of them looks to see if you have food every minute, without realising that someone else is serving you in between. It depends what you want to happen.</p>\n<p>But I think that rather than checking the existence of the food before spawning it, I would rather check for a running timer.</p>\n<p>To do this with SetTimeout you would need to set an ID, so that you can use <code>GetTimer</code> to check if it currently exists. Or, as in my code, you could have a timer that always exists and just set or check its <code>enabled</code> flag.</p>\n\n",
      "PostDate": "2021-06-20T16:33:47.4308632Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1bb36175-0e90-454b-9309-ebca2ebe345b",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I was aiming for:\r\n\r\n```\r\n10 enter diner\r\n20 if food is not visible, waiter brings food\r\n30 if food is eaten in diner, waiter brings more in 5 seconds\r\n40 if food is eaten outside of diner, nothing happens\r\n50 re-enter diner with no food, goto 10 (metaphorically)\r\n60 re-enter diner with food, goto 30 (metaphorically)\r\n```\r\n\r\n---\r\nSo, I put the trigger for the timer on the ```eat``` verb on the food, which will end up calling a function, which should only bring food if the player is in the diner and there is no food.\r\n\r\nI'll test it thoroughly after I figure out what the update to Arch changed that broke Quest under WINE.",
      "EditableFormat": "markdown",
      "HTML": "<p>I was aiming for:</p>\n<pre><code>10 enter diner\n20 if food is not visible, waiter brings food\n30 if food is eaten in diner, waiter brings more in 5 seconds\n40 if food is eaten outside of diner, nothing happens\n50 re-enter diner with no food, goto 10 (metaphorically)\n60 re-enter diner with food, goto 30 (metaphorically)\n</code></pre>\n<hr>\n<p>So, I put the trigger for the timer on the <code>eat</code> verb on the food, which will end up calling a function, which should only bring food if the player is in the diner and there is no food.</p>\n<p>I'll test it thoroughly after I figure out what the update to Arch changed that broke Quest under WINE.</p>\n\n",
      "PostDate": "2021-06-20T16:44:14.2870219Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "8272b965-0897-4134-9734-402cd7640736",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Seems logical. But I think your line 50 should either be:\r\n```\r\n50 re-enter diner with no food and timer isn't running, goto 10 (metaphorically)\r\n```\r\nor\r\n```\r\n50 re-enter diner with no food, stop timer and goto 10 (metaphorically)\r\n```\r\nYou're testing if there is food on the table, but not if the waiter is currently away getting you some.\r\n\r\n\r\nAlso, I should point out that your `food.eaten_once` is a little unnecessary complexity, unless you're doing something else with it. All you're doing is changing a message the first time it's printed, which there is already a text processor directive for. (`{once:` or `{notfirst:`, which you can use either or both of)",
      "EditableFormat": "markdown",
      "HTML": "<p>Seems logical. But I think your line 50 should either be:</p>\n<pre><code>50 re-enter diner with no food and timer isn't running, goto 10 (metaphorically)\n</code></pre>\n<p>or</p>\n<pre><code>50 re-enter diner with no food, stop timer and goto 10 (metaphorically)\n</code></pre>\n<p>You're testing if there is food on the table, but not if the waiter is currently away getting you some.</p>\n<p>Also, I should point out that your <code>food.eaten_once</code> is a little unnecessary complexity, unless you're doing something else with it. All you're doing is changing a message the first time it's printed, which there is already a text processor directive for. (<code>{once:</code> or <code>{notfirst:</code>, which you can use either or both of)</p>\n\n",
      "PostDate": "2021-06-20T18:39:24.6081849Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "c70a8949-1244-49c9-b076-699fd32afb1b",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Oh!  I see what you're saying about the main bug.\r\n\r\nI have my timer on 5 seconds for testing, and I can't go out and back into to the diner within that time frame. That's why I couldn't recreate it.",
      "EditableFormat": "markdown",
      "HTML": "<p>Oh!  I see what you're saying about the main bug.</p>\n<p>I have my timer on 5 seconds for testing, and I can't go out and back into to the diner within that time frame. That's why I couldn't recreate it.</p>\n\n",
      "PostDate": "2021-06-20T21:38:04.0756569Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "6427c7da-0fc4-4983-8d36-9762c306ab91",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Well, Quest opens in my Arch install now, but the screen is black.\r\n\r\n---\r\nSince my code is buggy, and I can't fix it right now, I'm removing it from the earlier posts.",
      "EditableFormat": "markdown",
      "HTML": "<p>Well, Quest opens in my Arch install now, but the screen is black.</p>\n<hr>\n<p>Since my code is buggy, and I can't fix it right now, I'm removing it from the earlier posts.</p>\n\n",
      "PostDate": "2021-06-20T22:31:13.0800056Z",
      "LastEditDate": "2021-06-20T22:33:43.6163044Z",
      "link": null
    },
    {
      "PostId": "0bbb7c7d-a1d9-453b-9498-16c59083961a",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "PS\r\n\r\nI was using ```food.eaten_once``` to clear it out after leaving the diner. It seemed it shouldn't say \"more\" food the first time you get food during each visit.\r\n\r\n---\r\nAlso, I just now looked at this on a desktop browser. I didn't even see the code you posted until just now, mrangel. Ha ha. Had I seen that, I'd have left this one be. :)",
      "EditableFormat": "markdown",
      "HTML": "<p>PS</p>\n<p>I was using <code>food.eaten_once</code> to clear it out after leaving the diner. It seemed it shouldn't say \"more\" food the first time you get food during each visit.</p>\n<hr>\n<p>Also, I just now looked at this on a desktop browser. I didn't even see the code you posted until just now, mrangel. Ha ha. Had I seen that, I'd have left this one be. :)</p>\n\n",
      "PostDate": "2021-06-20T22:37:36.1772134Z",
      "LastEditDate": "2021-06-21T00:26:02.1859271Z",
      "link": null
    },
    {
      "PostId": "9219985e-a0d5-4d14-bf87-29a1f5862ef0",
      "UserId": 374963,
      "Username": "Sara377544",
      "AvatarUrl": "https://i.imgur.com/YCtLz3Nb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thank you everyone for your help. Somehow I managed to fix the script by just putting a disable timer in the beginning of the script and then putting a 'enable timer' at the end of the script. (Theres a couple messages separated by 'wait for a key press', and in the last one is where the enable timer is)\r\n\r\nStill learning but getting a bt better.",
      "EditableFormat": "markdown",
      "HTML": "<p>Thank you everyone for your help. Somehow I managed to fix the script by just putting a disable timer in the beginning of the script and then putting a 'enable timer' at the end of the script. (Theres a couple messages separated by 'wait for a key press', and in the last one is where the enable timer is)</p>\n<p>Still learning but getting a bt better.</p>\n\n",
      "PostDate": "2021-06-21T12:06:25.7889272Z",
      "LastEditDate": "2021-06-21T12:07:36.0364677Z",
      "link": null
    }
  ]
}
