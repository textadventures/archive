{
  "Topic": {
    "TopicId": "1875",
    "ForumId": "10",
    "Title": "Bug in QDK Pro 4.03 plus workaround",
    "LastUpdated": "2008-05-14T18:02:59+01:00",
    "ReplyCount": 2
  },
  "Posts": [
    {
      "PostId": "15029",
      "UserId": 0,
      "Username": "wsquires",
      "UserAvatar": null,
      "UserGravatar": "a05959621d38181f935e617da51de4b6",
      "EditableText": "Where can I file a bug report? Here's the situation:\n\n[b:rykt0cbz]Problem:[/b:rykt0cbz]\nNested comparisons 'lose' the statement order because QDK doesn't enforce its own use of '{','}' to enclose all statements within the &quot;then&quot; or &quot;else&quot; branch of conditionals.\n\n[b:rykt0cbz]Description:[/b:rykt0cbz]\nWhen a comparison has both &quot;then&quot; and &quot;else&quot; conditions, you nest a conditional inside the &quot;then&quot; of another conditional, and there's only a single statement in each block, its &quot;else&quot; code ends up in the &quot;else&quot; code of its outermost conditional. Example:\n\nif &lt;player has an object: lamp&gt; then\n  if &lt;the flag 'is_lit' = true&gt; then\n    Print &quot;you already turned on the light!&quot;\n  else\n    Set the flag 'is_lit' to true.\n  end if\nelse\n  Print &quot;you don't have the light!&quot;\nend if\n\nwhen you close the script editor window, and re-edit the script, the line &quot;Set the flag 'is_lit' to true&quot; will end up as part of the outermost else as: &quot;Set the flag 'is_lit' to true else Print &quot;you don't have the light!&quot;&quot;\n\n[b:rykt0cbz]To replicate:[/b:rykt0cbz]\n1) Start a new game (I called mine &quot;bugtest.asl&quot;)\n2) Create a new, blank room (it doesn't matter what you call it, it's just there so the player will have a place to start) and give it a simple description. &quot;Closet - This is a dark closet.&quot; for example.\n3) Create an item called &quot;flashlight&quot; in the room. Again, give the flashlight a simple description under the &quot;look&quot; verb. &quot;flashlight - This is a nice, shiny flashlight.&quot;\n4) Create a new verb for it, &quot;turn on&quot;, and select the &quot;run a script&quot; radio button. Click on the &quot;Edit...&quot; button to create a new script for this.\n5) Immediately, click the &quot;Add Conditional&quot; button (2nd from the left at the top.) Click on the &quot;Add&quot; button next to the &quot;If:&quot; pane.\n6) Select the condition &quot;player has an object&quot;, and &quot;flashlight&quot;. Click OK.\n7) Click the &quot;Edit...&quot; button near the &quot;Else:&quot; pane.\n8) In the editfield, type &quot;You don't have the flashlight!&quot; Click OK.\n9) Click the &quot;Edit...&quot; button near the &quot;Then:&quot; pane.\n10) Again, immediately click on the &quot;add conditional&quot; button.\n11) Select the condition &quot;a flag is set&quot;. Click on the &quot;NOT&quot; checkbox. Under &quot;Condition parameters&quot; type in &quot;is_lit&quot; into the editfield where it says &quot;Flag:&quot;. Click OK.\n12) Click the &quot;Edit...&quot; button next to the &quot;Else:&quot; pane. Type into the editfield, &quot;The flashlight is already on!&quot; Click OK.\n13) Click the &quot;Edit...&quot; button next to the &quot;Then:&quot; pane. Under &quot;Variables&quot; select &quot;Set a flag on&quot; and - in the right hand editfield, select &quot;is_lit&quot; from the popup menu, or just type it in. Click OK\n14) You should now be at the script editor for the inner nested conditional. Click OK.\n15) You should now be at the script editor for the outer conditional. Click OK.\n16) You should now be back at the main screen where you just added the &quot;turn on&quot; verb. It should still be selected. Click the &quot;Edit...&quot; button again. Whoops! Look at the &quot;Else:&quot; pane! It now says:\n\nPrint &quot;The flashlight is already on!&quot; Else Print &quot;You don't have the flashlight!&quot;\n\n[b:rykt0cbz]Workaround:[/b:rykt0cbz]\n  Make sure every &quot;Then:&quot; or &quot;Else:&quot; block in a [b:rykt0cbz]nested[/b:rykt0cbz] conditional has at least two statements; this'll force QDK to insert opening and closing curly braces so it won't get confused later. A single conditional by itself is not a problem, just when you nest them. It may also occur if you nest a Select Case in a conditional too, though I haven't encountered that yet.",
      "EditableFormat": "bbcode",
      "HTML": "Where can I file a bug report? Here's the situation:<br/><br/><span style=\"font-weight:bold;\">Problem:</span><br/>Nested comparisons 'lose' the statement order because QDK doesn't enforce its own use of '{','}' to enclose all statements within the &quot;then&quot; or &quot;else&quot; branch of conditionals.<br/><br/><span style=\"font-weight:bold;\">Description:</span><br/>When a comparison has both &quot;then&quot; and &quot;else&quot; conditions, you nest a conditional inside the &quot;then&quot; of another conditional, and there's only a single statement in each block, its &quot;else&quot; code ends up in the &quot;else&quot; code of its outermost conditional. Example:<br/><br/>if &lt;player has an object: lamp&gt; then<br/>  if &lt;the flag 'is_lit' = true&gt; then<br/>    Print &quot;you already turned on the light!&quot;<br/>  else<br/>    Set the flag 'is_lit' to true.<br/>  end if<br/>else<br/>  Print &quot;you don't have the light!&quot;<br/>end if<br/><br/>when you close the script editor window, and re-edit the script, the line &quot;Set the flag 'is_lit' to true&quot; will end up as part of the outermost else as: &quot;Set the flag 'is_lit' to true else Print &quot;you don't have the light!&quot;&quot;<br/><br/><span style=\"font-weight:bold;\">To replicate:</span><br/>1) Start a new game (I called mine &quot;bugtest.asl&quot;)<br/>2) Create a new, blank room (it doesn't matter what you call it, it's just there so the player will have a place to start) and give it a simple description. &quot;Closet - This is a dark closet.&quot; for example.<br/>3) Create an item called &quot;flashlight&quot; in the room. Again, give the flashlight a simple description under the &quot;look&quot; verb. &quot;flashlight - This is a nice, shiny flashlight.&quot;<br/>4) Create a new verb for it, &quot;turn on&quot;, and select the &quot;run a script&quot; radio button. Click on the &quot;Edit...&quot; button to create a new script for this.<br/>5) Immediately, click the &quot;Add Conditional&quot; button (2nd from the left at the top.) Click on the &quot;Add&quot; button next to the &quot;If:&quot; pane.<br/>6) Select the condition &quot;player has an object&quot;, and &quot;flashlight&quot;. Click OK.<br/>7) Click the &quot;Edit...&quot; button near the &quot;Else:&quot; pane.<br/>8) In the editfield, type &quot;You don't have the flashlight!&quot; Click OK.<br/>9) Click the &quot;Edit...&quot; button near the &quot;Then:&quot; pane.<br/>10) Again, immediately click on the &quot;add conditional&quot; button.<br/>11) Select the condition &quot;a flag is set&quot;. Click on the &quot;NOT&quot; checkbox. Under &quot;Condition parameters&quot; type in &quot;is_lit&quot; into the editfield where it says &quot;Flag:&quot;. Click OK.<br/>12) Click the &quot;Edit...&quot; button next to the &quot;Else:&quot; pane. Type into the editfield, &quot;The flashlight is already on!&quot; Click OK.<br/>13) Click the &quot;Edit...&quot; button next to the &quot;Then:&quot; pane. Under &quot;Variables&quot; select &quot;Set a flag on&quot; and - in the right hand editfield, select &quot;is_lit&quot; from the popup menu, or just type it in. Click OK<br/>14) You should now be at the script editor for the inner nested conditional. Click OK.<br/>15) You should now be at the script editor for the outer conditional. Click OK.<br/>16) You should now be back at the main screen where you just added the &quot;turn on&quot; verb. It should still be selected. Click the &quot;Edit...&quot; button again. Whoops! Look at the &quot;Else:&quot; pane! It now says:<br/><br/>Print &quot;The flashlight is already on!&quot; Else Print &quot;You don't have the flashlight!&quot;<br/><br/><span style=\"font-weight:bold;\">Workaround:</span><br/>  Make sure every &quot;Then:&quot; or &quot;Else:&quot; block in a <span style=\"font-weight:bold;\">nested</span> conditional has at least two statements; this'll force QDK to insert opening and closing curly braces so it won't get confused later. A single conditional by itself is not a problem, just when you nest them. It may also occur if you nest a Select Case in a conditional too, though I haven't encountered that yet.",
      "PostDate": "2008-05-13T15:42:08+01:00",
      "LastEditDate": null
    },
    {
      "PostId": "15030",
      "UserId": 0,
      "Username": "Alex",
      "UserAvatar": null,
      "UserGravatar": "188b72c5e13327f4fde3989dca7d7d53",
      "EditableText": "Excellent bug report - if only they were all this detailed! I've added it to the &quot;to do&quot; list for the next version.",
      "EditableFormat": "bbcode",
      "HTML": "Excellent bug report - if only they were all this detailed! I've added it to the &quot;to do&quot; list for the next version.",
      "PostDate": "2008-05-13T17:41:00+01:00",
      "LastEditDate": null
    },
    {
      "PostId": "15031",
      "UserId": 0,
      "Username": "wsquires",
      "UserAvatar": null,
      "UserGravatar": "a05959621d38181f935e617da51de4b6",
      "EditableText": "Related to the previous bug report:\n\nThe following is not a workaround, though it should be:\n\nIf you edit the ASL file to put the '{' and '}' in yourself, QDK Pro will remove them - again - when you try to edit the script that has the previously mentioned problem (though you may not see it until after you've edited the script)! Again, I believe this is because the language specifications for the scripts make the open/close curly braces optional - rather than required - for cases where a block of script code in a conditional has only one statement. Although C/C++ have no problem with one-statement &quot;if&quot;s, QDK gets confused (see the previous bug report.)\n\nBesides the copy/paste bug, this is probably the most aggravating problem of QDK Pro which is otherwise a fine product for making IF!",
      "EditableFormat": "bbcode",
      "HTML": "Related to the previous bug report:<br/><br/>The following is not a workaround, though it should be:<br/><br/>If you edit the ASL file to put the '{' and '}' in yourself, QDK Pro will remove them - again - when you try to edit the script that has the previously mentioned problem (though you may not see it until after you've edited the script)! Again, I believe this is because the language specifications for the scripts make the open/close curly braces optional - rather than required - for cases where a block of script code in a conditional has only one statement. Although C/C++ have no problem with one-statement &quot;if&quot;s, QDK gets confused (see the previous bug report.)<br/><br/>Besides the copy/paste bug, this is probably the most aggravating problem of QDK Pro which is otherwise a fine product for making IF!",
      "PostDate": "2008-05-14T18:02:59+01:00",
      "LastEditDate": null
    }
  ]
}
