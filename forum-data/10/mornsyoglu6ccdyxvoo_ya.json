{
  "Topic": {
    "TopicId": "mornsyoglu6ccdyxvoo_ya",
    "ForumId": "10",
    "Title": "JS.addScript reference to file?",
    "LastUpdated": "2020-09-30T13:33:37.237643Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "a6f95bef-128f-42dc-8c8a-1da31ed5f81b",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "The \"<a href='https://docs.textadventures.co.uk/quest/ui-callback.html'>JavaScript to Quest with ASLEvent</a>\" discussion provides a cool way to get Quest and JavaScript to talk to each other. However, the \"To test...\" section shows a cumbersome way to parse a JavaScript function into a string \"s\" variable:\r\n\r\n```\r\ns = \"<script>\"\r\ns = s + \"function askAge() {\"\r\ns = s + \"var answer = prompt('How old are you?');\"\r\ns = s + \"if (answer != null && answer != '') {\"\r\ns = s + \"ASLEvent('InputboxCallback', answer);\"\r\ns = s + \"}}</script>\"\r\nJS.addScript(s)\r\nJS.askAge()\r\n```\r\nIs there a way to put all that into an included JavaScript file?  The following didn't work for me:\r\n\r\n```\r\nJS.addScript(GetFileURL(\"testscript.js\"))\r\nJS.askAge ()\r\n```\r\n\r\nThe contents of testscript.js are exactly the same as \"s\" above except for leaving out the closing and opening ``` <script> ``` tags.\r\n\r\nThanks!",
      "EditableFormat": "markdown",
      "HTML": "<p>The \"<a href=\"https://docs.textadventures.co.uk/quest/ui-callback.html\">JavaScript to Quest with ASLEvent</a>\" discussion provides a cool way to get Quest and JavaScript to talk to each other. However, the \"To test...\" section shows a cumbersome way to parse a JavaScript function into a string \"s\" variable:</p>\n<pre><code>s = \"&lt;script&gt;\"\ns = s + \"function askAge() {\"\ns = s + \"var answer = prompt('How old are you?');\"\ns = s + \"if (answer != null &amp;&amp; answer != '') {\"\ns = s + \"ASLEvent('InputboxCallback', answer);\"\ns = s + \"}}&lt;/script&gt;\"\nJS.addScript(s)\nJS.askAge()\n</code></pre>\n<p>Is there a way to put all that into an included JavaScript file?  The following didn't work for me:</p>\n<pre><code>JS.addScript(GetFileURL(\"testscript.js\"))\nJS.askAge ()\n</code></pre>\n<p>The contents of testscript.js are exactly the same as \"s\" above except for leaving out the closing and opening <code>&lt;script&gt;</code> tags.</p>\n<p>Thanks!</p>\n\n",
      "PostDate": "2020-09-30T13:33:37.237643Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5aa5c487-d7e5-4142-883a-05b8a0ddebf7",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "That's an odd way to add a script.\r\n\r\nI was under the impression that any *.js files included within a Quest game would be automatically loaded at the start. therefore your script would just be:\r\n```\r\nJS.askAge ()\r\n```\r\n\r\nI can't test this, because I'm limited to using the web editor, which doesn't allow you to add javascript. But if it doesn't work automatically, you could probably do either:\r\n```\r\nJS.addScript(\"<script src=\\\"\" + GetFileURL(\"testscript.js\") + \"\\\" />\")\r\nJS.askAge ()\r\n```\r\nor\r\n```\r\nJS.addScript(\"<script>\" + GetFileData(\"testscript.js\") + \"</script>\")\r\nJS.askAge ()\r\n```\r\nor even:\r\n```\r\nJS.eval(GetFileData(\"testscript.js\"))\r\nJS.askAge ()\r\n```\r\n(As I can't use external files for my javascript, I'm used to putting them through a JS compression utility that outputs a single line of code, and then just pasting that into a single `JS.eval` call. I'm pretty sure that's more efficient than having to wrap it i HTML and append it to the document every time)",
      "EditableFormat": "markdown",
      "HTML": "<p>That's an odd way to add a script.</p>\n<p>I was under the impression that any *.js files included within a Quest game would be automatically loaded at the start. therefore your script would just be:</p>\n<pre><code>JS.askAge ()\n</code></pre>\n<p>I can't test this, because I'm limited to using the web editor, which doesn't allow you to add javascript. But if it doesn't work automatically, you could probably do either:</p>\n<pre><code>JS.addScript(\"&lt;script src=\\\"\" + GetFileURL(\"testscript.js\") + \"\\\" /&gt;\")\nJS.askAge ()\n</code></pre>\n<p>or</p>\n<pre><code>JS.addScript(\"&lt;script&gt;\" + GetFileData(\"testscript.js\") + \"&lt;/script&gt;\")\nJS.askAge ()\n</code></pre>\n<p>or even:</p>\n<pre><code>JS.eval(GetFileData(\"testscript.js\"))\nJS.askAge ()\n</code></pre>\n<p>(As I can't use external files for my javascript, I'm used to putting them through a JS compression utility that outputs a single line of code, and then just pasting that into a single <code>JS.eval</code> call. I'm pretty sure that's more efficient than having to wrap it i HTML and append it to the document every time)</p>\n\n",
      "PostDate": "2020-09-30T15:16:31.900081Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "cc2a6839-d956-42bd-884e-27b1485898de",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "That did it!  These two solutions both work in my desktop editor:\r\n\r\n```\r\nJS.addScript(\"<script>\" + GetFileData(\"testscript.js\") + \"</script>\")\r\nJS.askAge ()\r\n```\r\nand:\r\n\r\n```\r\nJS.eval(GetFileData(\"testscript.js\"))\r\nJS.askAge ()\r\n```\r\nI believe your ```JS.eval``` solution (first running the code through minification) works, too.",
      "EditableFormat": "markdown",
      "HTML": "<p>That did it!  These two solutions both work in my desktop editor:</p>\n<pre><code>JS.addScript(\"&lt;script&gt;\" + GetFileData(\"testscript.js\") + \"&lt;/script&gt;\")\nJS.askAge ()\n</code></pre>\n<p>and:</p>\n<pre><code>JS.eval(GetFileData(\"testscript.js\"))\nJS.askAge ()\n</code></pre>\n<p>I believe your <code>JS.eval</code> solution (first running the code through minification) works, too.</p>\n\n",
      "PostDate": "2020-09-30T20:33:46.5577701Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "6340879a-4867-4524-828e-4117e4f364c3",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Yep :)\r\n\r\nBut if minifying code, make sure to escape it correctly. My usual approach is to to take the output from an online compressor, then run a pair of search/replaces on it; changing `\\` to `\\\\` and `\"` to `'` (or to `\\\"` if there's already single quotes in there). Then just stick `JS.eval(\"` on the beginning and `\")` on the end.\r\n\r\nI suspect having it in a separate file is better if you can. I'd only recommend my method if you're on the web editor and so can't upload files to include.",
      "EditableFormat": "markdown",
      "HTML": "<p>Yep :)</p>\n<p>But if minifying code, make sure to escape it correctly. My usual approach is to to take the output from an online compressor, then run a pair of search/replaces on it; changing <code>\\</code> to <code>\\\\</code> and <code>\"</code> to <code>'</code> (or to <code>\\\"</code> if there's already single quotes in there). Then just stick <code>JS.eval(\"</code> on the beginning and <code>\")</code> on the end.</p>\n<p>I suspect having it in a separate file is better if you can. I'd only recommend my method if you're on the web editor and so can't upload files to include.</p>\n\n",
      "PostDate": "2020-09-30T20:39:04.0319563Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "f911ad2f-7853-473e-bea3-83c89ac8e5a8",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Just curious: why do you only use the web editor?",
      "EditableFormat": "markdown",
      "HTML": "<p>Just curious: why do you only use the web editor?</p>\n\n",
      "PostDate": "2020-09-30T23:38:17.9076947Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "de2a20f3-495e-4ac5-ba9b-b19f5c32e6b2",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "The desktop one requires Windows.",
      "EditableFormat": "markdown",
      "HTML": "<p>The desktop one requires Windows.</p>\n\n",
      "PostDate": "2020-10-01T00:18:34.3186125Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "7c4a2131-1667-41b9-af50-e5e34bb6c1d2",
      "UserId": 924,
      "Username": "Pertex",
      "AvatarUrl": "https://secure.gravatar.com/avatar/4cc1e52f99452e841ecf4cbee9eadde9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Just curious: mattgmr1, when you are using the offline editor, why don't you just import the .js file?",
      "EditableFormat": "markdown",
      "HTML": "<p>Just curious: mattgmr1, when you are using the offline editor, why don't you just import the .js file?</p>\n\n",
      "PostDate": "2020-10-01T13:00:22.181163Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "025638f8-ed25-4238-87df-5e71b92f2108",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I suppose I would if I knew how! I see that Squiffy has an ```@import``` command, but that doesn't seem to work in Quest.",
      "EditableFormat": "markdown",
      "HTML": "<p>I suppose I would if I knew how! I see that Squiffy has an <code>@import</code> command, but that doesn't seem to work in Quest.</p>\n\n",
      "PostDate": "2020-10-02T10:40:55.598652Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5676c3bf-c759-46c0-9908-6839b0a8f23f",
      "UserId": 924,
      "Username": "Pertex",
      "AvatarUrl": "https://secure.gravatar.com/avatar/4cc1e52f99452e841ecf4cbee9eadde9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "In the left tree of the editor you have \"Advanced\" and there is \"Javascript\" where you can add script files",
      "EditableFormat": "markdown",
      "HTML": "<p>In the left tree of the editor you have \"Advanced\" and there is \"Javascript\" where you can add script files</p>\n\n",
      "PostDate": "2020-10-02T16:06:24.3114739Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "3e8291f5-bba3-4582-b522-177aa097630a",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Fantastic! Thanks so much.",
      "EditableFormat": "markdown",
      "HTML": "<p>Fantastic! Thanks so much.</p>\n\n",
      "PostDate": "2020-10-02T16:33:20.6984812Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
