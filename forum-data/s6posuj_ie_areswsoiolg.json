{
  "Topic": {
    "TopicId": "s6posuj_ie_areswsoiolg",
    "ForumId": "10",
    "Title": "[RESOLVED] What counts as a turn? Turnscripts not running unless explicitly told to.",
    "LastUpdated": "2020-10-04T22:01:18.7288101Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "caf6fdf5-b20e-4671-9621-3f89290d1e48",
      "UserId": 509320,
      "Username": "Zdarlight",
      "AvatarUrl": "https://secure.gravatar.com/avatar/07472d2c8dd9b7b48a41983da6083c4b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "**Main Issue: Turnscripts don't seem to be running unless I explicitly call the RunTurnScripts command somewhere, despite being enabled.**\r\n\r\n**RESOLUTION: A fresh install seems to have fixed the problem, though the root cause of the issue still isn't clear**\r\n\r\nI know this sounds like a super basic question, and at some level it is, but I'm really confused by what counts as a turn in Quest.\r\n\r\nAs I (thought I) understood it, a turn is generally supposed to be any command you pass into the game. This is why it is often recommended to have some sort of way to catch unsuccessful turns (i.e. using a notarealturn attribute). I set up such an attribute according to the directions in [The Pixie's ClockLib tutorial](https://github.com/ThePix/quest/wiki/Library:-Tracking-time).\r\n\r\nAs it stands, however, with the exception of a turnscript which prevents time from advancing on the character creation screen, it seems like none of my turnscripts are running unless I explicitly use RunTurnScripts. This includes the ClockLibTurnScript which is included in ClockLib. They are all enabled when the game begins, so I don't think that that's the issue, but I could be wrong.\r\n\r\nThere is not a lot yet in the game, as it's still very early in development, but these are the actions which I have tried which fail to advance the turn count: going through exits, speaking to characters, sitting on a couch, the \"wait\" command which comes with ClockLib. I am using Quest 5.8.0 desktop version, and all my testing has been through the \"Play\" button in the desktop editor.\r\n\r\nHave I misunderstood what a turn is? Or is it possible I've overlooked something in the code? I tried searching the forums to see if this question had been answered before, but couldn't find anything quite right.\r\n\r\nEDIT: It is worth mentioning also that they're not throwing any errors, they just don't seem to be doing anything at all.",
      "EditableFormat": "markdown",
      "HTML": "<p><strong>Main Issue: Turnscripts don't seem to be running unless I explicitly call the RunTurnScripts command somewhere, despite being enabled.</strong></p>\n<p><strong>RESOLUTION: A fresh install seems to have fixed the problem, though the root cause of the issue still isn't clear</strong></p>\n<p>I know this sounds like a super basic question, and at some level it is, but I'm really confused by what counts as a turn in Quest.</p>\n<p>As I (thought I) understood it, a turn is generally supposed to be any command you pass into the game. This is why it is often recommended to have some sort of way to catch unsuccessful turns (i.e. using a notarealturn attribute). I set up such an attribute according to the directions in <a href=\"https://github.com/ThePix/quest/wiki/Library:-Tracking-time\">The Pixie's ClockLib tutorial</a>.</p>\n<p>As it stands, however, with the exception of a turnscript which prevents time from advancing on the character creation screen, it seems like none of my turnscripts are running unless I explicitly use RunTurnScripts. This includes the ClockLibTurnScript which is included in ClockLib. They are all enabled when the game begins, so I don't think that that's the issue, but I could be wrong.</p>\n<p>There is not a lot yet in the game, as it's still very early in development, but these are the actions which I have tried which fail to advance the turn count: going through exits, speaking to characters, sitting on a couch, the \"wait\" command which comes with ClockLib. I am using Quest 5.8.0 desktop version, and all my testing has been through the \"Play\" button in the desktop editor.</p>\n<p>Have I misunderstood what a turn is? Or is it possible I've overlooked something in the code? I tried searching the forums to see if this question had been answered before, but couldn't find anything quite right.</p>\n<p>EDIT: It is worth mentioning also that they're not throwing any errors, they just don't seem to be doing anything at all.</p>\n\n",
      "PostDate": "2020-10-04T22:01:18.7288101Z",
      "LastEditDate": "2020-10-08T01:49:08.2181613Z",
      "link": null
    },
    {
      "PostId": "f5d907c8-1455-49f7-8fb7-5cce23ca6c28",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Have you modified any of the core functions? I know some libraries included modified versions of functions like `RunTurnScripts` in order to fix issues in the core. But if you use those libraries with a newer version of Quest in which the core stuff works differently, it can create some very odd issues.\r\n\r\nCan you share the game? Poking around in the code might reveal some clues.\r\n\r\n> This is why it is often recommended to have some sort of way to catch unsuccessful turns (i.e. using a notarealturn attribute). \r\n\r\nAs of Quest 5.8, you can do this using the `SuppressTurnscripts()` function.\r\n\r\n> Have I misunderstood what a turn is?\r\n\r\nUntil Quest 5.7, a turn was an exchange of data between the Quest backend and the Javascript frontend. This could be caused by the player inputting commands, some javascript calling `ASLEvent`, or a timer triggering. This made turnscripts perfect for things like updating custom status bars, attaching icons to the inventory, or displaying a custom map, because it meant they would be run every time something on screen needs to change.\r\n\r\nAs of Quest 5.8, a turn is the successful execution of a single command. This means they're better for things like counting turns or the player being poisoned, but are no longer suitable for all the display sync stuff.",
      "EditableFormat": "markdown",
      "HTML": "<p>Have you modified any of the core functions? I know some libraries included modified versions of functions like <code>RunTurnScripts</code> in order to fix issues in the core. But if you use those libraries with a newer version of Quest in which the core stuff works differently, it can create some very odd issues.</p>\n<p>Can you share the game? Poking around in the code might reveal some clues.</p>\n<blockquote>\n<p>This is why it is often recommended to have some sort of way to catch unsuccessful turns (i.e. using a notarealturn attribute).</p>\n</blockquote>\n<p>As of Quest 5.8, you can do this using the <code>SuppressTurnscripts()</code> function.</p>\n<blockquote>\n<p>Have I misunderstood what a turn is?</p>\n</blockquote>\n<p>Until Quest 5.7, a turn was an exchange of data between the Quest backend and the Javascript frontend. This could be caused by the player inputting commands, some javascript calling <code>ASLEvent</code>, or a timer triggering. This made turnscripts perfect for things like updating custom status bars, attaching icons to the inventory, or displaying a custom map, because it meant they would be run every time something on screen needs to change.</p>\n<p>As of Quest 5.8, a turn is the successful execution of a single command. This means they're better for things like counting turns or the player being poisoned, but are no longer suitable for all the display sync stuff.</p>\n\n",
      "PostDate": "2020-10-04T22:50:12.8078004Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2c0760cf-e0e6-4ed2-8774-9068be49d378",
      "UserId": 509320,
      "Username": "Zdarlight",
      "AvatarUrl": "https://i.imgur.com/rZfZobAb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">Have you modified any of the core functions?\r\n\r\nOnly insofar as ClockLib does, as that's the only custom library I'm using at the moment.\r\n\r\n>Can you share the game?\r\n\r\nDue to the nature of the game, I don't want to publicly post the whole thing in this forum, if you catch my meaning. I can share the relevant stuff, however, including turnscripts and whatnot. These are just the ones not included in ClockLib, since those can be found on The Pixie's github I linked in the OP.\r\n\r\n**turn tracker** (self explanatory, just a tracker I'm using to test when turns are actually advancing. Currently only moves forward if RunTurnScripts is called, except in the first room where it works as normal if I remove the game.notarealturn = true line in the timeless script.)\r\n```\r\nif (not game.notarealturn) {\r\n  player.turns = player.turns + 1\r\n}\r\ngame.notarealturn = false\r\n```\r\n\r\n**timeless** (prevents time from advancing in the character creation screen. This is the only script which currently seems to be working as intended.)\r\n```\r\nif (game.pov.parent = intro) {\r\n  game.notarealturn = True\r\n  SetInc (0)\r\n}\r\n```\r\n\r\n**NpcTurnScript** (taken from the [Making NPCs Patrol tutorial](http://docs.textadventures.co.uk/quest/patrolling_npcs.html), works as intended as long as RunTurnScripts is called)\r\n```\r\nforeach (o, AllObjects()) {\r\n  if (HasScript(o, \"takeaturn\")) {\r\n    do (o, \"takeaturn\")\r\n  }\r\n}\r\n```\r\nThis is a typical example of the kind of verb that is currently in my game. It's just a standard \"sit on couch\" thing. Without calling RunTurnScripts, however, they don't run, though it seems to me that they should.\r\n```\r\nmsg (\"You sit on the couch and rest for a moment. After a couple minutes you get up.\")\r\nRunTurnScripts\r\n```\r\n\r\nThe only thing I can think of that I haven't mentioned or tested much yet is that turnscripts seem to work fine in the first room, which is currently used for some character creation and introduction stuff. There is a one-way exit in from the first room which is how the player enters the rest of the game. Could that be affecting the turnscripts somehow? Using the exit there runs this script (I had to include enabling NpcTurnScript because for some reason it was showing in the debug tool as disabled even though it is supposed to be enabled from the start):\r\n```\r\nplayer.parent = this.to\r\nDisableTurnScript (timeless)\r\nEnableTurnScript (NpcTurnScript)\r\n```\r\n\r\nThank you for your help!",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>Have you modified any of the core functions?</p>\n</blockquote>\n<p>Only insofar as ClockLib does, as that's the only custom library I'm using at the moment.</p>\n<blockquote>\n<p>Can you share the game?</p>\n</blockquote>\n<p>Due to the nature of the game, I don't want to publicly post the whole thing in this forum, if you catch my meaning. I can share the relevant stuff, however, including turnscripts and whatnot. These are just the ones not included in ClockLib, since those can be found on The Pixie's github I linked in the OP.</p>\n<p><strong>turn tracker</strong> (self explanatory, just a tracker I'm using to test when turns are actually advancing. Currently only moves forward if RunTurnScripts is called, except in the first room where it works as normal if I remove the game.notarealturn = true line in the timeless script.)</p>\n<pre><code>if (not game.notarealturn) {\n  player.turns = player.turns + 1\n}\ngame.notarealturn = false\n</code></pre>\n<p><strong>timeless</strong> (prevents time from advancing in the character creation screen. This is the only script which currently seems to be working as intended.)</p>\n<pre><code>if (game.pov.parent = intro) {\n  game.notarealturn = True\n  SetInc (0)\n}\n</code></pre>\n<p><strong>NpcTurnScript</strong> (taken from the <a href=\"http://docs.textadventures.co.uk/quest/patrolling_npcs.html\">Making NPCs Patrol tutorial</a>, works as intended as long as RunTurnScripts is called)</p>\n<pre><code>foreach (o, AllObjects()) {\n  if (HasScript(o, \"takeaturn\")) {\n    do (o, \"takeaturn\")\n  }\n}\n</code></pre>\n<p>This is a typical example of the kind of verb that is currently in my game. It's just a standard \"sit on couch\" thing. Without calling RunTurnScripts, however, they don't run, though it seems to me that they should.</p>\n<pre><code>msg (\"You sit on the couch and rest for a moment. After a couple minutes you get up.\")\nRunTurnScripts\n</code></pre>\n<p>The only thing I can think of that I haven't mentioned or tested much yet is that turnscripts seem to work fine in the first room, which is currently used for some character creation and introduction stuff. There is a one-way exit in from the first room which is how the player enters the rest of the game. Could that be affecting the turnscripts somehow? Using the exit there runs this script (I had to include enabling NpcTurnScript because for some reason it was showing in the debug tool as disabled even though it is supposed to be enabled from the start):</p>\n<pre><code>player.parent = this.to\nDisableTurnScript (timeless)\nEnableTurnScript (NpcTurnScript)\n</code></pre>\n<p>Thank you for your help!</p>\n\n",
      "PostDate": "2020-10-05T23:54:22.1458955Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "d4411c72-554e-43b4-9b05-982441ecc7bd",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> The only thing I can think of that I haven't mentioned or tested much yet is that turnscripts seem to work fine in the first room, which is currently used for some character creation and introduction stuff. \r\n\r\nIf you add this line to the script in the first room:\r\n```\r\nRemoveObject (NpcTurnScript)\r\n```\r\nwhat happens?\r\n\r\n(This may seem an odd question. I found that asking it in a more sensible way quickly turned into a wall of text because I'm not sure how much detail you know about how turnscripts work)",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>The only thing I can think of that I haven't mentioned or tested much yet is that turnscripts seem to work fine in the first room, which is currently used for some character creation and introduction stuff.</p>\n</blockquote>\n<p>If you add this line to the script in the first room:</p>\n<pre><code>RemoveObject (NpcTurnScript)\n</code></pre>\n<p>what happens?</p>\n<p>(This may seem an odd question. I found that asking it in a more sensible way quickly turned into a wall of text because I'm not sure how much detail you know about how turnscripts work)</p>\n\n",
      "PostDate": "2020-10-06T00:49:02.0773219Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2eb2d19f-4506-4911-89cb-d9908b8bf5e6",
      "UserId": 509320,
      "Username": "Zdarlight",
      "AvatarUrl": "https://i.imgur.com/rZfZobAb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Since you didn't specify where to add that, I tried adding that line to the script in a few places. The first was in the room description (setting it to run a script instead of display text, of course). Then I tried running it before entering the room. Then I tried it on the exit to the next screen. Finally, I tried it in the timeless turnscript. As far as I can tell, it didn't do anything in any of those locations.\r\n\r\nIn case this is what you're getting at, or at least helpful for it: the timeless turnscript is located specifically in the first room. The other ones are under the \"Objects\" part of the file tree (i.e. not in any rooms). They show up in the turnscripts list in the game tab, however.",
      "EditableFormat": "markdown",
      "HTML": "<p>Since you didn't specify where to add that, I tried adding that line to the script in a few places. The first was in the room description (setting it to run a script instead of display text, of course). Then I tried running it before entering the room. Then I tried it on the exit to the next screen. Finally, I tried it in the timeless turnscript. As far as I can tell, it didn't do anything in any of those locations.</p>\n<p>In case this is what you're getting at, or at least helpful for it: the timeless turnscript is located specifically in the first room. The other ones are under the \"Objects\" part of the file tree (i.e. not in any rooms). They show up in the turnscripts list in the game tab, however.</p>\n\n",
      "PostDate": "2020-10-07T00:45:24.1134842Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "f9ced000-1293-48c0-9932-9ec659b347b3",
      "UserId": 509320,
      "Username": "Zdarlight",
      "AvatarUrl": "https://i.imgur.com/rZfZobAb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "In the interest of helping find where things are going screwy, I'm going to post a slightly redacted version of the full code. The only things I'm excluding are a few of the actions that made me reluctant to share this publicly earlier and some dialogue related to that as well. The actions so far only print text, so I doubt that's where the issue is. Additionally, a bunch of empty rooms are getting left out, but they're literally empty except for exits that do nothing special.\r\n\r\nI hope this helps!\r\n\r\n```\r\n<!--Saved by Quest 5.8.6836.13983-->\r\n<asl version=\"580\">\r\n  <include ref=\"English.aslx\" />\r\n  <include ref=\"Core.aslx\" />\r\n  <include ref=\"ClockLib.aslx\" />\r\n  <game name=\"Sharktooth Cove Spa and Resort\">\r\n    <gameid>96720655-204a-492b-b45f-fc5727374433</gameid>\r\n    <version>1.0</version>\r\n    <firstpublished>2020</firstpublished>\r\n    <author>Zdarlight</author>\r\n    <gridmap />\r\n    <category>Adult</category>\r\n    <notarealturn type=\"boolean\">false</notarealturn>\r\n    <attr name=\"feature_advancedscripts\" type=\"boolean\">false</attr>\r\n    <statusattributes type=\"stringdictionary\">\r\n      <item>\r\n        <key>clock</key>\r\n        <value>Time: !</value>\r\n      </item>\r\n    </statusattributes>\r\n    <attr name=\"feature_asktell\" type=\"boolean\">false</attr>\r\n    <appendobjectdescription type=\"boolean\">false</appendobjectdescription>\r\n    <start type=\"script\">\r\n      SetTime (\"01:06:59\")\r\n      game.clock = TimeAsString()\r\n      game_clock.waittime = 10\r\n    </start>\r\n    <unresolvedcommandhandler type=\"script\">\r\n      game.notarealturn = true\r\n      msg (Template(\"UnrecognisedCommand\"))\r\n    </unresolvedcommandhandler>\r\n    <roomenter type=\"script\">\r\n      RunTurnScripts\r\n    </roomenter>\r\n  </game>\r\n  <object name=\"intro\">\r\n    <inherit name=\"editor_room\" />\r\n    <alias>Introduction</alias>\r\n    <usedefaultprefix type=\"boolean\">false</usedefaultprefix>\r\n    <prefix>the</prefix>\r\n    <beforefirstenter type=\"script\">\r\n    </beforefirstenter>\r\n    <description type=\"string\"></description>\r\n    <object name=\"player\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"editor_player\" />\r\n      <statusattributes type=\"stringdictionary\">\r\n        <item>\r\n          <key>weight</key>\r\n          <value>Weight: ! lbs</value>\r\n        </item>\r\n        <item>\r\n          <key>species</key>\r\n          <value>Species: !</value>\r\n        </item>\r\n        <item>\r\n          <key>alias</key>\r\n          <value>Name: !</value>\r\n        </item>\r\n        <item>\r\n          <key>playerGender</key>\r\n          <value>Gender: !</value>\r\n        </item>\r\n        <item>\r\n          <key>turns</key>\r\n          <value>Turns: !</value>\r\n        </item>\r\n      </statusattributes>\r\n      <turns type=\"int\">0</turns>\r\n      <weight type=\"int\">120</weight>\r\n      <playerGender type=\"string\"></playerGender>\r\n      <species type=\"string\"></species>\r\n      <alias type=\"string\"></alias>\r\n    </object>\r\n    <exit alias=\"in\" to=\"lobby\">\r\n      <inherit name=\"indirection\" />\r\n      <runscript />\r\n      <script type=\"script\">\r\n        player.parent = this.to\r\n        DisableTurnScript (timeless)\r\n        EnableTurnScript (NpcTurnScript)\r\n      </script>\r\n    </exit>\r\n    <turnscript name=\"timeless\">\r\n      <enabled />\r\n      <script>\r\n        if (game.pov.parent = intro) {\r\n          SetInc (0)\r\n          game.notarealturn = True\r\n        }\r\n      </script>\r\n    </turnscript>\r\n    <object name=\"Nametag\">\r\n      <inherit name=\"editor_object\" />\r\n      <feature_usegive />\r\n      <displayverbs type=\"stringlist\">\r\n        <value>Look at</value>\r\n        <value>Use</value>\r\n      </displayverbs>\r\n      <look>Use this to set your name.</look>\r\n      <use type=\"script\">\r\n        msg (\"Input name...\")\r\n        get input {\r\n          player.alias = result\r\n          msg (\"Name set to \" + player.alias)\r\n        }\r\n      </use>\r\n    </object>\r\n    <object name=\"Species Changer\">\r\n      <inherit name=\"editor_object\" />\r\n      <look>Use this to set your species.</look>\r\n      <displayverbs type=\"stringlist\">\r\n        <value>Look at</value>\r\n        <value>Use</value>\r\n      </displayverbs>\r\n      <feature_usegive />\r\n      <use type=\"script\">\r\n        msg (\"Input species...\")\r\n        get input {\r\n          player.species = result\r\n          msg (\"Player species set to \" + player.species)\r\n        }\r\n      </use>\r\n    </object>\r\n    <object name=\"Gender Changer\">\r\n      <inherit name=\"editor_object\" />\r\n      <feature_usegive />\r\n      <displayverbs type=\"stringlist\">\r\n        <value>Look at</value>\r\n        <value>Use</value>\r\n      </displayverbs>\r\n      <look>Use this to set your gender.</look>\r\n      <use type=\"script\">\r\n        options = NewStringList()\r\n        list add (options, \"Male\")\r\n        list add (options, \"Female\")\r\n        list add (options, \"Non-Binary\")\r\n        ShowMenu (\"Select Gender...\", options, false) {\r\n          switch (result) {\r\n            case (\"Male\") {\r\n              player.playerGender = \"Male\"\r\n            }\r\n            case (\"Female\") {\r\n              player.playerGender = \"Female\"\r\n            }\r\n            case (\"Non-Binary\") {\r\n              player.playerGender = \"Non-Binary\"\r\n            }\r\n          }\r\n        }\r\n      </use>\r\n    </object>\r\n  </object>\r\n  <object name=\"lobby\">\r\n    <inherit name=\"editor_room\" />\r\n    <usedefaultprefix type=\"boolean\">false</usedefaultprefix>\r\n    <prefix>the</prefix>\r\n    <description><![CDATA[The lobby is neat and clean. The walls are painted white and the furniture tends to be in various shades of light blue. During the day, the room is filled with bright sunlight flowing in from tall windows.<br/><br/>To the north you see a hallway leading toward the beach. To the east you see a hallway leading toward the guests' rooms. To the west you see the buffet.]]></description>\r\n    <firstenter type=\"script\">\r\n    </firstenter>\r\n    <beforefirstenter type=\"script\">\r\n    </beforefirstenter>\r\n    <exit alias=\"east\" to=\"eHall1\">\r\n      <inherit name=\"eastdirection\" />\r\n      <runscript type=\"boolean\">false</runscript>\r\n      <script type=\"script\">\r\n        player.parent = this.to\r\n      </script>\r\n    </exit>\r\n    <exit alias=\"west\" to=\"buffet\">\r\n      <inherit name=\"westdirection\" />\r\n      <runscript type=\"boolean\">false</runscript>\r\n      <script type=\"script\">\r\n      </script>\r\n    </exit>\r\n    <exit alias=\"north\" to=\"nHall1\">\r\n      <inherit name=\"northdirection\" />\r\n      <attr name=\"grid_length\" type=\"int\">3</attr>\r\n      <runscript type=\"boolean\">false</runscript>\r\n      <script type=\"script\">\r\n      </script>\r\n    </exit>\r\n    <object name=\"concierge\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"male\" />\r\n      <look>An unnaturally-perfect looking red fox in a perfectly tailored suit. He never seems to move from behind the desk.</look>\r\n      <speak type=\"script\">\r\n        options = NewStringList()\r\n        list add (options, \"Where am I?\")\r\n        list add (options, \"Who are you?\")\r\n        list add (options, \"I am ready to check out.\")\r\n        ShowMenu (\"\\\"Welcome to the Sharktooth Cove Spa and Resort. How can I help you?\\\"\", options, true) {\r\n          switch (result) {\r\n            case (\"Where am I?\") {\r\n              msg (\"\\\"You are in the wonder Sharktooth Cove Spa and Resort. Enjoy our many wonderful amenities, including the all-you-can-eat buffet and the pool. This is a very social place, so please feel free to interact with your fellow guests.\\\"\")\r\n            }\r\n            case (\"Who are you?\") {\r\n              msg (\"\\\"I am the concierge. It is my job to watch over the resort and ensure our guests are happy and the property is properly maintained. Speak to me if you have any questions, or if you are ready to check out.\\\"\")\r\n            }\r\n            case (\"I am ready to check out.\") {\r\n              msg (\"\\\"Excellent. Unfortunately this feature has not fully been implemented yet. \\\"\")\r\n            }\r\n          }\r\n        }\r\n      </speak>\r\n    </object>\r\n    <object name=\"couch\">\r\n      <inherit name=\"editor_object\" />\r\n      <look>A firm, light-blue couch. It looks nice, but not overly comfortable.</look>\r\n      <sit type=\"script\">\r\n        msg (\"You sit on the couch and rest for a moment. After a couple minutes you get up.\")\r\n        RunTurnScripts\r\n      </sit>\r\n    </object>\r\n  </object>\r\n  <object name=\"eHall1\">\r\n    <inherit name=\"editor_room\" />\r\n    <alias>eastern hallway</alias>\r\n    <usedefaultprefix type=\"boolean\">false</usedefaultprefix>\r\n    <prefix>the</prefix>\r\n    <description>The hallway is clean and well lit with polished hardwood floors. To the north is your room. To the south is Zdar's room. To the west is the lobby. More bedrooms are to the east.</description>\r\n    <exit alias=\"west\" to=\"lobby\">\r\n      <inherit name=\"westdirection\" />\r\n    </exit>\r\n    <exit alias=\"east\" to=\"eHall2\">\r\n      <inherit name=\"eastdirection\" />\r\n    </exit>\r\n    <exit alias=\"north\" to=\"playerBed\">\r\n      <inherit name=\"northdirection\" />\r\n    </exit>\r\n    <exit alias=\"south\" to=\"zdarBed\">\r\n      <inherit name=\"southdirection\" />\r\n    </exit>\r\n  </object>\r\n  <object name=\"zdarBed\">\r\n    <inherit name=\"editor_room\" />\r\n    <alias>bedroom</alias>\r\n    <usedefaultprefix type=\"boolean\">false</usedefaultprefix>\r\n    <prefix>Zdar's</prefix>\r\n    <exit alias=\"north\" to=\"eHall1\">\r\n      <inherit name=\"northdirection\" />\r\n    </exit>\r\n    <exit alias=\"in\" to=\"zdarBath\">\r\n      <inherit name=\"indirection\" />\r\n    </exit>\r\n    <object name=\"Zdar\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"namedmale\" />\r\n      <look>A porcupine with brown skin and cream-colored quills. He's wearing an unbuttoned lavender shirt and dark blue shorts.</look>\r\n      <weight type=\"int\">250</weight>\r\n      <species>porcupine</species>\r\n      <feature_startscript />\r\n      <feature_usegive />\r\n      <speak>there will be dialogue here</speak>\r\n      <attr name=\"_initialise_\" type=\"script\"><![CDATA[\r\n        oldroom = this.parent\r\n        this.takeaturn => {\r\n          if (this.eaten = False) {\r\n            if (not IsAfterDaily(\"1:00\") or IsAfterDaily(\"19:00\")) {\r\n              this.parent = bar\r\n            }\r\n            else if (IsAfterDaily(\"1:00\") and not IsAfterDaily(\"9:00\")) {\r\n              this.parent = zdarBed\r\n            }\r\n            else if (IsAfterDaily(\"9:00\") and not IsAfterDaily(\"10:00\")) {\r\n              this.parent = buffet\r\n            }\r\n            else if (IsAfterDaily(\"10:00\") and not IsAfterDaily(\"11:00\")) {\r\n              this.parent = rileyBed\r\n            }\r\n            else if (IsAfterDaily(\"11:00\") and not IsAfterDaily(\"14:00\")) {\r\n              this.parent = beach\r\n            }\r\n            else if (IsAfterDaily(\"14:00\") and not IsAfterDaily(\"15:00\")) {\r\n              this.parent = buffet\r\n            }\r\n            else if (IsAfterDaily(\"15:00\") and not IsAfterDaily(\"16:00\")) {\r\n              this.parent = zdarBed\r\n            }\r\n            else if (IsAfterDaily(\"16:00\") and not IsAfterDaily(\"18:00\")) {\r\n              this.parent = sauna\r\n            }\r\n            else if (IsAfterDaily(\"18:00\") and not IsAfterDaily(\"19:00\")) {\r\n              this.parent = buffet\r\n            }\r\n          }\r\n        }\r\n        if (not oldroom = this.parent) {\r\n          PrintIfHere (oldroom, \"Zdar leaves the room\")\r\n          PrintIfHere (this.parent, \"Zdar enters the room\")\r\n        }\r\n      ]]></attr>\r\n    </object>\r\n  </object>\r\n  <turnscript name=\"turn tracker\">\r\n    <enabled />\r\n    <script>\r\n      if (not game.notarealturn) {\r\n        player.turns = player.turns + 1\r\n      }\r\n      game.notarealturn = false\r\n    </script>\r\n  </turnscript>\r\n  <turnscript name=\"NpcTurnScript\">\r\n    <enabled />\r\n    <script>\r\n      foreach (o, AllObjects()) {\r\n        if (HasScript(o, \"takeaturn\")) {\r\n          do (o, \"takeaturn\")\r\n        }\r\n      }\r\n    </script>\r\n  </turnscript>\r\n  <function name=\"PrintIfHere\" parameters=\"room, s\">\r\n    if (game.pov.parent = room) {\r\n      msg (s)\r\n    }\r\n  </function>\r\n</asl>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>In the interest of helping find where things are going screwy, I'm going to post a slightly redacted version of the full code. The only things I'm excluding are a few of the actions that made me reluctant to share this publicly earlier and some dialogue related to that as well. The actions so far only print text, so I doubt that's where the issue is. Additionally, a bunch of empty rooms are getting left out, but they're literally empty except for exits that do nothing special.</p>\n<p>I hope this helps!</p>\n<pre><code>&lt;!--Saved by Quest 5.8.6836.13983--&gt;\n&lt;asl version=\"580\"&gt;\n  &lt;include ref=\"English.aslx\" /&gt;\n  &lt;include ref=\"Core.aslx\" /&gt;\n  &lt;include ref=\"ClockLib.aslx\" /&gt;\n  &lt;game name=\"Sharktooth Cove Spa and Resort\"&gt;\n    &lt;gameid&gt;96720655-204a-492b-b45f-fc5727374433&lt;/gameid&gt;\n    &lt;version&gt;1.0&lt;/version&gt;\n    &lt;firstpublished&gt;2020&lt;/firstpublished&gt;\n    &lt;author&gt;Zdarlight&lt;/author&gt;\n    &lt;gridmap /&gt;\n    &lt;category&gt;Adult&lt;/category&gt;\n    &lt;notarealturn type=\"boolean\"&gt;false&lt;/notarealturn&gt;\n    &lt;attr name=\"feature_advancedscripts\" type=\"boolean\"&gt;false&lt;/attr&gt;\n    &lt;statusattributes type=\"stringdictionary\"&gt;\n      &lt;item&gt;\n        &lt;key&gt;clock&lt;/key&gt;\n        &lt;value&gt;Time: !&lt;/value&gt;\n      &lt;/item&gt;\n    &lt;/statusattributes&gt;\n    &lt;attr name=\"feature_asktell\" type=\"boolean\"&gt;false&lt;/attr&gt;\n    &lt;appendobjectdescription type=\"boolean\"&gt;false&lt;/appendobjectdescription&gt;\n    &lt;start type=\"script\"&gt;\n      SetTime (\"01:06:59\")\n      game.clock = TimeAsString()\n      game_clock.waittime = 10\n    &lt;/start&gt;\n    &lt;unresolvedcommandhandler type=\"script\"&gt;\n      game.notarealturn = true\n      msg (Template(\"UnrecognisedCommand\"))\n    &lt;/unresolvedcommandhandler&gt;\n    &lt;roomenter type=\"script\"&gt;\n      RunTurnScripts\n    &lt;/roomenter&gt;\n  &lt;/game&gt;\n  &lt;object name=\"intro\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;alias&gt;Introduction&lt;/alias&gt;\n    &lt;usedefaultprefix type=\"boolean\"&gt;false&lt;/usedefaultprefix&gt;\n    &lt;prefix&gt;the&lt;/prefix&gt;\n    &lt;beforefirstenter type=\"script\"&gt;\n    &lt;/beforefirstenter&gt;\n    &lt;description type=\"string\"&gt;&lt;/description&gt;\n    &lt;object name=\"player\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"editor_player\" /&gt;\n      &lt;statusattributes type=\"stringdictionary\"&gt;\n        &lt;item&gt;\n          &lt;key&gt;weight&lt;/key&gt;\n          &lt;value&gt;Weight: ! lbs&lt;/value&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n          &lt;key&gt;species&lt;/key&gt;\n          &lt;value&gt;Species: !&lt;/value&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n          &lt;key&gt;alias&lt;/key&gt;\n          &lt;value&gt;Name: !&lt;/value&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n          &lt;key&gt;playerGender&lt;/key&gt;\n          &lt;value&gt;Gender: !&lt;/value&gt;\n        &lt;/item&gt;\n        &lt;item&gt;\n          &lt;key&gt;turns&lt;/key&gt;\n          &lt;value&gt;Turns: !&lt;/value&gt;\n        &lt;/item&gt;\n      &lt;/statusattributes&gt;\n      &lt;turns type=\"int\"&gt;0&lt;/turns&gt;\n      &lt;weight type=\"int\"&gt;120&lt;/weight&gt;\n      &lt;playerGender type=\"string\"&gt;&lt;/playerGender&gt;\n      &lt;species type=\"string\"&gt;&lt;/species&gt;\n      &lt;alias type=\"string\"&gt;&lt;/alias&gt;\n    &lt;/object&gt;\n    &lt;exit alias=\"in\" to=\"lobby\"&gt;\n      &lt;inherit name=\"indirection\" /&gt;\n      &lt;runscript /&gt;\n      &lt;script type=\"script\"&gt;\n        player.parent = this.to\n        DisableTurnScript (timeless)\n        EnableTurnScript (NpcTurnScript)\n      &lt;/script&gt;\n    &lt;/exit&gt;\n    &lt;turnscript name=\"timeless\"&gt;\n      &lt;enabled /&gt;\n      &lt;script&gt;\n        if (game.pov.parent = intro) {\n          SetInc (0)\n          game.notarealturn = True\n        }\n      &lt;/script&gt;\n    &lt;/turnscript&gt;\n    &lt;object name=\"Nametag\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;feature_usegive /&gt;\n      &lt;displayverbs type=\"stringlist\"&gt;\n        &lt;value&gt;Look at&lt;/value&gt;\n        &lt;value&gt;Use&lt;/value&gt;\n      &lt;/displayverbs&gt;\n      &lt;look&gt;Use this to set your name.&lt;/look&gt;\n      &lt;use type=\"script\"&gt;\n        msg (\"Input name...\")\n        get input {\n          player.alias = result\n          msg (\"Name set to \" + player.alias)\n        }\n      &lt;/use&gt;\n    &lt;/object&gt;\n    &lt;object name=\"Species Changer\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;look&gt;Use this to set your species.&lt;/look&gt;\n      &lt;displayverbs type=\"stringlist\"&gt;\n        &lt;value&gt;Look at&lt;/value&gt;\n        &lt;value&gt;Use&lt;/value&gt;\n      &lt;/displayverbs&gt;\n      &lt;feature_usegive /&gt;\n      &lt;use type=\"script\"&gt;\n        msg (\"Input species...\")\n        get input {\n          player.species = result\n          msg (\"Player species set to \" + player.species)\n        }\n      &lt;/use&gt;\n    &lt;/object&gt;\n    &lt;object name=\"Gender Changer\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;feature_usegive /&gt;\n      &lt;displayverbs type=\"stringlist\"&gt;\n        &lt;value&gt;Look at&lt;/value&gt;\n        &lt;value&gt;Use&lt;/value&gt;\n      &lt;/displayverbs&gt;\n      &lt;look&gt;Use this to set your gender.&lt;/look&gt;\n      &lt;use type=\"script\"&gt;\n        options = NewStringList()\n        list add (options, \"Male\")\n        list add (options, \"Female\")\n        list add (options, \"Non-Binary\")\n        ShowMenu (\"Select Gender...\", options, false) {\n          switch (result) {\n            case (\"Male\") {\n              player.playerGender = \"Male\"\n            }\n            case (\"Female\") {\n              player.playerGender = \"Female\"\n            }\n            case (\"Non-Binary\") {\n              player.playerGender = \"Non-Binary\"\n            }\n          }\n        }\n      &lt;/use&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n  &lt;object name=\"lobby\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;usedefaultprefix type=\"boolean\"&gt;false&lt;/usedefaultprefix&gt;\n    &lt;prefix&gt;the&lt;/prefix&gt;\n    &lt;description&gt;&lt;![CDATA[The lobby is neat and clean. The walls are painted white and the furniture tends to be in various shades of light blue. During the day, the room is filled with bright sunlight flowing in from tall windows.&lt;br/&gt;&lt;br/&gt;To the north you see a hallway leading toward the beach. To the east you see a hallway leading toward the guests' rooms. To the west you see the buffet.]]&gt;&lt;/description&gt;\n    &lt;firstenter type=\"script\"&gt;\n    &lt;/firstenter&gt;\n    &lt;beforefirstenter type=\"script\"&gt;\n    &lt;/beforefirstenter&gt;\n    &lt;exit alias=\"east\" to=\"eHall1\"&gt;\n      &lt;inherit name=\"eastdirection\" /&gt;\n      &lt;runscript type=\"boolean\"&gt;false&lt;/runscript&gt;\n      &lt;script type=\"script\"&gt;\n        player.parent = this.to\n      &lt;/script&gt;\n    &lt;/exit&gt;\n    &lt;exit alias=\"west\" to=\"buffet\"&gt;\n      &lt;inherit name=\"westdirection\" /&gt;\n      &lt;runscript type=\"boolean\"&gt;false&lt;/runscript&gt;\n      &lt;script type=\"script\"&gt;\n      &lt;/script&gt;\n    &lt;/exit&gt;\n    &lt;exit alias=\"north\" to=\"nHall1\"&gt;\n      &lt;inherit name=\"northdirection\" /&gt;\n      &lt;attr name=\"grid_length\" type=\"int\"&gt;3&lt;/attr&gt;\n      &lt;runscript type=\"boolean\"&gt;false&lt;/runscript&gt;\n      &lt;script type=\"script\"&gt;\n      &lt;/script&gt;\n    &lt;/exit&gt;\n    &lt;object name=\"concierge\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"male\" /&gt;\n      &lt;look&gt;An unnaturally-perfect looking red fox in a perfectly tailored suit. He never seems to move from behind the desk.&lt;/look&gt;\n      &lt;speak type=\"script\"&gt;\n        options = NewStringList()\n        list add (options, \"Where am I?\")\n        list add (options, \"Who are you?\")\n        list add (options, \"I am ready to check out.\")\n        ShowMenu (\"\\\"Welcome to the Sharktooth Cove Spa and Resort. How can I help you?\\\"\", options, true) {\n          switch (result) {\n            case (\"Where am I?\") {\n              msg (\"\\\"You are in the wonder Sharktooth Cove Spa and Resort. Enjoy our many wonderful amenities, including the all-you-can-eat buffet and the pool. This is a very social place, so please feel free to interact with your fellow guests.\\\"\")\n            }\n            case (\"Who are you?\") {\n              msg (\"\\\"I am the concierge. It is my job to watch over the resort and ensure our guests are happy and the property is properly maintained. Speak to me if you have any questions, or if you are ready to check out.\\\"\")\n            }\n            case (\"I am ready to check out.\") {\n              msg (\"\\\"Excellent. Unfortunately this feature has not fully been implemented yet. \\\"\")\n            }\n          }\n        }\n      &lt;/speak&gt;\n    &lt;/object&gt;\n    &lt;object name=\"couch\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;look&gt;A firm, light-blue couch. It looks nice, but not overly comfortable.&lt;/look&gt;\n      &lt;sit type=\"script\"&gt;\n        msg (\"You sit on the couch and rest for a moment. After a couple minutes you get up.\")\n        RunTurnScripts\n      &lt;/sit&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n  &lt;object name=\"eHall1\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;alias&gt;eastern hallway&lt;/alias&gt;\n    &lt;usedefaultprefix type=\"boolean\"&gt;false&lt;/usedefaultprefix&gt;\n    &lt;prefix&gt;the&lt;/prefix&gt;\n    &lt;description&gt;The hallway is clean and well lit with polished hardwood floors. To the north is your room. To the south is Zdar's room. To the west is the lobby. More bedrooms are to the east.&lt;/description&gt;\n    &lt;exit alias=\"west\" to=\"lobby\"&gt;\n      &lt;inherit name=\"westdirection\" /&gt;\n    &lt;/exit&gt;\n    &lt;exit alias=\"east\" to=\"eHall2\"&gt;\n      &lt;inherit name=\"eastdirection\" /&gt;\n    &lt;/exit&gt;\n    &lt;exit alias=\"north\" to=\"playerBed\"&gt;\n      &lt;inherit name=\"northdirection\" /&gt;\n    &lt;/exit&gt;\n    &lt;exit alias=\"south\" to=\"zdarBed\"&gt;\n      &lt;inherit name=\"southdirection\" /&gt;\n    &lt;/exit&gt;\n  &lt;/object&gt;\n  &lt;object name=\"zdarBed\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;alias&gt;bedroom&lt;/alias&gt;\n    &lt;usedefaultprefix type=\"boolean\"&gt;false&lt;/usedefaultprefix&gt;\n    &lt;prefix&gt;Zdar's&lt;/prefix&gt;\n    &lt;exit alias=\"north\" to=\"eHall1\"&gt;\n      &lt;inherit name=\"northdirection\" /&gt;\n    &lt;/exit&gt;\n    &lt;exit alias=\"in\" to=\"zdarBath\"&gt;\n      &lt;inherit name=\"indirection\" /&gt;\n    &lt;/exit&gt;\n    &lt;object name=\"Zdar\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"namedmale\" /&gt;\n      &lt;look&gt;A porcupine with brown skin and cream-colored quills. He's wearing an unbuttoned lavender shirt and dark blue shorts.&lt;/look&gt;\n      &lt;weight type=\"int\"&gt;250&lt;/weight&gt;\n      &lt;species&gt;porcupine&lt;/species&gt;\n      &lt;feature_startscript /&gt;\n      &lt;feature_usegive /&gt;\n      &lt;speak&gt;there will be dialogue here&lt;/speak&gt;\n      &lt;attr name=\"_initialise_\" type=\"script\"&gt;&lt;![CDATA[\n        oldroom = this.parent\n        this.takeaturn =&gt; {\n          if (this.eaten = False) {\n            if (not IsAfterDaily(\"1:00\") or IsAfterDaily(\"19:00\")) {\n              this.parent = bar\n            }\n            else if (IsAfterDaily(\"1:00\") and not IsAfterDaily(\"9:00\")) {\n              this.parent = zdarBed\n            }\n            else if (IsAfterDaily(\"9:00\") and not IsAfterDaily(\"10:00\")) {\n              this.parent = buffet\n            }\n            else if (IsAfterDaily(\"10:00\") and not IsAfterDaily(\"11:00\")) {\n              this.parent = rileyBed\n            }\n            else if (IsAfterDaily(\"11:00\") and not IsAfterDaily(\"14:00\")) {\n              this.parent = beach\n            }\n            else if (IsAfterDaily(\"14:00\") and not IsAfterDaily(\"15:00\")) {\n              this.parent = buffet\n            }\n            else if (IsAfterDaily(\"15:00\") and not IsAfterDaily(\"16:00\")) {\n              this.parent = zdarBed\n            }\n            else if (IsAfterDaily(\"16:00\") and not IsAfterDaily(\"18:00\")) {\n              this.parent = sauna\n            }\n            else if (IsAfterDaily(\"18:00\") and not IsAfterDaily(\"19:00\")) {\n              this.parent = buffet\n            }\n          }\n        }\n        if (not oldroom = this.parent) {\n          PrintIfHere (oldroom, \"Zdar leaves the room\")\n          PrintIfHere (this.parent, \"Zdar enters the room\")\n        }\n      ]]&gt;&lt;/attr&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n  &lt;turnscript name=\"turn tracker\"&gt;\n    &lt;enabled /&gt;\n    &lt;script&gt;\n      if (not game.notarealturn) {\n        player.turns = player.turns + 1\n      }\n      game.notarealturn = false\n    &lt;/script&gt;\n  &lt;/turnscript&gt;\n  &lt;turnscript name=\"NpcTurnScript\"&gt;\n    &lt;enabled /&gt;\n    &lt;script&gt;\n      foreach (o, AllObjects()) {\n        if (HasScript(o, \"takeaturn\")) {\n          do (o, \"takeaturn\")\n        }\n      }\n    &lt;/script&gt;\n  &lt;/turnscript&gt;\n  &lt;function name=\"PrintIfHere\" parameters=\"room, s\"&gt;\n    if (game.pov.parent = room) {\n      msg (s)\n    }\n  &lt;/function&gt;\n&lt;/asl&gt;\n</code></pre>\n\n",
      "PostDate": "2020-10-07T23:47:06.9974728Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "8154d843-ca10-451c-ba97-0c2430bda54a",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I can't see any problems here, it certainly looks like turnscripts should be running.\r\n\r\nI can't replicate this problem myself, so it's hard to work out what could be causing it.\r\nI assume that it's the clock failing to change that lets you know they aren't running?\r\n\r\nThis one has me really confused now.",
      "EditableFormat": "markdown",
      "HTML": "<p>I can't see any problems here, it certainly looks like turnscripts should be running.</p>\n<p>I can't replicate this problem myself, so it's hard to work out what could be causing it.<br>\nI assume that it's the clock failing to change that lets you know they aren't running?</p>\n<p>This one has me really confused now.</p>\n\n",
      "PostDate": "2020-10-08T00:46:30.8003788Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "e10149c1-a965-4167-a359-0a5b24da9884",
      "UserId": 509320,
      "Username": "Zdarlight",
      "AvatarUrl": "https://i.imgur.com/rZfZobAb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Yeah, the clock not changing and the turn counter not incrementing except when RunTurnScripts is called are the main things that are indicating to me that turnscripts aren't running.\r\n\r\nI just tried something that I should have tried earlier: a fresh install. That seems to have fixed it, but I'm not sure what caused the issue in the first place now...\r\n\r\nThanks for your help and doing what you could to try to get this fixed!",
      "EditableFormat": "markdown",
      "HTML": "<p>Yeah, the clock not changing and the turn counter not incrementing except when RunTurnScripts is called are the main things that are indicating to me that turnscripts aren't running.</p>\n<p>I just tried something that I should have tried earlier: a fresh install. That seems to have fixed it, but I'm not sure what caused the issue in the first place now...</p>\n<p>Thanks for your help and doing what you could to try to get this fixed!</p>\n\n",
      "PostDate": "2020-10-08T01:46:54.6019943Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
