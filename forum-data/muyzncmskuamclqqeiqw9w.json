{
  "Topic": {
    "TopicId": "muyzncmskuamclqqeiqw9w",
    "ForumId": "10",
    "Title": "Cloning a room - contents?",
    "LastUpdated": "2017-10-04T12:54:45.1246686Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "6715d7d6-eb76-46b9-9c28-9fbf9a53a97b",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Before I do a load of experiments to work out what to do in this situation, maybe somebody can tell me. People have done random dungeon creators before, so somebody probably knows:\r\n\r\nIf I clone a room, what happens to its contents?\r\n* Are items in the room also cloned?\r\n* Are exits from the room duplicated?\r\n* Are exits *to* the room duplicated?\r\n* Are the `_initialise_` or `changedparent` scripts called for objects duplicated in this way?\r\n\r\nAnd the biggest question:\r\n* Is there a good way to make this easier, without falling foul of any weird gotchas, that someone who's been here before can suggest?",
      "EditableFormat": "markdown",
      "HTML": "<p>Before I do a load of experiments to work out what to do in this situation, maybe somebody can tell me. People have done random dungeon creators before, so somebody probably knows:</p>\n<p>If I clone a room, what happens to its contents?</p>\n<ul>\n<li>Are items in the room also cloned?</li>\n<li>Are exits from the room duplicated?</li>\n<li>Are exits <em>to</em> the room duplicated?</li>\n<li>Are the <code>_initialise_</code> or <code>changedparent</code> scripts called for objects duplicated in this way?</li>\n</ul>\n<p>And the biggest question:</p>\n<ul>\n<li>Is there a good way to make this easier, without falling foul of any weird gotchas, that someone who's been here before can suggest?</li>\n</ul>\n\n",
      "PostDate": "2017-10-04T12:54:45.1246686Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "89d8cd5d-701c-4d0c-a84c-e1c332ba0527",
      "UserId": 267336,
      "Username": "jmnevil54",
      "AvatarUrl": "https://secure.gravatar.com/avatar/5d73d7ec1dbe20a5cb46f02a6d53f187?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "DarkLizerd imported the Wumpus, which uses a dungeon spawner script...",
      "EditableFormat": "markdown",
      "HTML": "<p>DarkLizerd imported the Wumpus, which uses a dungeon spawner script...</p>\n\n",
      "PostDate": "2017-10-04T13:26:12.9373044Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "abed1234-9b22-4708-bda4-7c440e66f0f2",
      "UserId": 325816,
      "Username": "Amochure",
      "AvatarUrl": "https://i.imgur.com/qVl9es3b.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Not sure if this is what you are asking, but I've copied and pasted rooms and it duplicates everything about the room. Exits, objects, scripts... even the player! Hope that helps.",
      "EditableFormat": "markdown",
      "HTML": "<p>Not sure if this is what you are asking, but I've copied and pasted rooms and it duplicates everything about the room. Exits, objects, scripts... even the player! Hope that helps.</p>\n\n",
      "PostDate": "2017-10-04T14:39:54.4328677Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "841f85c0-76d5-42ca-ad3d-5da2d102c3c8",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "OK... I spent a while running test cases.\r\n\r\nConclusions:\r\n* Cloning a room does clone all its contents\r\n* Objects inside a cloned room get a `changedparent` event\r\n  * They think they've been moved from the original room to the clone\r\n  * There's no easy way for the changedparent script to distinguish between a move and a clone\r\n\r\nAs I have all my exits with a 'reverse' attribute that points to the exit in the other direction, and a `changedparent` that changes the other side's `to` to keep them in sync (and vice versa), this would result in both the original and cloned exits being in the clone room, and the exit 'to' the original room being moved to the clone.\r\n\r\nAs far as I can see, the simplest way to deal with this would be something like:\r\n```\r\nmovedobjects = NewObjectList()\r\nforeach (o, ListCombine (GetDirectChildren(this), ScopeExitsForRoom(this))) {\r\n  if (not GetBoolean(o, \"plenty\") or RandomChange(50)) {\r\n    list add (movedobjects, o)\r\n    if (o = game.pov) {\r\n      o.silentmovement = true\r\n    }\r\n    o.parent = null\r\n  }\r\n}\r\nnewroom = CloneObject (this)\r\ndir = RandomDirection()\r\nMakeExits (this, newroom, dir)\r\nforeach (o, movedobjects) {\r\n  if (o.alias = dir) {\r\n    o.parent = newroom\r\n  }\r\n  else if (o.alias = ReverseDirection(dir)) {\r\n    o.parent = this\r\n  }\r\n  else if (Randomhance(50)) {\r\n    o.parent = this\r\n  }\r\n  else {\r\n    o.parent = newroom\r\n  }\r\n  if (o = game.pov) {\r\n    o.silentmovement = false\r\n  }\r\n}\r\n```\r\n\r\nIs there anything unexpected that's likely to jump up and bite me with that?",
      "EditableFormat": "markdown",
      "HTML": "<p>OK... I spent a while running test cases.</p>\n<p>Conclusions:</p>\n<ul>\n<li>Cloning a room does clone all its contents</li>\n<li>Objects inside a cloned room get a <code>changedparent</code> event\n<ul>\n<li>They think they've been moved from the original room to the clone</li>\n<li>There's no easy way for the changedparent script to distinguish between a move and a clone</li>\n</ul>\n</li>\n</ul>\n<p>As I have all my exits with a 'reverse' attribute that points to the exit in the other direction, and a <code>changedparent</code> that changes the other side's <code>to</code> to keep them in sync (and vice versa), this would result in both the original and cloned exits being in the clone room, and the exit 'to' the original room being moved to the clone.</p>\n<p>As far as I can see, the simplest way to deal with this would be something like:</p>\n<pre><code>movedobjects = NewObjectList()\nforeach (o, ListCombine (GetDirectChildren(this), ScopeExitsForRoom(this))) {\n  if (not GetBoolean(o, \"plenty\") or RandomChange(50)) {\n    list add (movedobjects, o)\n    if (o = game.pov) {\n      o.silentmovement = true\n    }\n    o.parent = null\n  }\n}\nnewroom = CloneObject (this)\ndir = RandomDirection()\nMakeExits (this, newroom, dir)\nforeach (o, movedobjects) {\n  if (o.alias = dir) {\n    o.parent = newroom\n  }\n  else if (o.alias = ReverseDirection(dir)) {\n    o.parent = this\n  }\n  else if (Randomhance(50)) {\n    o.parent = this\n  }\n  else {\n    o.parent = newroom\n  }\n  if (o = game.pov) {\n    o.silentmovement = false\n  }\n}\n</code></pre>\n<p>Is there anything unexpected that's likely to jump up and bite me with that?</p>\n\n",
      "PostDate": "2017-10-04T15:49:29.0369477Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "9d933535-969b-4deb-9139-be71a21b9150",
      "UserId": 267336,
      "Username": "jmnevil54",
      "AvatarUrl": "https://secure.gravatar.com/avatar/5d73d7ec1dbe20a5cb46f02a6d53f187?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "```\r\nAmochure  Oct 4, 2017 10:39 AM new\r\nNot sure if this is what you are asking, but I've copied and pasted rooms and it duplicates everything about the room. Exits, objects, scripts... even the player! Hope that helps.\r\n```\r\nWait, the player? Does it clone the player too, or just the player object???",
      "EditableFormat": "markdown",
      "HTML": "<pre><code>Amochure  Oct 4, 2017 10:39 AM new\nNot sure if this is what you are asking, but I've copied and pasted rooms and it duplicates everything about the room. Exits, objects, scripts... even the player! Hope that helps.\n</code></pre>\n<p>Wait, the player? Does it clone the player too, or just the player object???</p>\n\n",
      "PostDate": "2017-10-04T16:15:54.3093986Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "84869fa8-5e7d-42e4-9796-1a243507d88b",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "this is a good question...\r\n\r\n'deep copying' vs 'shallow copying'\r\n\r\nhttp://www.cs.utexas.edu/~scottm/cs307/handouts/deepCopying.htm (no idea how good this link is - briefly looked at it only, just google search: deep vs shallow copying, if you want to look for better links)\r\n\r\n// or (I am using an old apple computer and browser, so it can't handle the 'https / secure http' url usage, argh), so here's the normal/secure (shttp) link of it for everyone with a modern computer/browser, lol:\r\nhttps://www.cs.utexas.edu/~scottm/cs307/handouts/deepCopying.htm\r\n\r\ndoes quest automatically do 'deep copying' without you having to manually do it (you just do 'shallow copying', but underneath quest actually does 'deep copying') or do you have to manually do 'deep vs shallow' copying ???",
      "EditableFormat": "markdown",
      "HTML": "<p>this is a good question...</p>\n<p>'deep copying' vs 'shallow copying'</p>\n<p>http://www.cs.utexas.edu/~scottm/cs307/handouts/deepCopying.htm (no idea how good this link is - briefly looked at it only, just google search: deep vs shallow copying, if you want to look for better links)</p>\n<p>// or (I am using an old apple computer and browser, so it can't handle the 'https / secure http' url usage, argh), so here's the normal/secure (shttp) link of it for everyone with a modern computer/browser, lol:<br>\nhttps://www.cs.utexas.edu/~scottm/cs307/handouts/deepCopying.htm</p>\n<p>does quest automatically do 'deep copying' without you having to manually do it (you just do 'shallow copying', but underneath quest actually does 'deep copying') or do you have to manually do 'deep vs shallow' copying ???</p>\n\n",
      "PostDate": "2017-10-04T17:33:59.5320165Z",
      "LastEditDate": "2017-10-04T17:37:17.3221986Z",
      "link": null
    },
    {
      "PostId": "695c854d-32d1-4b2b-bf74-4de6728831c6",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "HK: I know what a deep copy is. That's not what I asked.\r\n\r\nI think that making a trivial test game to check something is when I hate the web editor most; because just creating an object that needs no detail beyond a name takes 5-10 seconds longer than it should. Building a simple test game (two rooms, a pair of exits, and a command that clones one of them) took me half an hour. So, sorry to keep asking things I should be able to check myself.",
      "EditableFormat": "markdown",
      "HTML": "<p>HK: I know what a deep copy is. That's not what I asked.</p>\n<p>I think that making a trivial test game to check something is when I hate the web editor most; because just creating an object that needs no detail beyond a name takes 5-10 seconds longer than it should. Building a simple test game (two rooms, a pair of exits, and a command that clones one of them) took me half an hour. So, sorry to keep asking things I should be able to check myself.</p>\n\n",
      "PostDate": "2017-10-04T18:01:31.5912598Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1325888a-5884-4de2-91bb-6ce9f2b579e9",
      "UserId": 267336,
      "Username": "jmnevil54",
      "AvatarUrl": "https://secure.gravatar.com/avatar/5d73d7ec1dbe20a5cb46f02a6d53f187?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I think hegemonkhan was trying to say my question with different wording.\r\n\r\n\"Building a simple test game (two rooms, a pair of exits, and a command that clones one of them) took me half an hour.\"\r\n\r\nYou must have done something else because holy crap, that's not very much for one hour!\r\n\r\nI know that typing the name for an object takes awhile, but it needs a name. Just like any other program or folder, or Word Document, or something. When I am lazy, I just type random letters anyway. uhfu\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>I think hegemonkhan was trying to say my question with different wording.</p>\n<p>\"Building a simple test game (two rooms, a pair of exits, and a command that clones one of them) took me half an hour.\"</p>\n<p>You must have done something else because holy crap, that's not very much for one hour!</p>\n<p>I know that typing the name for an object takes awhile, but it needs a name. Just like any other program or folder, or Word Document, or something. When I am lazy, I just type random letters anyway. uhfu</p>\n\n",
      "PostDate": "2017-10-04T19:10:30.8021394Z",
      "LastEditDate": "2017-10-04T19:12:44.7211723Z",
      "link": null
    },
    {
      "PostId": "b8846c43-16bb-4542-a74f-93c167cc8bd8",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I meant that this topic is similar to how quest handles (at least the concept anyways) of 'deep vs shallow copying', as I'm still a bit of a noob in understanding these coding concepts and with how quest works.\r\n\r\n--------\r\n\r\n@ mrangel:\r\n\r\nI wasn't responding to your post directly (and I know you know what 'deep/shallow copying' is, as you're a good/knowledgeable programmer, I'm still taking lower division classes / am a noob programmer), sorry if it came off like that.\r\n\r\n-----\r\n\r\n@ jmnevil54:\r\n\r\nI wasn't responding directly to your post too, lol.\r\n\r\n------\r\n\r\nI was just making a comment, that to me, the topic of how quest deals with nested Objects/Attributes when copying, seems to be similar to the concept of 'deep vs shallow copying', and hoping that I could get repsonses on it, explaining it to me (whether I am on the right track or not, lol), as I still have some trouble with these code concepts and that I don't know how quest works much.\r\n\r\n-----------\r\n\r\nP.S.\r\n\r\n@ mrangel:\r\n\r\nI totally understand that too (we're of the same mind, lol), except for me, it's just due to me being uber lazy, lol.\r\n\r\nI'm lazy, so I just ask a question here, hoping to get a quick answer/response, instead of testing it myself and getting an answer.",
      "EditableFormat": "markdown",
      "HTML": "<p>I meant that this topic is similar to how quest handles (at least the concept anyways) of 'deep vs shallow copying', as I'm still a bit of a noob in understanding these coding concepts and with how quest works.</p>\n<hr>\n<p>@ mrangel:</p>\n<p>I wasn't responding to your post directly (and I know you know what 'deep/shallow copying' is, as you're a good/knowledgeable programmer, I'm still taking lower division classes / am a noob programmer), sorry if it came off like that.</p>\n<hr>\n<p>@ jmnevil54:</p>\n<p>I wasn't responding directly to your post too, lol.</p>\n<hr>\n<p>I was just making a comment, that to me, the topic of how quest deals with nested Objects/Attributes when copying, seems to be similar to the concept of 'deep vs shallow copying', and hoping that I could get repsonses on it, explaining it to me (whether I am on the right track or not, lol), as I still have some trouble with these code concepts and that I don't know how quest works much.</p>\n<hr>\n<p>P.S.</p>\n<p>@ mrangel:</p>\n<p>I totally understand that too (we're of the same mind, lol), except for me, it's just due to me being uber lazy, lol.</p>\n<p>I'm lazy, so I just ask a question here, hoping to get a quick answer/response, instead of testing it myself and getting an answer.</p>\n\n",
      "PostDate": "2017-10-04T22:36:38.0607467Z",
      "LastEditDate": "2017-10-04T22:40:07.1339828Z",
      "link": null
    }
  ]
}
