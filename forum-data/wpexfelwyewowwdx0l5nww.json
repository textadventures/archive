{
  "Topic": {
    "TopicId": "wpexfelwyewowwdx0l5nww",
    "ForumId": "10",
    "Title": "Save / Load library not working [Moved to the Quest Forum]",
    "LastUpdated": "2024-07-16T14:07:13.1276692Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "19ea08d4-25e5-43c0-be2a-84acf036ebdd",
      "UserId": 26387,
      "Username": "M4u",
      "AvatarUrl": "https://secure.gravatar.com/avatar/71ebfc011d52b6e8d2e91bc9f2fdda5a?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi guys, I tried to use the new library to save a game but it is not working:\r\n\r\nhttps://github.com/ThePix/quest/wiki/Library:-Save-and-Load\r\n\r\nIt gets stuck in: \"About to do clones\"\r\n\r\nAny advise or a different way to save when playing online?  \r\n\r\nThank you,",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi guys, I tried to use the new library to save a game but it is not working:</p>\n<p>https://github.com/ThePix/quest/wiki/Library:-Save-and-Load</p>\n<p>It gets stuck in: \"About to do clones\"</p>\n<p>Any advise or a different way to save when playing online?</p>\n<p>Thank you,</p>\n\n",
      "PostDate": "2024-07-16T14:07:13.1276692Z",
      "LastEditDate": "2024-11-23T04:14:00.4009837Z",
      "link": null
    },
    {
      "PostId": "1941dd1e-710c-4e8c-b096-28fef059d8b5",
      "UserId": 31991,
      "Username": "daeun",
      "AvatarUrl": "https://i.imgur.com/Xvt8zzBb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Just double confirming, pixie's save-and-load might indeed be not working \r\nas I had tried before in \r\nhttps://textadventures.co.uk/forum/quest/topic/kx6xtevrhug7dvspfkdz9q/running-start-script-on-every-play-even-on-saves",
      "EditableFormat": "markdown",
      "HTML": "<p>Just double confirming, pixie's save-and-load might indeed be not working<br>\nas I had tried before in<br>\nhttps://textadventures.co.uk/forum/quest/topic/kx6xtevrhug7dvspfkdz9q/running-start-script-on-every-play-even-on-saves</p>\n\n",
      "PostDate": "2024-07-16T14:20:54.2057987Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "598e5841-63bc-4ebd-8efe-6b2ab9549013",
      "UserId": 587281,
      "Username": "PsychoVyse",
      "AvatarUrl": "https://secure.gravatar.com/avatar/f359107abf9dc8cfe62bba1e4a8e84a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I'm also interested to know as I heavily rely on object clones and will need to reload them in the same state as they were when they were saved.",
      "EditableFormat": "markdown",
      "HTML": "<p>I'm also interested to know as I heavily rely on object clones and will need to reload them in the same state as they were when they were saved.</p>\n\n",
      "PostDate": "2024-07-22T08:54:15.7405227Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1a2aeb93-78ea-4c99-9553-02158474cf45",
      "UserId": 587281,
      "Username": "PsychoVyse",
      "AvatarUrl": "https://secure.gravatar.com/avatar/f359107abf9dc8cfe62bba1e4a8e84a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I noticed you posted a Quest 5.8 guide to saving yet this is the QuestJS forum, this is the guide to saving on QuestJS https://github.com/ThePix/QuestJS/wiki/Save-Load \r\n\r\n---\r\n**NOTE FROM MODERATOR: This thread was moved to the Quest Forum after this was posted.**",
      "EditableFormat": "markdown",
      "HTML": "<p>I noticed you posted a Quest 5.8 guide to saving yet this is the QuestJS forum, this is the guide to saving on QuestJS https://github.com/ThePix/QuestJS/wiki/Save-Load</p>\n<hr>\n<p><strong>NOTE FROM MODERATOR: This thread was moved to the Quest Forum after this was posted.</strong></p>\n\n",
      "PostDate": "2024-07-23T20:09:14.9041575Z",
      "LastEditDate": "2024-11-23T04:13:29.5259143Z",
      "link": null
    },
    {
      "PostId": "8b8449d5-1458-4806-a197-3a1c60a1f9ed",
      "UserId": 26387,
      "Username": "M4u",
      "AvatarUrl": "https://secure.gravatar.com/avatar/71ebfc011d52b6e8d2e91bc9f2fdda5a?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thank you PsychoVyse, where can i get QuestJS? is that Quest 6 as mentioned in the article? Is it the version online?",
      "EditableFormat": "markdown",
      "HTML": "<p>Thank you PsychoVyse, where can i get QuestJS? is that Quest 6 as mentioned in the article? Is it the version online?</p>\n\n",
      "PostDate": "2024-08-27T22:18:25.7059266Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "674aff2d-51d2-4d2c-83ea-6c68a669dae9",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hello.\r\n\r\n>where can i get QuestJS? is that Quest 6 as mentioned in the article? Is it the version online?\r\n\r\nhttps://github.com/ThePix/QuestJS",
      "EditableFormat": "markdown",
      "HTML": "<p>Hello.</p>\n<blockquote>\n<p>where can i get QuestJS? is that Quest 6 as mentioned in the article? Is it the version online?</p>\n</blockquote>\n<p>https://github.com/ThePix/QuestJS</p>\n\n",
      "PostDate": "2024-08-28T04:51:02.2204264Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "d511ea06-6c6b-40c2-be69-adbebd3a2dbd",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "If you are still checking this thread, the normal online saving feature has recently been fixed.",
      "EditableFormat": "markdown",
      "HTML": "<p>If you are still checking this thread, the normal online saving feature has recently been fixed.</p>\n\n",
      "PostDate": "2024-09-30T03:09:10.6827024Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "b5dbe594-07fc-44f9-9686-fd8375fc1606",
      "UserId": 703786,
      "Username": "TextMisadventures",
      "AvatarUrl": "https://i.imgur.com/HoT06tvb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "For anyone reading this who is having this issue, I believe this might be what happens when the game includes a `|` in the code somewhere.\r\n\r\nhttps://github.com/ThePix/quest/wiki/Library:-Save-and-Load\r\n\r\n---\r\n>### [Clones](https://github.com/ThePix/quest/wiki/Library:-Save-and-Load#clones)\r\n>\r\n>It can handle clones, but you do need to set them up. When a save-game is loaded, all existing clones in the game world are destroyed, and then all the clones from the save-game are re-created. Note that they will be cloned from the saved prototypes, so if your prototype has changed, it will be a clone of the prototype as it was when the game was saved.\r\n>\r\n>To ensure a clone gets its attributes set properly, you need to give the prototype a \"saveloadatts\" attribute - and Quest will refuse to clone anything without it. The attribute should be a string list of attributes to save. Unlike the \"saveloadatts\" attribute of the `game` object, Quest will attempt to guess the attribute type, and is restricted to `int`, `string` and `boolean`\r\n\r\n---\r\n> ### [Limitations](https://github.com/ThePix/quest/wiki/Library:-Save-and-Load#limitations)\r\n>\r\n>Your game name must not include a vertical bar, `|`.\r\n>\r\n>This cannot cope with attributes that are scripts, dictionaries or lists, except for string lists and dictionaries of string lists (if the latter seems somewhat obscure, it is because it is required internally). You certainly can use these other attributes in your game, they just will not be saved, so you cannot have them change during game play.\r\n>\r\n>It cannot cope with objects that are created during game time, as you will not know their names or types. It can handle cloned objects, so you can work around that limitation.\r\n>\r\n>It assumes the player object is called \"player\", and does not allow for changing POV.\r\n>\r\n>The `firsttime/otherwise` script command saves deep in the underlying code, inaccessible to Quest, and therefore cannot be saved. It is probably best avoided altogether. You can use the `once` text processor directive.\r\n\r\n---\r\n<a target=\"_blank\" href=\"https://github.com/ThePix/quest/blob/1b45540319969405d58e22b219de4a1f8104cab6/SaveLoad.aslx#L428C1-L445C14\">https://github.com/ThePix/quest/blob/1b45540319969405d58e22b219de4a1f8104cab6/SaveLoad.aslx#L428C1-L445C14</a>\r\n\r\n<pre class=\"dark-plus\" style=\"background-color:#1E1E1E;color:#D4D4D4\" tabindex=\"0\"><code><div class=\"line\"><span style=\"color:#808080\">  &#x3C;</span><span style=\"color:#569CD6\">function</span><span style=\"color:#9CDCFE\"> name</span><span style=\"color:#D4D4D4\">=</span><span style=\"color:#CE9178\">\"GetCloneData\"</span><span style=\"color:#9CDCFE\"> type</span><span style=\"color:#D4D4D4\">=</span><span style=\"color:#CE9178\">\"string\"</span><span style=\"color:#808080\">></span></div><div class=\"line\"><span style=\"color:#D4D4D4\">    ol = FilterByNotAttribute(AllObjects(), \"prototype\", null)</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">    sl = NewStringList()</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">    msg(\"About to do clones\")</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">    foreach (o, ol) {</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">      s = o.name + \"/\" + o.prototype.name</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">      if (HasAttribute(o, \"saveloadatts\")) {</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">        foreach (att, o.saveloadatts) {</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">          s = s + \"/\" + GetAttribute(o, att)</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">        }</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">        list add (sl, s)</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">      }</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">      else {</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">        error(\"Clone prototype, \" + o.prototype.name + \", has no 'saveloadatts' attribute.\")</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">      }</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">    }</span></div><div class=\"line\"><span style=\"color:#D4D4D4\">    return (Join(sl, \"|\"))</span></div><div class=\"line\"><span style=\"color:#808080\">  &#x3C;/</span><span style=\"color:#569CD6\">function</span><span style=\"color:#808080\">></span></div></code></pre>\r\n\r\n---\r\nTo test this theory, one could replace this line:\r\n```\r\n    return (Join(sl, \"|\"))\r\n```\r\n\r\n... with these 2 lines:\r\n```\r\n    msg(\"About to return GetCloneData...\")\r\n    return (Join(sl, \"|\"))\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>For anyone reading this who is having this issue, I believe this might be what happens when the game includes a <code>|</code> in the code somewhere.</p>\n<p>https://github.com/ThePix/quest/wiki/Library:-Save-and-Load</p>\n<hr>\n<blockquote>\n<h3><a href=\"https://github.com/ThePix/quest/wiki/Library:-Save-and-Load#clones\">Clones</a></h3>\n<p>It can handle clones, but you do need to set them up. When a save-game is loaded, all existing clones in the game world are destroyed, and then all the clones from the save-game are re-created. Note that they will be cloned from the saved prototypes, so if your prototype has changed, it will be a clone of the prototype as it was when the game was saved.</p>\n<p>To ensure a clone gets its attributes set properly, you need to give the prototype a \"saveloadatts\" attribute - and Quest will refuse to clone anything without it. The attribute should be a string list of attributes to save. Unlike the \"saveloadatts\" attribute of the <code>game</code> object, Quest will attempt to guess the attribute type, and is restricted to <code>int</code>, <code>string</code> and <code>boolean</code></p>\n</blockquote>\n<hr>\n<blockquote>\n<h3><a href=\"https://github.com/ThePix/quest/wiki/Library:-Save-and-Load#limitations\">Limitations</a></h3>\n<p>Your game name must not include a vertical bar, <code>|</code>.</p>\n<p>This cannot cope with attributes that are scripts, dictionaries or lists, except for string lists and dictionaries of string lists (if the latter seems somewhat obscure, it is because it is required internally). You certainly can use these other attributes in your game, they just will not be saved, so you cannot have them change during game play.</p>\n<p>It cannot cope with objects that are created during game time, as you will not know their names or types. It can handle cloned objects, so you can work around that limitation.</p>\n<p>It assumes the player object is called \"player\", and does not allow for changing POV.</p>\n<p>The <code>firsttime/otherwise</code> script command saves deep in the underlying code, inaccessible to Quest, and therefore cannot be saved. It is probably best avoided altogether. You can use the <code>once</code> text processor directive.</p>\n</blockquote>\n<hr>\n<p><a target=\"_blank\" href=\"https://github.com/ThePix/quest/blob/1b45540319969405d58e22b219de4a1f8104cab6/SaveLoad.aslx#L428C1-L445C14\">https://github.com/ThePix/quest/blob/1b45540319969405d58e22b219de4a1f8104cab6/SaveLoad.aslx#L428C1-L445C14</a></p>\n<pre style=\"background-color: #1E1E1E; color: #D4D4D4\" tabindex=\"0\"><code><div><span style=\"color: #808080\">  &lt;</span><span style=\"color: #569CD6\">function</span><span style=\"color: #9CDCFE\"> name</span><span style=\"color: #D4D4D4\">=</span><span style=\"color: #CE9178\">\"GetCloneData\"</span><span style=\"color: #9CDCFE\"> type</span><span style=\"color: #D4D4D4\">=</span><span style=\"color: #CE9178\">\"string\"</span><span style=\"color: #808080\">&gt;</span></div><div><span style=\"color: #D4D4D4\">    ol = FilterByNotAttribute(AllObjects(), \"prototype\", null)</span></div><div><span style=\"color: #D4D4D4\">    sl = NewStringList()</span></div><div><span style=\"color: #D4D4D4\">    msg(\"About to do clones\")</span></div><div><span style=\"color: #D4D4D4\">    foreach (o, ol) {</span></div><div><span style=\"color: #D4D4D4\">      s = o.name + \"/\" + o.prototype.name</span></div><div><span style=\"color: #D4D4D4\">      if (HasAttribute(o, \"saveloadatts\")) {</span></div><div><span style=\"color: #D4D4D4\">        foreach (att, o.saveloadatts) {</span></div><div><span style=\"color: #D4D4D4\">          s = s + \"/\" + GetAttribute(o, att)</span></div><div><span style=\"color: #D4D4D4\">        }</span></div><div><span style=\"color: #D4D4D4\">        list add (sl, s)</span></div><div><span style=\"color: #D4D4D4\">      }</span></div><div><span style=\"color: #D4D4D4\">      else {</span></div><div><span style=\"color: #D4D4D4\">        error(\"Clone prototype, \" + o.prototype.name + \", has no 'saveloadatts' attribute.\")</span></div><div><span style=\"color: #D4D4D4\">      }</span></div><div><span style=\"color: #D4D4D4\">    }</span></div><div><span style=\"color: #D4D4D4\">    return (Join(sl, \"|\"))</span></div><div><span style=\"color: #808080\">  &lt;/</span><span style=\"color: #569CD6\">function</span><span style=\"color: #808080\">&gt;</span></div></code></pre>\n<hr>\n<p>To test this theory, one could replace this line:</p>\n<pre><code>    return (Join(sl, \"|\"))\n</code></pre>\n<p>... with these 2 lines:</p>\n<pre><code>    msg(\"About to return GetCloneData...\")\n    return (Join(sl, \"|\"))\n</code></pre>\n\n",
      "PostDate": "2024-11-23T04:09:59.8727648Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
