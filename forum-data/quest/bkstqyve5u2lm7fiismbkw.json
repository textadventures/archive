{
  "Topic": {
    "TopicId": "bkstqyve5u2lm7fiismbkw",
    "ForumId": "10",
    "Title": "moving in a dark room in Quest",
    "LastUpdated": "2020-03-04T06:58:18.6149223Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "fdb39e7e-427f-4ae5-8b45-1ade770a72eb",
      "UserId": 454326,
      "Username": "Brian5757",
      "AvatarUrl": "https://secure.gravatar.com/avatar/411c3e8cd4782d4a996f292940a61069?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "It looks like once you move to a dark room without a light source then none of the commands will work for the player. Is there a way to move out of the dark room, such as moving out of a dark cave into light. \r\nIt's also a problem if the touch runs out of battery power in the dark as the player can't change the battery. Putting the touch down then moving to another dark room also seems to stop game play as your in the dark so Quest won't respond to any commands by the player.",
      "EditableFormat": "markdown",
      "HTML": "<p>It looks like once you move to a dark room without a light source then none of the commands will work for the player. Is there a way to move out of the dark room, such as moving out of a dark cave into light.<br>\nIt's also a problem if the touch runs out of battery power in the dark as the player can't change the battery. Putting the touch down then moving to another dark room also seems to stop game play as your in the dark so Quest won't respond to any commands by the player.</p>\n\n",
      "PostDate": "2020-03-04T06:58:18.6149223Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "75206a27-ea6a-45f9-9cfd-0b5e0bbdfed9",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> Is there a way to move out of the dark room, such as moving out of a dark cave into light.\r\n\r\nThe normal way to do this would be to make the exit a weak light source. Then it's bright enough to be seen in a dark room, but not bright enough to illuminate the rest of the room.\r\n\r\n> It's also a problem if the touch runs out of battery power in the dark as the player can't change the battery.\r\n\r\nIn most games that have a torch with limited battery, this is an intentional way to lose the game.\r\nThere are a couple of ways to change it depending on what you would like to happen in this case.\r\n\r\n(one of my frustrations with the darkness system is that it doesn't account for checking the darkness level of a room other than the one where the player is. It's possible to work around this, but it's somewhat awkward. I've used a script before which renders exits visible if they lead to a room that isn't dark, but the code is pretty ugly. In another game, \"Circus\", I made a system where using the \"go\" command in a dark room causes the game to pick an exit at random; picking a non-compass exit (one of the ladders, or climbing into the dolphin tank) generates the response \"You trip in the darkness and break your neck.\" instead)",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>Is there a way to move out of the dark room, such as moving out of a dark cave into light.</p>\n</blockquote>\n<p>The normal way to do this would be to make the exit a weak light source. Then it's bright enough to be seen in a dark room, but not bright enough to illuminate the rest of the room.</p>\n<blockquote>\n<p>It's also a problem if the touch runs out of battery power in the dark as the player can't change the battery.</p>\n</blockquote>\n<p>In most games that have a torch with limited battery, this is an intentional way to lose the game.<br>\nThere are a couple of ways to change it depending on what you would like to happen in this case.</p>\n<p>(one of my frustrations with the darkness system is that it doesn't account for checking the darkness level of a room other than the one where the player is. It's possible to work around this, but it's somewhat awkward. I've used a script before which renders exits visible if they lead to a room that isn't dark, but the code is pretty ugly. In another game, \"Circus\", I made a system where using the \"go\" command in a dark room causes the game to pick an exit at random; picking a non-compass exit (one of the ladders, or climbing into the dolphin tank) generates the response \"You trip in the darkness and break your neck.\" instead)</p>\n\n",
      "PostDate": "2020-03-04T09:11:57.9234611Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "35dfd32b-403e-4c21-8234-29a6615b61fb",
      "UserId": 454326,
      "Username": "Brian5757",
      "AvatarUrl": "https://secure.gravatar.com/avatar/411c3e8cd4782d4a996f292940a61069?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thanks mrangel.\r\n\r\nAt least I can use the weak light source exit. It will save the player from having to start over again. ",
      "EditableFormat": "markdown",
      "HTML": "<p>Thanks mrangel.</p>\n<p>At least I can use the weak light source exit. It will save the player from having to start over again.</p>\n\n",
      "PostDate": "2020-03-05T01:42:28.7266702Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "bb6c4382-fee7-422b-aa5d-145d2732af06",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "One option I thought of was modifying the `CheckDarkness` function so that if the room is dark, it also checks all the current room's exits, and turns them into weak light sources if the room on the other side isn't dark. That would cover examples such as the player being able to find their way back to the room they just left their torch in; but it would need a little more code if, for example, the torch goes out when the player isn't present.",
      "EditableFormat": "markdown",
      "HTML": "<p>One option I thought of was modifying the <code>CheckDarkness</code> function so that if the room is dark, it also checks all the current room's exits, and turns them into weak light sources if the room on the other side isn't dark. That would cover examples such as the player being able to find their way back to the room they just left their torch in; but it would need a little more code if, for example, the torch goes out when the player isn't present.</p>\n\n",
      "PostDate": "2020-03-05T03:11:49.0433361Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1aef7e03-075d-479a-a207-548e88b4fd2a",
      "UserId": 454326,
      "Username": "Brian5757",
      "AvatarUrl": "https://secure.gravatar.com/avatar/411c3e8cd4782d4a996f292940a61069?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "At the moment when their is a faint exit light you can still walk from a dark location into another dark location and once that happens all players commands are ignored.\r\nWhat I would like to see if a way of preventing the player in a dark room from walking into another dark room by having the message \"It's too dark to go in that direction\" if the player tries to do this. Maybe there is a test to see if the player is in a dark room.\r\n\r\nI don't know Quest well enought to find the CheckDarkness function.",
      "EditableFormat": "markdown",
      "HTML": "<p>At the moment when their is a faint exit light you can still walk from a dark location into another dark location and once that happens all players commands are ignored.<br>\nWhat I would like to see if a way of preventing the player in a dark room from walking into another dark room by having the message \"It's too dark to go in that direction\" if the player tries to do this. Maybe there is a test to see if the player is in a dark room.</p>\n<p>I don't know Quest well enought to find the CheckDarkness function.</p>\n\n",
      "PostDate": "2020-03-05T12:50:23.8924717Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "88dc98fb-55f2-4195-98e5-706fb0969740",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> At the moment when their is a faint exit light you can still walk from a dark location into another dark location\r\n\r\nThat's odd. Can you provide a test game to show this behaviour?\r\nIn a dark room, the player should be able to see only the illuminated exit, which presumably leads back into a lit area.\r\n\r\n> I don't know Quest well enought to find the CheckDarkness function.\r\n\r\nI can't edit core functions on the web version, so can't really advise. Here's an alternate way to do it.\r\n\r\nFirst, a function to check the darkness level of a room:\r\n```\r\n<function name=\"CheckDarknessForRoom\" type=\"boolean\" parameters=\"room\">\r\n  if (room = game.pov.parent) {\r\n    level = CheckDarkness()\r\n  }\r\n  else if ((GetBoolean (room, \"transparent\") or GetBoolean (room, \"isopen\")) and HasObject (room, \"parent\")) {\r\n    // If a torch goes out in a box, make sure we darken the containing room and not just the box\r\n    level = CheckDarknessForRoom (room.parent) and GetBoolean (room, \"dark\")\r\n  }\r\n  else if (not GetBoolean (room, \"dark\")) {\r\n    level = false\r\n  }\r\n  else {\r\n    // Check for light sources\r\n    level = true\r\n    foreach (obj, ScopeVisibleForRoom(room)) {\r\n      if (GetBoolean (obj, \"lightsource\") and GetString (obj, \"lightstrength\") = \"strong\") {\r\n        level = false\r\n      }\r\n    }\r\n  }\r\n  if (not room.darklevel = level) {\r\n    room.darklevel = level\r\n    // the room has become dark or light; so change the lightsourceness of any exits leading here\r\n    foreach (exit, AllExits()) {\r\n      if (exit.to = room) {\r\n        // don't mess around with doors that are lightsources anyway\r\n        if (not HasBoolean (exit, \"naturallightsource\")) {\r\n          exit.naturallightsource = GetBoolean (exit, \"lightsource\")\r\n        }\r\n        if (not HasString (exit, \"lightstrength\")) {\r\n          exit.lightstrength = \"weak\"\r\n        }\r\n        exit.lightsource = level or exit.naturallightsource\r\n      }\r\n    }\r\n  }\r\n  return (room.level)\r\n</function>\r\n```\r\n\r\nThen in the \"roomenter\" script of the game object (run whenever a player enters a room) you would do:\r\n```\r\nif (CheckDarkness()) {\r\n  // we don't use ScopeExits() because that wouldn't check the ones that are currently dark\r\n  foreach (exit, AllExits()) {\r\n    if (exit.parent = game.pov.parent and HasObject (exit, \"to\")) {\r\n      CheckDarknessForRoom (exit.to)\r\n    }\r\n  }\r\n}\r\n```\r\nIf you have a script which turns off or moves a lightsource when the player isn't in the room (such as a torch battery running out), you would also want to run `CheckDarknessForRoom` on its parent object. This means that if the player leaves their torch in an adjacent room and waits, the exit will no longer be illuminated when the torch goes out.\r\n\r\n\r\nAll off the top of my head, so my apologies for any errors there.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>At the moment when their is a faint exit light you can still walk from a dark location into another dark location</p>\n</blockquote>\n<p>That's odd. Can you provide a test game to show this behaviour?<br>\nIn a dark room, the player should be able to see only the illuminated exit, which presumably leads back into a lit area.</p>\n<blockquote>\n<p>I don't know Quest well enought to find the CheckDarkness function.</p>\n</blockquote>\n<p>I can't edit core functions on the web version, so can't really advise. Here's an alternate way to do it.</p>\n<p>First, a function to check the darkness level of a room:</p>\n<pre><code>&lt;function name=\"CheckDarknessForRoom\" type=\"boolean\" parameters=\"room\"&gt;\n  if (room = game.pov.parent) {\n    level = CheckDarkness()\n  }\n  else if ((GetBoolean (room, \"transparent\") or GetBoolean (room, \"isopen\")) and HasObject (room, \"parent\")) {\n    // If a torch goes out in a box, make sure we darken the containing room and not just the box\n    level = CheckDarknessForRoom (room.parent) and GetBoolean (room, \"dark\")\n  }\n  else if (not GetBoolean (room, \"dark\")) {\n    level = false\n  }\n  else {\n    // Check for light sources\n    level = true\n    foreach (obj, ScopeVisibleForRoom(room)) {\n      if (GetBoolean (obj, \"lightsource\") and GetString (obj, \"lightstrength\") = \"strong\") {\n        level = false\n      }\n    }\n  }\n  if (not room.darklevel = level) {\n    room.darklevel = level\n    // the room has become dark or light; so change the lightsourceness of any exits leading here\n    foreach (exit, AllExits()) {\n      if (exit.to = room) {\n        // don't mess around with doors that are lightsources anyway\n        if (not HasBoolean (exit, \"naturallightsource\")) {\n          exit.naturallightsource = GetBoolean (exit, \"lightsource\")\n        }\n        if (not HasString (exit, \"lightstrength\")) {\n          exit.lightstrength = \"weak\"\n        }\n        exit.lightsource = level or exit.naturallightsource\n      }\n    }\n  }\n  return (room.level)\n&lt;/function&gt;\n</code></pre>\n<p>Then in the \"roomenter\" script of the game object (run whenever a player enters a room) you would do:</p>\n<pre><code>if (CheckDarkness()) {\n  // we don't use ScopeExits() because that wouldn't check the ones that are currently dark\n  foreach (exit, AllExits()) {\n    if (exit.parent = game.pov.parent and HasObject (exit, \"to\")) {\n      CheckDarknessForRoom (exit.to)\n    }\n  }\n}\n</code></pre>\n<p>If you have a script which turns off or moves a lightsource when the player isn't in the room (such as a torch battery running out), you would also want to run <code>CheckDarknessForRoom</code> on its parent object. This means that if the player leaves their torch in an adjacent room and waits, the exit will no longer be illuminated when the torch goes out.</p>\n<p>All off the top of my head, so my apologies for any errors there.</p>\n\n",
      "PostDate": "2020-03-05T13:40:00.551813Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "01505d99-58fc-4097-bffc-0ae7316f1241",
      "UserId": 454326,
      "Username": "Brian5757",
      "AvatarUrl": "https://secure.gravatar.com/avatar/411c3e8cd4782d4a996f292940a61069?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thanks mrangel for the codes.\r\n\r\n\r\n\r\n    At the moment when their is a faint exit light you can still walk from a dark location into another dark location\r\n\r\nThat's odd. Can you provide a test game to show this behaviour?\r\nIn a dark room, the player should be able to see only the illuminated exit, which presumably leads back into a lit area.\r\n\r\nIn my adventure the only directions the player knows about are those included in the room text such as \"The cave extends towards to west. There is a faint light in the east.\". The panel that gives room directions is turned off so that the adventure looks like a text book.\r\n\r\nI'll do some more experimenting on this to see what is possible.",
      "EditableFormat": "markdown",
      "HTML": "<p>Thanks mrangel for the codes.</p>\n<pre><code>At the moment when their is a faint exit light you can still walk from a dark location into another dark location\n</code></pre>\n<p>That's odd. Can you provide a test game to show this behaviour?<br>\nIn a dark room, the player should be able to see only the illuminated exit, which presumably leads back into a lit area.</p>\n<p>In my adventure the only directions the player knows about are those included in the room text such as \"The cave extends towards to west. There is a faint light in the east.\". The panel that gives room directions is turned off so that the adventure looks like a text book.</p>\n<p>I'll do some more experimenting on this to see what is possible.</p>\n\n",
      "PostDate": "2020-03-05T23:43:59.2943093Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "92b80412-a554-48b3-b5be-1924b1e9377b",
      "UserId": 454326,
      "Username": "Brian5757",
      "AvatarUrl": "https://secure.gravatar.com/avatar/411c3e8cd4782d4a996f292940a61069?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi mrangel.\r\n\r\nI did some testing using a test adventure and found that if you try to go to a direction that does not have a weak light source then you are told that \"you can't go in that direction\", so I'm not certain why my main adventure is not giving me that message and allowing me to go to another dark room in the cave. It may have something to do with the code you gave me to run at the start of the game go that I can type W, WEST, GO WEST, GO CAVE.\r\nI've found with programming that if you change something in the code then it can cause problems elsewhere in the code.\r\nI could have message \"It's too dark to travel west\" as the default dark room message to try and stop the player going into the another dark cave.\r\nI might also be able to have a condition that if the player types W and is in the first dark room then I could have the code \r\nif (game.pov.parent = Cave2) {\r\nif (Cave1,dark) {\r\n  msg \"You can't go in that direction\r\n}\r\n}\r\n\r\n\r\n\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi mrangel.</p>\n<p>I did some testing using a test adventure and found that if you try to go to a direction that does not have a weak light source then you are told that \"you can't go in that direction\", so I'm not certain why my main adventure is not giving me that message and allowing me to go to another dark room in the cave. It may have something to do with the code you gave me to run at the start of the game go that I can type W, WEST, GO WEST, GO CAVE.<br>\nI've found with programming that if you change something in the code then it can cause problems elsewhere in the code.<br>\nI could have message \"It's too dark to travel west\" as the default dark room message to try and stop the player going into the another dark cave.<br>\nI might also be able to have a condition that if the player types W and is in the first dark room then I could have the code<br>\nif (game.pov.parent = Cave2) {<br>\nif (Cave1,dark) {<br>\nmsg \"You can't go in that direction<br>\n}<br>\n}</p>\n\n",
      "PostDate": "2020-03-06T00:47:35.3352695Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2aecb128-0460-43aa-bae9-301bead4ecc6",
      "UserId": 454326,
      "Username": "Brian5757",
      "AvatarUrl": "https://secure.gravatar.com/avatar/411c3e8cd4782d4a996f292940a61069?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi mrangel.\r\n\r\nIt does not look like the 'W' word pattern script is going to work (see my previous post) as if I'm in other locations then I can't move west.\r\nWhat I need is if condition does not pass then fall back on the default script for moving the player west.\r\nThe only other way that might work is to use the 'Before entering room' script for the dark location but then I would need a way in the script to stop the player from moving to the dark room.",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi mrangel.</p>\n<p>It does not look like the 'W' word pattern script is going to work (see my previous post) as if I'm in other locations then I can't move west.<br>\nWhat I need is if condition does not pass then fall back on the default script for moving the player west.<br>\nThe only other way that might work is to use the 'Before entering room' script for the dark location but then I would need a way in the script to stop the player from moving to the dark room.</p>\n\n",
      "PostDate": "2020-03-06T03:05:31.8472869Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "14b0bd87-f2ae-41b0-acda-b4f95a4ec33e",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> It may have something to do with the code you gave me to run at the start of the game go that I can type W, WEST, GO WEST, GO CAVE\r\n\r\nThat shouldn't affect it.\r\nCan you share your game so I can take a look at it? It shouldn't be too hard to figure out what is causing this problem.\r\n\r\n> What I need is if condition does not pass then fall back on the default script for moving the player west.\r\n\r\nI believe I already showed how to do that in response to another question.\r\n\r\nHowever, this is still a weird way to do it. Don't make another command without a good reason. If you just want to block off a particular exit, make that exit run a script instead of moving the player. Something like:\r\n```\r\nif (Cave1.darklevel) {\r\n  msg (\"It is too dark to find the path.\")\r\n}\r\nelse {\r\n  MovePlayer (this.to)\r\n}\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>It may have something to do with the code you gave me to run at the start of the game go that I can type W, WEST, GO WEST, GO CAVE</p>\n</blockquote>\n<p>That shouldn't affect it.<br>\nCan you share your game so I can take a look at it? It shouldn't be too hard to figure out what is causing this problem.</p>\n<blockquote>\n<p>What I need is if condition does not pass then fall back on the default script for moving the player west.</p>\n</blockquote>\n<p>I believe I already showed how to do that in response to another question.</p>\n<p>However, this is still a weird way to do it. Don't make another command without a good reason. If you just want to block off a particular exit, make that exit run a script instead of moving the player. Something like:</p>\n<pre><code>if (Cave1.darklevel) {\n  msg (\"It is too dark to find the path.\")\n}\nelse {\n  MovePlayer (this.to)\n}\n</code></pre>\n\n",
      "PostDate": "2020-03-06T08:15:33.5498964Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5241805b-cdd3-4b9b-935f-5f6a15e4ed33",
      "UserId": 454326,
      "Username": "Brian5757",
      "AvatarUrl": "https://secure.gravatar.com/avatar/411c3e8cd4782d4a996f292940a61069?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi mrangel\r\n\r\nHow do I get my game to you?",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi mrangel</p>\n<p>How do I get my game to you?</p>\n\n",
      "PostDate": "2020-03-06T10:48:12.3374366Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
