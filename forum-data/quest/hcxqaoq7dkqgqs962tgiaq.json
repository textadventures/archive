{
  "Topic": {
    "TopicId": "hcxqaoq7dkqgqs962tgiaq",
    "ForumId": "10",
    "Title": "Need help with very simple turn-based combat",
    "LastUpdated": "2018-05-10T09:42:42.6531203Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "7885780d-d3e8-4387-958a-9e62b5656147",
      "UserId": 329008,
      "Username": "Banjo",
      "AvatarUrl": "https://secure.gravatar.com/avatar/d5c333b97093bc51f88066a6d36312ae?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "(edit)\r\n\r\nAs someone new to Quest, I've been happy at how I've figured out lots of things, but this one has stumped me. After much trial and error (and reading!) I've decided to bite the bullet and ask for help!\r\n\r\nI've searched the forums here and found lots of posts discussing making combat systems, but their all either end up relying on a library (which is fine, but I've not found one that does what I want), diverging into complex code discussions, or being unresolved.\r\n\r\nI'm looking do implement a very simple turn-based combat, the sort of thing found in gamebooks like the Lone Wolf series or Fighting Fantasy.\r\n\r\n**Basics:**\r\nThe player and enemies have a Skill and Endurance score. The former is their combat ability, the latter their \"hit points\". I can set all that up just fine.\r\n\r\n**Now, here's how I imagined the system working:**\r\n1) Player enters a room where an enemy has been placed (object with an \"ishostile\" boolean set to true)\r\n2) Combat initiates automatically (no need to type \"fight enemy\", etc.)\r\n3) The player is asked \"What do you want to do?\", and is presented with the choices \"Fight\", \"Special\", \"Escape\". This can be via an inline or popup menu (the latter is preferable).\r\n4) When the player chooses \"Fight\", a function runs that compares player skill + 1D10 random roll vs enemy skill + 1D10 random roll. If the player is lower, they lose 2 Endurance. If the enemy is lower, they lose 2 Endurance.\r\n5) If neither party is dead (Endurance 0 or less), combat loops to the next \"round\", and the player is asked to Fight/Special/Escape again. This continues until someone is dead or \"Escape\" is chosen.\r\n\r\n\"Special\" would use an item to instantly kill the enemy. \"Escape\" would end combat and move the player back to a specific room. That can wait for later to figure out, though.\r\n\r\nAt this point, I don't even need the enemy and player to alternate \"turns\"; for now, combat can just be one set of \"dice rolls\" to determine a \"winner\" and \"loser\" each \"round\".\r\n\r\nI'm also not worried so much at figuring out the mechanics for combat (endurance loss, dice rolls, escaping, etc.). I think I can manage that myself with some work.\r\n\r\nMaking the combat auto-trigger is presumably a matter of using something like \"foreach (object, ScopeReachableNotHeldForRoom (player.parent)) { if (HasAttribute(object, \"hostile\")) { if (object.hostile = true) { etc\" which I can get working with a turnscript.\r\n\r\n_**What I DO really need help with is how to do the basic \"Combat Starts->Select Fight->Do Combat->Repeat if nobody is dead\" script loop/function.**_\r\n\r\nI've tried using ShowMenu (or the popup equivalent) but keep getting stuck on either ShowMenu not parsing variables (so I had to turn them into global game.x ones, I suspect?) or not being able to make the menu \"pause\" to show the player messages relating to combat.\r\n\r\nI'm sure something basic like this is doable with a lot less headache than it's giving me, so I'd really appreciate if anyone can help me figure this out. If there's actually a \"turn based combat\" library, awesome! But I'm happy to learn, if only I can get the basic menu flow working.\r\n\r\nNote: below is my most recent attempt, but I still can't get it working (no feedback messages are shown, and I suspect game.fightoption isn't being changed no matter what the user clicks when asked).\r\n```\r\n\tgame.fightoption = 0\r\n\tmenulist = NewStringList()\r\n\tlist add (menulist, \"Fight\")\r\n\tlist add (menulist, \"Special\")\r\n\tlist add (menulist, \"Escape\")\r\n\tShowMenu (\"You are in combat.\", menulist, false) {\r\n\t  if (result = \"Fight\") {\r\n\t\tgame.fightoption = 1\r\n\t  }\r\n\t  if (result = \"Special\") {\r\n\t\tgame.fightoption = 2\r\n\t  }\r\n\t  if (result = \"Escape\") {\r\n\t\tgame.fightoption = 3\r\n\t  }\r\n\t}\r\n\tif(game.fightoption=1) {\r\n\t\tmsg (\"You fight the foe!\")\r\n\t}\r\n\telse if(game.fightoption=2) {\r\n\t\tmsg (\"You can't do that now.\")\r\n\t}\r\n\telse if(game.fightoption=3) {\r\n\t\tmsg (\"You can't escape this fight.\")\r\n\t}\r\n\telse if (game.fightoption=0) {\r\n\t\tmsg (\"Error! fightoption = \"+game.fightoption+\"!\")\r\n\t}\r\n```\r\nPlease disregard the above code if starting from scratch is better and less confusing!",
      "EditableFormat": "markdown",
      "HTML": "<p>(edit)</p>\n<p>As someone new to Quest, I've been happy at how I've figured out lots of things, but this one has stumped me. After much trial and error (and reading!) I've decided to bite the bullet and ask for help!</p>\n<p>I've searched the forums here and found lots of posts discussing making combat systems, but their all either end up relying on a library (which is fine, but I've not found one that does what I want), diverging into complex code discussions, or being unresolved.</p>\n<p>I'm looking do implement a very simple turn-based combat, the sort of thing found in gamebooks like the Lone Wolf series or Fighting Fantasy.</p>\n<p><strong>Basics:</strong><br>\nThe player and enemies have a Skill and Endurance score. The former is their combat ability, the latter their \"hit points\". I can set all that up just fine.</p>\n<p><strong>Now, here's how I imagined the system working:</strong></p>\n<ol>\n<li>Player enters a room where an enemy has been placed (object with an \"ishostile\" boolean set to true)</li>\n<li>Combat initiates automatically (no need to type \"fight enemy\", etc.)</li>\n<li>The player is asked \"What do you want to do?\", and is presented with the choices \"Fight\", \"Special\", \"Escape\". This can be via an inline or popup menu (the latter is preferable).</li>\n<li>When the player chooses \"Fight\", a function runs that compares player skill + 1D10 random roll vs enemy skill + 1D10 random roll. If the player is lower, they lose 2 Endurance. If the enemy is lower, they lose 2 Endurance.</li>\n<li>If neither party is dead (Endurance 0 or less), combat loops to the next \"round\", and the player is asked to Fight/Special/Escape again. This continues until someone is dead or \"Escape\" is chosen.</li>\n</ol>\n<p>\"Special\" would use an item to instantly kill the enemy. \"Escape\" would end combat and move the player back to a specific room. That can wait for later to figure out, though.</p>\n<p>At this point, I don't even need the enemy and player to alternate \"turns\"; for now, combat can just be one set of \"dice rolls\" to determine a \"winner\" and \"loser\" each \"round\".</p>\n<p>I'm also not worried so much at figuring out the mechanics for combat (endurance loss, dice rolls, escaping, etc.). I think I can manage that myself with some work.</p>\n<p>Making the combat auto-trigger is presumably a matter of using something like \"foreach (object, ScopeReachableNotHeldForRoom (player.parent)) { if (HasAttribute(object, \"hostile\")) { if (object.hostile = true) { etc\" which I can get working with a turnscript.</p>\n<p><em><strong>What I DO really need help with is how to do the basic \"Combat Starts-&gt;Select Fight-&gt;Do Combat-&gt;Repeat if nobody is dead\" script loop/function.</strong></em></p>\n<p>I've tried using ShowMenu (or the popup equivalent) but keep getting stuck on either ShowMenu not parsing variables (so I had to turn them into global game.x ones, I suspect?) or not being able to make the menu \"pause\" to show the player messages relating to combat.</p>\n<p>I'm sure something basic like this is doable with a lot less headache than it's giving me, so I'd really appreciate if anyone can help me figure this out. If there's actually a \"turn based combat\" library, awesome! But I'm happy to learn, if only I can get the basic menu flow working.</p>\n<p>Note: below is my most recent attempt, but I still can't get it working (no feedback messages are shown, and I suspect game.fightoption isn't being changed no matter what the user clicks when asked).</p>\n<pre><code>\tgame.fightoption = 0\n\tmenulist = NewStringList()\n\tlist add (menulist, \"Fight\")\n\tlist add (menulist, \"Special\")\n\tlist add (menulist, \"Escape\")\n\tShowMenu (\"You are in combat.\", menulist, false) {\n\t  if (result = \"Fight\") {\n\t\tgame.fightoption = 1\n\t  }\n\t  if (result = \"Special\") {\n\t\tgame.fightoption = 2\n\t  }\n\t  if (result = \"Escape\") {\n\t\tgame.fightoption = 3\n\t  }\n\t}\n\tif(game.fightoption=1) {\n\t\tmsg (\"You fight the foe!\")\n\t}\n\telse if(game.fightoption=2) {\n\t\tmsg (\"You can't do that now.\")\n\t}\n\telse if(game.fightoption=3) {\n\t\tmsg (\"You can't escape this fight.\")\n\t}\n\telse if (game.fightoption=0) {\n\t\tmsg (\"Error! fightoption = \"+game.fightoption+\"!\")\n\t}\n</code></pre>\n<p>Please disregard the above code if starting from scratch is better and less confusing!</p>\n\n",
      "PostDate": "2018-05-10T09:42:42.6531203Z",
      "LastEditDate": "2018-05-10T09:52:33.0088883Z",
      "link": null
    },
    {
      "PostId": "8a59f83f-7b01-4a6c-a0d8-5b88ab367487",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "your code is almost 100% correct (though you might want to remove the 'dot/period' in your \"You are in combat.\" ShowMenu's display prompt Parameter, as it might cause problems (probably don't need to remove it, but just in case, as the dot/period can be parsed/seen as a coding command/symbol, which would cause problems), and you can just use an 'else' for the fallback-catch last condition:\r\n\r\n```\r\n\tgame.fightoption = 0\r\n\r\n\tmenulist = NewStringList()\r\n\tlist add (menulist, \"Fight\")\r\n\tlist add (menulist, \"Special\")\r\n\tlist add (menulist, \"Escape\")\r\n\r\n\tShowMenu (\"You are in combat\", menulist, false) {\r\n\r\n\t  if (result = \"Fight\") {\r\n\t\tgame.fightoption = 1\r\n\t  }\r\n\t  else if (result = \"Special\") {\r\n\t\tgame.fightoption = 2\r\n\t  }\r\n\t  else if (result = \"Escape\") {\r\n\t\tgame.fightoption = 3\r\n\t  }\r\n\t}\r\n\r\n        // the 'on ready' is for hopefully being able to make the below wait, until you've selected your choice from the menu above, but it doesn't always work... but the explanation (someone explained it in some post) confused me at the time anyways of what/when it works and what/when it doesn't... so the 'on ready' might not do any good anyways...\r\n\r\n        on ready {\r\n\t  if (game.fightoption=1) {\r\n\t\tmsg (\"You fight the foe!\")\r\n\t  }\r\n\t  else if (game.fightoption=2) {\r\n\t\tmsg (\"You can't do that now.\")\r\n\t  }\r\n\t  else if(game.fightoption=3) {\r\n\t\tmsg (\"You can't escape this fight.\")\r\n\t  }\r\n\t  else {\r\n\t\tmsg (\"Error! fightoption = \"+game.fightoption)\r\n\t  }\r\n        }\r\n```\r\n\r\n-----------------\r\n\r\nas for 'looping', here's a simple example:\r\n\r\n(do NOT do this though, as this is an infinite loop, which will crash quest, infinite loops are bad, lol)\r\n\r\n```\r\n<game name=\"example_game\">\r\n  <attr name=\"start\" type=\"script\">\r\n    infinite_loop_function\r\n  </attr>\r\n</game>\r\n\r\n<function name=\"infinite_loop_function\">\r\n  msg (\"hi\")\r\n  infinite_loop_function\r\n</function>\r\n```\r\n\r\nthe 'game.start' fires and calls/does/uses the 'infinite_loop_function' Function\r\n\r\nthe 'infinite_loop_function' Function' displays 'hi', and then calls/does/uses the 'infinite_loop_function' Function (itself) again\r\n\r\nand thus you got an endless displayment of:\r\n\r\nhi\r\nhi\r\nhi\r\nhi\r\nhi\r\nhi\r\nhi\r\netc etc etc\r\n\r\nhowever, your computer's, and quest's use of its, resources (memory/space) are not infinite, and so quest crashes\r\n\r\n-----\r\n\r\nto not have an infinite loop, you need a way to stop/exit/end it from calling itself (looping)\r\n\r\nfor example:\r\n\r\n```\r\n<game name=\"example_game\">\r\n  <attr name=\"start\" type=\"script\">\r\n    escapable_loop_function\r\n  </attr>\r\n</game>\r\n\r\n<function name=\"escapable_loop_function\">\r\n  msg (\"hi\")\r\n  ask (\"loop?\") {\r\n    // the built-in 'ask/Ask' Functions/Scripts:\r\n    // choice: yes ---> result = true\r\n    // choice: no ---> result = false\r\n    if (result) { // if (TRUE)\r\n      escapable_loop_function\r\n    } else { // if (FALSE)\r\n      msg (\"BYE BYE!\")\r\n    }\r\n  }\r\n</function>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>your code is almost 100% correct (though you might want to remove the 'dot/period' in your \"You are in combat.\" ShowMenu's display prompt Parameter, as it might cause problems (probably don't need to remove it, but just in case, as the dot/period can be parsed/seen as a coding command/symbol, which would cause problems), and you can just use an 'else' for the fallback-catch last condition:</p>\n<pre><code>\tgame.fightoption = 0\n\n\tmenulist = NewStringList()\n\tlist add (menulist, \"Fight\")\n\tlist add (menulist, \"Special\")\n\tlist add (menulist, \"Escape\")\n\n\tShowMenu (\"You are in combat\", menulist, false) {\n\n\t  if (result = \"Fight\") {\n\t\tgame.fightoption = 1\n\t  }\n\t  else if (result = \"Special\") {\n\t\tgame.fightoption = 2\n\t  }\n\t  else if (result = \"Escape\") {\n\t\tgame.fightoption = 3\n\t  }\n\t}\n\n        // the 'on ready' is for hopefully being able to make the below wait, until you've selected your choice from the menu above, but it doesn't always work... but the explanation (someone explained it in some post) confused me at the time anyways of what/when it works and what/when it doesn't... so the 'on ready' might not do any good anyways...\n\n        on ready {\n\t  if (game.fightoption=1) {\n\t\tmsg (\"You fight the foe!\")\n\t  }\n\t  else if (game.fightoption=2) {\n\t\tmsg (\"You can't do that now.\")\n\t  }\n\t  else if(game.fightoption=3) {\n\t\tmsg (\"You can't escape this fight.\")\n\t  }\n\t  else {\n\t\tmsg (\"Error! fightoption = \"+game.fightoption)\n\t  }\n        }\n</code></pre>\n<hr>\n<p>as for 'looping', here's a simple example:</p>\n<p>(do NOT do this though, as this is an infinite loop, which will crash quest, infinite loops are bad, lol)</p>\n<pre><code>&lt;game name=\"example_game\"&gt;\n  &lt;attr name=\"start\" type=\"script\"&gt;\n    infinite_loop_function\n  &lt;/attr&gt;\n&lt;/game&gt;\n\n&lt;function name=\"infinite_loop_function\"&gt;\n  msg (\"hi\")\n  infinite_loop_function\n&lt;/function&gt;\n</code></pre>\n<p>the 'game.start' fires and calls/does/uses the 'infinite_loop_function' Function</p>\n<p>the 'infinite_loop_function' Function' displays 'hi', and then calls/does/uses the 'infinite_loop_function' Function (itself) again</p>\n<p>and thus you got an endless displayment of:</p>\n<p>hi<br>\nhi<br>\nhi<br>\nhi<br>\nhi<br>\nhi<br>\nhi<br>\netc etc etc</p>\n<p>however, your computer's, and quest's use of its, resources (memory/space) are not infinite, and so quest crashes</p>\n<hr>\n<p>to not have an infinite loop, you need a way to stop/exit/end it from calling itself (looping)</p>\n<p>for example:</p>\n<pre><code>&lt;game name=\"example_game\"&gt;\n  &lt;attr name=\"start\" type=\"script\"&gt;\n    escapable_loop_function\n  &lt;/attr&gt;\n&lt;/game&gt;\n\n&lt;function name=\"escapable_loop_function\"&gt;\n  msg (\"hi\")\n  ask (\"loop?\") {\n    // the built-in 'ask/Ask' Functions/Scripts:\n    // choice: yes ---&gt; result = true\n    // choice: no ---&gt; result = false\n    if (result) { // if (TRUE)\n      escapable_loop_function\n    } else { // if (FALSE)\n      msg (\"BYE BYE!\")\n    }\n  }\n&lt;/function&gt;\n</code></pre>\n\n",
      "PostDate": "2018-05-10T10:50:30.3683785Z",
      "LastEditDate": "2018-05-10T11:08:13.8951862Z",
      "link": null
    },
    {
      "PostId": "dbc9db03-0864-4e49-b32d-58820f04df60",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "for the combat auto-trigger:\r\n\r\nthe simpliest way would be to use the global 'onenterroom' Script:\r\n\r\n'game' Object -> WHATEVER TAB -> find the global 'onenterroom' Script (or it's called something like 'upon entering room, run a script' or something like that)\r\n\r\nand then, you're right, you'd use the 'foreach' and an Object List (which can be created/returned via the Scope Functions) to iterate through all of the Objects in the Room you're in, checking if they got your 'ishostile' Boolean Attribute, and if they do, then handle the combat for them... you can do the combat individually for each of them or you can have your combat handle all of them together, let us know which you prefer, and we can help with either design/method you want to do",
      "EditableFormat": "markdown",
      "HTML": "<p>for the combat auto-trigger:</p>\n<p>the simpliest way would be to use the global 'onenterroom' Script:</p>\n<p>'game' Object -&gt; WHATEVER TAB -&gt; find the global 'onenterroom' Script (or it's called something like 'upon entering room, run a script' or something like that)</p>\n<p>and then, you're right, you'd use the 'foreach' and an Object List (which can be created/returned via the Scope Functions) to iterate through all of the Objects in the Room you're in, checking if they got your 'ishostile' Boolean Attribute, and if they do, then handle the combat for them... you can do the combat individually for each of them or you can have your combat handle all of them together, let us know which you prefer, and we can help with either design/method you want to do</p>\n\n",
      "PostDate": "2018-05-10T10:59:42.3968725Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "3648838b-0563-40cc-9476-82923735e1ea",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "P.S.\r\n\r\nare you using the 'Game Book' or the 'Text Adventure' version of quest?",
      "EditableFormat": "markdown",
      "HTML": "<p>P.S.</p>\n<p>are you using the 'Game Book' or the 'Text Adventure' version of quest?</p>\n\n",
      "PostDate": "2018-05-10T11:09:02.2528702Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1c4a3f09-70b9-49f3-8816-d8658372e111",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "you might have already seen this combat code of mine and it confuses you, but if not, here it is:\r\n\r\nhttps://textadventures.co.uk/forum/quest/topic/3348/noobie-hks-help-me-thread#22485 (download pertex' file, as he cleaned up this old bad poor combat code of mine, so you can understand it better)\r\n\r\nand there's this too, but it's a bit more advanced (and you'd need to be able to understand/read code... or you can try to load it into quest's GUI/Editor and study it there, and/or play/run it... but it's old code of an earlier quest version, so it probably won't work for current version of quest):\r\n\r\nhttp://textadventures.co.uk/forum/samples/topic/4988/character-creation-crude-code-and-sample-game\r\n\r\nyou can look at it for some ideas/ways of doing (looping) menus (most of it is redundent functions --- my brain wasn't working at the time... as I can have a single/few functions handling all of it instead of the many redundent functions... lol)",
      "EditableFormat": "markdown",
      "HTML": "<p>you might have already seen this combat code of mine and it confuses you, but if not, here it is:</p>\n<p>https://textadventures.co.uk/forum/quest/topic/3348/noobie-hks-help-me-thread#22485 (download pertex' file, as he cleaned up this old bad poor combat code of mine, so you can understand it better)</p>\n<p>and there's this too, but it's a bit more advanced (and you'd need to be able to understand/read code... or you can try to load it into quest's GUI/Editor and study it there, and/or play/run it... but it's old code of an earlier quest version, so it probably won't work for current version of quest):</p>\n<p>http://textadventures.co.uk/forum/samples/topic/4988/character-creation-crude-code-and-sample-game</p>\n<p>you can look at it for some ideas/ways of doing (looping) menus (most of it is redundent functions --- my brain wasn't working at the time... as I can have a single/few functions handling all of it instead of the many redundent functions... lol)</p>\n\n",
      "PostDate": "2018-05-10T11:19:29.9945799Z",
      "LastEditDate": "2018-05-10T11:22:30.4705891Z",
      "link": null
    },
    {
      "PostId": "f0ec1e7c-2434-4cbc-907b-40668c33b25f",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "When using ShowMenu, you need to remember that all it does is *display* a menu, and make an internal note of what to do when to do when the player chooses an option.\r\n\r\n```\r\nShowMenu (\"This is displayed on the screen\", some_options, true) {\r\n  // Quest *makes a note of* this code, to run when\r\n  // the player has chosen an option\r\n}\r\n// This code is run immediately after displaying the menu\r\n```\r\n\r\nSo at the moment, you're trying to display \"You fight the foe\" or similar before the player has chosen an option.\r\n\r\nYou need to do something more like:\r\n```\r\nmenulist = NewStringList()\r\nlist add (menulist, \"Fight\")\r\nlist add (menulist, \"Special\")\r\nlist add (menulist, \"Escape\")\r\nShowMenu (\"You are in combat.\", menulist, false) {\r\n  if(result = \"Fight\") {\r\n    msg (\"You fight the foe!\")\r\n  }\r\n  else if(result = \"Special\") {\r\n    msg (\"You can't do that now.\")\r\n  }\r\n  else if(result = \"Escape\") {\r\n    msg (\"You can't escape this fight.\")\r\n  }\r\n  else {\r\n    msg (\"Error! result = \"+result+\"!\")\r\n  }\r\n  if ( some test to see if the enemy is still alive ) {\r\n    DoFight\r\n  }\r\n}\r\n```\r\n(assuming this code is in a function called `DoFight`; so it runs it again if the enemy isn't dead)",
      "EditableFormat": "markdown",
      "HTML": "<p>When using ShowMenu, you need to remember that all it does is <em>display</em> a menu, and make an internal note of what to do when to do when the player chooses an option.</p>\n<pre><code>ShowMenu (\"This is displayed on the screen\", some_options, true) {\n  // Quest *makes a note of* this code, to run when\n  // the player has chosen an option\n}\n// This code is run immediately after displaying the menu\n</code></pre>\n<p>So at the moment, you're trying to display \"You fight the foe\" or similar before the player has chosen an option.</p>\n<p>You need to do something more like:</p>\n<pre><code>menulist = NewStringList()\nlist add (menulist, \"Fight\")\nlist add (menulist, \"Special\")\nlist add (menulist, \"Escape\")\nShowMenu (\"You are in combat.\", menulist, false) {\n  if(result = \"Fight\") {\n    msg (\"You fight the foe!\")\n  }\n  else if(result = \"Special\") {\n    msg (\"You can't do that now.\")\n  }\n  else if(result = \"Escape\") {\n    msg (\"You can't escape this fight.\")\n  }\n  else {\n    msg (\"Error! result = \"+result+\"!\")\n  }\n  if ( some test to see if the enemy is still alive ) {\n    DoFight\n  }\n}\n</code></pre>\n<p>(assuming this code is in a function called <code>DoFight</code>; so it runs it again if the enemy isn't dead)</p>\n\n",
      "PostDate": "2018-05-10T16:20:25.1767815Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "92ea287c-8d28-48a5-97f2-a171455a6fe6",
      "UserId": 267336,
      "Username": "jmnevil54",
      "AvatarUrl": "https://secure.gravatar.com/avatar/5d73d7ec1dbe20a5cb46f02a6d53f187?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I'll try to contribute.\r\nI have game code myself. You could have just typed \"simple rpg combat\" in the search bar, like I did...\r\n\r\nMy code posted. https://textadventures.co.uk/forum/samples/topic/qzqe52enhuuacpdrljnffq/simple-turn-rpg-combat-for-the-web-quest#e27e61b1-4658-4a0f-bea4-2d01f7f325c0\r\nSecond thread as update. http://textadventures.co.uk/forum/samples/topic/vg6jtjrayesr4e5kqqytig/simple-combat-code-update-working-on-a-new-system#700b753e-07e5-40dc-9fff-6c7cfa19ab28\r\n\r\nThis is The Pixie's Zombie Apocalypse tutorial. It uses a turnscript instead of anything else, kind of like a real first person shooter! This may be what you want. https://github.com/ThePix/quest/wiki/The-Zombie-Apocalypse-(on-the-web-version)\r\n\r\nJust don't forget attributes if you're doing combat!\r\nI also have another game where the monsters spawn 100% the first time, then they spawn again after a counter ticks the right number. I couldn't figure out how to do it the traditional way, so I made one counter and one attribute. I realize I could have only did it with the counter, but it's old business now. Basically, the monsters would only spawn on one number only. Ask me if you are interested in it, and I'll post it up.\r\n\r\nAs for spawning enemies, I believe I created an entire lock system for my first game, which literally locks all rooms at once. My second game (titled Fing Game) uses a teleport system which teleports the player to another room, the battle room. (Post link for context. http://textadventures.co.uk/forum/quest/topic/tyotvy93i02ca5efbxpuyg/teleporting-a-player-and-a-zombie-stallin )",
      "EditableFormat": "markdown",
      "HTML": "<p>I'll try to contribute.<br>\nI have game code myself. You could have just typed \"simple rpg combat\" in the search bar, like I did...</p>\n<p>My code posted. https://textadventures.co.uk/forum/samples/topic/qzqe52enhuuacpdrljnffq/simple-turn-rpg-combat-for-the-web-quest#e27e61b1-4658-4a0f-bea4-2d01f7f325c0<br>\nSecond thread as update. http://textadventures.co.uk/forum/samples/topic/vg6jtjrayesr4e5kqqytig/simple-combat-code-update-working-on-a-new-system#700b753e-07e5-40dc-9fff-6c7cfa19ab28</p>\n<p>This is The Pixie's Zombie Apocalypse tutorial. It uses a turnscript instead of anything else, kind of like a real first person shooter! This may be what you want. https://github.com/ThePix/quest/wiki/The-Zombie-Apocalypse-(on-the-web-version)</p>\n<p>Just don't forget attributes if you're doing combat!<br>\nI also have another game where the monsters spawn 100% the first time, then they spawn again after a counter ticks the right number. I couldn't figure out how to do it the traditional way, so I made one counter and one attribute. I realize I could have only did it with the counter, but it's old business now. Basically, the monsters would only spawn on one number only. Ask me if you are interested in it, and I'll post it up.</p>\n<p>As for spawning enemies, I believe I created an entire lock system for my first game, which literally locks all rooms at once. My second game (titled Fing Game) uses a teleport system which teleports the player to another room, the battle room. (Post link for context. http://textadventures.co.uk/forum/quest/topic/tyotvy93i02ca5efbxpuyg/teleporting-a-player-and-a-zombie-stallin )</p>\n\n",
      "PostDate": "2018-05-11T11:47:35.9545738Z",
      "LastEditDate": "2018-05-11T12:01:20.5096946Z",
      "link": null
    },
    {
      "PostId": "6af80c40-27a7-4b99-9ab9-c8f13f2dc36e",
      "UserId": 329008,
      "Username": "Banjo",
      "AvatarUrl": "https://secure.gravatar.com/avatar/d5c333b97093bc51f88066a6d36312ae?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thanks to everyone who replied! I just hope my ramblings make sense; I'm not a programmer, so I worry I'm able to even convey what I'm attempting or wanting, much less do it correctly!\r\n\r\nhegemonkhan, thanks for all the detailed examples and suggestions; I've been impressed with your work on this forum from all the threads I read through before asking for help myself!\r\n\r\nmrangel, that's exactly where I hit my biggest stumbling block: putting the code for each menu choice inside the menu didn't work for me because variables have to all be global for that to work. Putting it afterwards... yup, ShowMenu doesn't pause for input! In the end, I went back to my original model, similar to your example, and converted all my variables needed into global ones for use during combat (i.e. each enemy has their own \"stats\" but these get translated to global game.xxx variables for use in combat). Not sure if that's the best way to do it, but it solves the variables-in-menus issue for me.\r\n\r\nFor now, I've held off going back to getting the \"auto-combat\" part working and just focused on the actual combat cycle for now. In my current build, combat begins when the player types \"fight xxx\" when an enemy is present. And it works! I can fight and kill or be killed, all in turn-based gamebook style combat (note: this is text adventure mode, not gamebook mode, though).\r\n\r\nI've got two problems still, however. While combat now works (yay!), I wanted to add a \"Special\" submenu for spells, special attacks, grenades, etc. Broadly speaking, this means the player can either Fight (normal combat), Special (special submenu) or Escape (this depends on if escape is allowed or not by the enemy). The first and last work, but the Special part is proving problematic for one main reason: I can't get menus to run inside another menu correctly! It's obvious what's happening: the menus both run together, rather than one \"pausing\" while the other interrupts.\r\n\r\nCombat should look like this:\r\nYou are in combat. Select action:\r\n1. Fight\r\n->If 1, player fights the enemy. Loser takes damage.\r\n2. Special\r\n->If 2, show submenu:\r\n---1. Grenade\r\n---2. Heal (not implemented)\r\n---3. Cancel\r\n---->These do special actions; grenades automatically hit enemy for 1d10 damage, cancel goes back to original combat menu.\r\n3. Escape\r\n-> Ends combat unless enemy is set to disallow this.\r\nCombat repeats if enemy and player are still alive.\r\n\r\nI'll post my code below and would appreciate pointers on how to fix it!\r\n\r\n**Enemies**\r\n```\r\n  <type name=\"combatenc\">\r\n\t<displayverbs type=\"listextend\">Fight</displayverbs>\r\n    <inventoryverbs type=\"listextend\">Fight</inventoryverbs>\r\n    <fight type=\"script\">\r\n\t\tDoFight(this,this.name,this.combatskill,this.endurance,this.wpnbonus,this.wpndamage,this.noescape)\r\n    </fight>\r\n    <autocombat type=\"boolean\">false</autocombat>\r\n    <combatskill type=\"int\">1</combatskill>\r\n    <endurance type=\"int\">1</endurance>\r\n    <wpnbonus type=\"int\">0</wpnbonus>\r\n    <wpndamage type=\"int\">1</wpndamage>\r\n    <noescape type=\"boolean\">true</noescape>\r\n  </type>\r\n```\r\n**Combat Functions**\r\n```\r\n<function name=\"DoFight\" parameters=\"enemy,enemyname,enemycombatskill,enemyendurance,enemywpnbonus,enemywpndamage,enemyescape\">\r\n    <![CDATA[\r\n    game.incombat = true\r\n\tgame.enemy = enemy\r\n    game.enemyname = enemyname\r\n    game.enemycombatskill = enemycombatskill\r\n    game.enemyendurance = enemyendurance\r\n    game.enemywpnbonus = enemywpnbonus\r\n    game.enemywpndamage = enemywpndamage\r\n    game.noescape = enemyescape\r\n\tUpdateEnemyStatus()\r\n\tClearScreen\r\n\tmenulist = NewStringList()\r\n\tlist add (menulist, \"Fight\")\r\n\tlist add (menulist, \"Special\")\r\n\tlist add (menulist, \"Escape\")\r\n\tShowMenu (\"You are in combat\", menulist, false) {\r\n\t  if(result = \"Fight\") {\r\n\t    msg (\"You fight the \"+game.enemyname+\"!\")\r\n\t\tRollCombat()\r\n\t\tCheckPlayer()\r\n\t\tCheckEnemy()\r\n\t  }\r\n\t  else if(result = \"Special\") {\r\n   \t\tDoSpecial()\r\n\t  }\r\n\t  else if(result = \"Escape\") {\r\n\t\tif(GetBoolean(game, \"noescape\")) {\r\n\t    \tmsg (\"You cannot escape from this combat.\")\r\n\t\t}\r\n\t\telse {\r\n\t    \tmsg (\"You escape from combat.\")\r\n\t    \tgame.incombat = false\r\n\t    }\r\n\t  }\r\n\t  wait {\r\n\t  \tif ((game.enemyendurance > 0) and (GetBoolean(game, \"incombat\"))) {\r\n\t    \tDoFight(game.enemy,game.enemyname,game.enemycombatskill,game.enemyendurance,game.enemywpnbonus,game.enemywpndamage,game.noescape)\r\n\t  \t}\r\n\t  \telse {\r\n\t\t  \tif (game.enemyendurance < 1) {\r\n\t\t\t\tRemoveObject (game.enemy)\t\t  \r\n\t\t  \t}\r\n\t  \t  \tClearEnemyStatus()\r\n\t  \t}\r\n\t  }\r\n\t}\r\n    ]]>\r\n  </function>\r\n```\r\n\r\n**Special Function**\r\n```\r\n  <function name=\"DoSpecial\">\r\n    <![CDATA[\r\n\tspmenulist = NewStringList()\r\n\tif(GetBoolean(game, \"allowgrenades\")) {\r\n\t\tlist add (spmenulist, \"Grenade\")\r\n\t}\r\n\tlist add (spmenulist, \"Heal\")\r\n\tlist add (spmenulist, \"Cancel\")\r\n\tShowMenu (\"What do you want to do?\", spmenulist, true) {\r\n\t  if(result = \"Grenade\") {\r\n\t\tUseGrenade()\r\n\t\tCheckEnemy()\r\n\t  }\r\n\t  else if(result = \"Heal\") {\r\n\t    msg (\"You can't do that now.\")\r\n\t  }\r\n\t  else if(result = \"Cancel\") {\r\n\t  }\r\n\t}\r\n    ]]>\r\n  </function>\r\n```\r\nThe \"wait\" command in DoFight is very possibly wrong and likely part of the problem, but that's the only way I could get combat to pause at all, so message feedback could be read before the next \"round\".\r\n\r\nRight now, it gives a nice \"Continue\" after normal Fight or Escape choices, but while it allows Special choice to work, it doesn't *really* work because there's still a \"Continue\" link underneath that can be clicked (skips submenu, as expected) and there's no user textbox to input the choice number; that is, while I can use the Grenade option by clicking on the hyperlink for it, I can't type \"1\" in that menu like I can for Fight (presumably, the \"menu shown while inside a menu\" is confusing things?).\r\n\r\nNote: Enemy stats aren't shown in messages in the code above because it's being displayed in a status pane that updates during combat.\r\n\r\nAs I said, my core combat now works great for what I wanted... it was when I tried to add the \"Special\" submenu (I've started with just one working choice: Grenade) that I ran into trouble again! :(\r\n\r\nP.S. jmnevil54, I never found your thread, though the Pokemon battle menu concept sounds a lot like what I want to do! Sadly, these forums seem to have a terrible search system; i.e. I'd searched for \"basic combat\" and \"turn-based\" already! :( I will definitely take a look at your game/code; it looks fun, too!\r\n\r\nThe zombie apocalypse example is awesome but much more of a \"live/active combat\" method compared to the static gamebook style I want. In fact, I've already been working on something like that for a different game, with combat running \"live\" via turnscripts, which I found surprisingly easier than the turn-based type due to not having to mess with menus and \"pausing\"!",
      "EditableFormat": "markdown",
      "HTML": "<p>Thanks to everyone who replied! I just hope my ramblings make sense; I'm not a programmer, so I worry I'm able to even convey what I'm attempting or wanting, much less do it correctly!</p>\n<p>hegemonkhan, thanks for all the detailed examples and suggestions; I've been impressed with your work on this forum from all the threads I read through before asking for help myself!</p>\n<p>mrangel, that's exactly where I hit my biggest stumbling block: putting the code for each menu choice inside the menu didn't work for me because variables have to all be global for that to work. Putting it afterwards... yup, ShowMenu doesn't pause for input! In the end, I went back to my original model, similar to your example, and converted all my variables needed into global ones for use during combat (i.e. each enemy has their own \"stats\" but these get translated to global game.xxx variables for use in combat). Not sure if that's the best way to do it, but it solves the variables-in-menus issue for me.</p>\n<p>For now, I've held off going back to getting the \"auto-combat\" part working and just focused on the actual combat cycle for now. In my current build, combat begins when the player types \"fight xxx\" when an enemy is present. And it works! I can fight and kill or be killed, all in turn-based gamebook style combat (note: this is text adventure mode, not gamebook mode, though).</p>\n<p>I've got two problems still, however. While combat now works (yay!), I wanted to add a \"Special\" submenu for spells, special attacks, grenades, etc. Broadly speaking, this means the player can either Fight (normal combat), Special (special submenu) or Escape (this depends on if escape is allowed or not by the enemy). The first and last work, but the Special part is proving problematic for one main reason: I can't get menus to run inside another menu correctly! It's obvious what's happening: the menus both run together, rather than one \"pausing\" while the other interrupts.</p>\n<p>Combat should look like this:<br>\nYou are in combat. Select action:</p>\n<ol>\n<li>Fight<br>\n-&gt;If 1, player fights the enemy. Loser takes damage.</li>\n<li>Special<br>\n-&gt;If 2, show submenu:<br>\n---1. Grenade<br>\n---2. Heal (not implemented)<br>\n---3. Cancel<br>\n----&gt;These do special actions; grenades automatically hit enemy for 1d10 damage, cancel goes back to original combat menu.</li>\n<li>Escape<br>\n-&gt; Ends combat unless enemy is set to disallow this.<br>\nCombat repeats if enemy and player are still alive.</li>\n</ol>\n<p>I'll post my code below and would appreciate pointers on how to fix it!</p>\n<p><strong>Enemies</strong></p>\n<pre><code>  &lt;type name=\"combatenc\"&gt;\n\t&lt;displayverbs type=\"listextend\"&gt;Fight&lt;/displayverbs&gt;\n    &lt;inventoryverbs type=\"listextend\"&gt;Fight&lt;/inventoryverbs&gt;\n    &lt;fight type=\"script\"&gt;\n\t\tDoFight(this,this.name,this.combatskill,this.endurance,this.wpnbonus,this.wpndamage,this.noescape)\n    &lt;/fight&gt;\n    &lt;autocombat type=\"boolean\"&gt;false&lt;/autocombat&gt;\n    &lt;combatskill type=\"int\"&gt;1&lt;/combatskill&gt;\n    &lt;endurance type=\"int\"&gt;1&lt;/endurance&gt;\n    &lt;wpnbonus type=\"int\"&gt;0&lt;/wpnbonus&gt;\n    &lt;wpndamage type=\"int\"&gt;1&lt;/wpndamage&gt;\n    &lt;noescape type=\"boolean\"&gt;true&lt;/noescape&gt;\n  &lt;/type&gt;\n</code></pre>\n<p><strong>Combat Functions</strong></p>\n<pre><code>&lt;function name=\"DoFight\" parameters=\"enemy,enemyname,enemycombatskill,enemyendurance,enemywpnbonus,enemywpndamage,enemyescape\"&gt;\n    &lt;![CDATA[\n    game.incombat = true\n\tgame.enemy = enemy\n    game.enemyname = enemyname\n    game.enemycombatskill = enemycombatskill\n    game.enemyendurance = enemyendurance\n    game.enemywpnbonus = enemywpnbonus\n    game.enemywpndamage = enemywpndamage\n    game.noescape = enemyescape\n\tUpdateEnemyStatus()\n\tClearScreen\n\tmenulist = NewStringList()\n\tlist add (menulist, \"Fight\")\n\tlist add (menulist, \"Special\")\n\tlist add (menulist, \"Escape\")\n\tShowMenu (\"You are in combat\", menulist, false) {\n\t  if(result = \"Fight\") {\n\t    msg (\"You fight the \"+game.enemyname+\"!\")\n\t\tRollCombat()\n\t\tCheckPlayer()\n\t\tCheckEnemy()\n\t  }\n\t  else if(result = \"Special\") {\n   \t\tDoSpecial()\n\t  }\n\t  else if(result = \"Escape\") {\n\t\tif(GetBoolean(game, \"noescape\")) {\n\t    \tmsg (\"You cannot escape from this combat.\")\n\t\t}\n\t\telse {\n\t    \tmsg (\"You escape from combat.\")\n\t    \tgame.incombat = false\n\t    }\n\t  }\n\t  wait {\n\t  \tif ((game.enemyendurance &gt; 0) and (GetBoolean(game, \"incombat\"))) {\n\t    \tDoFight(game.enemy,game.enemyname,game.enemycombatskill,game.enemyendurance,game.enemywpnbonus,game.enemywpndamage,game.noescape)\n\t  \t}\n\t  \telse {\n\t\t  \tif (game.enemyendurance &lt; 1) {\n\t\t\t\tRemoveObject (game.enemy)\t\t  \n\t\t  \t}\n\t  \t  \tClearEnemyStatus()\n\t  \t}\n\t  }\n\t}\n    ]]&gt;\n  &lt;/function&gt;\n</code></pre>\n<p><strong>Special Function</strong></p>\n<pre><code>  &lt;function name=\"DoSpecial\"&gt;\n    &lt;![CDATA[\n\tspmenulist = NewStringList()\n\tif(GetBoolean(game, \"allowgrenades\")) {\n\t\tlist add (spmenulist, \"Grenade\")\n\t}\n\tlist add (spmenulist, \"Heal\")\n\tlist add (spmenulist, \"Cancel\")\n\tShowMenu (\"What do you want to do?\", spmenulist, true) {\n\t  if(result = \"Grenade\") {\n\t\tUseGrenade()\n\t\tCheckEnemy()\n\t  }\n\t  else if(result = \"Heal\") {\n\t    msg (\"You can't do that now.\")\n\t  }\n\t  else if(result = \"Cancel\") {\n\t  }\n\t}\n    ]]&gt;\n  &lt;/function&gt;\n</code></pre>\n<p>The \"wait\" command in DoFight is very possibly wrong and likely part of the problem, but that's the only way I could get combat to pause at all, so message feedback could be read before the next \"round\".</p>\n<p>Right now, it gives a nice \"Continue\" after normal Fight or Escape choices, but while it allows Special choice to work, it doesn't <em>really</em> work because there's still a \"Continue\" link underneath that can be clicked (skips submenu, as expected) and there's no user textbox to input the choice number; that is, while I can use the Grenade option by clicking on the hyperlink for it, I can't type \"1\" in that menu like I can for Fight (presumably, the \"menu shown while inside a menu\" is confusing things?).</p>\n<p>Note: Enemy stats aren't shown in messages in the code above because it's being displayed in a status pane that updates during combat.</p>\n<p>As I said, my core combat now works great for what I wanted... it was when I tried to add the \"Special\" submenu (I've started with just one working choice: Grenade) that I ran into trouble again! :(</p>\n<p>P.S. jmnevil54, I never found your thread, though the Pokemon battle menu concept sounds a lot like what I want to do! Sadly, these forums seem to have a terrible search system; i.e. I'd searched for \"basic combat\" and \"turn-based\" already! :( I will definitely take a look at your game/code; it looks fun, too!</p>\n<p>The zombie apocalypse example is awesome but much more of a \"live/active combat\" method compared to the static gamebook style I want. In fact, I've already been working on something like that for a different game, with combat running \"live\" via turnscripts, which I found surprisingly easier than the turn-based type due to not having to mess with menus and \"pausing\"!</p>\n\n",
      "PostDate": "2018-05-11T16:06:36.7875159Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1a7df07e-18aa-40b4-9d7b-ba82f9fc6bc2",
      "UserId": 267336,
      "Username": "jmnevil54",
      "AvatarUrl": "https://secure.gravatar.com/avatar/5d73d7ec1dbe20a5cb46f02a6d53f187?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "\"basic combat\" and \"turn-based\"\r\n\r\nI guess that might be because my games or my threads don't have those words (maybe turn based, I don't know) in the m. I'll take a look.\r\n\r\nWhat do you have going on for that looping combat in the first place? You may need to turn that off! For the time being,  turn off the looping, and maybe then let the player decide when they attack?",
      "EditableFormat": "markdown",
      "HTML": "<p>\"basic combat\" and \"turn-based\"</p>\n<p>I guess that might be because my games or my threads don't have those words (maybe turn based, I don't know) in the m. I'll take a look.</p>\n<p>What do you have going on for that looping combat in the first place? You may need to turn that off! For the time being,  turn off the looping, and maybe then let the player decide when they attack?</p>\n\n",
      "PostDate": "2018-05-11T17:16:09.6893717Z",
      "LastEditDate": "2018-05-11T17:16:46.7363823Z",
      "link": null
    },
    {
      "PostId": "e2dd73d3-2ec1-437c-9ccc-6f2df11dadeb",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "**'mrangel, that's exactly where I hit my biggest stumbling block: putting the code for each menu choice inside the menu didn't work for me because variables have to all be global for that to work (Banjo)'**\r\n\r\nsorry about that... I have a hard time remembering/knowing whether 'Variable' VARIABLES (NAME_OF_VARIABLE or NAME_OF_VARIABLE = VALUE_OR_EXPRESSION) are able to be used inside of nested scripting stuff or not.\r\n\r\nSince it doesn't work, the reason is that the 'ShowMenu/show menu' Scripts/Functions is walled off from the outside scripting. \r\n\r\n'Attribute' VARIABLES (NAME_OF_OBJECT.NAME_OF_ATTRIBUTE or NAME_OF_OBJECT.NAME_OF_ATTRIBUTE = VALUE_OR_EXPRESSION) are able to bypass this 'walling off', and thus why they're 'global' VARIABLES, as you can use them anywhere\r\n\r\nyou can 'pass/transfer' through Parameters but the built-in 'show menu/ShowMenu' Scripts/Functions have 3 Parameters set already, and can't take anymore (which you could use to transfer your 'Variable' VARIABLE into it for use by it), unless you edit its Function.\r\n\r\nthis is why its a good idea to learn and just use 'Attribute' VARIABLES for now, until you understand more about basic coding/scripting and are thus better in understanding how to use 'Variables' VARIABLES with that basic knowledge in coding/scripting\r\n\r\n--------------\r\n\r\n**i.e. each enemy has their own \"stats\" but these get translated to global game.xxx variables for use in combat). Not sure if that's the best way to do it, but it solves the variables-in-menus issue for me (Banjo)**\r\n\r\nyou can just directly use your individual Objects' stats ('Attribute' VARIABLES) in your combat code, unless you're doing stuff in your combat code that would alter those stats' values and you don't want that to happen, if this is the case, then you actually already did it the correct way, by assigning those stats into your combat scripting's 'Variable' VARIABLES, as this way, you're not altering your stats' values.\r\n\r\n--------\r\n\r\nas for your issues:\r\n\r\nyour code is actually perfect (for the most part / as far as I can see)\r\n\r\nthe issue you're having is dealing with the 'order of operations' with your code design and how the quest code stuff works\r\n\r\nyou can try sticking in the 'on ready' Script/Function where-ever it might be needed to hopefully work and wait for the prior code/scripting to finish, but it doesn't always work (it depends on some complicated stuff that I had trouble understanding, lol):\r\n\r\nhttp://docs.textadventures.co.uk/quest/scripts/on_ready.html\r\n\r\notherwise, a trick is to use a Boolean VARIABLE with an 'if' Script, but this only half solves the problem... as if the scripting is still progressing to get to this point, it'll pass by this point (thanks to the 'if Boolean VARIABLE' we put in, but then you're past where you want to be... it gets a bit complicated... we'd need to handle it based upon the code you got, or come up with some better code and handle it with it.\r\n\r\n----------\r\n\r\nwhile you're new to coding...\r\n\r\nit's best to try to keep your scripting in its simplest form, which is:\r\n\r\ndo stuff 1\r\n-> do stuff 2\r\n->-> do stuff 3\r\n->->-> do stuff 4\r\n->->->-> do stuff 5\r\netc etc etc\r\n\r\nthis is a \"straight\" line of (and via nested) operations:\r\n\r\ndo stuff 1 -> do stuff 2 -> do stuff 3 -> do stuff 4 -> do stuff 5 -> (etc etc etc)\r\n\r\n-----\r\n\r\nas for an example, look at how the 'order of operations' work with this:\r\n\r\n```\r\ndo stuff 1\r\n|\r\n|-> do stuff 2\r\n|\r\ndo stuff 3\r\n|\r\ndo stuff 4\r\n```\r\n\r\nboth 'do stuff 2' and 'do stuff 3' are firing at (technical: nearly, unless they're using separate 'threads'/CPUs and thus are able to be simultaneus) the same time, and on top of that, the 'do stuff 3' can finish before the 'do stuff 2' finishes, and thus the 'do stuff 4' is firing while the 'do stuff 2' still hasn;t finished",
      "EditableFormat": "markdown",
      "HTML": "<p><strong>'mrangel, that's exactly where I hit my biggest stumbling block: putting the code for each menu choice inside the menu didn't work for me because variables have to all be global for that to work (Banjo)'</strong></p>\n<p>sorry about that... I have a hard time remembering/knowing whether 'Variable' VARIABLES (NAME_OF_VARIABLE or NAME_OF_VARIABLE = VALUE_OR_EXPRESSION) are able to be used inside of nested scripting stuff or not.</p>\n<p>Since it doesn't work, the reason is that the 'ShowMenu/show menu' Scripts/Functions is walled off from the outside scripting.</p>\n<p>'Attribute' VARIABLES (NAME_OF_OBJECT.NAME_OF_ATTRIBUTE or NAME_OF_OBJECT.NAME_OF_ATTRIBUTE = VALUE_OR_EXPRESSION) are able to bypass this 'walling off', and thus why they're 'global' VARIABLES, as you can use them anywhere</p>\n<p>you can 'pass/transfer' through Parameters but the built-in 'show menu/ShowMenu' Scripts/Functions have 3 Parameters set already, and can't take anymore (which you could use to transfer your 'Variable' VARIABLE into it for use by it), unless you edit its Function.</p>\n<p>this is why its a good idea to learn and just use 'Attribute' VARIABLES for now, until you understand more about basic coding/scripting and are thus better in understanding how to use 'Variables' VARIABLES with that basic knowledge in coding/scripting</p>\n<hr>\n<p><strong>i.e. each enemy has their own \"stats\" but these get translated to global game.xxx variables for use in combat). Not sure if that's the best way to do it, but it solves the variables-in-menus issue for me (Banjo)</strong></p>\n<p>you can just directly use your individual Objects' stats ('Attribute' VARIABLES) in your combat code, unless you're doing stuff in your combat code that would alter those stats' values and you don't want that to happen, if this is the case, then you actually already did it the correct way, by assigning those stats into your combat scripting's 'Variable' VARIABLES, as this way, you're not altering your stats' values.</p>\n<hr>\n<p>as for your issues:</p>\n<p>your code is actually perfect (for the most part / as far as I can see)</p>\n<p>the issue you're having is dealing with the 'order of operations' with your code design and how the quest code stuff works</p>\n<p>you can try sticking in the 'on ready' Script/Function where-ever it might be needed to hopefully work and wait for the prior code/scripting to finish, but it doesn't always work (it depends on some complicated stuff that I had trouble understanding, lol):</p>\n<p>http://docs.textadventures.co.uk/quest/scripts/on_ready.html</p>\n<p>otherwise, a trick is to use a Boolean VARIABLE with an 'if' Script, but this only half solves the problem... as if the scripting is still progressing to get to this point, it'll pass by this point (thanks to the 'if Boolean VARIABLE' we put in, but then you're past where you want to be... it gets a bit complicated... we'd need to handle it based upon the code you got, or come up with some better code and handle it with it.</p>\n<hr>\n<p>while you're new to coding...</p>\n<p>it's best to try to keep your scripting in its simplest form, which is:</p>\n<p>do stuff 1<br>\n-&gt; do stuff 2<br>\n-&gt;-&gt; do stuff 3<br>\n-&gt;-&gt;-&gt; do stuff 4<br>\n-&gt;-&gt;-&gt;-&gt; do stuff 5<br>\netc etc etc</p>\n<p>this is a \"straight\" line of (and via nested) operations:</p>\n<p>do stuff 1 -&gt; do stuff 2 -&gt; do stuff 3 -&gt; do stuff 4 -&gt; do stuff 5 -&gt; (etc etc etc)</p>\n<hr>\n<p>as for an example, look at how the 'order of operations' work with this:</p>\n<pre><code>do stuff 1\n|\n|-&gt; do stuff 2\n|\ndo stuff 3\n|\ndo stuff 4\n</code></pre>\n<p>both 'do stuff 2' and 'do stuff 3' are firing at (technical: nearly, unless they're using separate 'threads'/CPUs and thus are able to be simultaneus) the same time, and on top of that, the 'do stuff 3' can finish before the 'do stuff 2' finishes, and thus the 'do stuff 4' is firing while the 'do stuff 2' still hasn;t finished</p>\n\n",
      "PostDate": "2018-05-11T18:17:39.3931009Z",
      "LastEditDate": "2018-05-11T18:57:17.3532652Z",
      "link": null
    },
    {
      "PostId": "aec367a5-d6b1-4ced-8109-23fb4cb29c39",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "try this (I just added in the 'on ready' before your 'wait') simple attempt-fix (lol):\r\n\r\n(otherwise, we'll have to re-design all/some of your various combat codings, so the order of operations works as wanted/needed)\r\n\r\n```\r\n<function name=\"DoFight\" parameters=\"enemy,enemyname,enemycombatskill,enemyendurance,enemywpnbonus,enemywpndamage,enemyescape\">\r\n\r\n  <![CDATA[\r\n\r\n    game.incombat = true\r\n\r\n    game.enemy = enemy\r\n\r\n    game.enemyname = enemyname\r\n\r\n    game.enemycombatskill = enemycombatskill\r\n\r\n    game.enemyendurance = enemyendurance\r\n\r\n    game.enemywpnbonus = enemywpnbonus\r\n\r\n    game.enemywpndamage = enemywpndamage\r\n\r\n    game.noescape = enemyescape\r\n    \r\n    UpdateEnemyStatus()\r\n\r\n    ClearScreen\r\n    \r\n    menulist = NewStringList()\r\n    list add (menulist, \"Fight\")\r\n    list add (menulist, \"Special\")\r\n    list add (menulist, \"Escape\")\r\n\r\n    ShowMenu (\"You are in combat\", menulist, false) {\r\n\r\n      if (result = \"Fight\") {\r\n\r\n        msg (\"You fight the \"+game.enemyname+\"!\")\r\n\r\n        RollCombat()\r\n\r\n        CheckPlayer()\r\n        CheckEnemy()\r\n\r\n      } else if (result = \"Special\") {\r\n\r\n        DoSpecial()\r\n\r\n      } else if (result = \"Escape\") {\r\n\r\n        if (GetBoolean(game, \"noescape\")) {\r\n\r\n\t  msg (\"You cannot escape from this combat.\")\r\n\r\n\t} else {\r\n\r\n\t  msg (\"You escape from combat.\")\r\n\r\n\t  game.incombat = false\r\n\r\n\t} // end of 'else'\r\n\r\n      } // end of 'else if'\r\n\r\n      on ready { // this was your 'wait { /* scripting */ }'\r\n\r\n        wait { // new 'wait' here instead, to keep this functionality for you\r\n\r\n          if (game.enemyendurance > 0 and GetBoolean (game, \"incombat\")) {\r\n\r\n            DoFight (game.enemy,game.enemyname,game.enemycombatskill,game.enemyendurance,game.enemywpnbonus,game.enemywpndamage,game.noescape)\r\n\r\n\t  } else {\r\n\r\n            if (game.enemyendurance < 1) {\r\n\r\n\t      RemoveObject (game.enemy)\t\t  \r\n\r\n\t    } // end of 'if'\r\n\r\n\t    ClearEnemyStatus()\r\n\r\n\t  } // end of 'else'\r\n\r\n        } // end of 'wait'\r\n\r\n      } // end of 'on ready'\r\n\r\n    } // end of 'ShowMenu'\r\n\r\n  ]]>\r\n\r\n</function>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>try this (I just added in the 'on ready' before your 'wait') simple attempt-fix (lol):</p>\n<p>(otherwise, we'll have to re-design all/some of your various combat codings, so the order of operations works as wanted/needed)</p>\n<pre><code>&lt;function name=\"DoFight\" parameters=\"enemy,enemyname,enemycombatskill,enemyendurance,enemywpnbonus,enemywpndamage,enemyescape\"&gt;\n\n  &lt;![CDATA[\n\n    game.incombat = true\n\n    game.enemy = enemy\n\n    game.enemyname = enemyname\n\n    game.enemycombatskill = enemycombatskill\n\n    game.enemyendurance = enemyendurance\n\n    game.enemywpnbonus = enemywpnbonus\n\n    game.enemywpndamage = enemywpndamage\n\n    game.noescape = enemyescape\n    \n    UpdateEnemyStatus()\n\n    ClearScreen\n    \n    menulist = NewStringList()\n    list add (menulist, \"Fight\")\n    list add (menulist, \"Special\")\n    list add (menulist, \"Escape\")\n\n    ShowMenu (\"You are in combat\", menulist, false) {\n\n      if (result = \"Fight\") {\n\n        msg (\"You fight the \"+game.enemyname+\"!\")\n\n        RollCombat()\n\n        CheckPlayer()\n        CheckEnemy()\n\n      } else if (result = \"Special\") {\n\n        DoSpecial()\n\n      } else if (result = \"Escape\") {\n\n        if (GetBoolean(game, \"noescape\")) {\n\n\t  msg (\"You cannot escape from this combat.\")\n\n\t} else {\n\n\t  msg (\"You escape from combat.\")\n\n\t  game.incombat = false\n\n\t} // end of 'else'\n\n      } // end of 'else if'\n\n      on ready { // this was your 'wait { /* scripting */ }'\n\n        wait { // new 'wait' here instead, to keep this functionality for you\n\n          if (game.enemyendurance &gt; 0 and GetBoolean (game, \"incombat\")) {\n\n            DoFight (game.enemy,game.enemyname,game.enemycombatskill,game.enemyendurance,game.enemywpnbonus,game.enemywpndamage,game.noescape)\n\n\t  } else {\n\n            if (game.enemyendurance &lt; 1) {\n\n\t      RemoveObject (game.enemy)\t\t  \n\n\t    } // end of 'if'\n\n\t    ClearEnemyStatus()\n\n\t  } // end of 'else'\n\n        } // end of 'wait'\n\n      } // end of 'on ready'\n\n    } // end of 'ShowMenu'\n\n  ]]&gt;\n\n&lt;/function&gt;\n</code></pre>\n\n",
      "PostDate": "2018-05-11T18:35:52.9218426Z",
      "LastEditDate": "2018-05-11T18:54:36.9912984Z",
      "link": null
    },
    {
      "PostId": "34a7d39a-fec2-4675-b961-3d80078a8e08",
      "UserId": 329008,
      "Username": "Banjo",
      "AvatarUrl": "https://secure.gravatar.com/avatar/d5c333b97093bc51f88066a6d36312ae?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Wow, thanks hegemonkhan... but sadly, that didn't seem to make a difference. I was hoping I could use on ready elsewhere maybe but reading up about it, it seems to not work with ShowMenu (I'm actually kinda wondering if using the popup \"show menu\" script might work, from reading that link... I think it might look better too).\r\n\r\nThe obvious solution is just to put all the commands that would be in Special in the main combat menu (conditionally, if the player has those items/skills) but that feels like admitting defeat. Quest must be able to do nested menus (sub-menus) somehow!\r\n\r\njmnevil54: that's what I've done; I've not bothered getting the auto-triggering of combat working and in my test build, I have to click (or type) \"fight\" for my test enemy to begin combat. I can already get combat to auto-start if I want it to, but I had issues with multiple combatants (again, the solution is not to have these, as they're not needed for gamebook style combat really, but I wanted to see if I could make it work with two or more enemies eventually).\r\n\r\nRight now, though, I just want to get this issue with menus nailed down... as I said, my programming experience isn't much (done a lot of modding with various languages over the years, but never formally learned coding) but this is my first time hitting something where it's clearly the order things are being done that's screwing me up; I suspect because it's rather counter-intuitive for ShowMenu *not* to pause as one might expect before continuing (judging from the many similar comments I've read here looking for an answer) and the need to work around this.",
      "EditableFormat": "markdown",
      "HTML": "<p>Wow, thanks hegemonkhan... but sadly, that didn't seem to make a difference. I was hoping I could use on ready elsewhere maybe but reading up about it, it seems to not work with ShowMenu (I'm actually kinda wondering if using the popup \"show menu\" script might work, from reading that link... I think it might look better too).</p>\n<p>The obvious solution is just to put all the commands that would be in Special in the main combat menu (conditionally, if the player has those items/skills) but that feels like admitting defeat. Quest must be able to do nested menus (sub-menus) somehow!</p>\n<p>jmnevil54: that's what I've done; I've not bothered getting the auto-triggering of combat working and in my test build, I have to click (or type) \"fight\" for my test enemy to begin combat. I can already get combat to auto-start if I want it to, but I had issues with multiple combatants (again, the solution is not to have these, as they're not needed for gamebook style combat really, but I wanted to see if I could make it work with two or more enemies eventually).</p>\n<p>Right now, though, I just want to get this issue with menus nailed down... as I said, my programming experience isn't much (done a lot of modding with various languages over the years, but never formally learned coding) but this is my first time hitting something where it's clearly the order things are being done that's screwing me up; I suspect because it's rather counter-intuitive for ShowMenu <em>not</em> to pause as one might expect before continuing (judging from the many similar comments I've read here looking for an answer) and the need to work around this.</p>\n\n",
      "PostDate": "2018-05-11T19:44:33.1802853Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a081e4d3-d9f8-45b2-aef3-655fb006598b",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I think this is how it works:\r\n\r\n```\r\nShowMenu(\"CHOOSE!\", Split(\"choice one;choice two\", \";\"), true){\r\n  // Everything here happens AFTER making this choice\r\n  // You cannot use local variables from outside of this ShowMenu here!\r\n  // You can only use object attributes (which are basically global variables)\r\n}\r\n// Anything here will happen without waiting for ShowMenu!\r\n// on ready does not wait for ShowMenu!\r\n```\r\n\r\n\r\n---\r\n```\r\nshow menu (\"CHOOSE!\", Split(\"choice one;choice two\", \";\"), true){\r\n  // Everything here happens AFTER making this choice\r\n  // You cannot use local variables from outside of this show menu here!\r\n  // You can only use object attributes (which are basically global variables)\r\n}\r\non ready {\r\n  // This will not run until AFTER show menu\r\n}\r\n// Anything here will happen without waiting for show menu!\r\n\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>I think this is how it works:</p>\n<pre><code>ShowMenu(\"CHOOSE!\", Split(\"choice one;choice two\", \";\"), true){\n  // Everything here happens AFTER making this choice\n  // You cannot use local variables from outside of this ShowMenu here!\n  // You can only use object attributes (which are basically global variables)\n}\n// Anything here will happen without waiting for ShowMenu!\n// on ready does not wait for ShowMenu!\n</code></pre>\n<hr>\n<pre><code>show menu (\"CHOOSE!\", Split(\"choice one;choice two\", \";\"), true){\n  // Everything here happens AFTER making this choice\n  // You cannot use local variables from outside of this show menu here!\n  // You can only use object attributes (which are basically global variables)\n}\non ready {\n  // This will not run until AFTER show menu\n}\n// Anything here will happen without waiting for show menu!\n\n</code></pre>\n\n",
      "PostDate": "2018-05-11T19:49:51.8890424Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5189023e-3398-4e9c-a5e8-2a8a41401f42",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "```show menu``` is a Quest script, which means it's in the C# code (which we can't edit without building Quest from the source code).\r\n\r\n```on ready``` is also a Quest script, which waits for other **Quest scripts** to finish before running whatever is in its block of code.  Note that ```on ready``` does not wait for Quest functions, as it does not even know they exist.  It only knows about Quest scripts, because they live in Script Town, too.\r\n\r\n---\r\n```ShowMenu``` is a Quest function.  It has a callback, which is the script you add when coding.  ```ShowMenu``` doesn't know about anything else going on in the game except that it has a list of choices, and it will try to match the next command to those choices.  If there is a match, it pass the choice to the script via the ```result``` parameter, then it runs the script.\r\n\r\n---\r\n```on ready``` doesn't work together with ```ShowMenu```, because one is a script and the other is a function.  They work differently and separately.\r\n\r\n```on ready``` works with ```ask``` but not ```Ask``` for this same reason.\r\n\r\nI think it also works with ```get input```.\r\n\r\n---\r\nhttp://docs.textadventures.co.uk/quest/scripts/on_ready.html\r\n\r\nhttp://docs.textadventures.co.uk/quest/blocks_and_scripts.html",
      "EditableFormat": "markdown",
      "HTML": "<p><code>show menu</code> is a Quest script, which means it's in the C# code (which we can't edit without building Quest from the source code).</p>\n<p><code>on ready</code> is also a Quest script, which waits for other <strong>Quest scripts</strong> to finish before running whatever is in its block of code.  Note that <code>on ready</code> does not wait for Quest functions, as it does not even know they exist.  It only knows about Quest scripts, because they live in Script Town, too.</p>\n<hr>\n<p><code>ShowMenu</code> is a Quest function.  It has a callback, which is the script you add when coding.  <code>ShowMenu</code> doesn't know about anything else going on in the game except that it has a list of choices, and it will try to match the next command to those choices.  If there is a match, it pass the choice to the script via the <code>result</code> parameter, then it runs the script.</p>\n<hr>\n<p><code>on ready</code> doesn't work together with <code>ShowMenu</code>, because one is a script and the other is a function.  They work differently and separately.</p>\n<p><code>on ready</code> works with <code>ask</code> but not <code>Ask</code> for this same reason.</p>\n<p>I think it also works with <code>get input</code>.</p>\n<hr>\n<p>http://docs.textadventures.co.uk/quest/scripts/on_ready.html</p>\n<p>http://docs.textadventures.co.uk/quest/blocks_and_scripts.html</p>\n\n",
      "PostDate": "2018-05-11T19:59:15.699684Z",
      "LastEditDate": "2018-05-11T19:59:42.3843812Z",
      "link": null
    },
    {
      "PostId": "44d260fc-7f72-4538-8c33-ffcf976dca6f",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Looks like your code is pretty well structured.\r\n\r\nI think that putting the `wait` block at the end is problematic, because you don't ant that bit to happen if you chose 'Special'. You only want it to appear if you want the player to choose from those three options.\r\n\r\nIf I was you, I'd make a function which does the following:\r\n\r\n* If (monster is dead) {\r\n  * remove the monster object\r\n* }\r\nelse if (player is dead) {\r\n  * show messages, game over, etc\r\n* }\r\nelse {\r\n  * call DoFight again\r\n* }\r\n\r\nThat's a logical group of things to do together as a function, as you'll want them to be done after each round whether you fought, healed, used a grenade, or something else.\r\n\r\nThen you call that function:\r\n1. After fighting (within the `if (result=\"Fight\")` block)\r\n2. After failing to escape\r\n3. In the `DoSpecial` function, after resolving the player's action.\r\n\r\nThat way, if you choose \"Special\", the fight menu isn't shown again until after you've chosen what you're doing for that round.\r\n\r\n**Additional advice:** You could also make DoFight have fewer parameters. Make your 'fight' verb for the enemy look like:\r\n```\r\n<fight type=\"script\">\r\n  game.enemy = this\r\n  DoFight()\r\n</fight>\r\n```\r\n\r\nWithin the DoFight, DoSpecial, and CheckEnemy functions, you can use `game.enemy.combatskill`, or `game.enemy.name`, or whatever. You don't need to create copies of all those variables every time you call the function.\r\n\r\n\r\n**Alternatively:** I can see another way I'd arrange the code. But not sure if I'd recommend it or not.\r\nI'll post in a moment in case you're interested.",
      "EditableFormat": "markdown",
      "HTML": "<p>Looks like your code is pretty well structured.</p>\n<p>I think that putting the <code>wait</code> block at the end is problematic, because you don't ant that bit to happen if you chose 'Special'. You only want it to appear if you want the player to choose from those three options.</p>\n<p>If I was you, I'd make a function which does the following:</p>\n<ul>\n<li>If (monster is dead) {\n<ul>\n<li>remove the monster object</li>\n</ul>\n</li>\n<li>}<br>\nelse if (player is dead) {\n<ul>\n<li>show messages, game over, etc</li>\n</ul>\n</li>\n<li>}<br>\nelse {\n<ul>\n<li>call DoFight again</li>\n</ul>\n</li>\n<li>}</li>\n</ul>\n<p>That's a logical group of things to do together as a function, as you'll want them to be done after each round whether you fought, healed, used a grenade, or something else.</p>\n<p>Then you call that function:</p>\n<ol>\n<li>After fighting (within the <code>if (result=\"Fight\")</code> block)</li>\n<li>After failing to escape</li>\n<li>In the <code>DoSpecial</code> function, after resolving the player's action.</li>\n</ol>\n<p>That way, if you choose \"Special\", the fight menu isn't shown again until after you've chosen what you're doing for that round.</p>\n<p><strong>Additional advice:</strong> You could also make DoFight have fewer parameters. Make your 'fight' verb for the enemy look like:</p>\n<pre><code>&lt;fight type=\"script\"&gt;\n  game.enemy = this\n  DoFight()\n&lt;/fight&gt;\n</code></pre>\n<p>Within the DoFight, DoSpecial, and CheckEnemy functions, you can use <code>game.enemy.combatskill</code>, or <code>game.enemy.name</code>, or whatever. You don't need to create copies of all those variables every time you call the function.</p>\n<p><strong>Alternatively:</strong> I can see another way I'd arrange the code. But not sure if I'd recommend it or not.<br>\nI'll post in a moment in case you're interested.</p>\n\n",
      "PostDate": "2018-05-11T20:03:01.5261234Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "405ba818-b8da-402f-9c51-35d87efa1d64",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "\r\n@KV\r\nIf you want something that looks like `on ready` but waits for ShowMenu/Ask…\r\n\r\nEdit: Made it work with `Ask` too; and fixed a weird edge case where a script called by OnReady calls it again and also calls Ask.\r\n```\r\n<function name=\"OnReady\" parameters=\"callback\">\r\n  obj = GetObject(\"__waitformenu_turnscript\")\r\n  if (obj = null) {\r\n    if (not HasScript (game, \"menucallback\") and not HasScript (game, \"askcallback\")) {\r\n      invoke (callback)\r\n      return ()\r\n    }\r\n    create turnscript (\"__waitformenu_turnscript\")\r\n    obj = GetObject(\"__waitformenu_turnscript\")\r\n    obj.callbacks = NewList()\r\n    obj.script => {\r\n      scriptlist = this.callbacks\r\n      while ((ListCount(scriptlist) > 0) and not HasScript (game, \"menucallback\") and not HasScript (game, \"askcallback\")) {\r\n        callback = ListItem (scriptlist, 0)\r\n        list remove (scriptlist, callback)\r\n        invoke (callback)\r\n      }\r\n      if (ListCount (scriptlist) = 0) {\r\n        this.enabled = false\r\n      }\r\n    }\r\n  }\r\n  list add (obj.callbacks, callback)\r\n  obj.enabled = true\r\n</function>\r\n```\r\n(multiple calls to OnReady will queue up the callbacks passed to them. If one of the callbacks creates a menu, subsequent ones will be put on hold)",
      "EditableFormat": "markdown",
      "HTML": "<p>@KV<br>\nIf you want something that looks like <code>on ready</code> but waits for ShowMenu/Ask…</p>\n<p>Edit: Made it work with <code>Ask</code> too; and fixed a weird edge case where a script called by OnReady calls it again and also calls Ask.</p>\n<pre><code>&lt;function name=\"OnReady\" parameters=\"callback\"&gt;\n  obj = GetObject(\"__waitformenu_turnscript\")\n  if (obj = null) {\n    if (not HasScript (game, \"menucallback\") and not HasScript (game, \"askcallback\")) {\n      invoke (callback)\n      return ()\n    }\n    create turnscript (\"__waitformenu_turnscript\")\n    obj = GetObject(\"__waitformenu_turnscript\")\n    obj.callbacks = NewList()\n    obj.script =&gt; {\n      scriptlist = this.callbacks\n      while ((ListCount(scriptlist) &gt; 0) and not HasScript (game, \"menucallback\") and not HasScript (game, \"askcallback\")) {\n        callback = ListItem (scriptlist, 0)\n        list remove (scriptlist, callback)\n        invoke (callback)\n      }\n      if (ListCount (scriptlist) = 0) {\n        this.enabled = false\n      }\n    }\n  }\n  list add (obj.callbacks, callback)\n  obj.enabled = true\n&lt;/function&gt;\n</code></pre>\n<p>(multiple calls to OnReady will queue up the callbacks passed to them. If one of the callbacks creates a menu, subsequent ones will be put on hold)</p>\n\n",
      "PostDate": "2018-05-11T20:22:15.5435046Z",
      "LastEditDate": "2018-05-11T22:05:51.2903349Z",
      "link": null
    },
    {
      "PostId": "a7eb9421-fa58-4be5-bffd-2779ffbac63a",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Edit: silly error\r\n\r\nHere's how I'd do it.\r\nThis is probably not the best way, but I like having stuff in one place.\r\n\r\n```\r\n  <type name=\"combatenc\">\r\n    <displayverbs type=\"listextend\">Fight</displayverbs>\r\n    <inventoryverbs type=\"listextend\">Fight</inventoryverbs>\r\n    <fight type=\"script\">\r\n      DoFight(this)\r\n    </fight>\r\n    <autocombat type=\"boolean\">false</autocombat>\r\n    <combatskill type=\"int\">1</combatskill>\r\n    <endurance type=\"int\">1</endurance>\r\n    <wpnbonus type=\"int\">0</wpnbonus>\r\n    <wpndamage type=\"int\">1</wpndamage>\r\n    <noescape type=\"boolean\">true</noescape>\r\n  </type>\r\n```\r\n\r\n```\r\n  <function name=\"DoFight\" parameters=\"enemy\">\r\n    game.enemy = enemy\r\n    game.incombat = true\r\n    DoCombatTurn(\"\")\r\n  </function>\r\n\r\n  <function name=\"DoCombatTurn\" parameters=\"action\">\r\n    <![CDATA[\r\n    enemy = game.enemy\r\n    UpdateEnemyStatus()\r\n    ClearScreen\r\n    menulist = Split (\"Fight;Special;Escape\")\r\n    switch (action) {\r\n      case (\"Fight\") {\r\n        msg (\"You fight the \"+GetDisplayAlias(game.enemy)+\"!\")\r\n        RollCombat()\r\n      }\r\n      case (\"Special\") {\r\n        menulist = Split (ProcessText(\"{if game.allowgrenades:Grenade;}Heal;Cancel\"))\r\n      }\r\n      case (\"Escape\") {\r\n        if(GetBoolean(game.enemy, \"noescape\")) {\r\n          msg (\"You cannot escape from this combat.\")\r\n        }\r\n        else {\r\n          msg (\"You escape from combat.\")\r\n          game.incombat = false\r\n        }\r\n      }\r\n      case (\"Grenade\") {\r\n        UseGrenade()\r\n      }\r\n      case (\"Heal\") {\r\n        msg (\"You can't do that now.\")\r\n      }\r\n      case (\"\", \"Cancel\") {\r\n        // The player has either cancelled out of the \"Special\" menu, or this is the first turn\r\n        // so we just show the menu\r\n      }\r\n      default {\r\n        // This will only happen if there is a typo in one of the command names\r\n        // so that the \"menulist\" item and the case() statement don't match\r\n        // This is a pain to debug if it happens, so it's always worth including this block just in case\r\n        error (\"CAN'T HAPPEN! In DoCombatTurn, menu result was: \"+action)\r\n      }\r\n    }\r\n    // I'm assuming here that \"CheckPlayer\" and \"CheckEnemy\" will set game.incombat to false\r\n    // if either participant has died.\r\n    if (GetBoolean (game, \"incombat\")) {\r\n      CheckPlayer()\r\n    }\r\n    if (GetBoolean (game, \"incombat\")) {\r\n      CheckEnemy()\r\n    }\r\n    if (GetBoolean (game, \"incombat\")) {\r\n      // If this turn's action hasn't ended combat\r\n      // ask them what to do next turn\r\n      ShowMenu (\"You are in combat with a \"+GetDisplayAlias(enemy)+\". What would you like to do?\", menulist, false) {\r\n        DoCombatTurn (result)\r\n      }\r\n    }\r\n    ]]>\r\n  </function>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>Edit: silly error</p>\n<p>Here's how I'd do it.<br>\nThis is probably not the best way, but I like having stuff in one place.</p>\n<pre><code>  &lt;type name=\"combatenc\"&gt;\n    &lt;displayverbs type=\"listextend\"&gt;Fight&lt;/displayverbs&gt;\n    &lt;inventoryverbs type=\"listextend\"&gt;Fight&lt;/inventoryverbs&gt;\n    &lt;fight type=\"script\"&gt;\n      DoFight(this)\n    &lt;/fight&gt;\n    &lt;autocombat type=\"boolean\"&gt;false&lt;/autocombat&gt;\n    &lt;combatskill type=\"int\"&gt;1&lt;/combatskill&gt;\n    &lt;endurance type=\"int\"&gt;1&lt;/endurance&gt;\n    &lt;wpnbonus type=\"int\"&gt;0&lt;/wpnbonus&gt;\n    &lt;wpndamage type=\"int\"&gt;1&lt;/wpndamage&gt;\n    &lt;noescape type=\"boolean\"&gt;true&lt;/noescape&gt;\n  &lt;/type&gt;\n</code></pre>\n<pre><code>  &lt;function name=\"DoFight\" parameters=\"enemy\"&gt;\n    game.enemy = enemy\n    game.incombat = true\n    DoCombatTurn(\"\")\n  &lt;/function&gt;\n\n  &lt;function name=\"DoCombatTurn\" parameters=\"action\"&gt;\n    &lt;![CDATA[\n    enemy = game.enemy\n    UpdateEnemyStatus()\n    ClearScreen\n    menulist = Split (\"Fight;Special;Escape\")\n    switch (action) {\n      case (\"Fight\") {\n        msg (\"You fight the \"+GetDisplayAlias(game.enemy)+\"!\")\n        RollCombat()\n      }\n      case (\"Special\") {\n        menulist = Split (ProcessText(\"{if game.allowgrenades:Grenade;}Heal;Cancel\"))\n      }\n      case (\"Escape\") {\n        if(GetBoolean(game.enemy, \"noescape\")) {\n          msg (\"You cannot escape from this combat.\")\n        }\n        else {\n          msg (\"You escape from combat.\")\n          game.incombat = false\n        }\n      }\n      case (\"Grenade\") {\n        UseGrenade()\n      }\n      case (\"Heal\") {\n        msg (\"You can't do that now.\")\n      }\n      case (\"\", \"Cancel\") {\n        // The player has either cancelled out of the \"Special\" menu, or this is the first turn\n        // so we just show the menu\n      }\n      default {\n        // This will only happen if there is a typo in one of the command names\n        // so that the \"menulist\" item and the case() statement don't match\n        // This is a pain to debug if it happens, so it's always worth including this block just in case\n        error (\"CAN'T HAPPEN! In DoCombatTurn, menu result was: \"+action)\n      }\n    }\n    // I'm assuming here that \"CheckPlayer\" and \"CheckEnemy\" will set game.incombat to false\n    // if either participant has died.\n    if (GetBoolean (game, \"incombat\")) {\n      CheckPlayer()\n    }\n    if (GetBoolean (game, \"incombat\")) {\n      CheckEnemy()\n    }\n    if (GetBoolean (game, \"incombat\")) {\n      // If this turn's action hasn't ended combat\n      // ask them what to do next turn\n      ShowMenu (\"You are in combat with a \"+GetDisplayAlias(enemy)+\". What would you like to do?\", menulist, false) {\n        DoCombatTurn (result)\n      }\n    }\n    ]]&gt;\n  &lt;/function&gt;\n</code></pre>\n\n",
      "PostDate": "2018-05-11T21:12:07.9390216Z",
      "LastEditDate": "2018-05-11T21:13:12.1925844Z",
      "link": null
    },
    {
      "PostId": "43b1f328-3b5a-4179-ae88-1a7dc97ba174",
      "UserId": 329008,
      "Username": "Banjo",
      "AvatarUrl": "https://secure.gravatar.com/avatar/d5c333b97093bc51f88066a6d36312ae?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thanks again, everyone!\r\n\r\nmrangel, I solved it thanks to your \"make a separate function to check if combat should end\" suggestions. So obvious I feel stupid! But by gettting rid of that after the main combat menu, I now have:\r\n\r\n```\r\n  <function name=\"DoFight\" parameters=\"enemy,enemyname,enemycombatskill,enemyendurance,enemywpnbonus,enemywpndamage,enemyescape\">\r\n    <![CDATA[\r\n    game.incombat = true\r\n\tgame.enemy = enemy\r\n    game.enemyname = enemyname\r\n    game.enemycombatskill = enemycombatskill\r\n    game.enemyendurance = enemyendurance\r\n    game.enemywpnbonus = enemywpnbonus\r\n    game.enemywpndamage = enemywpndamage\r\n    game.noescape = enemyescape\r\n\tUpdateEnemyStatus()\r\n\tClearScreen\r\n\tmenulist = NewStringList()\r\n\tlist add (menulist, \"Fight\")\r\n\tlist add (menulist, \"Special\")\r\n\tlist add (menulist, \"Escape\")\r\n\tShowMenu (\"You are in combat\", menulist, false) {\r\n\t  if(result = \"Fight\") {\r\n\t    msg (\"You fight the \"+game.enemyname+\"!\")\r\n\t\tRollCombat()\r\n\t\tCheckPlayer()\r\n\t\tCheckEnemy()\r\n\t\twait {\r\n\t\t\tCheckCombatEnd()\r\n\t\t}\r\n\t  }\r\n\t  else if(result = \"Special\") {\r\n   \t\tDoSpecial()\r\n\t  }\r\n\t  else if(result = \"Escape\") {\r\n\t\tif(GetBoolean(game, \"noescape\")) {\r\n\t    \tmsg (\"You cannot escape from this combat.\")\r\n\t\t\twait {\r\n\t\t\t\tCheckCombatEnd()\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t    \tmsg (\"You escape from combat.\")\r\n\t    \tgame.incombat = false\r\n\t\t\twait {\r\n\t\t\t\tCheckCombatEnd()\r\n\t\t\t}\r\n\t    }\r\n\t  }\r\n\t}\r\n    ]]>\r\n  </function>\r\n\r\n  <function name=\"DoSpecial\">\r\n    <![CDATA[\r\n\tspmenulist = NewStringList()\r\n\tif(GetBoolean(game, \"allowgrenades\")) {\r\n\t\tlist add (spmenulist, \"Grenade\")\r\n\t}\r\n\tlist add (spmenulist, \"Heal\")\r\n\tlist add (spmenulist, \"Cancel\")\r\n\tShowMenu (\"What do you want to do?\", spmenulist, true) {\r\n\t  if(result = \"Grenade\") {\r\n\t\tUseGrenade()\r\n\t\tCheckEnemy()\r\n\t\twait {\r\n\t\t\tCheckCombatEnd()\r\n\t\t}\r\n\t  }\r\n\t  else if(result = \"Heal\") {\r\n\t    msg (\"You can't do that now.\")\r\n\t\twait {\r\n\t\t\tCheckCombatEnd()\r\n\t\t}\r\n\t  }\r\n\t  else if(result = \"Cancel\") {\r\n\t\tCheckCombatEnd()\r\n\t  }\r\n\t}\r\n    ]]>\r\n  </function>\r\n\r\n  <function name=\"CheckCombatEnd\">\r\n    <![CDATA[\r\n\tif ((game.enemyendurance > 0) and (GetBoolean(game, \"incombat\"))) {\r\n\t\tDoFight(game.enemy,game.enemyname,game.enemycombatskill,game.enemyendurance,game.enemywpnbonus,game.enemywpndamage,game.noescape)\r\n\t}\r\n\telse {\r\n\t  \tif (game.enemyendurance < 1) {\r\n\t\t\tRemoveObject (game.enemy)\t\t  \r\n\t  \t}\r\n\t  \tClearEnemyStatus()\r\n\t}\r\n    ]]>\r\n  </function>\r\n```\r\nWhich is a bit messy, but seems to work as I wanted (pauses after each \"turn\" but not mid-menu).\r\n\r\nI will look at the idea of getting rid of the \"copy the variables to global\" since I agree it's a bit hacky and messy, it was the only way around ShowMenu not passing local variables I could think of but would prefer a better way to do it.\r\n\r\nWill have to re-read the new posts again, but excited this now works!\r\n\r\nI've been working on a \"survival game\" library for a few months privately, but combat was the thing I was hesitant to approach. As someone who's nostalgia is far more for gamebooks than text adventures (my main childhood gaming was graphic adventures like Space Quest and King's Quest), being able to do \"Deververse\" or \"Fighting Fantasy\" style combat is awesome!",
      "EditableFormat": "markdown",
      "HTML": "<p>Thanks again, everyone!</p>\n<p>mrangel, I solved it thanks to your \"make a separate function to check if combat should end\" suggestions. So obvious I feel stupid! But by gettting rid of that after the main combat menu, I now have:</p>\n<pre><code>  &lt;function name=\"DoFight\" parameters=\"enemy,enemyname,enemycombatskill,enemyendurance,enemywpnbonus,enemywpndamage,enemyescape\"&gt;\n    &lt;![CDATA[\n    game.incombat = true\n\tgame.enemy = enemy\n    game.enemyname = enemyname\n    game.enemycombatskill = enemycombatskill\n    game.enemyendurance = enemyendurance\n    game.enemywpnbonus = enemywpnbonus\n    game.enemywpndamage = enemywpndamage\n    game.noescape = enemyescape\n\tUpdateEnemyStatus()\n\tClearScreen\n\tmenulist = NewStringList()\n\tlist add (menulist, \"Fight\")\n\tlist add (menulist, \"Special\")\n\tlist add (menulist, \"Escape\")\n\tShowMenu (\"You are in combat\", menulist, false) {\n\t  if(result = \"Fight\") {\n\t    msg (\"You fight the \"+game.enemyname+\"!\")\n\t\tRollCombat()\n\t\tCheckPlayer()\n\t\tCheckEnemy()\n\t\twait {\n\t\t\tCheckCombatEnd()\n\t\t}\n\t  }\n\t  else if(result = \"Special\") {\n   \t\tDoSpecial()\n\t  }\n\t  else if(result = \"Escape\") {\n\t\tif(GetBoolean(game, \"noescape\")) {\n\t    \tmsg (\"You cannot escape from this combat.\")\n\t\t\twait {\n\t\t\t\tCheckCombatEnd()\n\t\t\t}\n\t\t}\n\t\telse {\n\t    \tmsg (\"You escape from combat.\")\n\t    \tgame.incombat = false\n\t\t\twait {\n\t\t\t\tCheckCombatEnd()\n\t\t\t}\n\t    }\n\t  }\n\t}\n    ]]&gt;\n  &lt;/function&gt;\n\n  &lt;function name=\"DoSpecial\"&gt;\n    &lt;![CDATA[\n\tspmenulist = NewStringList()\n\tif(GetBoolean(game, \"allowgrenades\")) {\n\t\tlist add (spmenulist, \"Grenade\")\n\t}\n\tlist add (spmenulist, \"Heal\")\n\tlist add (spmenulist, \"Cancel\")\n\tShowMenu (\"What do you want to do?\", spmenulist, true) {\n\t  if(result = \"Grenade\") {\n\t\tUseGrenade()\n\t\tCheckEnemy()\n\t\twait {\n\t\t\tCheckCombatEnd()\n\t\t}\n\t  }\n\t  else if(result = \"Heal\") {\n\t    msg (\"You can't do that now.\")\n\t\twait {\n\t\t\tCheckCombatEnd()\n\t\t}\n\t  }\n\t  else if(result = \"Cancel\") {\n\t\tCheckCombatEnd()\n\t  }\n\t}\n    ]]&gt;\n  &lt;/function&gt;\n\n  &lt;function name=\"CheckCombatEnd\"&gt;\n    &lt;![CDATA[\n\tif ((game.enemyendurance &gt; 0) and (GetBoolean(game, \"incombat\"))) {\n\t\tDoFight(game.enemy,game.enemyname,game.enemycombatskill,game.enemyendurance,game.enemywpnbonus,game.enemywpndamage,game.noescape)\n\t}\n\telse {\n\t  \tif (game.enemyendurance &lt; 1) {\n\t\t\tRemoveObject (game.enemy)\t\t  \n\t  \t}\n\t  \tClearEnemyStatus()\n\t}\n    ]]&gt;\n  &lt;/function&gt;\n</code></pre>\n<p>Which is a bit messy, but seems to work as I wanted (pauses after each \"turn\" but not mid-menu).</p>\n<p>I will look at the idea of getting rid of the \"copy the variables to global\" since I agree it's a bit hacky and messy, it was the only way around ShowMenu not passing local variables I could think of but would prefer a better way to do it.</p>\n<p>Will have to re-read the new posts again, but excited this now works!</p>\n<p>I've been working on a \"survival game\" library for a few months privately, but combat was the thing I was hesitant to approach. As someone who's nostalgia is far more for gamebooks than text adventures (my main childhood gaming was graphic adventures like Space Quest and King's Quest), being able to do \"Deververse\" or \"Fighting Fantasy\" style combat is awesome!</p>\n\n",
      "PostDate": "2018-05-12T05:07:29.069291Z",
      "LastEditDate": "2018-05-13T13:16:34.2012625Z",
      "link": null
    },
    {
      "PostId": "148ba9ad-b981-4950-a35a-ccd32b3c99ec",
      "UserId": 329008,
      "Username": "Banjo",
      "AvatarUrl": "https://i.imgur.com/c9ZLB1Yb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "EDIT\r\n\r\nSorry for the double post, but just want to add more thanks as I now have it working without needing to copy all the enemy stats, as per mrangel's suggestion (this also solved an umentioned issue I had with trying to pass them back to the enemy if the player escaped).\r\n\r\nReally happy to have a working turn-based combat system now and have already enjoyed adding lots of tweaks; it now can be set to simulate three gamebook combat rulesets, has special moves (grenades, healing, etc.), initiative, a stealth system, equipment and multiple enemy fights.\r\n\r\nI would love to share it as a library here for others to use if there's an interest once it's done. :)",
      "EditableFormat": "markdown",
      "HTML": "<p>EDIT</p>\n<p>Sorry for the double post, but just want to add more thanks as I now have it working without needing to copy all the enemy stats, as per mrangel's suggestion (this also solved an umentioned issue I had with trying to pass them back to the enemy if the player escaped).</p>\n<p>Really happy to have a working turn-based combat system now and have already enjoyed adding lots of tweaks; it now can be set to simulate three gamebook combat rulesets, has special moves (grenades, healing, etc.), initiative, a stealth system, equipment and multiple enemy fights.</p>\n<p>I would love to share it as a library here for others to use if there's an interest once it's done. :)</p>\n\n",
      "PostDate": "2018-05-13T13:14:29.38644Z",
      "LastEditDate": "2018-05-13T13:22:35.9792826Z",
      "link": null
    }
  ]
}
