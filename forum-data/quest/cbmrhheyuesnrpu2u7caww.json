{
  "Topic": {
    "TopicId": "cbmrhheyuesnrpu2u7caww",
    "ForumId": "10",
    "Title": "Gridmap Clicking",
    "LastUpdated": "2024-06-01T17:59:18.3477579Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "cf94b1a3-cce0-4aee-8d54-02020bce89e9",
      "UserId": 579655,
      "Username": "Jennifer Wren",
      "AvatarUrl": "https://i.imgur.com/t1XUS1Kb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "What is supposed to happen when you tick the box that makes the map \"respond to clicks\"? I tried that and nothing happened. I wanted to have a great big clickable map with a picture overtop of it that moves when the the player is in any given room. I also want to know how to make the map rooms size change midgame and back again, for instance when the player clicks switch on an object.",
      "EditableFormat": "markdown",
      "HTML": "<p>What is supposed to happen when you tick the box that makes the map \"respond to clicks\"? I tried that and nothing happened. I wanted to have a great big clickable map with a picture overtop of it that moves when the the player is in any given room. I also want to know how to make the map rooms size change midgame and back again, for instance when the player clicks switch on an object.</p>\n\n",
      "PostDate": "2024-06-01T17:59:18.3477579Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "8755a6aa-53bb-4bce-bbdf-679c1bfa00d1",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> What is supposed to happen when you tick the box that makes the map \"respond to clicks\"?\r\n\r\nIt calls this core function:\r\n```\r\n  <function name=\"GridSquareClick\" parameters=\"x, y\">\r\n    // Copy this function into your game to handle grid square clicks\r\n  </function>\r\n```\r\n\r\nBasically, if you create your own function with the same name, it will be called when the player clicks on the map; so you can make it do whatever you want.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>What is supposed to happen when you tick the box that makes the map \"respond to clicks\"?</p>\n</blockquote>\n<p>It calls this core function:</p>\n<pre><code>  &lt;function name=\"GridSquareClick\" parameters=\"x, y\"&gt;\n    // Copy this function into your game to handle grid square clicks\n  &lt;/function&gt;\n</code></pre>\n<p>Basically, if you create your own function with the same name, it will be called when the player clicks on the map; so you can make it do whatever you want.</p>\n\n",
      "PostDate": "2024-06-01T21:16:25.5159591Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "654a47bf-1ebf-4751-a27a-0e0e2f48019e",
      "UserId": 31991,
      "Username": "daeun",
      "AvatarUrl": "https://i.imgur.com/Xvt8zzBb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I am not an expert, but this code may change room size in midgame\r\n\r\nThis code changes \"room\", so if you wanna change \"room5\", edit the code to room5\r\n```\r\nroom.grid_width = 2\r\nroom.grid_length = 3\r\nGrid_Redraw\r\n```\r\n_________________________________\r\n\r\nPretty interesting to find out map \"respond to clicks\" actually does something!",
      "EditableFormat": "markdown",
      "HTML": "<p>I am not an expert, but this code may change room size in midgame</p>\n<p>This code changes \"room\", so if you wanna change \"room5\", edit the code to room5</p>\n<pre><code>room.grid_width = 2\nroom.grid_length = 3\nGrid_Redraw\n</code></pre>\n<hr>\n<p>Pretty interesting to find out map \"respond to clicks\" actually does something!</p>\n\n",
      "PostDate": "2024-06-02T00:18:30.7203273Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "96afb7fe-6ae0-486f-9158-4785d1d4a02a",
      "UserId": 579655,
      "Username": "Jennifer Wren",
      "AvatarUrl": "https://i.imgur.com/t1XUS1Kb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "What I want to do is move player to the room being called by clicking on the map. When I ticked the box \"map should be clickable\" and then went into my game and clicked on a room on the map, I had expected to move to that room. I still don't know what to add to make that happen. MoveObject (player,(x,y)) or it could be anything else.  \r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>What I want to do is move player to the room being called by clicking on the map. When I ticked the box \"map should be clickable\" and then went into my game and clicked on a room on the map, I had expected to move to that room. I still don't know what to add to make that happen. MoveObject (player,(x,y)) or it could be anything else.</p>\n\n",
      "PostDate": "2024-06-02T01:26:33.0877414Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "77670a4e-7e3e-49f9-ad11-d62d114ed967",
      "UserId": 579655,
      "Username": "Jennifer Wren",
      "AvatarUrl": "https://i.imgur.com/t1XUS1Kb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "While checking out if Daeun's, your script, will change the size of a room midgame is probably well worth looking into for future games and just knowing, what I wanted to do this time is change the default room size as compared to the size of the map. It is usually preset to 30 and 300. I just wanted to set it at say 200 instead of 30 and bring it down to 30 when the player wants to examine more of the map instead of the details, in order to travel long distances.  I want to cover the gridmap with an image, and equip it with clickable movement. I can stand the thought of not changing the size of the map at all and leaving the map to show maybe two rows at a time, or three. I don't know. I haven't written it yet.\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>While checking out if Daeun's, your script, will change the size of a room midgame is probably well worth looking into for future games and just knowing, what I wanted to do this time is change the default room size as compared to the size of the map. It is usually preset to 30 and 300. I just wanted to set it at say 200 instead of 30 and bring it down to 30 when the player wants to examine more of the map instead of the details, in order to travel long distances.  I want to cover the gridmap with an image, and equip it with clickable movement. I can stand the thought of not changing the size of the map at all and leaving the map to show maybe two rows at a time, or three. I don't know. I haven't written it yet.</p>\n\n",
      "PostDate": "2024-06-02T01:37:38.5474694Z",
      "LastEditDate": "2024-06-02T03:17:00.6199584Z",
      "link": null
    },
    {
      "PostId": "5232cb3a-ce9e-4574-a53a-37a14ec4675a",
      "UserId": 31991,
      "Username": "daeun",
      "AvatarUrl": "https://i.imgur.com/Xvt8zzBb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">I want to cover the gridmap with an image, and equip it with clickable movement\r\n\r\nFor people trying to solve this, this link may offer some insight\r\nhttps://textadventures.co.uk/forum/quest/topic/5859/picture-zoom\r\n\r\n_________________________\r\nI wasn't able to change from 300 to 200,\r\nbut it seems like I can change from 30 to 60, \r\nnot sure how the math works, \r\nbut it looks like it is zoomed in for me,\r\nunfortunately the old map still exists, and I do not know the code to remove the old map away from view\r\n\r\n```\r\nfirsttime {\r\n  JS.Grid_SetScale (60)\r\n  Grid_Redraw\r\n}\r\notherwise {\r\n  JS.Grid_SetScale (30)\r\n  Grid_Redraw\r\n}\r\n```\r\n",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I want to cover the gridmap with an image, and equip it with clickable movement</p>\n</blockquote>\n<p>For people trying to solve this, this link may offer some insight<br>\nhttps://textadventures.co.uk/forum/quest/topic/5859/picture-zoom</p>\n<hr>\n<p>I wasn't able to change from 300 to 200,<br>\nbut it seems like I can change from 30 to 60,<br>\nnot sure how the math works,<br>\nbut it looks like it is zoomed in for me,<br>\nunfortunately the old map still exists, and I do not know the code to remove the old map away from view</p>\n<pre><code>firsttime {\n  JS.Grid_SetScale (60)\n  Grid_Redraw\n}\notherwise {\n  JS.Grid_SetScale (30)\n  Grid_Redraw\n}\n</code></pre>\n\n",
      "PostDate": "2024-06-02T02:37:59.697001Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "edb293a2-4688-41f8-9c5d-0875da54ea37",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> While checking out if Daeun's, your script, will change the size of a room midgame is probably well worth looking into for future games and just knowing, what I wanted to do this time is change the default room size as compared to the size of the map. It is usually preset to 30 and 300. I just wanted to set it at say 200 instead of 30 and bring it down to 30 when the player wants to examine more of the map instead of the details, in order to travel long distances. I want to cover the gridmap with an image, and equip it with clickable movement. I can stand the thought of not changing the size of the map at all and leaving the map to show maybe two rows at a time, or three. I don't know. I haven't written it yet.\r\n\r\nSounds to me like you want to zoom the map, not resize the rooms. The functions you want are the javascript functions `window.gridApi.zoomIn` and `window.gridApi.setZoom`. To call those from Quest, you would refer to them as `JS.gridApi.zoomIn` and `JS.gridApi.setZoom`.\r\n\r\n* `JS.gridApisetZoom (n)` sets the current zoom level to `n`. I'm not quite sure what units it uses, so you may have to experiment if you want to use it.\r\n* `JS.gridApi.zoomIn (n)` multiplies the current zoom level by <code>1.1<sup>n</sup></code> - so `zoomIn(4)` will allow the player to see about 50% more rooms on the map, and `zoomIn(-4)` will reverse that.\r\n\r\n(It should be noted that the player can also call `zoomIn` by using their scroll wheel over the map; not sure if there's a way to disable that or not, but if you're tying it to an item you probably don't want to let the player zoom the map manually)",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>While checking out if Daeun's, your script, will change the size of a room midgame is probably well worth looking into for future games and just knowing, what I wanted to do this time is change the default room size as compared to the size of the map. It is usually preset to 30 and 300. I just wanted to set it at say 200 instead of 30 and bring it down to 30 when the player wants to examine more of the map instead of the details, in order to travel long distances. I want to cover the gridmap with an image, and equip it with clickable movement. I can stand the thought of not changing the size of the map at all and leaving the map to show maybe two rows at a time, or three. I don't know. I haven't written it yet.</p>\n</blockquote>\n<p>Sounds to me like you want to zoom the map, not resize the rooms. The functions you want are the javascript functions <code>window.gridApi.zoomIn</code> and <code>window.gridApi.setZoom</code>. To call those from Quest, you would refer to them as <code>JS.gridApi.zoomIn</code> and <code>JS.gridApi.setZoom</code>.</p>\n<ul>\n<li><code>JS.gridApisetZoom (n)</code> sets the current zoom level to <code>n</code>. I'm not quite sure what units it uses, so you may have to experiment if you want to use it.</li>\n<li><code>JS.gridApi.zoomIn (n)</code> multiplies the current zoom level by <code>1.1<sup>n</sup></code> - so <code>zoomIn(4)</code> will allow the player to see about 50% more rooms on the map, and <code>zoomIn(-4)</code> will reverse that.</li>\n</ul>\n<p>(It should be noted that the player can also call <code>zoomIn</code> by using their scroll wheel over the map; not sure if there's a way to disable that or not, but if you're tying it to an item you probably don't want to let the player zoom the map manually)</p>\n\n",
      "PostDate": "2024-06-02T10:29:43.0627308Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "fb67a718-fb7c-41a9-a15a-596bd9dd2be9",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "[sorry for the long delay between my two posts; I was on a train but it arrived at the station, and then I had to find somewhere I could get my laptop out before finishing this one… and it's telling me I can't post that here when I go to edit]\r\n\r\n> What I want to do is move player to the room being called by clicking on the map. When I ticked the box \"map should be clickable\" and then went into my game and clicked on a room on the map, I had expected to move to that room. I still don't know what to add to make that happen. MoveObject (player,(x,y)) or it could be anything else.\r\n\r\nI think that to do that, you'd have to find out which room those coordinates correspond to… which might be challenging because the grid doesn't require whole-number coordinates. It looks like the x and y values you get are the grid coordinates of the mouse, rounded down to the nearest square; so if you have a room or exit whose grid size isn't a whole number, the coordinates you're given might not actually be in the same room as the mouse pointer.\r\n\r\nStill, assuming whole numbers are sane, you would want something like:\r\n```\r\n<function name=\"FindRoomForCoordinates\" parameters=\"player, x, y\" type=\"object\">\r\n  dict = Grid_GetPlayerCoordinateDictionary (player)\r\n  if (not dict = null) {\r\n    foreach (roomname, dict) {\r\n      coords = DictionaryItem (dict, roomname)\r\n      room = GetObject (roomname)\r\n      if (DictionaryContains (coords, \"x\") and DictionaryContains (coords, \"y\") and not room = null) {\r\n        roomx = DictionaryItem (coords, \"x\")\r\n        roomy = DictionaryItem (coords, \"y\")\r\n        if (x >= roomx and y >= roomy and x <= (roomx+room.grid_width) and y <= (roomy+room.grid_height)) {\r\n          return (room)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return (null)\r\n</function>\r\n\r\n<function name=\"GridSquareClick\" parameters=\"x, y\">\r\n  room = FindRoomForCoordinates(game.pov, x,y)\r\n  if (not room=null) {\r\n    // If there are rooms the player can't teleport to (locked doors or whatever),\r\n    // check for them here\r\n    MoveObject (game.pov, room)\r\n  }\r\n</function>\r\n```\r\nAll off the top of my head, but I think it should be a good start.\r\nNote that this will allow the player to click on any room whose coordinates have been calculated, regardless of whether or not the room is actually visible on the map. If you want to restrict them based on closed doors, you'd need to check that.\r\n\r\nAn alternative for games with more restricted movement might be something like this:\r\n```\r\n<function name=\"FindRoomForCoordinates\" parameters=\"player, x, y\" type=\"object\">\r\n  checked = NewObjectList()\r\n  if (HasAttribute (game, \"teleport_destinations\")) {\r\n    tocheck = game.teleport_destinations\r\n  }\r\n  else {\r\n    tocheck = NewObjectList()\r\n  }\r\n  list add (tocheck, player.parent)\r\n  while (not ListCount (tocheck) = 0) {\r\n    room = ListItem (tocheck, 0)\r\n    list remove (tocheck, room)\r\n    list add (checked, room)\r\n    coords = Grid_GetPlayerCoordinatesForRoom (player, room)\r\n    if (DictionaryContains (coords, \"x\") and DictionaryContains (coords, \"y\")) {\r\n      roomx = DictionaryItem (coords, \"x\")\r\n      roomy = DictionaryItem (coords, \"y\")\r\n      if (x >= roomx and y >= roomy and x <= (roomx+room.grid_width) and y <= (roomy+room.grid_height)) {\r\n        return (room)\r\n      }\r\n    }\r\n    if (GetBoolean (room, \"visited\")) {\r\n      foreach (door, FilterByAttribute (AllExits(), \"parent\", room)) {\r\n        if (HasBoolean (door, \"allowteleport\")) {\r\n          allowed = door.allowteleport\r\n        }\r\n        else {\r\n          allowed = GetBoolean (door, \"visible\") and not (GetBoolean (door, \"runscript\") or GetBoolean (door, \"locked\"))\r\n        }\r\n        if (allowed and HasObject (door, \"to\")) {\r\n          if (not (ListContains (checked, door.to) or ListContains (tocheck, door.to))) {\r\n            list add (tocheck, door.to)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return (null)\r\n</function>\r\n```\r\nThis one should only allow the player to click on rooms which are reachable from the player's current location, only passing through rooms they have already visited and unlocked exits.\r\n\r\nBecause the most common use for scripts on exits seems to be not allowing the player through without a certain item or something like that, this function counts exits with scripts as if they were locked. If you want to override this, or allow the player to fast travel through locked doors, you can give exits an `allowteleport` boolean, which overrides the default visible/not-locked/not-script checks. There can also be a list, `game.teleport_destinations`, for rooms which can be clicked on even if there's no path for the player to walk there from here.\r\n\r\nI think that for most text adventures, this version of the function would be more useful; but may take more time to execute; so you can figure out which function would best fit your game.",
      "EditableFormat": "markdown",
      "HTML": "<p>[sorry for the long delay between my two posts; I was on a train but it arrived at the station, and then I had to find somewhere I could get my laptop out before finishing this one… and it's telling me I can't post that here when I go to edit]</p>\n<blockquote>\n<p>What I want to do is move player to the room being called by clicking on the map. When I ticked the box \"map should be clickable\" and then went into my game and clicked on a room on the map, I had expected to move to that room. I still don't know what to add to make that happen. MoveObject (player,(x,y)) or it could be anything else.</p>\n</blockquote>\n<p>I think that to do that, you'd have to find out which room those coordinates correspond to… which might be challenging because the grid doesn't require whole-number coordinates. It looks like the x and y values you get are the grid coordinates of the mouse, rounded down to the nearest square; so if you have a room or exit whose grid size isn't a whole number, the coordinates you're given might not actually be in the same room as the mouse pointer.</p>\n<p>Still, assuming whole numbers are sane, you would want something like:</p>\n<pre><code>&lt;function name=\"FindRoomForCoordinates\" parameters=\"player, x, y\" type=\"object\"&gt;\n  dict = Grid_GetPlayerCoordinateDictionary (player)\n  if (not dict = null) {\n    foreach (roomname, dict) {\n      coords = DictionaryItem (dict, roomname)\n      room = GetObject (roomname)\n      if (DictionaryContains (coords, \"x\") and DictionaryContains (coords, \"y\") and not room = null) {\n        roomx = DictionaryItem (coords, \"x\")\n        roomy = DictionaryItem (coords, \"y\")\n        if (x &gt;= roomx and y &gt;= roomy and x &lt;= (roomx+room.grid_width) and y &lt;= (roomy+room.grid_height)) {\n          return (room)\n        }\n      }\n    }\n  }\n  return (null)\n&lt;/function&gt;\n\n&lt;function name=\"GridSquareClick\" parameters=\"x, y\"&gt;\n  room = FindRoomForCoordinates(game.pov, x,y)\n  if (not room=null) {\n    // If there are rooms the player can't teleport to (locked doors or whatever),\n    // check for them here\n    MoveObject (game.pov, room)\n  }\n&lt;/function&gt;\n</code></pre>\n<p>All off the top of my head, but I think it should be a good start.<br>\nNote that this will allow the player to click on any room whose coordinates have been calculated, regardless of whether or not the room is actually visible on the map. If you want to restrict them based on closed doors, you'd need to check that.</p>\n<p>An alternative for games with more restricted movement might be something like this:</p>\n<pre><code>&lt;function name=\"FindRoomForCoordinates\" parameters=\"player, x, y\" type=\"object\"&gt;\n  checked = NewObjectList()\n  if (HasAttribute (game, \"teleport_destinations\")) {\n    tocheck = game.teleport_destinations\n  }\n  else {\n    tocheck = NewObjectList()\n  }\n  list add (tocheck, player.parent)\n  while (not ListCount (tocheck) = 0) {\n    room = ListItem (tocheck, 0)\n    list remove (tocheck, room)\n    list add (checked, room)\n    coords = Grid_GetPlayerCoordinatesForRoom (player, room)\n    if (DictionaryContains (coords, \"x\") and DictionaryContains (coords, \"y\")) {\n      roomx = DictionaryItem (coords, \"x\")\n      roomy = DictionaryItem (coords, \"y\")\n      if (x &gt;= roomx and y &gt;= roomy and x &lt;= (roomx+room.grid_width) and y &lt;= (roomy+room.grid_height)) {\n        return (room)\n      }\n    }\n    if (GetBoolean (room, \"visited\")) {\n      foreach (door, FilterByAttribute (AllExits(), \"parent\", room)) {\n        if (HasBoolean (door, \"allowteleport\")) {\n          allowed = door.allowteleport\n        }\n        else {\n          allowed = GetBoolean (door, \"visible\") and not (GetBoolean (door, \"runscript\") or GetBoolean (door, \"locked\"))\n        }\n        if (allowed and HasObject (door, \"to\")) {\n          if (not (ListContains (checked, door.to) or ListContains (tocheck, door.to))) {\n            list add (tocheck, door.to)\n          }\n        }\n      }\n    }\n  }\n  return (null)\n&lt;/function&gt;\n</code></pre>\n<p>This one should only allow the player to click on rooms which are reachable from the player's current location, only passing through rooms they have already visited and unlocked exits.</p>\n<p>Because the most common use for scripts on exits seems to be not allowing the player through without a certain item or something like that, this function counts exits with scripts as if they were locked. If you want to override this, or allow the player to fast travel through locked doors, you can give exits an <code>allowteleport</code> boolean, which overrides the default visible/not-locked/not-script checks. There can also be a list, <code>game.teleport_destinations</code>, for rooms which can be clicked on even if there's no path for the player to walk there from here.</p>\n<p>I think that for most text adventures, this version of the function would be more useful; but may take more time to execute; so you can figure out which function would best fit your game.</p>\n\n",
      "PostDate": "2024-06-02T12:31:00.7715076Z",
      "LastEditDate": "2024-06-02T12:38:34.1465143Z",
      "link": null
    },
    {
      "PostId": "8ca6716b-67eb-43ec-9ada-9e62b9e12bd6",
      "UserId": 579655,
      "Username": "Jennifer Wren",
      "AvatarUrl": "https://i.imgur.com/t1XUS1Kb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "So, what I could do, if the zoom on scroll is something that can be disabled, is make the room description for each room the full sized picture, have a set of flags or attribute system for more than one size, probably only full size and small, make the map respond to clicks by moving the player nest rooms within rooms and give them all the same alias. Add an object that switches the map to small and also  changes the size of the picture, then, on click, move the player and also, on room description, move the picture around beyond the screen, depending on which room the player is in, with room description: read the flag or variable integer,   set the flag/ or add or subtract from the variable, clear screen plus switch to the larger picture and reset the map, all with the room description. And add smaller pictures which show up over picture map over the gridmap when objects are dropped in rooms when that room would be visible on the map wherever that particular room centre is at the time. I could make the gridmap background really big, 600 maybe, and leave some room for one or two sentences at a time to show on the screen with links and things.",
      "EditableFormat": "markdown",
      "HTML": "<p>So, what I could do, if the zoom on scroll is something that can be disabled, is make the room description for each room the full sized picture, have a set of flags or attribute system for more than one size, probably only full size and small, make the map respond to clicks by moving the player nest rooms within rooms and give them all the same alias. Add an object that switches the map to small and also  changes the size of the picture, then, on click, move the player and also, on room description, move the picture around beyond the screen, depending on which room the player is in, with room description: read the flag or variable integer,   set the flag/ or add or subtract from the variable, clear screen plus switch to the larger picture and reset the map, all with the room description. And add smaller pictures which show up over picture map over the gridmap when objects are dropped in rooms when that room would be visible on the map wherever that particular room centre is at the time. I could make the gridmap background really big, 600 maybe, and leave some room for one or two sentences at a time to show on the screen with links and things.</p>\n\n",
      "PostDate": "2024-06-02T13:13:07.9374242Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
