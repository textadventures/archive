{
  "Topic": {
    "TopicId": "ik0dbblaq0o5fdqq7nuwia",
    "ForumId": "10",
    "Title": "JS function to find the last divOutputAlign in a saved game [SOLVED]",
    "LastUpdated": "2017-10-14T05:38:32.6319717Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "b3bb461f-62cc-4a1b-95b6-0a4c5fcf2f9a",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "\r\n### UPDATE:  Altering the ```clearMenu``` function is the simple and **proper** fix for this.  Just so you know before you read all of my 'notes' I posted while finding a fix.\r\n\r\n---\r\n#### **NOTE: I found a dirty way to make it work here, but you can scroll on down to mrangel's posts for the solution.**\r\nhttp://textadventures.co.uk/forum/quest/topic/ik0dbblaq0o5fdqq7nuwia/js-function-to-find-the-last-divoutputalign-in-a-saved-game-solved#14cb0c29-3383-4c85-ae2b-611a9ae81558\r\n\r\n---\r\nHello,\r\n\r\nI've gone crazy trying to solve this one.  \r\n\r\nWhen play begins, if you leave it where it displays the title and author, you have ```divOutputAlign1``` through ```divOutputAlign5```.  \r\n\r\nThat's what I have, anyway.  \r\n\r\n**EDIT: This is <s>**sort of** a math/JS problem, so if yours is different, we can just shift the numbers around.</s> ACTUALLY a problem with the ```clearScreen``` function.  (Thanks, mrangel.)**\r\n\r\n---\r\nMaybe we just need a function to search for the text ```divOutputAlign```, then assign the highest number to a variable.  Then, we'll feed that variable to ```setDivCount```.\r\n\r\n\r\n A JS function which finds what the highest numbered ```divOutputAlign``` in a saved game is what I'm really after here.\r\n\r\n\r\n---\r\n\r\nWhen you take a turn, two instances of divOutputAlign are created.\r\n\r\nOne **appears to be** whitespace (between turns), the second is this:\r\n<samp>\r\n\r\n\\>jump\r\nYou jump, but nothing happens.\r\n</samp>\r\n\r\n---\r\nIf that was your first command, you would now have ```divOutputAlign6``` and ```divOutputAlign7```.\r\n\r\n```divOutputAlign6 ``` is an empty element, and ```divOutputAlign7``` contains the HTML code for the outputted text.\r\n\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31572695-46c5499a-b071-11e7-8616-4379fde712af.png)\r\n</details>\r\n\r\n---\r\nNow, for those of you who never use ```ClearScreen```, you have no worries concerning any of this.\r\n\r\nThe rest of us have a chance of running into problems when people load saved games.\r\n\r\n...unless the player is using the web player, in which case the screen will be cleared when play begins.  (This is actually a good thing for us screen-clearers.)\r\n\r\n---\r\nThese next few screenshots aren't any fun.  They only show what happens when the screen is NOT cleared.\r\n\r\n\r\n#### I start the game.  I jump.  Then I save, putting me at ```divOutputAlign9```.\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31572732-0413005a-b072-11e7-9983-a1c5f3b1da58.png)\r\n</details>\r\n\r\n---\r\n#### Now I load the saved game and Z, giving me ```divOutputAlign10```, which is good:\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31572754-75ecf212-b072-11e7-8305-2e42befcd56e.png)\r\n</details>\r\n\r\n---\r\nNow, let's do the same thing, but clear the screen before we save.\r\n\r\n\r\nWait...\r\n\r\nFirst I'll show you what happens when we clear the screen.  It just deletes all previous instances of ```divOutputAlign``` (and the numbering system will remain intact).  This, I believe, is so Quest doesn't have to deal with any \\<output> which won't be displayed when a saved game is loaded.\r\n\r\nI'm starting the game, jumping, clearing the screen (I made it a command), then saving.\r\n\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31572780-45a1782a-b073-11e7-92a3-d57e2309152b.png)\r\n</details>\r\n\r\n---\r\nNow, I load the saved game:\r\n\r\nWhen play begins, I am at ```divOutputAlign12```, just as I should be:\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31572825-3af0e180-b074-11e7-8d1a-bf442ff77897.png)\r\n</details>\r\n\r\n---\r\nThis is the data Quest saved to load the text:\r\n\r\n```\r\n  <output>\r\n    <html><![CDATA[<div id=\"divOutputAlign10\" style=\"text-align: left\" class=\"section3\"></div><div id=\"divOutputAlign11\" style=\"text-align: left\" class=\"\"></div><div id=\"divOutputAlign12\" style=\"text-align: left\" class=\"section4\"><span style=\"font-family:Georgia, serif;color:Black;font-size:12pt;\"></span><br><span style=\"font-family:Georgia, serif;color:Black;font-size:12pt;\">&gt; save</span><br></div>]]></html>\r\n  </output>\r\n```\r\n\r\nWhen I enter a command, the ```divOutputAlign``` numbering system is broken.  Everything from here on out is ```divOutputAlignNaN```, which breaks ```ShowMenu```.\r\n\r\nThis was discussed here:\r\n\r\nhttp://textadventures.co.uk/forum/quest/topic/6j-wzgnus0urepk6bksura/what-can-break-displaying-menus#cebf0fcd-9060-4e6d-a714-03e33549d05e\r\n\r\nThat ***does***  fix the problem with ```ShowMenu```, but it seems to cause other problems.\r\n\r\n---\r\nI opened my saved game and added my 'fix' to this game:\r\n```\r\n    <inituserinterface type=\"script\">\r\n\t  JS.getDivCount ()\r\n    </inituserinterface>\r\n```\r\n\r\nNow my first move after loading the saved game is labeled ```divOutputAlign1```!\r\n\r\nRuh-roh, Raggy!!!\r\n\r\nWhat will happen once ```divOutputAlign``` rolls back up to an ID that's in the game already, you ask?\r\n\r\nWell...  The text in the FIRST instance of that ID will be displayed, of course!!!\r\n\r\nThe funny thing is that it replaced ```divOutputAlign10``` and ```divOutputAlign11``` with the NEW text, but it seems to get 'stuck' at the current one, which is ```divOutputAlign12```.  So, it prints the new ```divOutputAlign11``` above the old ```divOutputAlign12```:\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31572933-7b2e9e0c-b076-11e7-8565-c9afcbdae794.png)\r\n</details>\r\n\r\n---\r\nIf you are changing rooms when this happens, it can be quite confusing. \r\n\r\nI'm sure either:\r\n\r\n- JS can be used to find the strings containing ```divOutputAlign``` in the saved game file, then set the highest number as the new ```divOutputAlign```, hence fixing everything.\r\n\r\nOR\r\n\r\n- We can set up an attribute in Quest that multiplies ```game.currentturnoutputsection``` by something to make sure the latest ```divOutputAlign``` has a number higher than the last one.\r\n\r\n---\r\nLike I say, this has been driving me crazy.\r\n\r\nI've been working on it for about 24 hours now.  (With little forum breaks in between, of course!)\r\n\r\n22 of those hours were spent trying to find what I'd done in one of my scripts that kept my room description from changing after loading a saved game.  Then, I noticed it didn't matter if I switched rooms.  It did it on the same turn number after loading the game every time.\r\n\r\nThat's when I remembered the ```ShowMenu``` thing and got to the point I am now at:  right where I started.\r\n\r\n---\r\nHere are the JS functions from **playercore.js** that are related to this:\r\n\r\n<details><summary> code </summary>\r\n```\r\nfunction createNewDiv(alignment) {\r\n    var classes = _outputSections.join(\" \");\r\n    setDivCount(getDivCount() + 1);\r\n    $(\"<div/>\", {\r\n        id: \"divOutputAlign\" + getDivCount(),\r\n        style: \"text-align: \" + alignment,\r\n        \"class\": classes\r\n    }).appendTo(\"#divOutput\");\r\n    setCurrentDiv(\"#divOutputAlign\" + getDivCount());\r\n}\r\n\r\nvar _currentDiv = null;\r\n\r\nfunction getCurrentDiv() {\r\n    if (_currentDiv) return _currentDiv;\r\n\r\n    var divId = $(\"#outputData\").attr(\"data-currentdiv\");\r\n    if (divId) {\r\n        _currentDiv = $(divId);\r\n        return _currentDiv;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nfunction setCurrentDiv(div) {\r\n    _currentDiv = $(div);\r\n    $(\"#outputData\").attr(\"data-currentdiv\", div);\r\n}\r\n\r\nvar _divCount = -1;\r\n\r\nfunction getDivCount() {\r\n    if (_divCount == -1) {\r\n        _divCount = parseInt($(\"#outputData\").attr(\"data-divcount\"));\r\n    }\r\n    return _divCount;\r\n}\r\n\r\nfunction setDivCount(count) {\r\n    _divCount = count;\r\n    $(\"#outputData\").attr(\"data-divcount\", _divCount);\r\n}\r\n```\r\n</details>",
      "EditableFormat": "markdown",
      "HTML": "<h3>UPDATE:  Altering the <code>clearMenu</code> function is the simple and <strong>proper</strong> fix for this.  Just so you know before you read all of my 'notes' I posted while finding a fix.</h3>\n<hr>\n<h4><strong>NOTE: I found a dirty way to make it work here, but you can scroll on down to mrangel's posts for the solution.</strong></h4>\n<p>http://textadventures.co.uk/forum/quest/topic/ik0dbblaq0o5fdqq7nuwia/js-function-to-find-the-last-divoutputalign-in-a-saved-game-solved#14cb0c29-3383-4c85-ae2b-611a9ae81558</p>\n<hr>\n<p>Hello,</p>\n<p>I've gone crazy trying to solve this one.</p>\n<p>When play begins, if you leave it where it displays the title and author, you have <code>divOutputAlign1</code> through <code>divOutputAlign5</code>.</p>\n<p>That's what I have, anyway.</p>\n<p><strong>EDIT: This is <s><strong>sort of</strong> a math/JS problem, so if yours is different, we can just shift the numbers around.</s> ACTUALLY a problem with the <code>clearScreen</code> function.  (Thanks, mrangel.)</strong></p>\n<hr>\n<p>Maybe we just need a function to search for the text <code>divOutputAlign</code>, then assign the highest number to a variable.  Then, we'll feed that variable to <code>setDivCount</code>.</p>\n<p>A JS function which finds what the highest numbered <code>divOutputAlign</code> in a saved game is what I'm really after here.</p>\n<hr>\n<p>When you take a turn, two instances of divOutputAlign are created.</p>\n<p>One <strong>appears to be</strong> whitespace (between turns), the second is this:<br>\n<samp></samp></p>\n<p>&gt;jump<br>\nYou jump, but nothing happens.<br>\n</p>\n<hr>\n<p>If that was your first command, you would now have <code>divOutputAlign6</code> and <code>divOutputAlign7</code>.</p>\n<p><code>divOutputAlign6</code> is an empty element, and <code>divOutputAlign7</code> contains the HTML code for the outputted text.</p>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31572695-46c5499a-b071-11e7-8616-4379fde712af.png)\n</details>\n<hr>\n<p>Now, for those of you who never use <code>ClearScreen</code>, you have no worries concerning any of this.</p>\n<p>The rest of us have a chance of running into problems when people load saved games.</p>\n<p>...unless the player is using the web player, in which case the screen will be cleared when play begins.  (This is actually a good thing for us screen-clearers.)</p>\n<hr>\n<p>These next few screenshots aren't any fun.  They only show what happens when the screen is NOT cleared.</p>\n<h4>I start the game.  I jump.  Then I save, putting me at <code>divOutputAlign9</code>.</h4>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31572732-0413005a-b072-11e7-9983-a1c5f3b1da58.png)\n</details>\n<hr>\n<h4>Now I load the saved game and Z, giving me <code>divOutputAlign10</code>, which is good:</h4>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31572754-75ecf212-b072-11e7-8305-2e42befcd56e.png)\n</details>\n<hr>\n<p>Now, let's do the same thing, but clear the screen before we save.</p>\n<p>Wait...</p>\n<p>First I'll show you what happens when we clear the screen.  It just deletes all previous instances of <code>divOutputAlign</code> (and the numbering system will remain intact).  This, I believe, is so Quest doesn't have to deal with any &lt;output&gt; which won't be displayed when a saved game is loaded.</p>\n<p>I'm starting the game, jumping, clearing the screen (I made it a command), then saving.</p>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31572780-45a1782a-b073-11e7-92a3-d57e2309152b.png)\n</details>\n<hr>\n<p>Now, I load the saved game:</p>\n<p>When play begins, I am at <code>divOutputAlign12</code>, just as I should be:</p>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31572825-3af0e180-b074-11e7-8d1a-bf442ff77897.png)\n</details>\n<hr>\n<p>This is the data Quest saved to load the text:</p>\n<pre><code>  &lt;output&gt;\n    &lt;html&gt;&lt;![CDATA[&lt;div id=\"divOutputAlign10\" style=\"text-align: left\" class=\"section3\"&gt;&lt;/div&gt;&lt;div id=\"divOutputAlign11\" style=\"text-align: left\" class=\"\"&gt;&lt;/div&gt;&lt;div id=\"divOutputAlign12\" style=\"text-align: left\" class=\"section4\"&gt;&lt;span style=\"font-family:Georgia, serif;color:Black;font-size:12pt;\"&gt;&lt;/span&gt;&lt;br&gt;&lt;span style=\"font-family:Georgia, serif;color:Black;font-size:12pt;\"&gt;&amp;gt; save&lt;/span&gt;&lt;br&gt;&lt;/div&gt;]]&gt;&lt;/html&gt;\n  &lt;/output&gt;\n</code></pre>\n<p>When I enter a command, the <code>divOutputAlign</code> numbering system is broken.  Everything from here on out is <code>divOutputAlignNaN</code>, which breaks <code>ShowMenu</code>.</p>\n<p>This was discussed here:</p>\n<p>http://textadventures.co.uk/forum/quest/topic/6j-wzgnus0urepk6bksura/what-can-break-displaying-menus#cebf0fcd-9060-4e6d-a714-03e33549d05e</p>\n<p>That <strong><em>does</em></strong>  fix the problem with <code>ShowMenu</code>, but it seems to cause other problems.</p>\n<hr>\n<p>I opened my saved game and added my 'fix' to this game:</p>\n<pre><code>    &lt;inituserinterface type=\"script\"&gt;\n\t  JS.getDivCount ()\n    &lt;/inituserinterface&gt;\n</code></pre>\n<p>Now my first move after loading the saved game is labeled <code>divOutputAlign1</code>!</p>\n<p>Ruh-roh, Raggy!!!</p>\n<p>What will happen once <code>divOutputAlign</code> rolls back up to an ID that's in the game already, you ask?</p>\n<p>Well...  The text in the FIRST instance of that ID will be displayed, of course!!!</p>\n<p>The funny thing is that it replaced <code>divOutputAlign10</code> and <code>divOutputAlign11</code> with the NEW text, but it seems to get 'stuck' at the current one, which is <code>divOutputAlign12</code>.  So, it prints the new <code>divOutputAlign11</code> above the old <code>divOutputAlign12</code>:</p>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31572933-7b2e9e0c-b076-11e7-8565-c9afcbdae794.png)\n</details>\n<hr>\n<p>If you are changing rooms when this happens, it can be quite confusing.</p>\n<p>I'm sure either:</p>\n<ul>\n<li>JS can be used to find the strings containing <code>divOutputAlign</code> in the saved game file, then set the highest number as the new <code>divOutputAlign</code>, hence fixing everything.</li>\n</ul>\n<p>OR</p>\n<ul>\n<li>We can set up an attribute in Quest that multiplies <code>game.currentturnoutputsection</code> by something to make sure the latest <code>divOutputAlign</code> has a number higher than the last one.</li>\n</ul>\n<hr>\n<p>Like I say, this has been driving me crazy.</p>\n<p>I've been working on it for about 24 hours now.  (With little forum breaks in between, of course!)</p>\n<p>22 of those hours were spent trying to find what I'd done in one of my scripts that kept my room description from changing after loading a saved game.  Then, I noticed it didn't matter if I switched rooms.  It did it on the same turn number after loading the game every time.</p>\n<p>That's when I remembered the <code>ShowMenu</code> thing and got to the point I am now at:  right where I started.</p>\n<hr>\n<p>Here are the JS functions from <strong>playercore.js</strong> that are related to this:</p>\n<details><summary> code </summary>\n```\nfunction createNewDiv(alignment) {\n    var classes = _outputSections.join(\" \");\n    setDivCount(getDivCount() + 1);\n    $(\"<div>\", {\n        id: \"divOutputAlign\" + getDivCount(),\n        style: \"text-align: \" + alignment,\n        \"class\": classes\n    }).appendTo(\"#divOutput\");\n    setCurrentDiv(\"#divOutputAlign\" + getDivCount());\n}\n<p>var _currentDiv = null;</p>\n<p>function getCurrentDiv() {<br>\nif (_currentDiv) return _currentDiv;</p>\n<pre><code>var divId = $(\"#outputData\").attr(\"data-currentdiv\");\nif (divId) {\n    _currentDiv = $(divId);\n    return _currentDiv;\n}\n\nreturn null;\n</code></pre>\n<p>}</p>\n<p>function setCurrentDiv(div) {<br>\n_currentDiv = $(div);<br>\n$(\"#outputData\").attr(\"data-currentdiv\", div);<br>\n}</p>\n<p>var _divCount = -1;</p>\n<p>function getDivCount() {<br>\nif (_divCount == -1) {<br>\n_divCount = parseInt($(\"#outputData\").attr(\"data-divcount\"));<br>\n}<br>\nreturn _divCount;<br>\n}</p>\n<p>function setDivCount(count) {<br>\n_divCount = count;<br>\n$(\"#outputData\").attr(\"data-divcount\", _divCount);<br>\n}</p>\n<pre><code>&lt;/details&gt;\n</code></pre>\n\n</div></details>",
      "PostDate": "2017-10-14T05:38:32.6319717Z",
      "LastEditDate": "2017-10-15T14:57:57.6908077Z",
      "link": null
    },
    {
      "PostId": "039786de-db1b-4325-b3c4-6aadd7e9722f",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "So, I went with option B, and it seems to work.\r\n\r\nI added this to **Before entering room for the first time** on the first room:\r\n\r\n```\r\n  game.inituserinterface => {\r\n    JS.setDivCount (ToInt(game.lastoutputbeforesave) * 3)\r\n  }\r\n```\r\n\r\n---\r\nI added this to the save script:\r\n\r\n```\r\ngame.lastoutputbeforesave = game.currentturnoutputsection\r\nxlist = Split(game.lastoutputbeforesave, \"n\")\r\ngame.lastoutputbeforesave = ListItem(xlist,1)\r\n//===================================\r\n// Everything before this was added \r\n// by KV to fix the loaded saved game \r\n// divOutputAlign issue.\r\n// ===================================\r\n//\r\nrequest (RequestSave, \"\")\r\n```\r\n\r\n---\r\n# FIXED.\r\n\r\n### ...but it's dirty.\r\n\r\nAnyone have a clean solution?  Perhaps some way to alter a JS function and do it properly?",
      "EditableFormat": "markdown",
      "HTML": "<p>So, I went with option B, and it seems to work.</p>\n<p>I added this to <strong>Before entering room for the first time</strong> on the first room:</p>\n<pre><code>  game.inituserinterface =&gt; {\n    JS.setDivCount (ToInt(game.lastoutputbeforesave) * 3)\n  }\n</code></pre>\n<hr>\n<p>I added this to the save script:</p>\n<pre><code>game.lastoutputbeforesave = game.currentturnoutputsection\nxlist = Split(game.lastoutputbeforesave, \"n\")\ngame.lastoutputbeforesave = ListItem(xlist,1)\n//===================================\n// Everything before this was added \n// by KV to fix the loaded saved game \n// divOutputAlign issue.\n// ===================================\n//\nrequest (RequestSave, \"\")\n</code></pre>\n<hr>\n<h1>FIXED.</h1>\n<h3>...but it's dirty.</h3>\n<p>Anyone have a clean solution?  Perhaps some way to alter a JS function and do it properly?</p>\n\n",
      "PostDate": "2017-10-14T06:04:03.3367368Z",
      "LastEditDate": "2017-10-14T06:12:15.1608065Z",
      "link": null
    },
    {
      "PostId": "54e067d4-163b-4fe1-a801-dad674b80239",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "The value is stored as an attribute of an HTML element on the page, so you should be able to get it like this (in JS):\r\n\r\n```\r\nvar divId = $(\"#outputData\").attr(\"data-currentdiv\");\r\n```\r\n\r\nThat said, is the issue that this is wrong?",
      "EditableFormat": "markdown",
      "HTML": "<p>The value is stored as an attribute of an HTML element on the page, so you should be able to get it like this (in JS):</p>\n<pre><code>var divId = $(\"#outputData\").attr(\"data-currentdiv\");\n</code></pre>\n<p>That said, is the issue that this is wrong?</p>\n\n",
      "PostDate": "2017-10-14T07:24:35.0005595Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "57ca3e88-17cf-4957-86f4-5a6348f3668f",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "`$(\"div[id^=divOutputAlign]\").last()`",
      "EditableFormat": "markdown",
      "HTML": "<p><code>$(\"div[id^=divOutputAlign]\").last()</code></p>\n\n",
      "PostDate": "2017-10-14T09:35:53.7341203Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "9c24cd13-e72f-4ccb-a6a2-1db165acc461",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Or a more complete example; haven't tested yet, but I think this should work:\r\n```\r\nsetDivCount($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1);\r\n```\r\n\r\n(Does setDivCount contain the ID of the last div, or of the next one to be inserted? If the former you don't need the +1; but may be worth doing +0 anyway to force it to cast a string to an int)",
      "EditableFormat": "markdown",
      "HTML": "<p>Or a more complete example; haven't tested yet, but I think this should work:</p>\n<pre><code>setDivCount($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1);\n</code></pre>\n<p>(Does setDivCount contain the ID of the last div, or of the next one to be inserted? If the former you don't need the +1; but may be worth doing +0 anyway to force it to cast a string to an int)</p>\n\n",
      "PostDate": "2017-10-14T09:59:01.1054261Z",
      "LastEditDate": "2017-10-14T10:26:10.88138Z",
      "link": null
    },
    {
      "PostId": "4cbb486a-ceeb-4b8d-a7ee-6bb0502cd163",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Or you could change the way the  is stored so that it gets saved correctly:\r\n```\r\nsetDivCount = function(count) {\r\n  _divCount = count;\r\n    $('<input type=\"hidden\">').attr('name': 'divcount[]').attr('value',_divCount).attr('class','divCountField').appendTo(\"#outputData\");\r\n}\r\n\r\ngetDivCount = function() {\r\n  return $(\".divCountField\").last().attr('value');\r\n}\r\n```\r\n(maybe a little less efficient, though)\r\n\r\n@Pixie:\r\n> The value is stored as an attribute of an HTML element on the page, so you should be able to get it like this (in JS):\r\n\r\nAs far as I can tell, the save game code stores the contents of $(\"#outputData\") … not the outputData div itself (and so the attribute isn't restored when loading a saved game)",
      "EditableFormat": "markdown",
      "HTML": "<p>Or you could change the way the  is stored so that it gets saved correctly:</p>\n<pre><code>setDivCount = function(count) {\n  _divCount = count;\n    $('&lt;input type=\"hidden\"&gt;').attr('name': 'divcount[]').attr('value',_divCount).attr('class','divCountField').appendTo(\"#outputData\");\n}\n\ngetDivCount = function() {\n  return $(\".divCountField\").last().attr('value');\n}\n</code></pre>\n<p>(maybe a little less efficient, though)</p>\n<p>@Pixie:</p>\n<blockquote>\n<p>The value is stored as an attribute of an HTML element on the page, so you should be able to get it like this (in JS):</p>\n</blockquote>\n<p>As far as I can tell, the save game code stores the contents of $(\"#outputData\") … not the outputData div itself (and so the attribute isn't restored when loading a saved game)</p>\n\n",
      "PostDate": "2017-10-14T10:25:11.9788812Z",
      "LastEditDate": "2017-10-14T10:33:35.89431Z",
      "link": null
    },
    {
      "PostId": "e19ab64d-c0fd-408a-9db5-5bf430b7c4de",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "First, I created this JS function:\r\n\r\n```\r\nsetDivCount = function(count) {\r\n  _divCount = count;\r\n    $('<input type=\"hidden\">').attr('name': 'divcount[]').attr('value',_divCount).attr('class','divCountField').appendTo(\"#outputData\");\r\n}\r\n\r\ngetDivCount = function() {\r\n  return $(\".divCountField\").last().attr('value');\r\n}\r\n```\r\n\r\n\r\n---\r\nI get this result:\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31575725-b1287302-b0b2-11e7-8573-4195248d2315.png)\r\n</details>\r\n\r\n---\r\n```setDivCount($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1);```\r\n\r\nThat threw an error, so I ended up with this in my ```inituserinterface```:\r\n\r\n```\r\ngame.inituserinterface => {\r\n  JS.setDivCount($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1);)\r\n}\r\n```\r\n\r\n---\r\n\r\nI get this:\r\n\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31575798-1854edac-b0b4-11e7-9d14-a3cfa2c24069.png)\r\n</details>\r\n\r\n---\r\nNow, notice how it moves the output around when I get back to a ```divAlignOutput``` that already exists:\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31575838-d94e7bae-b0b4-11e7-9076-9edb05b22585.png)\r\n</details>\r\n\r\n---\r\nFor now, I've got it set up just a little differently than what I put in the last post.\r\n\r\nFrom what I've looked at, the ```divOutputAlign``` number is the number of the corresponding section times 2 plus 4.\r\n\r\nSo, this is what I've got right now:\r\n\r\n**Save script (same as above)**\r\n```\r\ngame.lastoutputbeforesave = game.currentturnoutputsection\r\nxlist = Split(game.lastoutputbeforesave, \"n\")\r\ngame.lastoutputbeforesave = ListItem(xlist,1)\r\n//===================================\r\n// Everything before this was added \r\n// by KV to fix the loaded saved game \r\n// divOutputAlign issue.\r\n// ===================================\r\n//\r\nrequest (RequestSave, \"\")\r\n```\r\n\r\n**inituserinterface**\r\n```\r\ngame.inituserinterface => {\r\n  JS.setDivCount ((ToInt(game.lastoutputbeforesave) * 2) + 4)\r\n}\r\n```\r\n\r\nWhich sets it correctly (in this case):\r\n\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31575925-604b348e-b0b6-11e7-8a72-93388245b90e.png)\r\n</details>\r\n\r\n---\r\nI can't see why mrangel's code doesn't work.\r\n\r\nOf course, I can't see why Pixie's doesn't either...\r\n\r\n**\\>The value is stored as an attribute of an HTML element on the page, so you should be able to get it like this (in JS):\r\n\\>\r\n\\>```var divId = $(\"#outputData\").attr(\"data-currentdiv\");```\r\n\\>That said, is the issue that this is wrong?**\r\n\r\nI wish I could provide an intelligent answer to that, Pix.  \r\n\r\nIf I leave everything as it is by default, all of the ```divOutputAlign`` IDs end in ```NaN```.\r\n\r\nIf I call ```getDivCount``` in ```inituserinterface```, It starts them back over from 1, and crazy things happen on screen when a new one overlaps with an old one.  Sometimes the old element with no text aligns with the new element with text, and everything seem to print to the screen correctly.  But when there are two elements with the same ID, I think the browser prints the first one it finds to the screen, rearranging all the rest in order of the ID name.\r\n\r\nI'll set up an example, but it makes the player think he hasn't changed rooms when it happens while exiting a room.\r\n\r\nThis is actually what brought my attention to this fully.  Pertex ran into the room description thing a couple of days ago while lending a helping hand.\r\n\r\n---\r\n\r\nI've been trying to find a JS function that finds every instance of ```divOutputAlign``` in a document.  Then, I think it could work from the position of that string to pick out the last occurrence, remove the searched string from the string, convert that to an integer, and add 1 to that.\r\n\r\nThat looks an awful lot like what mrangel's code should be doing to me.  \r\n\r\nEveryone who has posted code so far is much more knowledgeable in JS than I am, though.  I **just** started getting into it.\r\n\r\n...and I may not be plugging mrangel's code into the right place.  (I think I am, though.  I showed all of my 'work' above.)",
      "EditableFormat": "markdown",
      "HTML": "<p>First, I created this JS function:</p>\n<pre><code>setDivCount = function(count) {\n  _divCount = count;\n    $('&lt;input type=\"hidden\"&gt;').attr('name': 'divcount[]').attr('value',_divCount).attr('class','divCountField').appendTo(\"#outputData\");\n}\n\ngetDivCount = function() {\n  return $(\".divCountField\").last().attr('value');\n}\n</code></pre>\n<hr>\n<p>I get this result:</p>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31575725-b1287302-b0b2-11e7-8573-4195248d2315.png)\n</details>\n<hr>\n<p><code>setDivCount($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1);</code></p>\n<p>That threw an error, so I ended up with this in my <code>inituserinterface</code>:</p>\n<pre><code>game.inituserinterface =&gt; {\n  JS.setDivCount($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1);)\n}\n</code></pre>\n<hr>\n<p>I get this:</p>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31575798-1854edac-b0b4-11e7-9d14-a3cfa2c24069.png)\n</details>\n<hr>\n<p>Now, notice how it moves the output around when I get back to a <code>divAlignOutput</code> that already exists:</p>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31575838-d94e7bae-b0b4-11e7-9076-9edb05b22585.png)\n</details>\n<hr>\n<p>For now, I've got it set up just a little differently than what I put in the last post.</p>\n<p>From what I've looked at, the <code>divOutputAlign</code> number is the number of the corresponding section times 2 plus 4.</p>\n<p>So, this is what I've got right now:</p>\n<p><strong>Save script (same as above)</strong></p>\n<pre><code>game.lastoutputbeforesave = game.currentturnoutputsection\nxlist = Split(game.lastoutputbeforesave, \"n\")\ngame.lastoutputbeforesave = ListItem(xlist,1)\n//===================================\n// Everything before this was added \n// by KV to fix the loaded saved game \n// divOutputAlign issue.\n// ===================================\n//\nrequest (RequestSave, \"\")\n</code></pre>\n<p><strong>inituserinterface</strong></p>\n<pre><code>game.inituserinterface =&gt; {\n  JS.setDivCount ((ToInt(game.lastoutputbeforesave) * 2) + 4)\n}\n</code></pre>\n<p>Which sets it correctly (in this case):</p>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31575925-604b348e-b0b6-11e7-8a72-93388245b90e.png)\n</details>\n<hr>\n<p>I can't see why mrangel's code doesn't work.</p>\n<p>Of course, I can't see why Pixie's doesn't either...</p>\n<p><strong>&gt;The value is stored as an attribute of an HTML element on the page, so you should be able to get it like this (in JS):<br>\n&gt;<br>\n&gt;<code>var divId = $(\"#outputData\").attr(\"data-currentdiv\");</code><br>\n&gt;That said, is the issue that this is wrong?</strong></p>\n<p>I wish I could provide an intelligent answer to that, Pix.</p>\n<p>If I leave everything as it is by default, all of the <code>divOutputAlign`` IDs end in</code>NaN```.</p>\n<p>If I call <code>getDivCount</code> in <code>inituserinterface</code>, It starts them back over from 1, and crazy things happen on screen when a new one overlaps with an old one.  Sometimes the old element with no text aligns with the new element with text, and everything seem to print to the screen correctly.  But when there are two elements with the same ID, I think the browser prints the first one it finds to the screen, rearranging all the rest in order of the ID name.</p>\n<p>I'll set up an example, but it makes the player think he hasn't changed rooms when it happens while exiting a room.</p>\n<p>This is actually what brought my attention to this fully.  Pertex ran into the room description thing a couple of days ago while lending a helping hand.</p>\n<hr>\n<p>I've been trying to find a JS function that finds every instance of <code>divOutputAlign</code> in a document.  Then, I think it could work from the position of that string to pick out the last occurrence, remove the searched string from the string, convert that to an integer, and add 1 to that.</p>\n<p>That looks an awful lot like what mrangel's code should be doing to me.</p>\n<p>Everyone who has posted code so far is much more knowledgeable in JS than I am, though.  I <strong>just</strong> started getting into it.</p>\n<p>...and I may not be plugging mrangel's code into the right place.  (I think I am, though.  I showed all of my 'work' above.)</p>\n\n",
      "PostDate": "2017-10-14T13:36:35.1213495Z",
      "LastEditDate": "2017-10-14T22:42:24.815718Z",
      "link": null
    },
    {
      "PostId": "c2de3cf1-97d0-4cac-bdae-4f738ae9856b",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> If I call getDivCount in inituserinterface, It starts them back over from 1, and crazy things happen on screen when a new one overlaps with an old one. \r\n\r\nI have seen that myself. It happens if you try to print anything from `inituserinterface`presumably because at that point the div count has not been set.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>If I call getDivCount in inituserinterface, It starts them back over from 1, and crazy things happen on screen when a new one overlaps with an old one.</p>\n</blockquote>\n<p>I have seen that myself. It happens if you try to print anything from <code>inituserinterface</code>presumably because at that point the div count has not been set.</p>\n\n",
      "PostDate": "2017-10-14T15:36:28.2290397Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "48887928-7d1e-4351-ab00-584f281477bc",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">I have seen that myself. It happens if you try to print anything from ```inituserinterface``` presumably because at that point the div count has not been set.\r\n\r\nHmm...\r\n\r\nI'm not trying to print anything from ```inituserinterface``` in this one, though.\r\n\r\nWait... I bet you mean the \\<output> from the saved game hasn't loaded that HTML at that point.  It's usually at the very end of my game, so Quest would read it until last; correct?\r\n\r\nIf that's true, something similar to the script I added to the save function may be the best way to keep up with it, only calling the JS function posted by mrangel and saving the variable to a game attribute before saving.  Then using that game attribute pretty much like I did here. \r\n\r\n---\r\nI don't think my method of multiplying the number of the last output section by 2 then adding 4 will always work for everyone, but I'm not sure.\r\n\r\nI'm using the first altered save script I posted, where I just multiply the number of the last output section by 3.  \r\n\r\nThere are gaps in the ```divOutputAlign``` numbering scheme, but nothing overlaps, so it solved the problem in this particular game.  I guess it doesn't matter if they're not sequential, as long as Quest can put them in order.  (The ```divOutputAlign``` elements, I mean.)\r\n\r\n---\r\nI'm going to try to call mrangel's function on save instead of from ```inituserinterface```.  I don't fully understand the whole thing, but I can tell what each little thing does and slowly piece them all together in my old mind.  It looked like it should work to me, and the results not changing any makes sense now.  The HTML elements didn't exist yet when I called that function from ```inituserinterface```.\r\n\r\nIt'll be about an hour before I get back to it, though.  \r\n\r\nI must go deliver a fresh can of Whoop-ass to my 19-year-old first.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I have seen that myself. It happens if you try to print anything from <code>inituserinterface</code> presumably because at that point the div count has not been set.</p>\n</blockquote>\n<p>Hmm...</p>\n<p>I'm not trying to print anything from <code>inituserinterface</code> in this one, though.</p>\n<p>Wait... I bet you mean the &lt;output&gt; from the saved game hasn't loaded that HTML at that point.  It's usually at the very end of my game, so Quest would read it until last; correct?</p>\n<p>If that's true, something similar to the script I added to the save function may be the best way to keep up with it, only calling the JS function posted by mrangel and saving the variable to a game attribute before saving.  Then using that game attribute pretty much like I did here.</p>\n<hr>\n<p>I don't think my method of multiplying the number of the last output section by 2 then adding 4 will always work for everyone, but I'm not sure.</p>\n<p>I'm using the first altered save script I posted, where I just multiply the number of the last output section by 3.</p>\n<p>There are gaps in the <code>divOutputAlign</code> numbering scheme, but nothing overlaps, so it solved the problem in this particular game.  I guess it doesn't matter if they're not sequential, as long as Quest can put them in order.  (The <code>divOutputAlign</code> elements, I mean.)</p>\n<hr>\n<p>I'm going to try to call mrangel's function on save instead of from <code>inituserinterface</code>.  I don't fully understand the whole thing, but I can tell what each little thing does and slowly piece them all together in my old mind.  It looked like it should work to me, and the results not changing any makes sense now.  The HTML elements didn't exist yet when I called that function from <code>inituserinterface</code>.</p>\n<p>It'll be about an hour before I get back to it, though.</p>\n<p>I must go deliver a fresh can of Whoop-ass to my 19-year-old first.</p>\n\n",
      "PostDate": "2017-10-14T16:46:49.7374042Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "7cc0aaf7-cef9-43fd-b4ff-768942e435cc",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I'm trying to understand what happens when a saved game is restored; but I'm not that good with jQuery, and have no experience at all with the language for all the \"hard-coded\" stuff.\r\n\r\nCan someone with the full version of Quest tell me what order these steps occur in?\r\n* Loading playercore.js\r\n* Restoring the saved outputData content\r\n* Running the UI initialisation script\r\n* Running any JS files included in the game\r\n\r\n\r\n@KV\r\n> `setDivCount($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1);`\r\n> That threw an error, so I ended up with this in my `inituserinterface`:\r\n\r\nCan you share the error? My suspicion would be that it's an order of execution issue (this would fail if the previous output contents hasn't yet been restored).\r\nActually, that would also give an error the first time it's run if you're not loading a saved game. Maybe needs to check if `$(\"div[id^=divOutputAlign]\")` actually matches anything first, and setDivCount(1) otherwise.",
      "EditableFormat": "markdown",
      "HTML": "<p>I'm trying to understand what happens when a saved game is restored; but I'm not that good with jQuery, and have no experience at all with the language for all the \"hard-coded\" stuff.</p>\n<p>Can someone with the full version of Quest tell me what order these steps occur in?</p>\n<ul>\n<li>Loading playercore.js</li>\n<li>Restoring the saved outputData content</li>\n<li>Running the UI initialisation script</li>\n<li>Running any JS files included in the game</li>\n</ul>\n<p>@KV</p>\n<blockquote>\n<p><code>setDivCount($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1);</code><br>\nThat threw an error, so I ended up with this in my <code>inituserinterface</code>:</p>\n</blockquote>\n<p>Can you share the error? My suspicion would be that it's an order of execution issue (this would fail if the previous output contents hasn't yet been restored).<br>\nActually, that would also give an error the first time it's run if you're not loading a saved game. Maybe needs to check if <code>$(\"div[id^=divOutputAlign]\")</code> actually matches anything first, and setDivCount(1) otherwise.</p>\n\n",
      "PostDate": "2017-10-14T16:53:05.019572Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "ed96b008-fd7c-4921-8a9d-6d23924191d9",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I think it's like Pixie said, and ```#divOutput``` doesn't exist when ```inituserinterface``` runs.\r\n\r\nIt only did it at the beginning of a new game.  So I set the initialization script to set the initialization script up with that function.\r\n\r\nThat way, the function will run every time the game loads EXCEPT for the very first time, which was the only time it threw that error (which I will go recreate in one second).\r\n\r\n---\r\nWe'll need Pix to verify this, but I'm fairly certain it's:\r\n\r\n- playercore.js\r\n- inituserinterface\r\n- saved output data\r\n\r\nThe JS files included only run when a function is called (I think).\r\n\r\nIf you add a function with the same name as a default function, it acts just like a function you copy from Quest: it overrides it.\r\n\r\nI've got Pixie's new ```ClearMenu``` function as a stand-alone JS file in the game that will be released soon.  Quest calls it instead of the one in playercore.js all on its own.\r\n\r\n---\r\nhttps://github.com/ThePix/quest/wiki/UI-Part-05:-Where-and-When-To-Do-Stuff",
      "EditableFormat": "markdown",
      "HTML": "<p>I think it's like Pixie said, and <code>#divOutput</code> doesn't exist when <code>inituserinterface</code> runs.</p>\n<p>It only did it at the beginning of a new game.  So I set the initialization script to set the initialization script up with that function.</p>\n<p>That way, the function will run every time the game loads EXCEPT for the very first time, which was the only time it threw that error (which I will go recreate in one second).</p>\n<hr>\n<p>We'll need Pix to verify this, but I'm fairly certain it's:</p>\n<ul>\n<li>playercore.js</li>\n<li>inituserinterface</li>\n<li>saved output data</li>\n</ul>\n<p>The JS files included only run when a function is called (I think).</p>\n<p>If you add a function with the same name as a default function, it acts just like a function you copy from Quest: it overrides it.</p>\n<p>I've got Pixie's new <code>ClearMenu</code> function as a stand-alone JS file in the game that will be released soon.  Quest calls it instead of the one in playercore.js all on its own.</p>\n<hr>\n<p>https://github.com/ThePix/quest/wiki/UI-Part-05:-Where-and-When-To-Do-Stuff</p>\n\n",
      "PostDate": "2017-10-14T18:00:35.4443197Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "05296371-7c80-4953-8e00-598538399fc5",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Loading a new game with the function in ```inituserinterface```:\r\n\r\n<details><summary>screenshot</summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578085-d61811ea-b0df-11e7-897f-56d93f6f0a6a.png)\r\n</details>\r\n\r\n---\r\n\r\n<samp>\r\nError running script: Error compiling expression '$(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1': SyntaxError: Unexpected character: $Line: 1, Column: 1Unexpected token \"/\"; expected one of \")\"Line: 1, Column: 73\r\n</samp>\r\n\r\n---\r\nLoading the save (no error):\r\n\r\n<details><summary>screenshot</summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578105-1c5095f6-b0e0-11e7-847c-6add2032fcc6.png)\r\n</details>\r\n\r\n---\r\n\r\n...but...\r\n\r\n\r\nBefore I enter any commands (everything is in order):\r\n\r\n<details><summary>screenshot</summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578119-613fb570-b0e0-11e7-852f-f7a634b56807.png)\r\n</details>\r\n\r\n---\r\n\r\nNow I'm only entering JUMP repeatedly:\r\n\r\n<details><summary>screenshot</summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578141-b0abceb4-b0e0-11e7-97a5-927df147069a.png)\r\n</details>\r\n\r\n---\r\n\r\nSee how there are duplicates showing in the tools menu?\r\n\r\nSee how the order my turns were printed in changed around (I didn't JUMP until after loading the save)?\r\n\r\n---\r\nmrangel,\r\n\r\n<s>Your script is setting it up as 0, I believe.</s>  It was a returning a string.\r\n\r\nIf run this with the default function, it returns ```NaN```, which I believe is JavaScript-ese for Not a Number.\r\n\r\nI'm home now, and I'm wanting to set it up so that your function runs on game save.  I want it to set a game attribute for the value it returns, then call that in ```inituserinterface``` on every load except for the first time you open the game.",
      "EditableFormat": "markdown",
      "HTML": "<p>Loading a new game with the function in <code>inituserinterface</code>:</p>\n<details><summary>screenshot</summary>\n![image](https://user-images.githubusercontent.com/30656341/31578085-d61811ea-b0df-11e7-897f-56d93f6f0a6a.png)\n</details>\n<hr>\n<samp>\nError running script: Error compiling expression '$(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]+1': SyntaxError: Unexpected character: $Line: 1, Column: 1Unexpected token \"/\"; expected one of \")\"Line: 1, Column: 73\n</samp>\n<hr>\n<p>Loading the save (no error):</p>\n<details><summary>screenshot</summary>\n![image](https://user-images.githubusercontent.com/30656341/31578105-1c5095f6-b0e0-11e7-847c-6add2032fcc6.png)\n</details>\n<hr>\n<p>...but...</p>\n<p>Before I enter any commands (everything is in order):</p>\n<details><summary>screenshot</summary>\n![image](https://user-images.githubusercontent.com/30656341/31578119-613fb570-b0e0-11e7-852f-f7a634b56807.png)\n</details>\n<hr>\n<p>Now I'm only entering JUMP repeatedly:</p>\n<details><summary>screenshot</summary>\n![image](https://user-images.githubusercontent.com/30656341/31578141-b0abceb4-b0e0-11e7-97a5-927df147069a.png)\n</details>\n<hr>\n<p>See how there are duplicates showing in the tools menu?</p>\n<p>See how the order my turns were printed in changed around (I didn't JUMP until after loading the save)?</p>\n<hr>\n<p>mrangel,</p>\n<p><s>Your script is setting it up as 0, I believe.</s>  It was a returning a string.</p>\n<p>If run this with the default function, it returns <code>NaN</code>, which I believe is JavaScript-ese for Not a Number.</p>\n<p>I'm home now, and I'm wanting to set it up so that your function runs on game save.  I want it to set a game attribute for the value it returns, then call that in <code>inituserinterface</code> on every load except for the first time you open the game.</p>\n\n",
      "PostDate": "2017-10-14T18:13:56.9749318Z",
      "LastEditDate": "2017-10-14T22:13:45.2898081Z",
      "link": null
    },
    {
      "PostId": "e6a355cc-929e-4156-a0c5-366413002c8c",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I do not know is the simple answer (ETA: this is in response to the post a couple up now!). It is buried somewhere in the C# which I do not have access to at the moment.\r\n\r\nThe page KV linked to is what I found the hard way trying to get Deeper to work, and is a little out of date now. The next version will have JS.addScript which will allow you to add scripts (and CSS) by-passing the whole divCount system, to solve some of the issues, but not what you guys are looking at.\r\n\r\n> As far as I can tell, the save game code stores the contents of $(\"#outputData\") … not the outputData div itself (and so the attribute isn't restored when loading a saved game)\r\n\r\nIt saves the contents of `divOutput`, which has `outputData` as its first element, followed by divOutputAlign1, 2, 3... so it potentially has access to the original valve. I would guess that was why it was put into the HTML, rather than just stored as a JS variable.\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>I do not know is the simple answer (ETA: this is in response to the post a couple up now!). It is buried somewhere in the C# which I do not have access to at the moment.</p>\n<p>The page KV linked to is what I found the hard way trying to get Deeper to work, and is a little out of date now. The next version will have JS.addScript which will allow you to add scripts (and CSS) by-passing the whole divCount system, to solve some of the issues, but not what you guys are looking at.</p>\n<blockquote>\n<p>As far as I can tell, the save game code stores the contents of $(\"#outputData\") … not the outputData div itself (and so the attribute isn't restored when loading a saved game)</p>\n</blockquote>\n<p>It saves the contents of <code>divOutput</code>, which has <code>outputData</code> as its first element, followed by divOutputAlign1, 2, 3... so it potentially has access to the original valve. I would guess that was why it was put into the HTML, rather than just stored as a JS variable.</p>\n\n",
      "PostDate": "2017-10-14T18:37:35.1944443Z",
      "LastEditDate": "2017-10-14T18:38:37.7329761Z",
      "link": null
    },
    {
      "PostId": "c12730a4-9fe9-4e2f-8db2-e5711f05a732",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "From the Quest 5 directory in Windows, I can't find the```saveGame```for the desktop player (**playercore.js** is calling ```saveGame()``` on that line):\r\n\r\n<details><summary>screenshot</summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578283-d1c2985a-b0e3-11e7-99b3-a7e66ccd9294.png)\r\n</details>\r\n\r\n...but here it is in **desktopplayer.js** (from the source code -- it isn't in the **desktopplayer.js** in the main Quest directory after an install):\r\n\r\n```\r\nfunction doSave() {\r\n    UIEvent(\"Save\", $(\"#divOutput\").html());\r\n}\r\n```\r\n\r\n---\r\nIt's a JS function in the online player, though:\r\n\r\n<details><summary>screenshot</summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578297-12bfa1d6-b0e4-11e7-88a4-6d7810e24e1a.png)\r\n</details>\r\n\r\nSee the last two functions here:\r\n\r\nhttps://github.com/textadventures/quest/blob/master/WebPlayer/player.js\r\n\r\n---\r\nAnd here's a link to **playercore.js**:\r\n\r\nhttps://gist.github.com/KVonGit/f0bf86fa9c094e0b71b2f768f6123087#file-playercore-js\r\n\r\n---\r\n\r\nAnd **desktopplayer.js**:\r\n\r\nhttps://gist.github.com/KVonGit/9f355677e1386e43a61ca554f2fb847e#file-desktopplayer-js\r\n\r\n---\r\nThis may help, too:\r\n\r\n\r\nhttps://github.com/textadventures/quest/blob/528ead7b1cc2b3be3c2f8c427d0b67074ba76d12/Prototypes/jsrunner/index.html",
      "EditableFormat": "markdown",
      "HTML": "<p>From the Quest 5 directory in Windows, I can't find the<code>saveGame</code>for the desktop player (<strong>playercore.js</strong> is calling <code>saveGame()</code> on that line):</p>\n<details><summary>screenshot</summary>\n![image](https://user-images.githubusercontent.com/30656341/31578283-d1c2985a-b0e3-11e7-99b3-a7e66ccd9294.png)\n</details>\n<p>...but here it is in <strong>desktopplayer.js</strong> (from the source code -- it isn't in the <strong>desktopplayer.js</strong> in the main Quest directory after an install):</p>\n<pre><code>function doSave() {\n    UIEvent(\"Save\", $(\"#divOutput\").html());\n}\n</code></pre>\n<hr>\n<p>It's a JS function in the online player, though:</p>\n<details><summary>screenshot</summary>\n![image](https://user-images.githubusercontent.com/30656341/31578297-12bfa1d6-b0e4-11e7-88a4-6d7810e24e1a.png)\n</details>\n<p>See the last two functions here:</p>\n<p>https://github.com/textadventures/quest/blob/master/WebPlayer/player.js</p>\n<hr>\n<p>And here's a link to <strong>playercore.js</strong>:</p>\n<p>https://gist.github.com/KVonGit/f0bf86fa9c094e0b71b2f768f6123087#file-playercore-js</p>\n<hr>\n<p>And <strong>desktopplayer.js</strong>:</p>\n<p>https://gist.github.com/KVonGit/9f355677e1386e43a61ca554f2fb847e#file-desktopplayer-js</p>\n<hr>\n<p>This may help, too:</p>\n<p>https://github.com/textadventures/quest/blob/528ead7b1cc2b3be3c2f8c427d0b67074ba76d12/Prototypes/jsrunner/index.html</p>\n\n",
      "PostDate": "2017-10-14T18:59:17.1199445Z",
      "LastEditDate": "2017-10-14T22:11:49.2159942Z",
      "link": null
    },
    {
      "PostId": "14cb0c29-3383-4c85-ae2b-611a9ae81558",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I wasn't paying attention. I thought it was setting attributes on the container.\r\n\r\n> It saves the contents of `divOutput`, which has `outputData` as its first element\r\n\r\n`clearScreen()` deletes the entire contents of divOutput. If you clear the screen immediately before saving, does that mean that outputData isn't recreated and is missing from the saved output? That would explain the original bug that prompted this thread.",
      "EditableFormat": "markdown",
      "HTML": "<p>I wasn't paying attention. I thought it was setting attributes on the container.</p>\n<blockquote>\n<p>It saves the contents of <code>divOutput</code>, which has <code>outputData</code> as its first element</p>\n</blockquote>\n<p><code>clearScreen()</code> deletes the entire contents of divOutput. If you clear the screen immediately before saving, does that mean that outputData isn't recreated and is missing from the saved output? That would explain the original bug that prompted this thread.</p>\n\n",
      "PostDate": "2017-10-14T19:32:10.9253217Z",
      "LastEditDate": "2017-10-14T19:34:01.9331363Z",
      "link": null
    },
    {
      "PostId": "74b7b5e0-61ba-419d-89c2-39f64cf949ce",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Yeah, that looks about right.\r\nSo if I'm following this right, in `clearScreen()` you probably want to create a new `outputData`.\r\n\r\n`$(\"#divOutput\").html(\"\");`\r\ncould be changed to either:\r\n`$(\"#divOutput\").html('<div id=\"outputData\" style=\"display: none;\" />');`\r\nor\r\n`$(\"#outputData\").appendTo($(\"#divOutput\").empty());`\r\n(depending if you want to clearing the screen to reset any other attributes that outputData has)\r\n\r\nand the subsequent calls to `setCurrentDiv` and `setDivCount` will give it some attributes",
      "EditableFormat": "markdown",
      "HTML": "<p>Yeah, that looks about right.<br>\nSo if I'm following this right, in <code>clearScreen()</code> you probably want to create a new <code>outputData</code>.</p>\n<p><code>$(\"#divOutput\").html(\"\");</code><br>\ncould be changed to either:<br>\n<code>$(\"#divOutput\").html('&lt;div id=\"outputData\" style=\"display: none;\" /&gt;');</code><br>\nor<br>\n<code>$(\"#outputData\").appendTo($(\"#divOutput\").empty());</code><br>\n(depending if you want to clearing the screen to reset any other attributes that outputData has)</p>\n<p>and the subsequent calls to <code>setCurrentDiv</code> and <code>setDivCount</code> will give it some attributes</p>\n\n",
      "PostDate": "2017-10-14T19:56:38.4302071Z",
      "LastEditDate": "2017-10-14T20:46:38.9097773Z",
      "link": null
    },
    {
      "PostId": "a4a7102f-29f3-4178-a3c9-c9838ea58481",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> this is in response to the post a couple up now\r\n\r\nSorry about that, Pix!\r\n\r\nI don't know what all mrangel can access without Windows.\r\n\r\nBy the way, when I say \"going/driving me crazy\", it's not in an angry way.  I just really want to figure it out.\r\n\r\n---\r\n\r\nHere is the example game I've been experimenting with:\r\n\r\nhttp://textadventures.co.uk/games/view/q1qahgyn90kw2i2c2dhhta/testing-saves\r\n\r\nIt can't be tested online, though.  A loaded saved game starts with a cleared screen, so there are no existing ```divOutputAlign``` elements until a turn is taken.\r\n\r\n---\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578805-209282b0-b0ee-11e7-9c6c-ca270e522a07.png)\r\n</details>\r\n\r\n---\r\n#### After 4 JUMPs and a NORTH:\r\n\r\n---\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578649-08c331d2-b0eb-11e7-8607-f177f78985f4.png)\r\n</details>\r\n\r\n---\r\n#### When using desktop player:\r\n\r\nIf your last two or three turns didn't output lengthy prose, you can see it switching the order of your commands around if you pay attention, **but** it just looks like you get stuck in the room if the last command or two filled up your screen (and you can't see all the commands since you loaded the saved game).\r\n\r\nAND you can't interact with anything in the room description on the screen, because you're not really in that room.  (This is what Pertex encountered, which made me seriously look at this.)\r\n\r\n It's just a glitch concerning the outputted text. \r\n\r\n I put an object in room3 which can't be taken.  \r\n\r\nThe Places and Objects pane DOES show the children of the room in which you **actually** are, and you can interact with said objects.  (The compass works correctly as well.)\r\n\r\nThe status bar displays your location properly, too.\r\n\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578953-685476be-b0f1-11e7-91b7-cf869c0829b9.png)\r\n</details>\r\n\r\n---\r\n<details><summary> screenshot </summary>\r\n![image](https://user-images.githubusercontent.com/30656341/31578979-ac73eb72-b0f1-11e7-9b93-b658ad16fc53.png)\r\n</details>",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>this is in response to the post a couple up now</p>\n</blockquote>\n<p>Sorry about that, Pix!</p>\n<p>I don't know what all mrangel can access without Windows.</p>\n<p>By the way, when I say \"going/driving me crazy\", it's not in an angry way.  I just really want to figure it out.</p>\n<hr>\n<p>Here is the example game I've been experimenting with:</p>\n<p>http://textadventures.co.uk/games/view/q1qahgyn90kw2i2c2dhhta/testing-saves</p>\n<p>It can't be tested online, though.  A loaded saved game starts with a cleared screen, so there are no existing <code>divOutputAlign</code> elements until a turn is taken.</p>\n<hr>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31578805-209282b0-b0ee-11e7-9c6c-ca270e522a07.png)\n</details>\n<hr>\n<h4>After 4 JUMPs and a NORTH:</h4>\n<hr>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31578649-08c331d2-b0eb-11e7-8607-f177f78985f4.png)\n</details>\n<hr>\n<h4>When using desktop player:</h4>\n<p>If your last two or three turns didn't output lengthy prose, you can see it switching the order of your commands around if you pay attention, <strong>but</strong> it just looks like you get stuck in the room if the last command or two filled up your screen (and you can't see all the commands since you loaded the saved game).</p>\n<p>AND you can't interact with anything in the room description on the screen, because you're not really in that room.  (This is what Pertex encountered, which made me seriously look at this.)</p>\n<p>It's just a glitch concerning the outputted text.</p>\n<p>I put an object in room3 which can't be taken.</p>\n<p>The Places and Objects pane DOES show the children of the room in which you <strong>actually</strong> are, and you can interact with said objects.  (The compass works correctly as well.)</p>\n<p>The status bar displays your location properly, too.</p>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31578953-685476be-b0f1-11e7-91b7-cf869c0829b9.png)\n</details>\n<hr>\n<details><summary> screenshot </summary>\n![image](https://user-images.githubusercontent.com/30656341/31578979-ac73eb72-b0f1-11e7-9b93-b658ad16fc53.png)\n</details>\n\n",
      "PostDate": "2017-10-14T20:10:31.3395724Z",
      "LastEditDate": "2017-10-14T22:39:42.2900767Z",
      "link": null
    },
    {
      "PostId": "3045449d-675a-47f7-a348-39a0c8696ab5",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "KV: I think we may have been typing at the same time. I'm not sure as I can't test it, but I think I found a much, much simpler solution. Just modify clearScreen() so that it doesn't move `outputData` outside of `divOutput`, preventing it from being saved. (see my posts ↑ just before your last one)\r\n\r\nI can look at the code, as I have Quest \"installed\" under WINE; I just can't run it.\r\ngrepping through the *.js files looking for the functions was my first reaction.",
      "EditableFormat": "markdown",
      "HTML": "<p>KV: I think we may have been typing at the same time. I'm not sure as I can't test it, but I think I found a much, much simpler solution. Just modify clearScreen() so that it doesn't move <code>outputData</code> outside of <code>divOutput</code>, preventing it from being saved. (see my posts ↑ just before your last one)</p>\n<p>I can look at the code, as I have Quest \"installed\" under WINE; I just can't run it.<br>\ngrepping through the *.js files looking for the functions was my first reaction.</p>\n\n",
      "PostDate": "2017-10-14T20:16:42.7107457Z",
      "LastEditDate": "2017-10-14T20:17:24.9827004Z",
      "link": null
    },
    {
      "PostId": "92681659-593c-45bf-884f-a0a972bb6f12",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Sorry, mrangel.  It apparently took me about 40 minutes to type that last while experimenting in between.\r\n\r\n...but it's fine in the desktop player after clearing the screen and immediately saving.\r\n\r\n\r\nI clear the screen and saved.  I was at ```divOutputAlign12```.\r\n\r\nI load the save game.\r\n\r\nWhen play begins, I am at ```divOutputAlign12```, just as I should be:\r\n\r\n<details><summary> screenshot </summary>\r\n\r\n![image](https://user-images.githubusercontent.com/30656341/31572825-3af0e180-b074-11e7-8d1a-bf442ff77897.png)\r\n\r\n</details>\r\n\r\n---\r\nThe web player loads a saved game with a cleared screen no matter what.\r\n\r\nAll of the games I've played online, including games that never clear the screen during play, start with a cleared screen.  \r\n\r\n<s>I'm 99% sure Pixie mentioned this being fixed in the next release, but he may have been referring to the status bar...</s> \r\n\r\n**EDIT:** I'm 100% sure Pixie mentioned the status bar thing being fixed in the next release. (Ha-ha!  Whoops!)\r\n\r\nhttp://textadventures.co.uk/forum/quest/topic/qdwn7teux0im1uaryij1jw/while-a-game-is-being-tested#a3fd3237-fe4b-4604-b0e0-39fe93774513)\r\n\r\nEither way, the web player just makes you spend an extra turn if can't remember where you are and whatnot, that's not too big of a thing.  The player has just loaded a saved game at that point, so they're less likely to consider it a bug in the game and stop playing.",
      "EditableFormat": "markdown",
      "HTML": "<p>Sorry, mrangel.  It apparently took me about 40 minutes to type that last while experimenting in between.</p>\n<p>...but it's fine in the desktop player after clearing the screen and immediately saving.</p>\n<p>I clear the screen and saved.  I was at <code>divOutputAlign12</code>.</p>\n<p>I load the save game.</p>\n<p>When play begins, I am at <code>divOutputAlign12</code>, just as I should be:</p>\n<details><summary> screenshot </summary>\n<p><img src=\"https://user-images.githubusercontent.com/30656341/31572825-3af0e180-b074-11e7-8d1a-bf442ff77897.png\" alt=\"image\"></p>\n</details>\n<hr>\n<p>The web player loads a saved game with a cleared screen no matter what.</p>\n<p>All of the games I've played online, including games that never clear the screen during play, start with a cleared screen.</p>\n<p><s>I'm 99% sure Pixie mentioned this being fixed in the next release, but he may have been referring to the status bar...</s></p>\n<p><strong>EDIT:</strong> I'm 100% sure Pixie mentioned the status bar thing being fixed in the next release. (Ha-ha!  Whoops!)</p>\n<p>http://textadventures.co.uk/forum/quest/topic/qdwn7teux0im1uaryij1jw/while-a-game-is-being-tested#a3fd3237-fe4b-4604-b0e0-39fe93774513)</p>\n<p>Either way, the web player just makes you spend an extra turn if can't remember where you are and whatnot, that's not too big of a thing.  The player has just loaded a saved game at that point, so they're less likely to consider it a bug in the game and stop playing.</p>\n\n",
      "PostDate": "2017-10-14T20:17:45.7220058Z",
      "LastEditDate": "2017-10-23T14:00:46.6776696Z",
      "link": null
    },
    {
      "PostId": "323ab91a-e651-4597-8395-b50fbf35d5ab",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> I'm 99% sure Pixie mentioned this being fixed in the next release, but he may have been referring to the status bar...\r\n\r\nIt was the status bar!",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I'm 99% sure Pixie mentioned this being fixed in the next release, but he may have been referring to the status bar...</p>\n</blockquote>\n<p>It was the status bar!</p>\n\n",
      "PostDate": "2017-10-14T21:09:13.7169288Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "4966a2be-c992-4fec-b580-b9b28187acbc",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I think I'd have it if I could figure out how to set ```game.lastDivBeforeSave``` to ```$(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]``` with JS.\r\n\r\nThe ```+ 1``` that used to be on the end of that code added a \"1\" to the end of the string.\r\n\r\nIn this case, it returned \"7\", so the output was \"71\".\r\n\r\n\"7\" was the correct answer, though.  That is, in fact, the number of the last ```divOutputAlign```.\r\n\r\nIf I can set that \"7\" (returned by mrangel's JS function) as a string (or an integer) on ```game.lastDivBeforeSave```, I can put this in ```inituserinterface``` and I bet it will solve this:\r\n\r\n```\r\ngame.inituserinterface => {\r\n    JS.setDivCount (ToInt(game.lastDivBeforeSave))\r\n  }\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>I think I'd have it if I could figure out how to set <code>game.lastDivBeforeSave</code> to <code>$(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]</code> with JS.</p>\n<p>The <code>+ 1</code> that used to be on the end of that code added a \"1\" to the end of the string.</p>\n<p>In this case, it returned \"7\", so the output was \"71\".</p>\n<p>\"7\" was the correct answer, though.  That is, in fact, the number of the last <code>divOutputAlign</code>.</p>\n<p>If I can set that \"7\" (returned by mrangel's JS function) as a string (or an integer) on <code>game.lastDivBeforeSave</code>, I can put this in <code>inituserinterface</code> and I bet it will solve this:</p>\n<pre><code>game.inituserinterface =&gt; {\n    JS.setDivCount (ToInt(game.lastDivBeforeSave))\n  }\n</code></pre>\n\n",
      "PostDate": "2017-10-14T21:39:35.3805382Z",
      "LastEditDate": "2017-10-14T21:40:40.3605752Z",
      "link": null
    },
    {
      "PostId": "2909e2da-ec2d-4ac0-a169-74e958a4bbf9",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "KV: You shouldn't need that. That line of code is a really clunky workaround.\r\n\r\nI'm about 95% sure that if you override `clearScreen` with a version that doesn't delete `outputData`, Quest will be able to save and restore CurrentDiv and DivCount in the way it was intended to, and none of these more complex solutions would be necessary.\r\n\r\nIf you include this in your game:\r\n```\r\nfunction clearScreen() {\r\n    $(\"#divOutput\").css(\"min-height\", 0);\r\n    $(\"#outputData\").appendTo($(\"#divOutput\").empty());\r\n    createNewDiv(\"left\");\r\n    beginningOfCurrentTurnScrollPosition = 0;\r\n    setTimeout(function () {\r\n        $(\"html,body\").scrollTop(0);\r\n    }, 100);\r\n}\r\n```\r\nand don't call `SetDivCount()`, can you find any problematic behaviour?",
      "EditableFormat": "markdown",
      "HTML": "<p>KV: You shouldn't need that. That line of code is a really clunky workaround.</p>\n<p>I'm about 95% sure that if you override <code>clearScreen</code> with a version that doesn't delete <code>outputData</code>, Quest will be able to save and restore CurrentDiv and DivCount in the way it was intended to, and none of these more complex solutions would be necessary.</p>\n<p>If you include this in your game:</p>\n<pre><code>function clearScreen() {\n    $(\"#divOutput\").css(\"min-height\", 0);\n    $(\"#outputData\").appendTo($(\"#divOutput\").empty());\n    createNewDiv(\"left\");\n    beginningOfCurrentTurnScrollPosition = 0;\n    setTimeout(function () {\n        $(\"html,body\").scrollTop(0);\n    }, 100);\n}\n</code></pre>\n<p>and don't call <code>SetDivCount()</code>, can you find any problematic behaviour?</p>\n\n",
      "PostDate": "2017-10-14T22:04:57.7203352Z",
      "LastEditDate": "2017-10-14T22:24:45.9608664Z",
      "link": null
    },
    {
      "PostId": "aca4cd2e-2f59-41d5-a81d-b126b90789c4",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "mrangel,\r\n\r\nWe were posting at the same time on two threads, and I missed that.  (I just happened to be messing with ```ClearScreen``` at the same time as you, I guess.)\r\n\r\nI will do it that way next.\r\n\r\nBut I did figure out how to make it work correctly my way just now.\r\n\r\nThere are quite a few clunky bits, but I'm posting the code here before I mess with it, just for posterity.\r\n\r\n(I shall return with the results after altering ```ClearScreen```.)\r\n\r\n<details><summary>  Click here to see a fix which involves much too much work.  </summary>\r\n\r\n```\r\n<!--Saved by Quest 5.7.6404.15496-->\r\n<asl version=\"550\">\r\n  <include ref=\"English.aslx\" />\r\n  <include ref=\"Core.aslx\" />\r\n  <game name=\"testing saves\">\r\n    <gameid>61ad98f8-d95b-4200-b15a-73db2248901b</gameid>\r\n    <version>1.3</version>\r\n    <firstpublished>2017</firstpublished>\r\n    <feature_advancedscripts />\r\n    <multiplecommands />\r\n    <inituserinterface type=\"script\"><![CDATA[\r\n      game.inituserinterface => {\r\n        SetTimeout (1) {\r\n          JS.setDivCount (toInt(game.lastDivOnSave))\r\n        }\r\n      }\r\n    ]]></inituserinterface>\r\n  </game>\r\n  <command name=\"save\">\r\n    <pattern type=\"string\">^save$</pattern>\r\n    <script>\r\n      request (RequestSave, \"\")\r\n      JS.getDivCountKV ()\r\n    </script>\r\n  </command>\r\n  <object name=\"room\">\r\n    <inherit name=\"editor_room\" />\r\n    <description><![CDATA[This is the first room.<br/><br/>Enter the next room. Then save the game, load it, see what messes up!]]></description>\r\n    <firstenter type=\"script\">\r\n    </firstenter>\r\n    <object name=\"player\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"editor_player\" />\r\n    </object>\r\n    <exit alias=\"north\" to=\"room2\">\r\n      <inherit name=\"northdirection\" />\r\n    </exit>\r\n  </object>\r\n  <object name=\"room2\">\r\n    <inherit name=\"editor_room\" />\r\n    <description type=\"script\"><![CDATA[\r\n      msg (\"Welcome to room2!<br/><br/>The screen has been cleared.<br/><br/>{command:Save} the game, load it, then take the following steps:<br/><br/><br/><pre><code><br/><br/> LOOK 4 times<br/><br/>GO N (or S)<br/><br/></code></pre><br/><br/><hr/><br/>See what messes up?<br/>\")\r\n    ]]></description>\r\n    <enter type=\"script\">\r\n    </enter>\r\n    <beforeenter type=\"script\">\r\n      ClearScreen\r\n    </beforeenter>\r\n    <exit alias=\"south\" to=\"room\">\r\n      <inherit name=\"southdirection\" />\r\n    </exit>\r\n    <exit alias=\"north\" to=\"room3\">\r\n      <inherit name=\"northdirection\" />\r\n    </exit>\r\n  </object>\r\n  <object name=\"room3\">\r\n    <inherit name=\"editor_room\" />\r\n    <description><![CDATA[It's nice in the third room.<br/>]]></description>\r\n    <object name=\"thing\">\r\n      <inherit name=\"editor_object\" />\r\n      <scenery type=\"boolean\">false</scenery>\r\n      <takemsg>This thing is just to show you what's happening here.  You can't take it.</takemsg>\r\n      <alias>thing in room 3</alias>\r\n    </object>\r\n    <exit alias=\"south\" to=\"room2\">\r\n      <inherit name=\"southdirection\" />\r\n    </exit>\r\n  </object>\r\n  <command name=\"clear\">\r\n    <pattern>c;clear</pattern>\r\n    <script>\r\n      request (ClearScreen, \"\")\r\n    </script>\r\n  </command>\r\n  <function name=\"setKV\" parameters=\"div\">\r\n    set (game, \"lastDivOnSave\", div)\r\n  </function>\r\n  <javascript src=\"divToAtt.js\" />\r\n</asl>\r\n```\r\n\r\n**divToAtt.js**\r\n```\r\nfunction getDivCountKV() {\r\n      var divToAtt = parseInt($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]);\r\n      ASLEvent(\"setKV\", divToAtt)\r\n      addText(divToAtt)\r\n}\r\n```\r\n\r\n</details>\r\n\r\n---\r\nPix,\r\n\r\nSorry about putting those words in your mouth in the earlier post.  (I went back and edited that part to avoid confusing anyone.)\r\n\r\n---\r\nAnyone who's reading all of this,\r\n\r\nSorry.  \r\n\r\nWe all go a little mad sometimes, right?",
      "EditableFormat": "markdown",
      "HTML": "<p>mrangel,</p>\n<p>We were posting at the same time on two threads, and I missed that.  (I just happened to be messing with <code>ClearScreen</code> at the same time as you, I guess.)</p>\n<p>I will do it that way next.</p>\n<p>But I did figure out how to make it work correctly my way just now.</p>\n<p>There are quite a few clunky bits, but I'm posting the code here before I mess with it, just for posterity.</p>\n<p>(I shall return with the results after altering <code>ClearScreen</code>.)</p>\n<details><summary>  Click here to see a fix which involves much too much work.  </summary>\n<pre><code>&lt;!--Saved by Quest 5.7.6404.15496--&gt;\n&lt;asl version=\"550\"&gt;\n  &lt;include ref=\"English.aslx\" /&gt;\n  &lt;include ref=\"Core.aslx\" /&gt;\n  &lt;game name=\"testing saves\"&gt;\n    &lt;gameid&gt;61ad98f8-d95b-4200-b15a-73db2248901b&lt;/gameid&gt;\n    &lt;version&gt;1.3&lt;/version&gt;\n    &lt;firstpublished&gt;2017&lt;/firstpublished&gt;\n    &lt;feature_advancedscripts /&gt;\n    &lt;multiplecommands /&gt;\n    &lt;inituserinterface type=\"script\"&gt;&lt;![CDATA[\n      game.inituserinterface =&gt; {\n        SetTimeout (1) {\n          JS.setDivCount (toInt(game.lastDivOnSave))\n        }\n      }\n    ]]&gt;&lt;/inituserinterface&gt;\n  &lt;/game&gt;\n  &lt;command name=\"save\"&gt;\n    &lt;pattern type=\"string\"&gt;^save$&lt;/pattern&gt;\n    &lt;script&gt;\n      request (RequestSave, \"\")\n      JS.getDivCountKV ()\n    &lt;/script&gt;\n  &lt;/command&gt;\n  &lt;object name=\"room\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;description&gt;&lt;![CDATA[This is the first room.&lt;br/&gt;&lt;br/&gt;Enter the next room. Then save the game, load it, see what messes up!]]&gt;&lt;/description&gt;\n    &lt;firstenter type=\"script\"&gt;\n    &lt;/firstenter&gt;\n    &lt;object name=\"player\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"editor_player\" /&gt;\n    &lt;/object&gt;\n    &lt;exit alias=\"north\" to=\"room2\"&gt;\n      &lt;inherit name=\"northdirection\" /&gt;\n    &lt;/exit&gt;\n  &lt;/object&gt;\n  &lt;object name=\"room2\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;description type=\"script\"&gt;&lt;![CDATA[\n      msg (\"Welcome to room2!&lt;br/&gt;&lt;br/&gt;The screen has been cleared.&lt;br/&gt;&lt;br/&gt;{command:Save} the game, load it, then take the following steps:&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;pre&gt;&lt;code&gt;&lt;br/&gt;&lt;br/&gt; LOOK 4 times&lt;br/&gt;&lt;br/&gt;GO N (or S)&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br/&gt;&lt;br/&gt;&lt;hr/&gt;&lt;br/&gt;See what messes up?&lt;br/&gt;\")\n    ]]&gt;&lt;/description&gt;\n    &lt;enter type=\"script\"&gt;\n    &lt;/enter&gt;\n    &lt;beforeenter type=\"script\"&gt;\n      ClearScreen\n    &lt;/beforeenter&gt;\n    &lt;exit alias=\"south\" to=\"room\"&gt;\n      &lt;inherit name=\"southdirection\" /&gt;\n    &lt;/exit&gt;\n    &lt;exit alias=\"north\" to=\"room3\"&gt;\n      &lt;inherit name=\"northdirection\" /&gt;\n    &lt;/exit&gt;\n  &lt;/object&gt;\n  &lt;object name=\"room3\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;description&gt;&lt;![CDATA[It's nice in the third room.&lt;br/&gt;]]&gt;&lt;/description&gt;\n    &lt;object name=\"thing\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;scenery type=\"boolean\"&gt;false&lt;/scenery&gt;\n      &lt;takemsg&gt;This thing is just to show you what's happening here.  You can't take it.&lt;/takemsg&gt;\n      &lt;alias&gt;thing in room 3&lt;/alias&gt;\n    &lt;/object&gt;\n    &lt;exit alias=\"south\" to=\"room2\"&gt;\n      &lt;inherit name=\"southdirection\" /&gt;\n    &lt;/exit&gt;\n  &lt;/object&gt;\n  &lt;command name=\"clear\"&gt;\n    &lt;pattern&gt;c;clear&lt;/pattern&gt;\n    &lt;script&gt;\n      request (ClearScreen, \"\")\n    &lt;/script&gt;\n  &lt;/command&gt;\n  &lt;function name=\"setKV\" parameters=\"div\"&gt;\n    set (game, \"lastDivOnSave\", div)\n  &lt;/function&gt;\n  &lt;javascript src=\"divToAtt.js\" /&gt;\n&lt;/asl&gt;\n</code></pre>\n<p><strong>divToAtt.js</strong></p>\n<pre><code>function getDivCountKV() {\n      var divToAtt = parseInt($(\"#divOutput\").find(\"div[id^=divOutputAlign]\").last().attr(\"id\").match(/[0-9]+/)[0]);\n      ASLEvent(\"setKV\", divToAtt)\n      addText(divToAtt)\n}\n</code></pre>\n</details>\n<hr>\n<p>Pix,</p>\n<p>Sorry about putting those words in your mouth in the earlier post.  (I went back and edited that part to avoid confusing anyone.)</p>\n<hr>\n<p>Anyone who's reading all of this,</p>\n<p>Sorry.</p>\n<p>We all go a little mad sometimes, right?</p>\n\n",
      "PostDate": "2017-10-14T22:35:04.6795192Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "e7da8f8b-7e20-4875-8e0b-64f20a9d3c8f",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">If you include this in your game:\r\n>\r\n>```\r\n>function clearScreen() {\r\n>    $(\"#divOutput\").css(\"min-height\", 0);\r\n>    $(\"#outputData\").appendTo($(\"#divOutput\").empty());\r\n>    createNewDiv(\"left\");\r\n>    beginningOfCurrentTurnScrollPosition = 0;\r\n>    setTimeout(function () {\r\n>        $(\"html,body\").scrollTop(0);\r\n>    }, 100);\r\n>}\r\n>```\r\n>\r\n>and don't call SetDivCount(), can you find any problematic behaviour?\r\n\r\n---\r\nmrangel,\r\n\r\nI really wish I'd have slowed down and read that post!\r\n\r\nIt stripped out everything I added and simply created that JS function.\r\n\r\nIt works perfectly.\r\n\r\nThank you!\r\n\r\n<details><summary> screenshot </summary>\r\n\r\n![image](https://user-images.githubusercontent.com/30656341/31579969-4510d370-b108-11e7-9b45-af54293033ff.png)\r\n\r\n</details>\r\n\r\n---\r\n",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>If you include this in your game:</p>\n<pre><code>function clearScreen() {\n   $(\"#divOutput\").css(\"min-height\", 0);\n   $(\"#outputData\").appendTo($(\"#divOutput\").empty());\n   createNewDiv(\"left\");\n   beginningOfCurrentTurnScrollPosition = 0;\n   setTimeout(function () {\n       $(\"html,body\").scrollTop(0);\n   }, 100);\n}\n</code></pre>\n<p>and don't call SetDivCount(), can you find any problematic behaviour?</p>\n</blockquote>\n<hr>\n<p>mrangel,</p>\n<p>I really wish I'd have slowed down and read that post!</p>\n<p>It stripped out everything I added and simply created that JS function.</p>\n<p>It works perfectly.</p>\n<p>Thank you!</p>\n<details><summary> screenshot </summary>\n<p><img src=\"https://user-images.githubusercontent.com/30656341/31579969-4510d370-b108-11e7-9b45-af54293033ff.png\" alt=\"image\"></p>\n</details>\n<hr>\n\n",
      "PostDate": "2017-10-14T22:54:24.1945651Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1b51d245-abf6-43f1-977d-35a08d0cc805",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Also\r\n\r\n> The web player loads a saved game with a cleared screen no matter what.\r\n\r\n> Either way, the web player just makes you spend an extra turn if can't remember where you are and whatnot, that's not too big of a thing.\r\n\r\nI guess that could be an issue if your game counts turns. Thanks for pointing it out :)\r\nSo if I'm writing something where turn count is relevant, I should include some code in the UI init script to send a recap to the client if it hasn't been done by the system.",
      "EditableFormat": "markdown",
      "HTML": "<p>Also</p>\n<blockquote>\n<p>The web player loads a saved game with a cleared screen no matter what.</p>\n</blockquote>\n<blockquote>\n<p>Either way, the web player just makes you spend an extra turn if can't remember where you are and whatnot, that's not too big of a thing.</p>\n</blockquote>\n<p>I guess that could be an issue if your game counts turns. Thanks for pointing it out :)<br>\nSo if I'm writing something where turn count is relevant, I should include some code in the UI init script to send a recap to the client if it hasn't been done by the system.</p>\n\n",
      "PostDate": "2017-10-14T22:59:50.0483758Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "4df86210-8e33-4470-b7c7-8f4cceb4fc53",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I subtract 2 turns on saving after checking whether the online player is being used.   \r\n\r\nThis is my JS script to check it (the ```webPlayer``` function exists by default):\r\n\r\n```\r\nvar bool = false;\r\nfunction playerCheck() {\r\n  if (webPlayer) {\r\n    //addText(\"<br/>[Game running in Online player.]\");\r\n    bool = true;\r\n    ASLEvent(\"setOnline\", bool);\r\n    //gameFinished();\r\n  }\r\n  else {\r\n    //addText(\"<br/>[Game running in Desktop player.]\");\r\n    bool = false;\r\n    ASLEvent(\"setOnline\", bool);\r\n  }\r\n}\r\n```\r\n\r\n\r\n---\r\nYour idea sounds like a pretty good thing to add, too.",
      "EditableFormat": "markdown",
      "HTML": "<p>I subtract 2 turns on saving after checking whether the online player is being used.</p>\n<p>This is my JS script to check it (the <code>webPlayer</code> function exists by default):</p>\n<pre><code>var bool = false;\nfunction playerCheck() {\n  if (webPlayer) {\n    //addText(\"&lt;br/&gt;[Game running in Online player.]\");\n    bool = true;\n    ASLEvent(\"setOnline\", bool);\n    //gameFinished();\n  }\n  else {\n    //addText(\"&lt;br/&gt;[Game running in Desktop player.]\");\n    bool = false;\n    ASLEvent(\"setOnline\", bool);\n  }\n}\n</code></pre>\n<hr>\n<p>Your idea sounds like a pretty good thing to add, too.</p>\n\n",
      "PostDate": "2017-10-14T23:13:01.8787266Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "53d109c2-2963-4340-a9bb-434af8b1d152",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "wouldn't/couldn't subtracting/adjusting the turns possibly screw up the game (depending on its design, or even possibly regardless of the person's game design) ??\r\n\r\n(I was thinking the same thing too of just subtracting 1... not 2 though --- which I now understand why its 2 and not 1 lol, but then I'm like, no... that can potentially mess up the game, so never posted priorly about jsut subtracting/adjusting the turns)",
      "EditableFormat": "markdown",
      "HTML": "<p>wouldn't/couldn't subtracting/adjusting the turns possibly screw up the game (depending on its design, or even possibly regardless of the person's game design) ??</p>\n<p>(I was thinking the same thing too of just subtracting 1... not 2 though --- which I now understand why its 2 and not 1 lol, but then I'm like, no... that can potentially mess up the game, so never posted priorly about jsut subtracting/adjusting the turns)</p>\n\n",
      "PostDate": "2017-10-15T02:49:05.7188746Z",
      "LastEditDate": "2017-10-15T02:51:38.9818284Z",
      "link": null
    },
    {
      "PostId": "4e0dd07b-9f7b-419e-9947-5df2fb2453f9",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Nah, HK.  It just adjusts the turn count.  If you have a clock, and depending how it's set up, it might make time go backwards too, but that's all I can theorize I at the moment.\r\n\r\nAnd I didn't realize I didn't have ```game.notarealturn = true``` set on ```save``` until this came up.  So I figure it's just as easy to decrease it the turn count by 2.\r\n\r\nNow you've got me wondering about it...\r\n\r\nI'll be back.",
      "EditableFormat": "markdown",
      "HTML": "<p>Nah, HK.  It just adjusts the turn count.  If you have a clock, and depending how it's set up, it might make time go backwards too, but that's all I can theorize I at the moment.</p>\n<p>And I didn't realize I didn't have <code>game.notarealturn = true</code> set on <code>save</code> until this came up.  So I figure it's just as easy to decrease it the turn count by 2.</p>\n<p>Now you've got me wondering about it...</p>\n<p>I'll be back.</p>\n\n",
      "PostDate": "2017-10-15T03:01:02.1383307Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "8f22ca0a-73dc-401a-887d-7f41ab9e91ce",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "what about this save/load stuff/JS/etc stuff that has me seeing stars... lol (I tried, I tried, to read and understand this thread... but... NOPE... don't understand it at all, lol)\r\n\r\nwould messing with the turns, mess up the (future) saves and loads ??? maybe some funky stuff might happen ?? saving the same content twice, or whatever, loading at an unexpected spot, etc etc etc",
      "EditableFormat": "markdown",
      "HTML": "<p>what about this save/load stuff/JS/etc stuff that has me seeing stars... lol (I tried, I tried, to read and understand this thread... but... NOPE... don't understand it at all, lol)</p>\n<p>would messing with the turns, mess up the (future) saves and loads ??? maybe some funky stuff might happen ?? saving the same content twice, or whatever, loading at an unexpected spot, etc etc etc</p>\n\n",
      "PostDate": "2017-10-15T03:11:49.8770764Z",
      "LastEditDate": "2017-10-15T03:14:05.3486151Z",
      "link": null
    },
    {
      "PostId": "733b0eac-5fb0-4639-a895-51e8d7f1ffb8",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "The turn count is just an attribute we have to set up.  It isn't built-in.   Quest doesn't care about it at all.\r\n\r\nI had it subtracting 2 on save, but only when playing online, where you start a saved game with nothing on your screen but a command prompt.  You'll probably have to look, which takes 1 turn you wouldn't have wasted, and saving was counting as a turn because I hadn't set the script on it to discount it.\r\n\r\n---\r\nI did go test it out, though, HK.  There were no problems, even when I saved on the first turn and the turn count was negative when I loaded the saved game.\r\n\r\nHere's the little game I made to test it:\r\n\r\n<details><summary> code </summary>\r\n\r\n```\r\n<!--Saved by Quest 5.7.6404.15496-->\r\n<asl version=\"550\">\r\n  <include ref=\"English.aslx\" />\r\n  <include ref=\"Core.aslx\" />\r\n  <game name=\"turns\">\r\n    <gameid>c1aae2ba-8a34-4cd9-a4a7-8aa79fdc5efa</gameid>\r\n    <version>1.0</version>\r\n    <firstpublished>2017</firstpublished>\r\n    <turns type=\"int\">0</turns>\r\n    <notarealturn type=\"boolean\">false</notarealturn>\r\n    <statusattributes type=\"stringdictionary\">\r\n      <item>\r\n        <key>turns</key>\r\n        <value></value>\r\n      </item>\r\n    </statusattributes>\r\n  </game>\r\n  <command name=\"save\">\r\n    <pattern type=\"string\">^save$</pattern>\r\n    <script>\r\n      game.notarealturn = true\r\n      request (RequestSave, \"\")\r\n    </script>\r\n  </command>\r\n  <object name=\"room\">\r\n    <inherit name=\"editor_room\" />\r\n    <object name=\"player\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"editor_player\" />\r\n    </object>\r\n  </object>\r\n  <turnscript name=\"turnCount\">\r\n    <enabled />\r\n    <script>\r\n      if (not game.notarealturn) {\r\n        game.turns = game.turns + 1\r\n      }\r\n      game.notarealturn = false\r\n    </script>\r\n  </turnscript>\r\n  <javascript src=\"kvAddons.js\" />\r\n</asl>\r\n```\r\n\r\n</details>",
      "EditableFormat": "markdown",
      "HTML": "<p>The turn count is just an attribute we have to set up.  It isn't built-in.   Quest doesn't care about it at all.</p>\n<p>I had it subtracting 2 on save, but only when playing online, where you start a saved game with nothing on your screen but a command prompt.  You'll probably have to look, which takes 1 turn you wouldn't have wasted, and saving was counting as a turn because I hadn't set the script on it to discount it.</p>\n<hr>\n<p>I did go test it out, though, HK.  There were no problems, even when I saved on the first turn and the turn count was negative when I loaded the saved game.</p>\n<p>Here's the little game I made to test it:</p>\n<details><summary> code </summary>\n<pre><code>&lt;!--Saved by Quest 5.7.6404.15496--&gt;\n&lt;asl version=\"550\"&gt;\n  &lt;include ref=\"English.aslx\" /&gt;\n  &lt;include ref=\"Core.aslx\" /&gt;\n  &lt;game name=\"turns\"&gt;\n    &lt;gameid&gt;c1aae2ba-8a34-4cd9-a4a7-8aa79fdc5efa&lt;/gameid&gt;\n    &lt;version&gt;1.0&lt;/version&gt;\n    &lt;firstpublished&gt;2017&lt;/firstpublished&gt;\n    &lt;turns type=\"int\"&gt;0&lt;/turns&gt;\n    &lt;notarealturn type=\"boolean\"&gt;false&lt;/notarealturn&gt;\n    &lt;statusattributes type=\"stringdictionary\"&gt;\n      &lt;item&gt;\n        &lt;key&gt;turns&lt;/key&gt;\n        &lt;value&gt;&lt;/value&gt;\n      &lt;/item&gt;\n    &lt;/statusattributes&gt;\n  &lt;/game&gt;\n  &lt;command name=\"save\"&gt;\n    &lt;pattern type=\"string\"&gt;^save$&lt;/pattern&gt;\n    &lt;script&gt;\n      game.notarealturn = true\n      request (RequestSave, \"\")\n    &lt;/script&gt;\n  &lt;/command&gt;\n  &lt;object name=\"room\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;object name=\"player\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"editor_player\" /&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n  &lt;turnscript name=\"turnCount\"&gt;\n    &lt;enabled /&gt;\n    &lt;script&gt;\n      if (not game.notarealturn) {\n        game.turns = game.turns + 1\n      }\n      game.notarealturn = false\n    &lt;/script&gt;\n  &lt;/turnscript&gt;\n  &lt;javascript src=\"kvAddons.js\" /&gt;\n&lt;/asl&gt;\n</code></pre>\n</details>\n\n",
      "PostDate": "2017-10-15T03:41:39.0863549Z",
      "LastEditDate": "2017-10-15T03:43:09.1115563Z",
      "link": null
    },
    {
      "PostId": "200bfeca-4265-492e-98b7-309f98389cc6",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "that's really cool !!!! (you're really developing/discovering/fixing/solving a lot of really cool stuff and/or issues we've been having, keep it up KV... and then at some point, be patient and try to teach/help me with learning all of this stuff, lol)\r\n\r\ndoes any of this stuff help with the scrolling controls that another thread was asking about (do you now know how to get/control it to scroll to the top, as that's what that other thread's OP user was asking about)",
      "EditableFormat": "markdown",
      "HTML": "<p>that's really cool !!!! (you're really developing/discovering/fixing/solving a lot of really cool stuff and/or issues we've been having, keep it up KV... and then at some point, be patient and try to teach/help me with learning all of this stuff, lol)</p>\n<p>does any of this stuff help with the scrolling controls that another thread was asking about (do you now know how to get/control it to scroll to the top, as that's what that other thread's OP user was asking about)</p>\n\n",
      "PostDate": "2017-10-15T10:18:17.4540794Z",
      "LastEditDate": "2017-10-15T10:19:44.6588622Z",
      "link": null
    },
    {
      "PostId": "70665d46-9a75-4ce3-9dd7-3f65a0959a90",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">does any of this stuff help with the scrolling controls that another thread was asking about (do you now know how to get/control it to scroll to the top, as that's what that other thread's OP user was asking about)\r\n\r\nI think so...\r\n\r\nI ***think***  this might take you to the top of the HTML's \\<body> element:\r\n\r\n\r\n**EDITED (THIS WORKS)**\r\n```\r\nSetTimeout (2) {\r\n  JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")\r\n}\r\n```\r\n\r\nI'll test it and come right back.\r\n\r\n---\r\nUPDATE \r\n\r\nIf you use that in a script, you need a ```SetTimeout``` that is NO LESS THAN 2 SECONDS. Otherwise it immediately scrolls back down to the text input field (you can barely see it happen sometimes).\r\n\r\n\r\n**EDITED**\r\n```\r\n    <enter type=\"script\">\r\n    SetTimeout (2) {\r\n      JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")\r\n    }\r\n    </enter>\r\n```\r\n\r\nThis works.\r\n\r\n<details><summary>  Example game code </summary>\r\n\r\n**EDITED**\r\n```\r\n<!--Saved by Quest 5.7.6404.15496-->\r\n<asl version=\"550\">\r\n  <include ref=\"English.aslx\" />\r\n  <include ref=\"Core.aslx\" />\r\n  <game name=\"Scroll to Top\">\r\n    <gameid>c1aae2ba-8a34-4cd9-a4a7-8aa79fdc5efa</gameid>\r\n    <version>1.1</version>\r\n    <firstpublished>2017</firstpublished>\r\n    <turns type=\"int\">0</turns>\r\n    <notarealturn type=\"boolean\">false</notarealturn>\r\n    <statusattributes type=\"stringdictionary\">\r\n      <item>\r\n        <key>turns</key>\r\n        <value></value>\r\n      </item>\r\n    </statusattributes>\r\n    <commandpane />\r\n    <feature_advancedscripts />\r\n    <inituserinterface type=\"script\">\r\n      JS.setCommands (\"Scroll to top\")\r\n    </inituserinterface>\r\n    <description><![CDATA[Example game.<br/><br/><br/>-----------------------------------------------------------<br/>SetTimeout (2) {<br/>  JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")<br/>}<br/>-----------------------------------------------------------]]></description>\r\n  </game>\r\n  <command name=\"save\">\r\n    <pattern type=\"string\">^save$</pattern>\r\n    <script>\r\n      game.notarealturn = true\r\n      request (RequestSave, \"\")\r\n    </script>\r\n  </command>\r\n  <object name=\"room\">\r\n    <inherit name=\"editor_room\" />\r\n    <description><![CDATA[All work and no play makes Jack a dull boy.  All work and no play makes Jack a dull boy.  All work and no play makes Jack a dull boy.  <br/><br/><br/>All work and no play makes Jack a dull boy.  <br/>All work and no play makes Jack a dull boy.  <br/>All work and no play makes Jack a dull boy.   <br/><br/>   All work and no play makes Jack a dull boy.  <br/><br/>        All work and no play makes Jack a dull boy.  <br/><br/>All work and no play makes Jack a dull boy.  <br/>All work and no play makes Jack a dull boy.  <br/>All work and no play makes Jack a dull boy. All work and no play makes Jack a dull boy.  <br/>All work and no play makes Jack a dull boy.  <br/>All work and no play makes Jack a dull boy.   <br/><br/>   All work and no play makes Jack a dull boy.  <br/><br/>        All work and no play makes Jack a dull boy.  <br/><br/>All work and no play makes Jack a dull boy.  <br/><br/><br/><br/>]]></description>\r\n    <enter type=\"script\">\r\n      SetTimeout (2) {\r\n        JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")\r\n      }\r\n    </enter>\r\n    <object name=\"player\">\r\n      <inherit name=\"editor_object\" />\r\n      <inherit name=\"editor_player\" />\r\n    </object>\r\n  </object>\r\n  <turnscript name=\"turnCount\">\r\n    <enabled />\r\n    <script>\r\n      if (not game.notarealturn) {\r\n        game.turns = game.turns + 1\r\n      }\r\n      game.notarealturn = false\r\n    </script>\r\n  </turnscript>\r\n  <command>\r\n    <pattern>top;scroll up;scroll top;scroll to top</pattern>\r\n    <script>\r\n      SetTimeout (2) {\r\n        JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")\r\n      }\r\n      game.notarealturn = true\r\n    </script>\r\n  </command>\r\n  <javascript src=\"kvAddons.js\" />\r\n</asl>\r\n```\r\n\r\n</details>\r\n\r\nhttp://textadventures.co.uk/games/view/oc4uvldffuo98j0yjajavw/scroll-to-top\r\n\r\n---\r\n### It now works online (in Chrome, Firefox, Internet Explorer, Edge, and Samsung's stock browser on my Galaxy S6).",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>does any of this stuff help with the scrolling controls that another thread was asking about (do you now know how to get/control it to scroll to the top, as that's what that other thread's OP user was asking about)</p>\n</blockquote>\n<p>I think so...</p>\n<p>I <strong><em>think</em></strong>  this might take you to the top of the HTML's &lt;body&gt; element:</p>\n<p><strong>EDITED (THIS WORKS)</strong></p>\n<pre><code>SetTimeout (2) {\n  JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")\n}\n</code></pre>\n<p>I'll test it and come right back.</p>\n<hr>\n<p>UPDATE</p>\n<p>If you use that in a script, you need a <code>SetTimeout</code> that is NO LESS THAN 2 SECONDS. Otherwise it immediately scrolls back down to the text input field (you can barely see it happen sometimes).</p>\n<p><strong>EDITED</strong></p>\n<pre><code>    &lt;enter type=\"script\"&gt;\n    SetTimeout (2) {\n      JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")\n    }\n    &lt;/enter&gt;\n</code></pre>\n<p>This works.</p>\n<details><summary>  Example game code </summary>\n<p><strong>EDITED</strong></p>\n<pre><code>&lt;!--Saved by Quest 5.7.6404.15496--&gt;\n&lt;asl version=\"550\"&gt;\n  &lt;include ref=\"English.aslx\" /&gt;\n  &lt;include ref=\"Core.aslx\" /&gt;\n  &lt;game name=\"Scroll to Top\"&gt;\n    &lt;gameid&gt;c1aae2ba-8a34-4cd9-a4a7-8aa79fdc5efa&lt;/gameid&gt;\n    &lt;version&gt;1.1&lt;/version&gt;\n    &lt;firstpublished&gt;2017&lt;/firstpublished&gt;\n    &lt;turns type=\"int\"&gt;0&lt;/turns&gt;\n    &lt;notarealturn type=\"boolean\"&gt;false&lt;/notarealturn&gt;\n    &lt;statusattributes type=\"stringdictionary\"&gt;\n      &lt;item&gt;\n        &lt;key&gt;turns&lt;/key&gt;\n        &lt;value&gt;&lt;/value&gt;\n      &lt;/item&gt;\n    &lt;/statusattributes&gt;\n    &lt;commandpane /&gt;\n    &lt;feature_advancedscripts /&gt;\n    &lt;inituserinterface type=\"script\"&gt;\n      JS.setCommands (\"Scroll to top\")\n    &lt;/inituserinterface&gt;\n    &lt;description&gt;&lt;![CDATA[Example game.&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;-----------------------------------------------------------&lt;br/&gt;SetTimeout (2) {&lt;br/&gt;  JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")&lt;br/&gt;}&lt;br/&gt;-----------------------------------------------------------]]&gt;&lt;/description&gt;\n  &lt;/game&gt;\n  &lt;command name=\"save\"&gt;\n    &lt;pattern type=\"string\"&gt;^save$&lt;/pattern&gt;\n    &lt;script&gt;\n      game.notarealturn = true\n      request (RequestSave, \"\")\n    &lt;/script&gt;\n  &lt;/command&gt;\n  &lt;object name=\"room\"&gt;\n    &lt;inherit name=\"editor_room\" /&gt;\n    &lt;description&gt;&lt;![CDATA[All work and no play makes Jack a dull boy.  All work and no play makes Jack a dull boy.  All work and no play makes Jack a dull boy.  &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;All work and no play makes Jack a dull boy.  &lt;br/&gt;All work and no play makes Jack a dull boy.  &lt;br/&gt;All work and no play makes Jack a dull boy.   &lt;br/&gt;&lt;br/&gt;   All work and no play makes Jack a dull boy.  &lt;br/&gt;&lt;br/&gt;        All work and no play makes Jack a dull boy.  &lt;br/&gt;&lt;br/&gt;All work and no play makes Jack a dull boy.  &lt;br/&gt;All work and no play makes Jack a dull boy.  &lt;br/&gt;All work and no play makes Jack a dull boy. All work and no play makes Jack a dull boy.  &lt;br/&gt;All work and no play makes Jack a dull boy.  &lt;br/&gt;All work and no play makes Jack a dull boy.   &lt;br/&gt;&lt;br/&gt;   All work and no play makes Jack a dull boy.  &lt;br/&gt;&lt;br/&gt;        All work and no play makes Jack a dull boy.  &lt;br/&gt;&lt;br/&gt;All work and no play makes Jack a dull boy.  &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;]]&gt;&lt;/description&gt;\n    &lt;enter type=\"script\"&gt;\n      SetTimeout (2) {\n        JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")\n      }\n    &lt;/enter&gt;\n    &lt;object name=\"player\"&gt;\n      &lt;inherit name=\"editor_object\" /&gt;\n      &lt;inherit name=\"editor_player\" /&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n  &lt;turnscript name=\"turnCount\"&gt;\n    &lt;enabled /&gt;\n    &lt;script&gt;\n      if (not game.notarealturn) {\n        game.turns = game.turns + 1\n      }\n      game.notarealturn = false\n    &lt;/script&gt;\n  &lt;/turnscript&gt;\n  &lt;command&gt;\n    &lt;pattern&gt;top;scroll up;scroll top;scroll to top&lt;/pattern&gt;\n    &lt;script&gt;\n      SetTimeout (2) {\n        JS.eval (\"$('html, body').stop().animate({scrollTop: 0}, 'slow');\")\n      }\n      game.notarealturn = true\n    &lt;/script&gt;\n  &lt;/command&gt;\n  &lt;javascript src=\"kvAddons.js\" /&gt;\n&lt;/asl&gt;\n</code></pre>\n</details>\n<p>http://textadventures.co.uk/games/view/oc4uvldffuo98j0yjajavw/scroll-to-top</p>\n<hr>\n<h3>It now works online (in Chrome, Firefox, Internet Explorer, Edge, and Samsung's stock browser on my Galaxy S6).</h3>\n\n",
      "PostDate": "2017-10-15T11:48:30.6981318Z",
      "LastEditDate": "2017-10-15T12:55:32.7926515Z",
      "link": null
    },
    {
      "PostId": "9163d9bf-a8df-4d9c-90c4-52babc0a087f",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "http://i.imgur.com/FOIjtApb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">you're really developing/discovering/fixing/solving a lot of really cool stuff and/or issues we've been having, \r\n\r\nI'm just standing on other people's shoulders...\r\n\r\nEspecially Pixie and mrangel (which is who solved my issue here).\r\n\r\nIf it weren't for those two, I'd be clueless about any of this CSS and JS stuff.\r\n\r\n>at some point, be patient and try to teach/help me with learning all of this stuff\r\n\r\nAny time, HK!",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>you're really developing/discovering/fixing/solving a lot of really cool stuff and/or issues we've been having,</p>\n</blockquote>\n<p>I'm just standing on other people's shoulders...</p>\n<p>Especially Pixie and mrangel (which is who solved my issue here).</p>\n<p>If it weren't for those two, I'd be clueless about any of this CSS and JS stuff.</p>\n<blockquote>\n<p>at some point, be patient and try to teach/help me with learning all of this stuff</p>\n</blockquote>\n<p>Any time, HK!</p>\n\n",
      "PostDate": "2017-10-15T12:18:44.2609033Z",
      "LastEditDate": "2017-10-15T13:05:13.1610703Z",
      "link": null
    }
  ]
}
