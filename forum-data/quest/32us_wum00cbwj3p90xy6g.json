{
  "Topic": {
    "TopicId": "32us_wum00cbwj3p90xy6g",
    "ForumId": "10",
    "Title": "First time Quest user - NPCs in Gameplay",
    "LastUpdated": "2020-10-19T21:03:36.7242644Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "aec8aef6-d4d4-40bb-af34-bfc719323ab5",
      "UserId": 511838,
      "Username": "StokeBunnies",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a0207c201b2192ad0de5756c1dd87cf9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi, hoping someone can help.  I have built a simple 20 page maze, using N,S,W,E, and the player moves fine through the maze.  What I'd like to do is have 3 NPCs which are on different pages whenever someone starts the game.  I can see code for moving NPCs around, but can't see how to actually create one.  The plan is that if the player meets one of the NPCs on the same page, the game will end.  Thanks in advance. SB",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi, hoping someone can help.  I have built a simple 20 page maze, using N,S,W,E, and the player moves fine through the maze.  What I'd like to do is have 3 NPCs which are on different pages whenever someone starts the game.  I can see code for moving NPCs around, but can't see how to actually create one.  The plan is that if the player meets one of the NPCs on the same page, the game will end.  Thanks in advance. SB</p>\n\n",
      "PostDate": "2020-10-19T21:03:36.7242644Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "f30ea0c9-4c02-49f3-b6a1-69097b9849d4",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Is this a gamebook, or a text adventure?\r\n\r\nIf it's a text adventure, an NPC is just like any other object.\r\n\r\nIf it's a gamebook (implied by \"pages\", which a text adventure doesn't have), it's going to be harder because the editor only allows you to create pages, not objects. On the other hand, there's nothing to stop you from using a page as an object.\r\n\r\nIf you let us know which type of game you have used, I can go into more detail.",
      "EditableFormat": "markdown",
      "HTML": "<p>Is this a gamebook, or a text adventure?</p>\n<p>If it's a text adventure, an NPC is just like any other object.</p>\n<p>If it's a gamebook (implied by \"pages\", which a text adventure doesn't have), it's going to be harder because the editor only allows you to create pages, not objects. On the other hand, there's nothing to stop you from using a page as an object.</p>\n<p>If you let us know which type of game you have used, I can go into more detail.</p>\n\n",
      "PostDate": "2020-10-19T23:23:11.7565765Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "756adb4e-13e2-4f89-a72b-2b93d756f010",
      "UserId": 511838,
      "Username": "StokeBunnies",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a0207c201b2192ad0de5756c1dd87cf9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi mrangel,\r\nThks for the reply.  Yes, it's a gamebook. I tried with a text adventure first, but couldn't see how to add graphics and audio, which is what I wanted.  I've used Inform7 before, so know how a text adventure works, but liked the additional bells and whistles of the gamebook.\r\nSB",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi mrangel,<br>\nThks for the reply.  Yes, it's a gamebook. I tried with a text adventure first, but couldn't see how to add graphics and audio, which is what I wanted.  I've used Inform7 before, so know how a text adventure works, but liked the additional bells and whistles of the gamebook.<br>\nSB</p>\n\n",
      "PostDate": "2020-10-20T07:37:00.7098705Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "ce629236-cb34-49ab-8fcb-b2058e720acc",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "OK. Gamebook mode is a lot simpler and doesn't have most of Quest's features. But you could still do this. There are a few different ways you could do this; depending on how complex your situation is.\r\n\r\n**Using a game attribute**\r\n\r\nI think the easiest way to handle an NPC who could be in a random location would be making an attribute to track which room the NPC is in.\r\n\r\nOn the first page, you'd include a script something like:\r\n```\r\nlocations = Split(\"page1;page2;page5;page7;page9\")\r\ngame.john_location = GetObject (StringListItem (locations, GetRandomInt (1, ListCount (locations)) -1))\r\n```\r\n\r\nThen in the text of each page you could include something like:\r\n```\r\n{either player.parent = game.john_location:John is lounging on a chair in the corner.}\r\n```\r\n(this works because `player.parent` is the current page in gamebook mode. I think you have to use `either` rather than `if` because the text processor if can't compare two attributes)\r\n\r\nOr if you want to run code (like ending the game) you'd put it in the script section of each page:\r\n```\r\nif (player.parent = game.john_location) {\r\n  msg (\"Ooops! John has caught you. You lose!\")\r\n  finish\r\n}\r\n```\r\n\r\nThis could be bad for some uses, because scripts run before the text of the page is displayed. So if you want to do something like show a message after describing the room, you'd want to put it in a function. You'd create a function named `MeetJohn` which does whatever needs to happen when you meet john, and then at the end of the page you'd put:\r\n``\r\n{either player.parent = game.john_location:{=MeetJohn}}\r\n``\r\n\r\n**Editing the pages**\r\nIf you have a lot of NPCs, or a lot of locations, it might be easier to do this programatically.\r\n\r\nAt the start of the game, you'd have a script like this:\r\n```\r\nlocations = Split(\"page1;page2;page5;page7;page9\")\r\nforeach (npc, Split(\"John;Pete;Steve\")) {\r\n  randompage = GetObject (StringListItem (locations, GetRandomInt (1, ListCount (locations)) -1))\r\n  randompage.description = randompage.description + \"<br/><br/>{=Meet\" + npc + \"}\"\r\n}\r\n```\r\nThat basically picks a random page and adds the code `{=MeetJohn}`, or `{=MeetSteve}` or whatever to the end of its text. You don't need to track where the NPC is, because they're part of the page now. You can put whatever you want into those functions, and it will run after the page displays.\r\n\r\n**Pretend it's a text adventure**\r\n\r\nIf you want to use the NPC tutorials for text adventure mode, you just have to remember that pages and objects are the same thing. So create a page for each NPC, and you can move them around however you want. Some of the functions from text adventure mode might not exist, but you can work around most of them.\r\n\r\nProbably the biggest problem with this would be that the player can't see if there's an NPC in the room. You'd probably want to add a script to make the NPC's description and script display if they're in the current room. For example, in your start script you could put:\r\n```\r\nforeach (page, AllObjects()) {\r\n  if (HasString (page, \"description\")) {\r\n    page.description = page.description + \"{=HandleNPCs}\"\r\n  }\r\n}\r\n```\r\nAnd then create a function `HandleNPCs` with type \"string\", doing something like:\r\n```\r\npage = player.parent\r\nforeach (npc, GetDirectChildObjects (page)) {\r\n  if (not npc = player) {\r\n    if ((GetBoolean (npc, \"runscript\") or GetBoolean(npc, \"runscriptonly\")) and HasScript(npc, \"script\")) {\r\n        do (npc, \"script\")\r\n      }\r\n    }\r\n    // Stop if the player has moved\r\n    if (not page = player.parent) {\r\n      return (\"\")\r\n    }\r\n    if (page = npc.parent and not GetBoolean(npc, \"runscriptonly\")) {\r\n      if (HasString(npc, \"sound\")) {\r\n        if (LengthOf(npc.sound) > 0) {\r\n          play sound (npc.sound, false, false)\r\n          game.continuesound = GetBoolean(npc, \"continuesound\")\r\n        }\r\n      }\r\n \r\n      if (HasString(npc, \"picture\")) {\r\n        if (LengthOf(npc.picture) > 0) {\r\n          picture (npc.picture)\r\n          msg (\"\")\r\n        }\r\n      }\r\n      if (HasString(npc, \"youtube\")) {\r\n        if (LengthOf(npc.youtube) > 0) {\r\n          JS.AddYouTube(npc.youtube)\r\n          msg (\"\")\r\n        }\r\n      }\r\n      msg (npc.description)\r\n      msg (\"\")\r\n    }\r\n  }\r\n}\r\nreturn (\"\")\r\n```\r\nThat's very rough code off the top of my head. But should mean that if you create a \"page\" for an NPC and then move them into any other page, the NPC's script and text (plus sound, youtube, etc) will be displayed after the main text for the page. Unfortunately, doing options in this way isn't quite so easy (because you can't have multiple options sections displayed at the same time)",
      "EditableFormat": "markdown",
      "HTML": "<p>OK. Gamebook mode is a lot simpler and doesn't have most of Quest's features. But you could still do this. There are a few different ways you could do this; depending on how complex your situation is.</p>\n<p><strong>Using a game attribute</strong></p>\n<p>I think the easiest way to handle an NPC who could be in a random location would be making an attribute to track which room the NPC is in.</p>\n<p>On the first page, you'd include a script something like:</p>\n<pre><code>locations = Split(\"page1;page2;page5;page7;page9\")\ngame.john_location = GetObject (StringListItem (locations, GetRandomInt (1, ListCount (locations)) -1))\n</code></pre>\n<p>Then in the text of each page you could include something like:</p>\n<pre><code>{either player.parent = game.john_location:John is lounging on a chair in the corner.}\n</code></pre>\n<p>(this works because <code>player.parent</code> is the current page in gamebook mode. I think you have to use <code>either</code> rather than <code>if</code> because the text processor if can't compare two attributes)</p>\n<p>Or if you want to run code (like ending the game) you'd put it in the script section of each page:</p>\n<pre><code>if (player.parent = game.john_location) {\n  msg (\"Ooops! John has caught you. You lose!\")\n  finish\n}\n</code></pre>\n<p>This could be bad for some uses, because scripts run before the text of the page is displayed. So if you want to do something like show a message after describing the room, you'd want to put it in a function. You'd create a function named <code>MeetJohn</code> which does whatever needs to happen when you meet john, and then at the end of the page you'd put:<br>\n<code>{either player.parent = game.john_location:{=MeetJohn}}</code></p>\n<p><strong>Editing the pages</strong><br>\nIf you have a lot of NPCs, or a lot of locations, it might be easier to do this programatically.</p>\n<p>At the start of the game, you'd have a script like this:</p>\n<pre><code>locations = Split(\"page1;page2;page5;page7;page9\")\nforeach (npc, Split(\"John;Pete;Steve\")) {\n  randompage = GetObject (StringListItem (locations, GetRandomInt (1, ListCount (locations)) -1))\n  randompage.description = randompage.description + \"&lt;br/&gt;&lt;br/&gt;{=Meet\" + npc + \"}\"\n}\n</code></pre>\n<p>That basically picks a random page and adds the code <code>{=MeetJohn}</code>, or <code>{=MeetSteve}</code> or whatever to the end of its text. You don't need to track where the NPC is, because they're part of the page now. You can put whatever you want into those functions, and it will run after the page displays.</p>\n<p><strong>Pretend it's a text adventure</strong></p>\n<p>If you want to use the NPC tutorials for text adventure mode, you just have to remember that pages and objects are the same thing. So create a page for each NPC, and you can move them around however you want. Some of the functions from text adventure mode might not exist, but you can work around most of them.</p>\n<p>Probably the biggest problem with this would be that the player can't see if there's an NPC in the room. You'd probably want to add a script to make the NPC's description and script display if they're in the current room. For example, in your start script you could put:</p>\n<pre><code>foreach (page, AllObjects()) {\n  if (HasString (page, \"description\")) {\n    page.description = page.description + \"{=HandleNPCs}\"\n  }\n}\n</code></pre>\n<p>And then create a function <code>HandleNPCs</code> with type \"string\", doing something like:</p>\n<pre><code>page = player.parent\nforeach (npc, GetDirectChildObjects (page)) {\n  if (not npc = player) {\n    if ((GetBoolean (npc, \"runscript\") or GetBoolean(npc, \"runscriptonly\")) and HasScript(npc, \"script\")) {\n        do (npc, \"script\")\n      }\n    }\n    // Stop if the player has moved\n    if (not page = player.parent) {\n      return (\"\")\n    }\n    if (page = npc.parent and not GetBoolean(npc, \"runscriptonly\")) {\n      if (HasString(npc, \"sound\")) {\n        if (LengthOf(npc.sound) &gt; 0) {\n          play sound (npc.sound, false, false)\n          game.continuesound = GetBoolean(npc, \"continuesound\")\n        }\n      }\n \n      if (HasString(npc, \"picture\")) {\n        if (LengthOf(npc.picture) &gt; 0) {\n          picture (npc.picture)\n          msg (\"\")\n        }\n      }\n      if (HasString(npc, \"youtube\")) {\n        if (LengthOf(npc.youtube) &gt; 0) {\n          JS.AddYouTube(npc.youtube)\n          msg (\"\")\n        }\n      }\n      msg (npc.description)\n      msg (\"\")\n    }\n  }\n}\nreturn (\"\")\n</code></pre>\n<p>That's very rough code off the top of my head. But should mean that if you create a \"page\" for an NPC and then move them into any other page, the NPC's script and text (plus sound, youtube, etc) will be displayed after the main text for the page. Unfortunately, doing options in this way isn't quite so easy (because you can't have multiple options sections displayed at the same time)</p>\n\n",
      "PostDate": "2020-10-20T13:09:12.013676Z",
      "LastEditDate": "2020-10-20T18:38:45.4357419Z",
      "link": null
    },
    {
      "PostId": "844b4464-4869-4b4c-b9ac-76168786bfad",
      "UserId": 511838,
      "Username": "StokeBunnies",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a0207c201b2192ad0de5756c1dd87cf9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi mrangel\r\nThanks for all of that.\r\n I adapted this for my own theme\r\n\r\n```locations = Split(\"f05;f06;f08;f07;f09\")```\r\n```game.Ferdy_location = GetObject (StringListItem (locations, GetRandomInt (1, ListCount (locations)) -1))```\r\n\r\nI put that on the 'game' page, and the game runs OK\r\n\r\nOnce I put this on the pages as above,\r\n\r\n```picture (\"07forest.jpg\")```\r\n```either player.parent = game.Ferdy_location:Ferdy appears from behind a tree.```\r\n```picture (\"eastpath.jpg\")```\r\n```msg (\"East path\")```\r\n```picture (\"southpath.jpg\")```\r\n```msg (\"South path\")```\r\n```picture (\"westpath.jpg\")```\r\n```msg (\"West path\")```\r\n```TextFX_Typewriter (\"You can go east, west or south from here\", 100)```\r\n```GetInput() {```\r\n ```if (result = \"E\" or result = \"e\") {```\r\n``` MovePlayer (f06)```\r\n ```}```\r\n``` if (result = \"S\" or result = \"s\") {```\r\n``` MovePlayer (f01)```\r\n  ```}```\r\n```if (result = \"W\" or result = \"w\") {```\r\n ```MovePlayer (f05)```\r\n  ```}```\r\n```}```\r\n\r\nI get this error\r\n\r\nError running script: Error compiling expression 'game.Ferdy_location:Ferdy appears from behind a tree.': SyntaxError: Unexpected character: :Line: 1, Column: 28\r\n\r\nWhen i tried to use this code\r\n```if (player.parent = game.Ferdy_location) {```\r\n```  msg (\"Ooops! Ferdy has caught you. You lose!\")```\r\n  ```finish```\r\n```}```\r\n\r\nThe entire program crashed with a Quest error which appeared on every page, and is too long for here, but starts\r\n\r\nSystem.Collections.Generic.KeyNotFoundException: The given key was not present in the dictionary.\r\n\r\nHad to close everything and re-open\r\n\r\nKind regards SB",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi mrangel<br>\nThanks for all of that.<br>\nI adapted this for my own theme</p>\n<p><code>locations = Split(\"f05;f06;f08;f07;f09\")</code><br>\n<code>game.Ferdy_location = GetObject (StringListItem (locations, GetRandomInt (1, ListCount (locations)) -1))</code></p>\n<p>I put that on the 'game' page, and the game runs OK</p>\n<p>Once I put this on the pages as above,</p>\n<p><code>picture (\"07forest.jpg\")</code><br>\n<code>either player.parent = game.Ferdy_location:Ferdy appears from behind a tree.</code><br>\n<code>picture (\"eastpath.jpg\")</code><br>\n<code>msg (\"East path\")</code><br>\n<code>picture (\"southpath.jpg\")</code><br>\n<code>msg (\"South path\")</code><br>\n<code>picture (\"westpath.jpg\")</code><br>\n<code>msg (\"West path\")</code><br>\n<code>TextFX_Typewriter (\"You can go east, west or south from here\", 100)</code><br>\n<code>GetInput() {</code><br>\n<code>if (result = \"E\" or result = \"e\") {</code><br>\n<code>MovePlayer (f06)</code><br>\n<code>}</code><br>\n<code>if (result = \"S\" or result = \"s\") {</code><br>\n<code>MovePlayer (f01)</code><br>\n<code>}</code><br>\n<code>if (result = \"W\" or result = \"w\") {</code><br>\n<code>MovePlayer (f05)</code><br>\n<code>}</code><br>\n<code>}</code></p>\n<p>I get this error</p>\n<p>Error running script: Error compiling expression 'game.Ferdy_location:Ferdy appears from behind a tree.': SyntaxError: Unexpected character: :Line: 1, Column: 28</p>\n<p>When i tried to use this code<br>\n<code>if (player.parent = game.Ferdy_location) {</code><br>\n<code>msg (\"Ooops! Ferdy has caught you. You lose!\")</code><br>\n<code>finish</code><br>\n<code>}</code></p>\n<p>The entire program crashed with a Quest error which appeared on every page, and is too long for here, but starts</p>\n<p>System.Collections.Generic.KeyNotFoundException: The given key was not present in the dictionary.</p>\n<p>Had to close everything and re-open</p>\n<p>Kind regards SB</p>\n\n",
      "PostDate": "2020-10-20T17:48:47.8942597Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "95aea5c1-4ed7-49d8-8842-6d224222b822",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "The first time, you seem to have put a text processor directive in a script. Text processor directives like `{either:` are intended to be used in the text of a page, so you don't need to use a script. So if your page is already a script, you should use the script version.\r\n\r\nThat seems a very strange error to appear.\r\nDoes it give the error on every page, or just the ones with the code on?\r\n\r\nKeyNotFoundException doesn't appear often. That's not a Quest error, that's a C# error, and normally indicates that you've found a bug in Quest itself. I can't think of anything that would cause that; and I can't replicate it here. Do you have the game available anywhere so I could take a look?",
      "EditableFormat": "markdown",
      "HTML": "<p>The first time, you seem to have put a text processor directive in a script. Text processor directives like <code>{either:</code> are intended to be used in the text of a page, so you don't need to use a script. So if your page is already a script, you should use the script version.</p>\n<p>That seems a very strange error to appear.<br>\nDoes it give the error on every page, or just the ones with the code on?</p>\n<p>KeyNotFoundException doesn't appear often. That's not a Quest error, that's a C# error, and normally indicates that you've found a bug in Quest itself. I can't think of anything that would cause that; and I can't replicate it here. Do you have the game available anywhere so I could take a look?</p>\n\n",
      "PostDate": "2020-10-20T18:43:40.782891Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1cd836dd-8aa1-4fe0-9e83-2c9de2efdd59",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Ah, it looks to be an odd bug.\r\n\r\nApparently in Gamebook mode you can't use `finish` to display a game over screen. You'll need to display your own message and end the game yourself. For most functions, referencing a function that doesn't exist would generate an error saying no such function. In the particular case of `finish`, it crashes the web editor immediately, and won't allow that page to be viewed or edited.\r\n\r\nAnyway, this could easily be solved by making your own game over. In this case, I assume when the player is caught you no longer want them to be prompted where to go next. The simplest way to do this is probably by using an `else` clause. so your script would look like this:\r\n```\r\npicture (\"07forest.jpg\")\r\nif (this = game.Ferdy_location) {\r\n  msg (\"Ooops! Ferdy has caught you. You lose!\")\r\n}\r\nelse {\r\n  picture (\"eastpath.jpg\")\r\n  msg (\"East path\")\r\n  picture (\"southpath.jpg\")\r\n  msg (\"South path\")\r\n  picture (\"westpath.jpg\")\r\n  msg (\"West path\")\r\n  TextFX_Typewriter (\"You can go east, west or south from here\", 100)\r\n  GetInput() {\r\n    if (result = \"E\" or result = \"e\") {\r\n      MovePlayer (f06)\r\n    }\r\n    if (result = \"S\" or result = \"s\") {\r\n      MovePlayer (f01)\r\n    }\r\n    if (result = \"W\" or result = \"w\") {\r\n      MovePlayer (f05)\r\n    }\r\n  }\r\n}\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>Ah, it looks to be an odd bug.</p>\n<p>Apparently in Gamebook mode you can't use <code>finish</code> to display a game over screen. You'll need to display your own message and end the game yourself. For most functions, referencing a function that doesn't exist would generate an error saying no such function. In the particular case of <code>finish</code>, it crashes the web editor immediately, and won't allow that page to be viewed or edited.</p>\n<p>Anyway, this could easily be solved by making your own game over. In this case, I assume when the player is caught you no longer want them to be prompted where to go next. The simplest way to do this is probably by using an <code>else</code> clause. so your script would look like this:</p>\n<pre><code>picture (\"07forest.jpg\")\nif (this = game.Ferdy_location) {\n  msg (\"Ooops! Ferdy has caught you. You lose!\")\n}\nelse {\n  picture (\"eastpath.jpg\")\n  msg (\"East path\")\n  picture (\"southpath.jpg\")\n  msg (\"South path\")\n  picture (\"westpath.jpg\")\n  msg (\"West path\")\n  TextFX_Typewriter (\"You can go east, west or south from here\", 100)\n  GetInput() {\n    if (result = \"E\" or result = \"e\") {\n      MovePlayer (f06)\n    }\n    if (result = \"S\" or result = \"s\") {\n      MovePlayer (f01)\n    }\n    if (result = \"W\" or result = \"w\") {\n      MovePlayer (f05)\n    }\n  }\n}\n</code></pre>\n\n",
      "PostDate": "2020-10-20T19:00:56.0935268Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "855c34f4-ccf9-44e8-bd42-e005f4f2c9a2",
      "UserId": 511838,
      "Username": "StokeBunnies",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a0207c201b2192ad0de5756c1dd87cf9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi mrangel\r\n\r\nThanks a lot for all your help, it took me a while to sort out, but the game is up and running, and solvers have liked it.\r\n\r\nCheers SB",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi mrangel</p>\n<p>Thanks a lot for all your help, it took me a while to sort out, but the game is up and running, and solvers have liked it.</p>\n<p>Cheers SB</p>\n\n",
      "PostDate": "2020-10-26T09:26:19.9707612Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
