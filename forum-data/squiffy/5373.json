{
  "Topic": {
    "TopicId": "5373",
    "ForumId": "24",
    "Title": "set new variable within IF statement",
    "LastUpdated": "2015-08-13T20:26:39+01:00",
    "ReplyCount": 4
  },
  "Posts": [
    {
      "PostId": "37292",
      "UserId": 0,
      "Username": "qroft",
      "UserAvatar": null,
      "UserGravatar": "2ba5f745816455d5be5e4c8b3ad917ee",
      "EditableText": "Hi there,\ni have a section that starts with\n\n[b:1rnerdjr]\n{if faq1=1:Dan... Dani... Nope damn. I got it! @inc gameScore 1}\n{if faq1=2:Nope! @inc gameScore -1}\n[/b:1rnerdjr]\n\nSo before this section, the player is asked and depending on his choice he gets a point or not.\nMy problem is that the @inc does not work - it is simply shown as text.\nWhere is my error?\n\nBig greetings from this side on earth,\nCarlos",
      "EditableFormat": "bbcode",
      "HTML": "Hi there,<br/>i have a section that starts with<br/><br/><span style=\"font-weight:bold;\"><br/>{if faq1=1:Dan... Dani... Nope damn. I got it! @inc gameScore 1}<br/>{if faq1=2:Nope! @inc gameScore -1}<br/></span><br/><br/>So before this section, the player is asked and depending on his choice he gets a point or not.<br/>My problem is that the @inc does not work - it is simply shown as text.<br/>Where is my error?<br/><br/>Big greetings from this side on earth,<br/>Carlos",
      "PostDate": "2015-07-23T18:19:07+01:00",
      "LastEditDate": null
    },
    {
      "PostId": "37298",
      "UserId": 0,
      "Username": "Alex",
      "UserAvatar": null,
      "UserGravatar": "188b72c5e13327f4fde3989dca7d7d53",
      "EditableText": "You can't set variables within that kind of &quot;if&quot; - those { braces } mean you're using the text processor, and that's just for customising the text that gets displayed.\n\nInstead, you need to use JavaScript. I'm not sure exactly what you're trying to do, so if you could give some examples of the kind of output you're expecting that would help.\n\nHere's an example where there are two answers to a question. One increases the score and other decreases it. Either way the player then progresses to the next section:\n\n[code:16gp4qi8]\n@set score=0\n\nChoose an answer&#58;\n\n&#91;The right answer&#93;(right)\n&#91;The wrong anser&#93;(wrong)\n\n&#91;right&#93;&#58;\n@inc score\n    squiffy&#46;story&#46;go (&quot;next&quot;)\n    \n&#91;wrong&#93;&#58;\n@dec score\n    squiffy&#46;story&#46;go (&quot;next&quot;)\n    \n&#91;&#91;next&#93;&#93;&#58;\nYour score is {score}&#46;\n[/code:16gp4qi8]\n\nTry it out here: <!-- m --><a class=\"postlink\" href=\"http://docs.textadventures.co.uk/squiffy/scratchpad/?gistid=c51bfb0b72b6556824a3&amp;filename=example.squiffy\">http://docs.textadventures.co.uk/squiff ... le.squiffy</a><!-- m -->",
      "EditableFormat": "bbcode",
      "HTML": "You can't set variables within that kind of &quot;if&quot; - those { braces } mean you're using the text processor, and that's just for customising the text that gets displayed.<br/><br/>Instead, you need to use JavaScript. I'm not sure exactly what you're trying to do, so if you could give some examples of the kind of output you're expecting that would help.<br/><br/>Here's an example where there are two answers to a question. One increases the score and other decreases it. Either way the player then progresses to the next section:<br/><br/><pre><code><br/>@set score=0<br/><br/>Choose an answer&#58;<br/><br/>&#91;The right answer&#93;(right)<br/>&#91;The wrong anser&#93;(wrong)<br/><br/>&#91;right&#93;&#58;<br/>@inc score<br/>    squiffy&#46;story&#46;go (&quot;next&quot;)<br/>    <br/>&#91;wrong&#93;&#58;<br/>@dec score<br/>    squiffy&#46;story&#46;go (&quot;next&quot;)<br/>    <br/>&#91;&#91;next&#93;&#93;&#58;<br/>Your score is {score}&#46;<br/></code></pre><br/><br/>Try it out here: <!-- m --><a class=\"postlink\" href=\"http://docs.textadventures.co.uk/squiffy/scratchpad/?gistid=c51bfb0b72b6556824a3&amp;filename=example.squiffy\">http://docs.textadventures.co.uk/squiff ... le.squiffy</a><!-- m -->",
      "PostDate": "2015-07-23T23:06:40+01:00",
      "LastEditDate": null
    },
    {
      "PostId": "37316",
      "UserId": 0,
      "Username": "qroft",
      "UserAvatar": null,
      "UserGravatar": "2ba5f745816455d5be5e4c8b3ad917ee",
      "EditableText": "Thanks a lot Alex. I understand now how it works.\nMy problem is this: i do have in the INDEX.HTML a DIV with the ID &quot;gamescore&quot;.\nWhen i use this var within the squiffy file to show the actual score it works. What i would like to,\nis to pass that var to the index so that it can show the whole time the actual score.\n\nThis is the beginning of my squiffy file:\n\n[code:36ixa8pi]@start sec0\n@set gameScore = 0\n@set huntHealth = 41\n\n&#91;&#91;&#93;&#93;&#58;\n    var huntHealth = squiffy&#46;get(&quot;huntHealth&quot;)\n    var gameScore = squiffy&#46;get(&quot;gameScore&quot;)\n    if(gameScore == null){\n    gameScore = 0;\n    huntHealth = 41;\n    }\n    $('&#46;gameScore')&#46;text(gameScore)\n    $('&#46;huntHealth')&#46;text(huntHealth)[/code:36ixa8pi]\n\nSo whenever you get to a new section, the health and score showing is updated.\n\nIn short: is it possible  that the squiffy file can pass the score variable to my index.html ?",
      "EditableFormat": "bbcode",
      "HTML": "Thanks a lot Alex. I understand now how it works.<br/>My problem is this: i do have in the INDEX.HTML a DIV with the ID &quot;gamescore&quot;.<br/>When i use this var within the squiffy file to show the actual score it works. What i would like to,<br/>is to pass that var to the index so that it can show the whole time the actual score.<br/><br/>This is the beginning of my squiffy file:<br/><br/><pre><code>@start sec0<br/>@set gameScore = 0<br/>@set huntHealth = 41<br/><br/>&#91;&#91;&#93;&#93;&#58;<br/>    var huntHealth = squiffy&#46;get(&quot;huntHealth&quot;)<br/>    var gameScore = squiffy&#46;get(&quot;gameScore&quot;)<br/>    if(gameScore == null){<br/>    gameScore = 0;<br/>    huntHealth = 41;<br/>    }<br/>    $('&#46;gameScore')&#46;text(gameScore)<br/>    $('&#46;huntHealth')&#46;text(huntHealth)</code></pre><br/><br/>So whenever you get to a new section, the health and score showing is updated.<br/><br/>In short: is it possible  that the squiffy file can pass the score variable to my index.html ?",
      "PostDate": "2015-07-24T17:42:06+01:00",
      "LastEditDate": null
    },
    {
      "PostId": "37317",
      "UserId": 0,
      "Username": "qroft",
      "UserAvatar": null,
      "UserGravatar": "2ba5f745816455d5be5e4c8b3ad917ee",
      "EditableText": "[b:22hc30yo]Ok, i just found out one reason why this ain't working![/b:22hc30yo]\n\nFirst the [[]] is fired and then my gameScore increasing.\nThat is absolutely understandable.\n\nNow my idea was to insert some kind of javascript functions at the beginning of the game,\nbut i can not launch them. So on top of the .squiffy file i do have a simple JS function with the id refreshScore to\nlaunch an alert.\n\nIf i now write this code:\n[code:22hc30yo]\n&#91;&#91;theLivingRoom&#93;&#93;&#58;\n@inc gameScore\n    refreshScore();\n[/code:22hc30yo]\nthe game hangs and does neither show the alert nor the next section or whatever.\nWhat i get is: Uncaught ReferenceError: refreshScore is not defined\n\nAny suggestions?",
      "EditableFormat": "bbcode",
      "HTML": "<span style=\"font-weight:bold;\">Ok, i just found out one reason why this ain't working!</span><br/><br/>First the [[]] is fired and then my gameScore increasing.<br/>That is absolutely understandable.<br/><br/>Now my idea was to insert some kind of javascript functions at the beginning of the game,<br/>but i can not launch them. So on top of the .squiffy file i do have a simple JS function with the id refreshScore to<br/>launch an alert.<br/><br/>If i now write this code:<br/><pre><code><br/>&#91;&#91;theLivingRoom&#93;&#93;&#58;<br/>@inc gameScore<br/>    refreshScore();<br/></code></pre><br/>the game hangs and does neither show the alert nor the next section or whatever.<br/>What i get is: Uncaught ReferenceError: refreshScore is not defined<br/><br/>Any suggestions?",
      "PostDate": "2015-07-24T18:11:45+01:00",
      "LastEditDate": null
    },
    {
      "PostId": "37612",
      "UserId": 0,
      "Username": "theomstea",
      "UserAvatar": null,
      "UserGravatar": "8a7f871519fd90a1c481e24b99b5ca2a",
      "EditableText": "Hello,\n\nIt's also bugged me that variables cannot be set/unset in {if} sections.\nWorkarounds can be found most of the time but I think they can pose problem in certain cases.\n\nHere's an example:\n\n[code:12hg3pia]\n@set troll_sleeps\n@set wearing_boots\n    squiffy&#46;story&#46;go(&quot;outside&quot;);\n\n&#91;&#91;outside&#93;&#93;&#58;\n&#91;&#91;enter room&#46;&#93;&#93;(room)\n\n&#91;&#91;room&#93;&#93;&#58;\n{if troll_sleeps&#58;\n  Troll&#58; 'zzz' &lt;br&gt;\n  {if wearing_boots&#58;The troll wakes up&#46;}\n}\n{else&#58;Troll&#58; 'hello'}\n\n\n&#91;&#91;exit room&#93;&#93;(outside)\n[/code:12hg3pia]\n\nSo, we have a troll who's sleeping in a room. Upon entering the room, the troll gets woken up if wearing_boots is true.\nWhat's missing in the previous code is the unsetting of troll_sleeps. Where should we put it?\n\n1) The intuitive choice would be inside {if wearing_boots}:\n[code:12hg3pia]\n{if wearing_boots&#58;\n@unset troll_sleeps\nThe troll wakes up&#46;}\n[/code:12hg3pia]\nbut as Alex explained that's not possible.\n\n2) A workaround would be  to unset troll_sleeps upon exiting the room, i.e.\n[code:12hg3pia]\n  {if wearing_boots&#58;&#91;&#91;exit room&#93;&#93;(outside, not troll_sleeps)}\n  {else&#58;&#91;&#91;exit room&#93;&#93;(outside)}\n[/code:12hg3pia]\nbut that's inelegant for various reasons:\n[list=a:12hg3pia]\n[*:12hg3pia]What we really WANT is the troll waking up upon entering the room, not exting.[/*:m:12hg3pia]\n[*:12hg3pia]If there's several exit links we need to replicate the code.[/*:m:12hg3pia]\n[*:12hg3pia]What if stuff happens in the room, that depends on whether the troll is sleeping?[/*:m:12hg3pia][/list:o:12hg3pia]\nIn that case we need to find another workaround. The only one I see is\n\n3) Add an intermediate section:\n[code:12hg3pia]\n@set troll_sleeps\n@set wearing_boots\n    squiffy&#46;story&#46;go(&quot;outside&quot;);\n\n&#91;&#91;outside&#93;&#93;&#58;\n&#91;&#91;enter room&#46;&#93;&#93;(room)\n\n&#91;&#91;room&#93;&#93;&#58;\n{if troll_sleeps&#58;\n  Troll&#58; 'zzz' &lt;br&gt;\n  {if wearing_boots&#58;The troll wakes up&#46;}\n}\n{else&#58;Troll&#58; 'hello'}\n\n{if wearing_boots&#58;&#91;&#91;continue&#93;&#93;(room2, not troll_sleeps)}\n{else&#58;&#91;&#91;continue&#93;&#93;(room2)}\n\n&#91;&#91;room2&#93;&#93;&#58;\nStuff happens here that depends on troll_sleeps&#46;\n\n&#91;&#91;exit room&#93;&#93;(outside)\n[/code:12hg3pia]\nbut that multiplies the number of sections, i.e. the number of clicks required by the player. \nFrom a player perspective, this is not great (why make me click Continue if that's the only option anyway)\n\nIf I'm not wrong, I think there's no other choice than workaround 3), and I think it all comes down to Squiffy\nnot being able to change the value of an attribute in the middle of a same section:\n[code:12hg3pia]\n&#91;&#91;section&#93;&#93;&#58;\n@set x=1\n{x} should be 1 but is 2\n@set x=2\n{x} is 2\n[/code:12hg3pia]\nI am guessing this is due to the &quot;@&quot; statements being parsed and executed before \nthe text being interpreted. Which is a shame, but I suppose it's voluntary.\n\nI'd like to confirm I'm not missing an obvious/more elegant solution.\nAny thoughts on this?",
      "EditableFormat": "bbcode",
      "HTML": "Hello,<br/><br/>It's also bugged me that variables cannot be set/unset in {if} sections.<br/>Workarounds can be found most of the time but I think they can pose problem in certain cases.<br/><br/>Here's an example:<br/><br/><pre><code><br/>@set troll_sleeps<br/>@set wearing_boots<br/>    squiffy&#46;story&#46;go(&quot;outside&quot;);<br/><br/>&#91;&#91;outside&#93;&#93;&#58;<br/>&#91;&#91;enter room&#46;&#93;&#93;(room)<br/><br/>&#91;&#91;room&#93;&#93;&#58;<br/>{if troll_sleeps&#58;<br/>  Troll&#58; 'zzz' &lt;br&gt;<br/>  {if wearing_boots&#58;The troll wakes up&#46;}<br/>}<br/>{else&#58;Troll&#58; 'hello'}<br/><br/><br/>&#91;&#91;exit room&#93;&#93;(outside)<br/></code></pre><br/><br/>So, we have a troll who's sleeping in a room. Upon entering the room, the troll gets woken up if wearing_boots is true.<br/>What's missing in the previous code is the unsetting of troll_sleeps. Where should we put it?<br/><br/>1) The intuitive choice would be inside {if wearing_boots}:<br/><pre><code><br/>{if wearing_boots&#58;<br/>@unset troll_sleeps<br/>The troll wakes up&#46;}<br/></code></pre><br/>but as Alex explained that's not possible.<br/><br/>2) A workaround would be  to unset troll_sleeps upon exiting the room, i.e.<br/><pre><code><br/>  {if wearing_boots&#58;&#91;&#91;exit room&#93;&#93;(outside, not troll_sleeps)}<br/>  {else&#58;&#91;&#91;exit room&#93;&#93;(outside)}<br/></code></pre><br/>but that's inelegant for various reasons:<br/>[list=a]<br/>[*]What we really WANT is the troll waking up upon entering the room, not exting.[/*:m]<br/>[*]If there's several exit links we need to replicate the code.[/*:m]<br/>[*]What if stuff happens in the room, that depends on whether the troll is sleeping?[/*:m][/list:o]<br/>In that case we need to find another workaround. The only one I see is<br/><br/>3) Add an intermediate section:<br/><pre><code><br/>@set troll_sleeps<br/>@set wearing_boots<br/>    squiffy&#46;story&#46;go(&quot;outside&quot;);<br/><br/>&#91;&#91;outside&#93;&#93;&#58;<br/>&#91;&#91;enter room&#46;&#93;&#93;(room)<br/><br/>&#91;&#91;room&#93;&#93;&#58;<br/>{if troll_sleeps&#58;<br/>  Troll&#58; 'zzz' &lt;br&gt;<br/>  {if wearing_boots&#58;The troll wakes up&#46;}<br/>}<br/>{else&#58;Troll&#58; 'hello'}<br/><br/>{if wearing_boots&#58;&#91;&#91;continue&#93;&#93;(room2, not troll_sleeps)}<br/>{else&#58;&#91;&#91;continue&#93;&#93;(room2)}<br/><br/>&#91;&#91;room2&#93;&#93;&#58;<br/>Stuff happens here that depends on troll_sleeps&#46;<br/><br/>&#91;&#91;exit room&#93;&#93;(outside)<br/></code></pre><br/>but that multiplies the number of sections, i.e. the number of clicks required by the player. <br/>From a player perspective, this is not great (why make me click Continue if that's the only option anyway)<br/><br/>If I'm not wrong, I think there's no other choice than workaround 3), and I think it all comes down to Squiffy<br/>not being able to change the value of an attribute in the middle of a same section:<br/><pre><code><br/>&#91;&#91;section&#93;&#93;&#58;<br/>@set x=1<br/>{x} should be 1 but is 2<br/>@set x=2<br/>{x} is 2<br/></code></pre><br/>I am guessing this is due to the &quot;@&quot; statements being parsed and executed before <br/>the text being interpreted. Which is a shame, but I suppose it's voluntary.<br/><br/>I'd like to confirm I'm not missing an obvious/more elegant solution.<br/>Any thoughts on this?",
      "PostDate": "2015-08-13T20:26:39+01:00",
      "LastEditDate": null
    }
  ]
}
