{
  "Topic": {
    "TopicId": "twsu7sqjoegndwy3_g_qxq",
    "ForumId": "24",
    "Title": "Inventory show/hide",
    "LastUpdated": "2020-08-26T09:47:17.1635362Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "a4b840bb-b33d-4770-9078-f38e44b78e7b",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I have an inventory/notes section in my game keeping track of everything the character has picked up. Currently it just appears as a sidebar within each section, but I'd like to be able to hide it by default and have the panel toggle open/closed or slide in/out on click. I'd normally do it with a bit of javascript, but any script that uses (document).ready doesn't seem to work in Squiffy. Has anyone had any success doing something similar?\r\n\r\n(There's a game called Choice of Zombies listed in the textadventures.co.uk list which has a fantastic slide-in stats/inventory panel, - it's not Squiffy, but I'd love to be able to do that with my inventory!)",
      "EditableFormat": "markdown",
      "HTML": "<p>I have an inventory/notes section in my game keeping track of everything the character has picked up. Currently it just appears as a sidebar within each section, but I'd like to be able to hide it by default and have the panel toggle open/closed or slide in/out on click. I'd normally do it with a bit of javascript, but any script that uses (document).ready doesn't seem to work in Squiffy. Has anyone had any success doing something similar?</p>\n<p>(There's a game called Choice of Zombies listed in the textadventures.co.uk list which has a fantastic slide-in stats/inventory panel, - it's not Squiffy, but I'd love to be able to do that with my inventory!)</p>\n\n",
      "PostDate": "2020-08-26T09:47:17.1635362Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "0758c913-e25e-421a-9a3e-c8babd2584c5",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Do you mean `$(document).ready`? It works fine for me.\r\n\r\nThough all the Squiffy examples I'd seen use `jQuery` instead of `$`, so I had assumed the shorthand option was disabled for some reason. That means I can write shorter code now :)",
      "EditableFormat": "markdown",
      "HTML": "<p>Do you mean <code>$(document).ready</code>? It works fine for me.</p>\n<p>Though all the Squiffy examples I'd seen use <code>jQuery</code> instead of <code>$</code>, so I had assumed the shorthand option was disabled for some reason. That means I can write shorter code now :)</p>\n\n",
      "PostDate": "2020-08-26T11:08:09.2439641Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "7f574284-e0ca-4b58-b839-9c4257173e0b",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hmm, any idea then why the below doesn't work for me in Squiffy? (Button and box appear but the button doesn't toggle the box in and out - lifted from the second example at https://www.tutorialrepublic.com/faq/how-to-create-jquery-slide-left-and-right-toggle-effect.php)\r\n\r\n```$(document).ready(function(){```\r\n```$(\".slide-toggle\").click(function(){```\r\n```$(\".box\").animate({```\r\n```                width: \"toggle\"```\r\n```            });```\r\n```        });```\r\n```    });```\r\n```    });```\r\n\r\n```<button type=\"button\" class=\"slide-toggle\">Slide Toggle</button>```\r\n``` <div class=\"box\" style=\"float:left;overflow:hidden; background: #f0e68c;\">```\r\n``` <div class=\"box-inner\">Lorem ipsum dolor sit amet...</div>```\r\n``` </div>```",
      "EditableFormat": "markdown",
      "HTML": "<p>Hmm, any idea then why the below doesn't work for me in Squiffy? (Button and box appear but the button doesn't toggle the box in and out - lifted from the second example at https://www.tutorialrepublic.com/faq/how-to-create-jquery-slide-left-and-right-toggle-effect.php)</p>\n<p><code>$(document).ready(function(){</code><br>\n<code>$(\".slide-toggle\").click(function(){</code><br>\n<code>$(\".box\").animate({</code><br>\n<code>width: \"toggle\"</code><br>\n<code>});</code><br>\n<code>});</code><br>\n<code>});</code><br>\n<code>});</code></p>\n<p><code>&lt;button type=\"button\" class=\"slide-toggle\"&gt;Slide Toggle&lt;/button&gt;</code><br>\n<code>&lt;div class=\"box\" style=\"float:left;overflow:hidden; background: #f0e68c;\"&gt;</code><br>\n<code>&lt;div class=\"box-inner\"&gt;Lorem ipsum dolor sit amet...&lt;/div&gt;</code><br>\n<code>&lt;/div&gt;</code></p>\n\n",
      "PostDate": "2020-08-26T11:19:05.2634105Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "fa9b33c2-cf46-4478-91b2-1ace54630097",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I assume you mean:\r\n```\r\n    $(document).ready(function(){\r\n      $(\".slide-toggle\").click(function(){\r\n        $(\".box\").animate({\r\n          width: \"toggle\"\r\n        });\r\n      });\r\n    });\r\n\r\n<button type=\"button\" class=\"slide-toggle\">Slide Toggle</button>\r\n<div class=\"box\" style=\"float:left;overflow:hidden; background: #f0e68c;\">\r\n<div class=\"box-inner\">Lorem ipsum dolor sit amet...</div>\r\n</div>\r\n```\r\n\r\nThe issue here is that the JS is being run before the elements have been added to the page. There is no `.slide-toggle` for the event to be attached to. You'll need to bind the event to the document, with a selector, like this:\r\n```\r\n    $(document).ready(function(){\r\n      $(document).on('click', '.slide-toggle', function(){\r\n        $(\".box\").animate({\r\n          width: \"toggle\"\r\n        });\r\n      });\r\n    });\r\n\r\n<button type=\"button\" class=\"slide-toggle\">Slide Toggle</button>\r\n<div class=\"box\" style=\"float:left;overflow:hidden; background: #f0e68c;\">\r\n<div class=\"box-inner\">Lorem ipsum dolor sit amet...</div>\r\n</div>\r\n```\r\n\r\nAlthough I would comment that there is no reason to be using `$(document).ready` here. Squiffy waits for the document to be ready before it even runs your code, so this basically does nothing. It would be just as easy to do:\r\n```\r\n    $(document).on('click', '.slide-toggle', function(){\r\n      $(\".box\").animate({\r\n        width: \"toggle\"\r\n      });\r\n    });\r\n\r\n<button type=\"button\" class=\"slide-toggle\">Slide Toggle</button>\r\n<div class=\"box\" style=\"float:left;overflow:hidden; background: #f0e68c;\">\r\n<div class=\"box-inner\">Lorem ipsum dolor sit amet...</div>\r\n</div>\r\n```\r\n(and now I realise I've done the same thing in some code I posted in another thread, so probably need to change it…)",
      "EditableFormat": "markdown",
      "HTML": "<p>I assume you mean:</p>\n<pre><code>    $(document).ready(function(){\n      $(\".slide-toggle\").click(function(){\n        $(\".box\").animate({\n          width: \"toggle\"\n        });\n      });\n    });\n\n&lt;button type=\"button\" class=\"slide-toggle\"&gt;Slide Toggle&lt;/button&gt;\n&lt;div class=\"box\" style=\"float:left;overflow:hidden; background: #f0e68c;\"&gt;\n&lt;div class=\"box-inner\"&gt;Lorem ipsum dolor sit amet...&lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n<p>The issue here is that the JS is being run before the elements have been added to the page. There is no <code>.slide-toggle</code> for the event to be attached to. You'll need to bind the event to the document, with a selector, like this:</p>\n<pre><code>    $(document).ready(function(){\n      $(document).on('click', '.slide-toggle', function(){\n        $(\".box\").animate({\n          width: \"toggle\"\n        });\n      });\n    });\n\n&lt;button type=\"button\" class=\"slide-toggle\"&gt;Slide Toggle&lt;/button&gt;\n&lt;div class=\"box\" style=\"float:left;overflow:hidden; background: #f0e68c;\"&gt;\n&lt;div class=\"box-inner\"&gt;Lorem ipsum dolor sit amet...&lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n<p>Although I would comment that there is no reason to be using <code>$(document).ready</code> here. Squiffy waits for the document to be ready before it even runs your code, so this basically does nothing. It would be just as easy to do:</p>\n<pre><code>    $(document).on('click', '.slide-toggle', function(){\n      $(\".box\").animate({\n        width: \"toggle\"\n      });\n    });\n\n&lt;button type=\"button\" class=\"slide-toggle\"&gt;Slide Toggle&lt;/button&gt;\n&lt;div class=\"box\" style=\"float:left;overflow:hidden; background: #f0e68c;\"&gt;\n&lt;div class=\"box-inner\"&gt;Lorem ipsum dolor sit amet...&lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n<p>(and now I realise I've done the same thing in some code I posted in another thread, so probably need to change it…)</p>\n\n",
      "PostDate": "2020-08-26T11:39:06.1444542Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "0c7181b9-611e-498c-9a73-882a6918ae4d",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I see - well, by that I mean 'I don't understand jQuery nearly well enough but I can paste your code and it works and I bow to your knowledge' : ))\r\n\r\nNaturally it's thrown up some further questions!\r\n\r\n- I don't seem to be able to put this in a section eg ```[[inventory]]``` and then call it into the relevant passages with ```{inventory}``` - the script doesn't work. It does if I put it in the master section, but there are some sections where I don't want it, and the master section puts it everywhere!\r\n- That leads to my second problem, which is that when I have my div.box in multiple sections all displaying consecutively, the toggle button opens and closes all of them (with some funky repeated opens/closes). Is there a way I can make those buttons target only within their own section, so only the inventory panel of the current section opens/closes?",
      "EditableFormat": "markdown",
      "HTML": "<p>I see - well, by that I mean 'I don't understand jQuery nearly well enough but I can paste your code and it works and I bow to your knowledge' : ))</p>\n<p>Naturally it's thrown up some further questions!</p>\n<ul>\n<li>I don't seem to be able to put this in a section eg <code>[[inventory]]</code> and then call it into the relevant passages with <code>{inventory}</code> - the script doesn't work. It does if I put it in the master section, but there are some sections where I don't want it, and the master section puts it everywhere!</li>\n<li>That leads to my second problem, which is that when I have my div.box in multiple sections all displaying consecutively, the toggle button opens and closes all of them (with some funky repeated opens/closes). Is there a way I can make those buttons target only within their own section, so only the inventory panel of the current section opens/closes?</li>\n</ul>\n\n",
      "PostDate": "2020-08-26T14:34:37.2321672Z",
      "LastEditDate": "2020-08-26T14:35:12.5875737Z",
      "link": null
    },
    {
      "PostId": "e308cc5a-d3b7-4ec5-872b-0ec0ee73e8cc",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Bumping this in case someone has an inventory solution!",
      "EditableFormat": "markdown",
      "HTML": "<p>Bumping this in case someone has an inventory solution!</p>\n\n",
      "PostDate": "2020-08-27T16:01:41.2550563Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "1a94eb8d-0781-492a-b462-a46f0d181710",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Does each section need its own inventory section? I've only seen a box that slides off the side like that in a game where it doesn't move with the text. In which case you'd have a single inventory pane, created at the start of the game, and each section after that just changes its contents.\r\n\r\nNot sure I understand what you're trying to do with it here.",
      "EditableFormat": "markdown",
      "HTML": "<p>Does each section need its own inventory section? I've only seen a box that slides off the side like that in a game where it doesn't move with the text. In which case you'd have a single inventory pane, created at the start of the game, and each section after that just changes its contents.</p>\n<p>Not sure I understand what you're trying to do with it here.</p>\n\n",
      "PostDate": "2020-08-27T19:35:21.5326384Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "fd1eb73d-a8cc-43cd-a23b-47cc6c178de6",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I think that's what I'm trying to achieve - having the inventory pane slideable in and out regardless of what section the user is in - but I couldn't see a way to have just one instance of it updating as the player progresses. \r\n\r\nCurrently I have a sidebar which shows the inventory at all times, called individually in each section with {inventory}. Of course that means the div with the inventory in its appears in each section. But each instance doesn't update itself with later pickups, so I couldn't see a way of having an inventory panel called just once with {inventory} that would stay current.\r\n\r\nI also don't know how to have a user go into their inventory and use, for example, a healing item without losing their place in the main flow of the game! (I can give them the option to use an item, but I'd rather they could use stuff ad hoc.)",
      "EditableFormat": "markdown",
      "HTML": "<p>I think that's what I'm trying to achieve - having the inventory pane slideable in and out regardless of what section the user is in - but I couldn't see a way to have just one instance of it updating as the player progresses.</p>\n<p>Currently I have a sidebar which shows the inventory at all times, called individually in each section with {inventory}. Of course that means the div with the inventory in its appears in each section. But each instance doesn't update itself with later pickups, so I couldn't see a way of having an inventory panel called just once with {inventory} that would stay current.</p>\n<p>I also don't know how to have a user go into their inventory and use, for example, a healing item without losing their place in the main flow of the game! (I can give them the option to use an item, but I'd rather they could use stuff ad hoc.)</p>\n\n",
      "PostDate": "2020-08-27T20:31:56.4037456Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "67716a61-3ba3-4f53-8e2d-4e151edfaf12",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I can do the javascript, but not sure about the Squiffy bits.\r\n\r\nI think in the first section, you'd want to add the HTML. Something like:\r\n```\r\n<button style=\"position: fixed; top: 6px; left: 2px; display: hidden;\" id=\"showinv\" onclick=\"$('#inventorycontainer').animate({left: 2},500);\" type=\"button\">Show inventory</button>\r\n<div class=\"sidebar\" id=\"inventorycontainer\" style=\"background-color: white; position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"><button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\" onclick=\"$('#inventorycontainer').animate({left: -$('#inventorycontainer').width()}, 500);\" type=\"button\">Hide inventory</button></div>\r\n<style>\r\n.inventoryitem {\r\n  display: block;\r\n  border: 1px solid grey;\r\n  left: 2px; right: 2px;\r\n}\r\n</style>\r\n```\r\n\r\nEdit: I omitted the first <code>```</code> so that I could test the JS on the forum preview. What I didn't expect was that it randomly submitted my post. Sorry if that was confusing.\r\n\r\nThen in any section which adds an item to the inventory, you'd do something like:\r\n\r\n```\r\n    setTimeout(function () {\r\n      $('.inventoryitem').last().appendTo('#inventorycontainer').click(function () {\r\n        // This should run the javascript and display the text for a section without actually going there; and then remove this button from the inventory box\r\n        squiffy.story.sections['healingpotion'].js();\r\n        squiffy.ui.write(squiffy.story.sections['healingpotion'].text);\r\n        $(this).remove();\r\n      });\r\n    }, 100);\r\n\r\n<div class=\"inventoryitem\"><a>Healing potion</a></div>\r\n```\r\n\r\nIf you want a section not to have an inventory pane at the side, you do:\r\n```\r\n$('#showinv, #inventorycontainer').hide();\r\n```\r\nand when you want them back again, you do:\r\n```\r\n$('#showinv, #inventorycontainer').show();\r\n```\r\n\r\nDoes that work?",
      "EditableFormat": "markdown",
      "HTML": "<p>I can do the javascript, but not sure about the Squiffy bits.</p>\n<p>I think in the first section, you'd want to add the HTML. Something like:</p>\n<pre><code>&lt;button style=\"position: fixed; top: 6px; left: 2px; display: hidden;\" id=\"showinv\" onclick=\"$('#inventorycontainer').animate({left: 2},500);\" type=\"button\"&gt;Show inventory&lt;/button&gt;\n&lt;div class=\"sidebar\" id=\"inventorycontainer\" style=\"background-color: white; position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"&gt;&lt;button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\" onclick=\"$('#inventorycontainer').animate({left: -$('#inventorycontainer').width()}, 500);\" type=\"button\"&gt;Hide inventory&lt;/button&gt;&lt;/div&gt;\n&lt;style&gt;\n.inventoryitem {\n  display: block;\n  border: 1px solid grey;\n  left: 2px; right: 2px;\n}\n&lt;/style&gt;\n</code></pre>\n<p>Edit: I omitted the first <code>```</code> so that I could test the JS on the forum preview. What I didn't expect was that it randomly submitted my post. Sorry if that was confusing.</p>\n<p>Then in any section which adds an item to the inventory, you'd do something like:</p>\n<pre><code>    setTimeout(function () {\n      $('.inventoryitem').last().appendTo('#inventorycontainer').click(function () {\n        // This should run the javascript and display the text for a section without actually going there; and then remove this button from the inventory box\n        squiffy.story.sections['healingpotion'].js();\n        squiffy.ui.write(squiffy.story.sections['healingpotion'].text);\n        $(this).remove();\n      });\n    }, 100);\n\n&lt;div class=\"inventoryitem\"&gt;&lt;a&gt;Healing potion&lt;/a&gt;&lt;/div&gt;\n</code></pre>\n<p>If you want a section not to have an inventory pane at the side, you do:</p>\n<pre><code>$('#showinv, #inventorycontainer').hide();\n</code></pre>\n<p>and when you want them back again, you do:</p>\n<pre><code>$('#showinv, #inventorycontainer').show();\n</code></pre>\n<p>Does that work?</p>\n\n",
      "PostDate": "2020-08-28T08:53:17.7536376Z",
      "LastEditDate": "2020-08-28T09:29:03.9990408Z",
      "link": null
    },
    {
      "PostId": "6817bb9c-fdfb-433e-b5c9-f21ac3751d90",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I think the forum's maybe garbled it - I bunged it into Squiffy and tried running it - the inventory pane appears but doesn't show/hide.\r\n\r\nThe inventory also doesn't reliably update. If you pick up the potion it shows you have it; however if you drink the poition, it should change your status to 'healthy' and remove the potion from inventory - however it prints Healthy over the top of Unhealthy in the inventory pane, and doesn't remove the potion from inventory. (It does however reflect the correct true/false values in the main pane - just not in the sidebar).\r\n\r\nHere it is running: https://www.dragonchoice.com/inventory/index.html\r\n\r\nAnd the Squiffy markup:\r\n\r\n```@title Inventory test```\r\n\r\n```@set potion = false```\r\n```@set key = false```\r\n```@set health = false```\r\n\r\n```[[start]]```\r\n\r\n```[[]]:```\r\n\r\n```<div class=\"sidebar\" id=\"inventorycontainer\" style=\"position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"><button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\" onclick=\"$('#inventorycontainer').animate({left: 'toggle'}); $('#showinv').show();\" type=\"button\">Hide inventory</button>```\r\n```<p><strong>Inventory</strong></p>```\r\n\r\n```<p>You are {if health=true:healthy}{else: unhealthy}.</p>```\r\n\r\n```{if potion=true:<p>Has potion</p>}```\r\n```{if key=true:<p>Has key</p>}</div>```\r\n\r\n```<button style=\"position: fixed; top: 6px; left: 2px; display: hidden;\" id=\"showinv\" onclick=\"$('#inventorycontainer').animate({left: 'toggle'}); $('#showinv').hide();\" type=\"button\">Show inventory</button>```\r\n\r\n```[[start]]:```\r\n\r\n```<p>You see a potion and a key.</p>```\r\n```<p>[[Get the potion]](get potion, potion=true)</p>```\r\n```<p>[[Get the key]](get key,key=true)</p>```\r\n```<p>[[Move on]](move on)</p>```\r\n\r\n```[[get potion]]:```\r\n\r\n```<p>You pick up the potion</p>```\r\n\r\n```{if key=true:}{else:<p>[[Get the key]](get key,key=true)</p>}```\r\n```<p>[[Move on]](move on)</p>```\r\n\r\n```[[get key]]:```\r\n\r\n```<p>you pick up the key</p>```\r\n```{if potion=true:}{else:<p>Get the potion(get potion,potion=true)</p>}```\r\n\r\n```<p>[[Move on]](move on)</p>```\r\n\r\n```[[move on]]:```\r\n\r\n```{if potion=true:<p>You have a potion. [[Drink potion]](drink potion,health=true,potion=false)</p>}```\r\n```{if key=true:<p>You have a key</p>}```\r\n```{if potion=false:{if key=false:<p>you have nothing</p>}}```\r\n\r\n```[[drink potion]]:```\r\n\r\n```<p>Gulp! You are now {if health=true: healthy}.</p>```\r\n\r\n```[[move on]]```",
      "EditableFormat": "markdown",
      "HTML": "<p>I think the forum's maybe garbled it - I bunged it into Squiffy and tried running it - the inventory pane appears but doesn't show/hide.</p>\n<p>The inventory also doesn't reliably update. If you pick up the potion it shows you have it; however if you drink the poition, it should change your status to 'healthy' and remove the potion from inventory - however it prints Healthy over the top of Unhealthy in the inventory pane, and doesn't remove the potion from inventory. (It does however reflect the correct true/false values in the main pane - just not in the sidebar).</p>\n<p>Here it is running: https://www.dragonchoice.com/inventory/index.html</p>\n<p>And the Squiffy markup:</p>\n<p><code>@title Inventory test</code></p>\n<p><code>@set potion = false</code><br>\n<code>@set key = false</code><br>\n<code>@set health = false</code></p>\n<p><code>[[start]]</code></p>\n<p><code>[[]]:</code></p>\n<p><code>&lt;div class=\"sidebar\" id=\"inventorycontainer\" style=\"position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"&gt;&lt;button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\" onclick=\"$('#inventorycontainer').animate({left: 'toggle'}); $('#showinv').show();\" type=\"button\"&gt;Hide inventory&lt;/button&gt;</code><br>\n<code>&lt;p&gt;&lt;strong&gt;Inventory&lt;/strong&gt;&lt;/p&gt;</code></p>\n<p><code>&lt;p&gt;You are {if health=true:healthy}{else: unhealthy}.&lt;/p&gt;</code></p>\n<p><code>{if potion=true:&lt;p&gt;Has potion&lt;/p&gt;}</code><br>\n<code>{if key=true:&lt;p&gt;Has key&lt;/p&gt;}&lt;/div&gt;</code></p>\n<p><code>&lt;button style=\"position: fixed; top: 6px; left: 2px; display: hidden;\" id=\"showinv\" onclick=\"$('#inventorycontainer').animate({left: 'toggle'}); $('#showinv').hide();\" type=\"button\"&gt;Show inventory&lt;/button&gt;</code></p>\n<p><code>[[start]]:</code></p>\n<p><code>&lt;p&gt;You see a potion and a key.&lt;/p&gt;</code><br>\n<code>&lt;p&gt;[[Get the potion]](get potion, potion=true)&lt;/p&gt;</code><br>\n<code>&lt;p&gt;[[Get the key]](get key,key=true)&lt;/p&gt;</code><br>\n<code>&lt;p&gt;[[Move on]](move on)&lt;/p&gt;</code></p>\n<p><code>[[get potion]]:</code></p>\n<p><code>&lt;p&gt;You pick up the potion&lt;/p&gt;</code></p>\n<p><code>{if key=true:}{else:&lt;p&gt;[[Get the key]](get key,key=true)&lt;/p&gt;}</code><br>\n<code>&lt;p&gt;[[Move on]](move on)&lt;/p&gt;</code></p>\n<p><code>[[get key]]:</code></p>\n<p><code>&lt;p&gt;you pick up the key&lt;/p&gt;</code><br>\n<code>{if potion=true:}{else:&lt;p&gt;Get the potion(get potion,potion=true)&lt;/p&gt;}</code></p>\n<p><code>&lt;p&gt;[[Move on]](move on)&lt;/p&gt;</code></p>\n<p><code>[[move on]]:</code></p>\n<p><code>{if potion=true:&lt;p&gt;You have a potion. [[Drink potion]](drink potion,health=true,potion=false)&lt;/p&gt;}</code><br>\n<code>{if key=true:&lt;p&gt;You have a key&lt;/p&gt;}</code><br>\n<code>{if potion=false:{if key=false:&lt;p&gt;you have nothing&lt;/p&gt;}}</code></p>\n<p><code>[[drink potion]]:</code></p>\n<p><code>&lt;p&gt;Gulp! You are now {if health=true: healthy}.&lt;/p&gt;</code></p>\n<p><code>[[move on]]</code></p>\n\n",
      "PostDate": "2020-08-28T10:02:17.6796442Z",
      "LastEditDate": "2020-08-28T10:39:18.8083261Z",
      "link": null
    },
    {
      "PostId": "418ca2ec-3944-4995-aa15-bfed48343943",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Cross-posting I think :) I've just tried out your edited version, and I can't get that to work either. It would also present some logistical problems - I have a lot of inventory stuff (I'm simplifying for test purposes), plus I'm also using that panel to track quests/event flags for the user, so needing to use the code block from your second quote wouldn't be practical to use on the hundreds of occasions when the inventory changes, or a quest, or a character attribute!\r\n\r\nSo right now I'm back to my existing suboptimal solution of just calling the inventory into a sidebar in each section (which means it's always updated with the latest values) and having it always visible. It's lame because the sidebar then has to repeat down the page - it would just be nice if the user could toggle its visibility off when they don't need it.",
      "EditableFormat": "markdown",
      "HTML": "<p>Cross-posting I think :) I've just tried out your edited version, and I can't get that to work either. It would also present some logistical problems - I have a lot of inventory stuff (I'm simplifying for test purposes), plus I'm also using that panel to track quests/event flags for the user, so needing to use the code block from your second quote wouldn't be practical to use on the hundreds of occasions when the inventory changes, or a quest, or a character attribute!</p>\n<p>So right now I'm back to my existing suboptimal solution of just calling the inventory into a sidebar in each section (which means it's always updated with the latest values) and having it always visible. It's lame because the sidebar then has to repeat down the page - it would just be nice if the user could toggle its visibility off when they don't need it.</p>\n\n",
      "PostDate": "2020-08-28T10:50:52.8039245Z",
      "LastEditDate": "2020-08-28T11:12:51.1679502Z",
      "link": null
    },
    {
      "PostId": "c24bd422-ce61-4bb4-ad1d-d1152df935da",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "EDIT: Updated to fix a few small issues in the second option below; I think this is usable now.\r\n\r\nHmm… trying to think of other ways to do it.\r\n\r\nHow about something like this:\r\n```\r\n    $('#inventorycontainer').html(squiffy.ui.processText(squiffy.story.sections['sidebar'].text));\r\n```\r\nWill cause the contents of the sidebar to be replaced by the text from the section named `sidebar`.\r\n\r\n<hr style=\"border-top: thin double red\"/>\r\n\r\nOne alternative I've thought of, which could make things more streamlined, would be modifying the core squiffy functions at runtime, so that the sidebar is automatically updated after each section is visited.\r\n\r\nSomething like (in the first section):\r\n```\r\n    $(function () {\r\n      if (!squiffy.story.originalGo) {\r\n        var updateSidebar = function () {\r\n          if (!$('#sidebar').length) {\r\n            squiffy.ui.write(squiffy.story.sections['sidebar container'].text);\r\n          }\r\n          if ($('#sidebar:visible').length) {\r\n            $('#sidebar').children(':not(#hideinv)').remove();\r\n            $('#sidebar').append(squiffy.ui.processText(squiffy.story.sections['sidebar contents'].text));\r\n            $('#showinv').click(e => $('#sidebar').animate({left: 0}));\r\n            $('#hideinv').click(e => $('#sidebar').animate({left: 3-$('#sidebar').width()}));\r\n          }\r\n        };\r\n        squiffy.story.originalGo = squiffy.story.go;\r\n        updateSidebar();\r\n        squiffy.story.go = function (section) {\r\n          squiffy.story.originalGo (section);\r\n          updateSidebar();\r\n          if (squiffy.afterText) {\r\n            squiffy.afterText();\r\n            delete(squiffy['afterText']);\r\n          }\r\n        };\r\n      }\r\n    });\r\n```\r\nThen you could have:\r\n```\r\n[[sidebar container]]:\r\n<button style=\"position: fixed; top: 6px; left: 2px;\" id=\"showinv\" type=\"button\">Show sidebar</button>\r\n<div id=\"sidebar\" style=\"background-color: white; position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"><button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\"  type=\"button\">Hide sidebar</button></div>\r\n<style>\r\n#sidebar p {\r\n  margin: 3px;\r\n  border: 1px dotted blue;\r\n}\r\n</style>\r\n\r\n[[sidebar contents]]:\r\n<p style=\"font-weight: bold;\">Inventory</p>\r\n\r\n<p>You are {if health=true:healthy}{else: unhealthy}.</p>\r\n\r\n{if potion=true:<p>Has potion</p>}\r\n{if key=true:<p>Has key</p>}\r\n```\r\nThis is all off the top of my head so far, not tested. But I think it could  be made into something workable.",
      "EditableFormat": "markdown",
      "HTML": "<p>EDIT: Updated to fix a few small issues in the second option below; I think this is usable now.</p>\n<p>Hmm… trying to think of other ways to do it.</p>\n<p>How about something like this:</p>\n<pre><code>    $('#inventorycontainer').html(squiffy.ui.processText(squiffy.story.sections['sidebar'].text));\n</code></pre>\n<p>Will cause the contents of the sidebar to be replaced by the text from the section named <code>sidebar</code>.</p>\n<hr style=\"border-top: thin double red\">\n<p>One alternative I've thought of, which could make things more streamlined, would be modifying the core squiffy functions at runtime, so that the sidebar is automatically updated after each section is visited.</p>\n<p>Something like (in the first section):</p>\n<pre><code>    $(function () {\n      if (!squiffy.story.originalGo) {\n        var updateSidebar = function () {\n          if (!$('#sidebar').length) {\n            squiffy.ui.write(squiffy.story.sections['sidebar container'].text);\n          }\n          if ($('#sidebar:visible').length) {\n            $('#sidebar').children(':not(#hideinv)').remove();\n            $('#sidebar').append(squiffy.ui.processText(squiffy.story.sections['sidebar contents'].text));\n            $('#showinv').click(e =&gt; $('#sidebar').animate({left: 0}));\n            $('#hideinv').click(e =&gt; $('#sidebar').animate({left: 3-$('#sidebar').width()}));\n          }\n        };\n        squiffy.story.originalGo = squiffy.story.go;\n        updateSidebar();\n        squiffy.story.go = function (section) {\n          squiffy.story.originalGo (section);\n          updateSidebar();\n          if (squiffy.afterText) {\n            squiffy.afterText();\n            delete(squiffy['afterText']);\n          }\n        };\n      }\n    });\n</code></pre>\n<p>Then you could have:</p>\n<pre><code>[[sidebar container]]:\n&lt;button style=\"position: fixed; top: 6px; left: 2px;\" id=\"showinv\" type=\"button\"&gt;Show sidebar&lt;/button&gt;\n&lt;div id=\"sidebar\" style=\"background-color: white; position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"&gt;&lt;button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\"  type=\"button\"&gt;Hide sidebar&lt;/button&gt;&lt;/div&gt;\n&lt;style&gt;\n#sidebar p {\n  margin: 3px;\n  border: 1px dotted blue;\n}\n&lt;/style&gt;\n\n[[sidebar contents]]:\n&lt;p style=\"font-weight: bold;\"&gt;Inventory&lt;/p&gt;\n\n&lt;p&gt;You are {if health=true:healthy}{else: unhealthy}.&lt;/p&gt;\n\n{if potion=true:&lt;p&gt;Has potion&lt;/p&gt;}\n{if key=true:&lt;p&gt;Has key&lt;/p&gt;}\n</code></pre>\n<p>This is all off the top of my head so far, not tested. But I think it could  be made into something workable.</p>\n\n",
      "PostDate": "2020-08-28T14:45:15.5334891Z",
      "LastEditDate": "2020-08-28T15:54:57.4492237Z",
      "link": null
    },
    {
      "PostId": "66323d82-1ffb-4cbf-bd8f-46a181480494",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "(the above code also allows you to run scripts after the text of the section is displayed. For example, doing:\r\n```\r\n    squiffy.afterText = function () {\r\n      alert (\"This javascript will be run after the text is displayed. Useful if you want to move text around or something, or refer to form elements in the section's text\");\r\n    };\r\n```\r\n)",
      "EditableFormat": "markdown",
      "HTML": "<p>(the above code also allows you to run scripts after the text of the section is displayed. For example, doing:</p>\n<pre><code>    squiffy.afterText = function () {\n      alert (\"This javascript will be run after the text is displayed. Useful if you want to move text around or something, or refer to form elements in the section's text\");\n    };\n</code></pre>\n<p>)</p>\n\n",
      "PostDate": "2020-08-28T14:48:11.9236171Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2548ee0d-8833-4e3b-8439-25a14ed94dab",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Suspect I'm missing something crucial here! (Curiously, as soon as I pasted the code uncommented here, the blue bordered sidebar appeared on this page - but this code doens't produce anything run out of Squiffy!)\r\n\r\n@title Inventory test 3\r\n\r\n```$.ready(function () {```\r\n```      if (!squiffy.story.originalGo) {```\r\n```        var updateSidebar = function () {```\r\n```          if (!$('#sidebar').length) {```\r\n```            squiffy.ui.write(squiffy.story.sections['sidebar container'].text);```\r\n```          }```\r\n```          if ($('#sidebar:visible').length) {```\r\n```            $('#sidebar').children(':not(#hideinv)').remove();```\r\n```            $('#sidebar').append(squiffy.ui.processText(squiffy.story.sections['sidebar contents'].text));```\r\n```            $('#showinv,#hideinv').click(e => $('#sidebar').animate({left: 'toggle'}));```\r\n```          }```\r\n```        };```\r\n```        squiffy.story.originalGo = squiffy.story.go;```\r\n```        squiffy.story.go = function (section) {```\r\n```          squiffy.story.originalGo (section);```\r\n```          updateSidebar();```\r\n```          if (squiffy.afterText) {```\r\n```            squiffy.afterText();```\r\n```            delete(squiffy['afterText']);```\r\n```          }```\r\n```        };```\r\n```      }```\r\n```    });```\r\n\r\n```[[start]]```\r\n\r\n```[[sidebar container]]:```\r\n```<button style=\"position: fixed; top: 6px; left: 2px; display: hidden;\" id=\"showinv\" type=\"button\">Show sidebar</button>```\r\n```<div id=\"sidebar\" style=\"background-color: white; position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"><button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\"  type=\"button\">Hide sidebar</button></div>```\r\n```<style>```\r\n```#sidebar p {```\r\n```  margin: 3px;```\r\n```  border: 1px solid blue;```\r\n```}```\r\n```</style>```\r\n\r\n```[[sidebar contents]]:```\r\n```<p style=\"font-weight: bold;\">Inventory</p>```\r\n\r\n```<p>You are {if health=true:healthy}{else: unhealthy}.</p>```\r\n\r\n```{if potion=true:<p>Has potion</p>}```\r\n```{if key=true:<p>Has key</p>}```\r\n\r\n```[[start]]:```\r\n\r\n```<p>You see a potion and a key.</p>```\r\n```<p>[[Get the potion]](get potion, potion=true)</p>```\r\n```<p>[[Get the key]](get key,key=true)</p>```\r\n```<p>[[Move on]](move on)</p>```\r\n\r\n```[[get potion]]:```\r\n\r\n```<p>You pick up the potion</p>```\r\n\r\n```{if key=true:}{else:<p>[[Get the key]](get key,key=true)</p>}```\r\n```<p>[[Move on]](move on)</p>```\r\n\r\n```[[get key]]:```\r\n\r\n```<p>you pick up the key</p>```\r\n```{if potion=true:}{else:<p>Get the potion(get potion,potion=true)</p>}```\r\n\r\n```<p>[[Move on]](move on)</p>```\r\n\r\n```[[move on]]:```\r\n\r\n```{if potion=true:<p>You have a potion. [[Drink potion]](drink potion,health=true,potion=false)</p>}```\r\n```{if key=true:<p>You have a key</p>}```\r\n```{if potion=false:{if key=false:<p>you have nothing</p>}}```\r\n\r\n```[[drink potion]]:```\r\n\r\n```<p>Gulp! you are now {if health=true: healthy}.</p>```\r\n```[[move on]]```",
      "EditableFormat": "markdown",
      "HTML": "<p>Suspect I'm missing something crucial here! (Curiously, as soon as I pasted the code uncommented here, the blue bordered sidebar appeared on this page - but this code doens't produce anything run out of Squiffy!)</p>\n<p>@title Inventory test 3</p>\n<p><code>$.ready(function () {</code><br>\n<code>if (!squiffy.story.originalGo) {</code><br>\n<code>var updateSidebar = function () {</code><br>\n<code>if (!$('#sidebar').length) {</code><br>\n<code>squiffy.ui.write(squiffy.story.sections['sidebar container'].text);</code><br>\n<code>}</code><br>\n<code>if ($('#sidebar:visible').length) {</code><br>\n<code>$('#sidebar').children(':not(#hideinv)').remove();</code><br>\n<code>$('#sidebar').append(squiffy.ui.processText(squiffy.story.sections['sidebar contents'].text));</code><br>\n<code>$('#showinv,#hideinv').click(e =&gt; $('#sidebar').animate({left: 'toggle'}));</code><br>\n<code>}</code><br>\n<code>};</code><br>\n<code>squiffy.story.originalGo = squiffy.story.go;</code><br>\n<code>squiffy.story.go = function (section) {</code><br>\n<code>squiffy.story.originalGo (section);</code><br>\n<code>updateSidebar();</code><br>\n<code>if (squiffy.afterText) {</code><br>\n<code>squiffy.afterText();</code><br>\n<code>delete(squiffy['afterText']);</code><br>\n<code>}</code><br>\n<code>};</code><br>\n<code>}</code><br>\n<code>});</code></p>\n<p><code>[[start]]</code></p>\n<p><code>[[sidebar container]]:</code><br>\n<code>&lt;button style=\"position: fixed; top: 6px; left: 2px; display: hidden;\" id=\"showinv\" type=\"button\"&gt;Show sidebar&lt;/button&gt;</code><br>\n<code>&lt;div id=\"sidebar\" style=\"background-color: white; position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"&gt;&lt;button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\" type=\"button\"&gt;Hide sidebar&lt;/button&gt;&lt;/div&gt;</code><br>\n<code>&lt;style&gt;</code><br>\n<code>#sidebar p {</code><br>\n<code>margin: 3px;</code><br>\n<code>border: 1px solid blue;</code><br>\n<code>}</code><br>\n<code>&lt;/style&gt;</code></p>\n<p><code>[[sidebar contents]]:</code><br>\n<code>&lt;p style=\"font-weight: bold;\"&gt;Inventory&lt;/p&gt;</code></p>\n<p><code>&lt;p&gt;You are {if health=true:healthy}{else: unhealthy}.&lt;/p&gt;</code></p>\n<p><code>{if potion=true:&lt;p&gt;Has potion&lt;/p&gt;}</code><br>\n<code>{if key=true:&lt;p&gt;Has key&lt;/p&gt;}</code></p>\n<p><code>[[start]]:</code></p>\n<p><code>&lt;p&gt;You see a potion and a key.&lt;/p&gt;</code><br>\n<code>&lt;p&gt;[[Get the potion]](get potion, potion=true)&lt;/p&gt;</code><br>\n<code>&lt;p&gt;[[Get the key]](get key,key=true)&lt;/p&gt;</code><br>\n<code>&lt;p&gt;[[Move on]](move on)&lt;/p&gt;</code></p>\n<p><code>[[get potion]]:</code></p>\n<p><code>&lt;p&gt;You pick up the potion&lt;/p&gt;</code></p>\n<p><code>{if key=true:}{else:&lt;p&gt;[[Get the key]](get key,key=true)&lt;/p&gt;}</code><br>\n<code>&lt;p&gt;[[Move on]](move on)&lt;/p&gt;</code></p>\n<p><code>[[get key]]:</code></p>\n<p><code>&lt;p&gt;you pick up the key&lt;/p&gt;</code><br>\n<code>{if potion=true:}{else:&lt;p&gt;Get the potion(get potion,potion=true)&lt;/p&gt;}</code></p>\n<p><code>&lt;p&gt;[[Move on]](move on)&lt;/p&gt;</code></p>\n<p><code>[[move on]]:</code></p>\n<p><code>{if potion=true:&lt;p&gt;You have a potion. [[Drink potion]](drink potion,health=true,potion=false)&lt;/p&gt;}</code><br>\n<code>{if key=true:&lt;p&gt;You have a key&lt;/p&gt;}</code><br>\n<code>{if potion=false:{if key=false:&lt;p&gt;you have nothing&lt;/p&gt;}}</code></p>\n<p><code>[[drink potion]]:</code></p>\n<p><code>&lt;p&gt;Gulp! you are now {if health=true: healthy}.&lt;/p&gt;</code><br>\n<code>[[move on]]</code></p>\n\n",
      "PostDate": "2020-08-28T15:26:16.3080201Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "90518fb1-edb1-4172-8635-97e88f138ad9",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "My mistake; I used `$.ready(` instead of `$(document).ready(` or its shorter form `$(`.\r\n\r\nFixed the careless error, and it seems to work for me (although playing it in the editor is something of a pain, because the sidebar is partly covered by the bar at the top with the save/run buttons, and at the bottom by the bar with the current variables)",
      "EditableFormat": "markdown",
      "HTML": "<p>My mistake; I used <code>$.ready(</code> instead of <code>$(document).ready(</code> or its shorter form <code>$(</code>.</p>\n<p>Fixed the careless error, and it seems to work for me (although playing it in the editor is something of a pain, because the sidebar is partly covered by the bar at the top with the save/run buttons, and at the bottom by the bar with the current variables)</p>\n\n",
      "PostDate": "2020-08-28T15:48:56.5249479Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "054d42c9-6672-43c2-9226-c684ecca9544",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "For me, the sidebar appears if I run it within the Squiffy editor (with the attendant display issues), but not if I hit Preview to run it directly in the browser?",
      "EditableFormat": "markdown",
      "HTML": "<p>For me, the sidebar appears if I run it within the Squiffy editor (with the attendant display issues), but not if I hit Preview to run it directly in the browser?</p>\n\n",
      "PostDate": "2020-08-28T16:16:52.7522684Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "34a1042f-ac62-4a77-9ad4-19d345d7dcd3",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "OK, I'm really confused.\r\n\r\nI'm trying with this code for testing:\r\n```\r\n[[Start]]:\r\n    $(function () {\r\n      console.log(\"trying...\");\r\n      if (!squiffy.story.originalGo) {\r\n        console.log(\"Initialised!\");\r\n        window.sq = squiffy;\r\n        var updateSidebar = function () {\r\n        console.log(\"updating sidebar\");\r\n          if (!$('#sidebar').length) {\r\n        console.log(\"creating sidebar\");\r\n            squiffy.ui.write(squiffy.story.sections['sidebar container'].text);\r\n          }\r\n          if ($('#sidebar:visible').length) {\r\n        console.log(\"is not hidden\");\r\n            $('#sidebar').children(':not(#hideinv)').remove();\r\n            $('#sidebar').append(squiffy.ui.processText(squiffy.story.sections['sidebar contents'].text));\r\n            $('#showinv').click(e => $('#sidebar').animate({left: 0}));\r\n            $('#hideinv').click(e => $('#sidebar').animate({left: 5-$('#sidebar').width()}));\r\n          }\r\n        };\r\n        squiffy.story.originalGo = squiffy.story.go;\r\n        squiffy.story.go = function (section) {\r\n          squiffy.story.originalGo (section);\r\n          updateSidebar();\r\n          if (squiffy.afterText) {\r\n            squiffy.afterText();\r\n            delete(squiffy['afterText']);\r\n          }\r\n        };\r\n      }\r\n    });\r\n    \r\nThis is the starting page! Is it working?\r\n\r\n[[part2]]\r\n\r\n[[sidebar container]]:\r\n<button style=\"position: fixed; top: 36px; left: 2px;\" id=\"showinv\" type=\"button\">Show sidebar</button>\r\n<div id=\"sidebar\" style=\"background-color: white; position: fixed; left: 1px; top: 34px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"><button style=\"position: absolute; top: 32px; right: 2px;\" id=\"hideinv\"  type=\"button\">Hide sidebar</button></div>\r\n<style>\r\n#sidebar p {\r\n  margin: 3px;\r\n  border: 1px solid blue;\r\n}\r\n</style>\r\n\r\n[[sidebar contents]]:\r\n<p style=\"font-weight: bold;\">Inventory</p>\r\n\r\n<p>You are {if health=true:healthy}{else: unhealthy}.</p>\r\n\r\n{if potion=true:<p>Has potion</p>}\r\n{if key=true:<p>Has key</p>}\r\n\r\n[[part2]]:\r\n<p>You see a potion and a key.</p>\r\n<p>[[Get the potion]](get potion, potion=true)</p>\r\n<p>[[Get the key]](get key,key=true)</p>\r\n<p>[[Move on]](move on)</p>\r\n\r\n[[get potion]]:\r\n\r\n<p>You pick up the potion</p>\r\n\r\n{if key=true:}{else:<p>[[Get the key]](get key,key=true)</p>}\r\n<p>[[Move on]](move on)</p>\r\n\r\n[[get key]]:\r\n\r\n<p>you pick up the key</p>\r\n{if potion=true:}{else:<p>Get the potion(get potion,potion=true)</p>}\r\n\r\n<p>[[Move on]](move on)</p>\r\n\r\n[[move on]]:\r\n\r\n{if potion=true:<p>You have a potion. [[Drink potion]](drink potion,health=true,potion=false)</p>}\r\n{if key=true:<p>You have a key</p>}\r\n{if potion=false:{if key=false:<p>you have nothing</p>}}\r\n\r\n[[drink potion]]:\r\n\r\n<p>Gulp! you are now {if health=true: healthy}.</p>\r\n[[move on]]\r\n```\r\n\r\nIn the editor, it works fine. But when I hit \"preview\", the browser's in-memory copy of the game has the sections `part2` and `inventory container` having no text. They're just blank, as soon as the game is loaded (before my script even runs; tested by putting an extra section before the Start one)\r\n\r\nCan anyone with more Squiffy experience work out why?",
      "EditableFormat": "markdown",
      "HTML": "<p>OK, I'm really confused.</p>\n<p>I'm trying with this code for testing:</p>\n<pre><code>[[Start]]:\n    $(function () {\n      console.log(\"trying...\");\n      if (!squiffy.story.originalGo) {\n        console.log(\"Initialised!\");\n        window.sq = squiffy;\n        var updateSidebar = function () {\n        console.log(\"updating sidebar\");\n          if (!$('#sidebar').length) {\n        console.log(\"creating sidebar\");\n            squiffy.ui.write(squiffy.story.sections['sidebar container'].text);\n          }\n          if ($('#sidebar:visible').length) {\n        console.log(\"is not hidden\");\n            $('#sidebar').children(':not(#hideinv)').remove();\n            $('#sidebar').append(squiffy.ui.processText(squiffy.story.sections['sidebar contents'].text));\n            $('#showinv').click(e =&gt; $('#sidebar').animate({left: 0}));\n            $('#hideinv').click(e =&gt; $('#sidebar').animate({left: 5-$('#sidebar').width()}));\n          }\n        };\n        squiffy.story.originalGo = squiffy.story.go;\n        squiffy.story.go = function (section) {\n          squiffy.story.originalGo (section);\n          updateSidebar();\n          if (squiffy.afterText) {\n            squiffy.afterText();\n            delete(squiffy['afterText']);\n          }\n        };\n      }\n    });\n    \nThis is the starting page! Is it working?\n\n[[part2]]\n\n[[sidebar container]]:\n&lt;button style=\"position: fixed; top: 36px; left: 2px;\" id=\"showinv\" type=\"button\"&gt;Show sidebar&lt;/button&gt;\n&lt;div id=\"sidebar\" style=\"background-color: white; position: fixed; left: 1px; top: 34px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"&gt;&lt;button style=\"position: absolute; top: 32px; right: 2px;\" id=\"hideinv\"  type=\"button\"&gt;Hide sidebar&lt;/button&gt;&lt;/div&gt;\n&lt;style&gt;\n#sidebar p {\n  margin: 3px;\n  border: 1px solid blue;\n}\n&lt;/style&gt;\n\n[[sidebar contents]]:\n&lt;p style=\"font-weight: bold;\"&gt;Inventory&lt;/p&gt;\n\n&lt;p&gt;You are {if health=true:healthy}{else: unhealthy}.&lt;/p&gt;\n\n{if potion=true:&lt;p&gt;Has potion&lt;/p&gt;}\n{if key=true:&lt;p&gt;Has key&lt;/p&gt;}\n\n[[part2]]:\n&lt;p&gt;You see a potion and a key.&lt;/p&gt;\n&lt;p&gt;[[Get the potion]](get potion, potion=true)&lt;/p&gt;\n&lt;p&gt;[[Get the key]](get key,key=true)&lt;/p&gt;\n&lt;p&gt;[[Move on]](move on)&lt;/p&gt;\n\n[[get potion]]:\n\n&lt;p&gt;You pick up the potion&lt;/p&gt;\n\n{if key=true:}{else:&lt;p&gt;[[Get the key]](get key,key=true)&lt;/p&gt;}\n&lt;p&gt;[[Move on]](move on)&lt;/p&gt;\n\n[[get key]]:\n\n&lt;p&gt;you pick up the key&lt;/p&gt;\n{if potion=true:}{else:&lt;p&gt;Get the potion(get potion,potion=true)&lt;/p&gt;}\n\n&lt;p&gt;[[Move on]](move on)&lt;/p&gt;\n\n[[move on]]:\n\n{if potion=true:&lt;p&gt;You have a potion. [[Drink potion]](drink potion,health=true,potion=false)&lt;/p&gt;}\n{if key=true:&lt;p&gt;You have a key&lt;/p&gt;}\n{if potion=false:{if key=false:&lt;p&gt;you have nothing&lt;/p&gt;}}\n\n[[drink potion]]:\n\n&lt;p&gt;Gulp! you are now {if health=true: healthy}.&lt;/p&gt;\n[[move on]]\n</code></pre>\n<p>In the editor, it works fine. But when I hit \"preview\", the browser's in-memory copy of the game has the sections <code>part2</code> and <code>inventory container</code> having no text. They're just blank, as soon as the game is loaded (before my script even runs; tested by putting an extra section before the Start one)</p>\n<p>Can anyone with more Squiffy experience work out why?</p>\n\n",
      "PostDate": "2020-08-28T16:31:27.7793237Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "bf838fa0-7f28-4db3-a4ff-4622b18fc7b6",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "OK, this is just weird.\r\n\r\nIf my source contains the following section:\r\n```\r\n[[part2]]:\r\n\r\n<p>You see a potion and a key.</p>\r\n<p>[[Get the potion]](get potion, potion=true)</p>\r\n<p>[[Get the key]](get key,key=true)</p>\r\n<p>[[Move on]](move on)</p>\r\n```\r\n\r\nThen the section's text is *blank* when I load it in preview mode. Nothing appears, and examining it with the console confirms that `squiffy.story.sections['part2'].text` is an empty string.\r\n\r\nIf I change it to:\r\n```\r\n[[part2]]:\r\n\r\nYou see a potion and a key.\r\n<p>[[Get the potion]](get potion, potion=true)</p>\r\n<p>[[Get the key]](get key,key=true)</p>\r\n<p>[[Move on]](move on)</p>\r\n```\r\n(removing the `<p>` tags from one line) then that line appears fine, but only that line.\r\n\r\nExamining it with the console confirms that `squiffy.story.sections['part2'].text` is the string `<p>You see a potion and a key.</p>`\r\n\r\nSo when Squiffy compiles the game, it appears to be removing some of the text, and I have no idea why.\r\n\r\nOn further experimentation, it seems to be choking on the `<style>` block. If I remove that, everything works fine. So, putting a `<style>` element in a game's text both makes that section empty, and removes lines from the next section but one when the game is compiled.\r\n\r\nI have no idea how this can happen; but at least we have something that seems to work now.",
      "EditableFormat": "markdown",
      "HTML": "<p>OK, this is just weird.</p>\n<p>If my source contains the following section:</p>\n<pre><code>[[part2]]:\n\n&lt;p&gt;You see a potion and a key.&lt;/p&gt;\n&lt;p&gt;[[Get the potion]](get potion, potion=true)&lt;/p&gt;\n&lt;p&gt;[[Get the key]](get key,key=true)&lt;/p&gt;\n&lt;p&gt;[[Move on]](move on)&lt;/p&gt;\n</code></pre>\n<p>Then the section's text is <em>blank</em> when I load it in preview mode. Nothing appears, and examining it with the console confirms that <code>squiffy.story.sections['part2'].text</code> is an empty string.</p>\n<p>If I change it to:</p>\n<pre><code>[[part2]]:\n\nYou see a potion and a key.\n&lt;p&gt;[[Get the potion]](get potion, potion=true)&lt;/p&gt;\n&lt;p&gt;[[Get the key]](get key,key=true)&lt;/p&gt;\n&lt;p&gt;[[Move on]](move on)&lt;/p&gt;\n</code></pre>\n<p>(removing the <code>&lt;p&gt;</code> tags from one line) then that line appears fine, but only that line.</p>\n<p>Examining it with the console confirms that <code>squiffy.story.sections['part2'].text</code> is the string <code>&lt;p&gt;You see a potion and a key.&lt;/p&gt;</code></p>\n<p>So when Squiffy compiles the game, it appears to be removing some of the text, and I have no idea why.</p>\n<p>On further experimentation, it seems to be choking on the <code>&lt;style&gt;</code> block. If I remove that, everything works fine. So, putting a <code>&lt;style&gt;</code> element in a game's text both makes that section empty, and removes lines from the next section but one when the game is compiled.</p>\n<p>I have no idea how this can happen; but at least we have something that seems to work now.</p>\n\n",
      "PostDate": "2020-08-29T11:23:02.2895942Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "b7980a9e-ea62-4fd5-a23b-9d83570b2971",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I'm now playing around a little, making a way to put commands like \"drink potion\" in the sidebar, so that clicking them will run a section without actually making it the current section. Think I got this.",
      "EditableFormat": "markdown",
      "HTML": "<p>I'm now playing around a little, making a way to put commands like \"drink potion\" in the sidebar, so that clicking them will run a section without actually making it the current section. Think I got this.</p>\n\n",
      "PostDate": "2020-08-29T11:48:39.0599456Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "053a4af1-659a-487e-9c76-85aff0c1f584",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Will test without the style block later tonight when family commitments are done! Would also love to see if you can crack using stuff out of the inventory without needing to go to a new section!",
      "EditableFormat": "markdown",
      "HTML": "<p>Will test without the style block later tonight when family commitments are done! Would also love to see if you can crack using stuff out of the inventory without needing to go to a new section!</p>\n\n",
      "PostDate": "2020-08-29T18:02:24.1810569Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "839f2688-cfbf-4d27-9907-15acd4140d64",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Just to confirm what you found, that the ```<style>``` block breaks it, and it works without it. Not a problem in the scheme of things as I'll have my own custom external stylesheet which I'll retrospectively added to index.html once I've built the game (though it would be nice if there was a default call to a custom.css embedded in the template, so I don't have to keep re-adding it every time I re-build...]",
      "EditableFormat": "markdown",
      "HTML": "<p>Just to confirm what you found, that the <code>&lt;style&gt;</code> block breaks it, and it works without it. Not a problem in the scheme of things as I'll have my own custom external stylesheet which I'll retrospectively added to index.html once I've built the game (though it would be nice if there was a default call to a custom.css embedded in the template, so I don't have to keep re-adding it every time I re-build...]</p>\n\n",
      "PostDate": "2020-08-29T23:41:57.518325Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a02ca3e4-42f4-4717-b01a-d1e1eb42478b",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I've modified the custom `go` function so you can now do something like `[[drink potion]](quick:potion)`, which visits the section 'potion' and runs its script, without changing the value of `{_section}` or disabling any currently-visible links.\r\n\r\nI tried to make a quick test game, testing the different circumstances where this might be used in a real game. It mostly works, but there's one section where the game freezes completely, and I'm not sure if it's because of a bug in my code. I'll share as soon as I've fixed that.\r\n\r\n(I'm also not sure how Squiffy attributes work, I'm learning by trial and error, so I've used javascript for most of the variables in my test game. But I don't think that makes so much difference)",
      "EditableFormat": "markdown",
      "HTML": "<p>I've modified the custom <code>go</code> function so you can now do something like <code>[[drink potion]](quick:potion)</code>, which visits the section 'potion' and runs its script, without changing the value of <code>{_section}</code> or disabling any currently-visible links.</p>\n<p>I tried to make a quick test game, testing the different circumstances where this might be used in a real game. It mostly works, but there's one section where the game freezes completely, and I'm not sure if it's because of a bug in my code. I'll share as soon as I've fixed that.</p>\n<p>(I'm also not sure how Squiffy attributes work, I'm learning by trial and error, so I've used javascript for most of the variables in my test game. But I don't think that makes so much difference)</p>\n\n",
      "PostDate": "2020-08-30T08:33:24.5098739Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "9702dd41-a288-4eab-9267-4c6df9e1196e",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "OK… here's my latest attempt at the sidebar, along with a simple game I built to test it.\r\nHopefully you can't see any bugs in there, and a quick look at the code should tell you how I did everything.\r\n\r\nI haven't used passages, because I was quite near the end of playing with this when I found out that they exist. If they break the sidebar, please let me know and I can work on that. If anything else you're doing in your game breaks the sidebar, again, please let me know about that.\r\n\r\nHere is <a href=\"http://textadventures.co.uk/games/view/tvbrarouses9gs0xjlnpjg/very-silly-squiffy-sidebar-test-game\">the sample game I made to test the sidebar</a> - see if you can finish it before looking for more bugs. I know there's a few clunky bits, but I think those are more because of me not knowing how to write a CYOA that well than anything with the system. (for example, I am entirely aware that it's possible to carry -1 empty bottles. But fixing this would be so much effort for no real gain)\r\n\r\n[broken code removed. Updated and improved version in a post below]",
      "EditableFormat": "markdown",
      "HTML": "<p>OK… here's my latest attempt at the sidebar, along with a simple game I built to test it.<br>\nHopefully you can't see any bugs in there, and a quick look at the code should tell you how I did everything.</p>\n<p>I haven't used passages, because I was quite near the end of playing with this when I found out that they exist. If they break the sidebar, please let me know and I can work on that. If anything else you're doing in your game breaks the sidebar, again, please let me know about that.</p>\n<p>Here is <a href=\"http://textadventures.co.uk/games/view/tvbrarouses9gs0xjlnpjg/very-silly-squiffy-sidebar-test-game\">the sample game I made to test the sidebar</a> - see if you can finish it before looking for more bugs. I know there's a few clunky bits, but I think those are more because of me not knowing how to write a CYOA that well than anything with the system. (for example, I am entirely aware that it's possible to carry -1 empty bottles. But fixing this would be so much effort for no real gain)</p>\n<p>[broken code removed. Updated and improved version in a post below]</p>\n\n",
      "PostDate": "2020-08-30T09:47:17.9345976Z",
      "LastEditDate": "2020-08-30T21:47:11.1154839Z",
      "link": null
    },
    {
      "PostId": "c19a3130-ace7-4160-a895-2a70666e99fd",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I've got the kitten and died twice (by drinking 2x acid, and by jumping into the acid!)\r\n\r\nThe biggest thing for me is that the sidebar show/hide works fine at the beginning, but after a few sections the show/hide gets very slow (you click, nothing happens, and then a while later it reacts - I'm not sure why there's a delay. I'm using Firefox in case that makes a difference)\r\n\r\nThere's what looks like a random event with the fortune teller gesturing which seems to result in your getting more potions in your inventory (is that intended? Is there a formula for how many you get, I've had 1 and 3? is there a formula for if/when the event occurs?)\r\n\r\nDrinking acid from the sidebar doesn't update the health status in the sidebar until you click something in the main pane.\r\n\r\nFinally your link here to the code isn't active - would love to see how this all works!\r\n\r\nThat's all I've found to report!",
      "EditableFormat": "markdown",
      "HTML": "<p>I've got the kitten and died twice (by drinking 2x acid, and by jumping into the acid!)</p>\n<p>The biggest thing for me is that the sidebar show/hide works fine at the beginning, but after a few sections the show/hide gets very slow (you click, nothing happens, and then a while later it reacts - I'm not sure why there's a delay. I'm using Firefox in case that makes a difference)</p>\n<p>There's what looks like a random event with the fortune teller gesturing which seems to result in your getting more potions in your inventory (is that intended? Is there a formula for how many you get, I've had 1 and 3? is there a formula for if/when the event occurs?)</p>\n<p>Drinking acid from the sidebar doesn't update the health status in the sidebar until you click something in the main pane.</p>\n<p>Finally your link here to the code isn't active - would love to see how this all works!</p>\n<p>That's all I've found to report!</p>\n\n",
      "PostDate": "2020-08-30T13:31:34.540281Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2ad899d1-91b2-4246-aa61-08e67675b217",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> after a few sections the show/hide gets very slow\r\n\r\nI can't replicate that on chrome. Will try on firefox later, see if it's different.\r\n\r\n> There's what looks like a random event with the fortune teller\r\n\r\nIt's just a timer. Triggers 4 seconds after you enter the carnival, converts all your empty bottles to potions. It doesn't trigger if you don't have any bottles.\r\n\r\nThe known bug is that if you get to the lab fast enough, your empty bottle becomes a potion but it doesn't disable the 'fill a bottle with acid' link. So clicking that will leave you with negative empty bottles.\r\n\r\n> Drinking acid from the sidebar doesn't update the health status in the sidebar until you click something in the main pane.\r\n\r\nThanks, I'll try to work out why that is.\r\n\r\n> Finally your link here to the code isn't active\r\n\r\nWorks for me. It should expand to show the code. Do you have the same issue elsewhere on the forums?",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>after a few sections the show/hide gets very slow</p>\n</blockquote>\n<p>I can't replicate that on chrome. Will try on firefox later, see if it's different.</p>\n<blockquote>\n<p>There's what looks like a random event with the fortune teller</p>\n</blockquote>\n<p>It's just a timer. Triggers 4 seconds after you enter the carnival, converts all your empty bottles to potions. It doesn't trigger if you don't have any bottles.</p>\n<p>The known bug is that if you get to the lab fast enough, your empty bottle becomes a potion but it doesn't disable the 'fill a bottle with acid' link. So clicking that will leave you with negative empty bottles.</p>\n<blockquote>\n<p>Drinking acid from the sidebar doesn't update the health status in the sidebar until you click something in the main pane.</p>\n</blockquote>\n<p>Thanks, I'll try to work out why that is.</p>\n<blockquote>\n<p>Finally your link here to the code isn't active</p>\n</blockquote>\n<p>Works for me. It should expand to show the code. Do you have the same issue elsewhere on the forums?</p>\n\n",
      "PostDate": "2020-08-30T15:57:37.6301133Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "f12092c6-749a-4bf9-968f-01a1dd5b520e",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Sorry, didn't realise it was a link to expand the code! That's very useful indeed!\r\n\r\nI've just tried the show/hide in Chrome and it does the same. Basically if you open/close it every time you progress, it gets slower to react until you can click the button and wait 5+ seconds before it slides in/out.",
      "EditableFormat": "markdown",
      "HTML": "<p>Sorry, didn't realise it was a link to expand the code! That's very useful indeed!</p>\n<p>I've just tried the show/hide in Chrome and it does the same. Basically if you open/close it every time you progress, it gets slower to react until you can click the button and wait 5+ seconds before it slides in/out.</p>\n\n",
      "PostDate": "2020-08-30T16:40:55.5023081Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2d14dac4-e0a7-4c98-a229-962e9c805484",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Changed it so that it updates the sidebar after the afterText section, so it should update immediately in all cases.\r\n\r\nFixed the issue with the negative bottles, and added more silly easter eggs to add to your completion percentage (it's now 37% for winning, plus 7% for each attribute with a nonzero or true value. 100% should be possible, but a lot harder)\r\n\r\nWill publish the new version as soon as I'm back at my computer.",
      "EditableFormat": "markdown",
      "HTML": "<p>Changed it so that it updates the sidebar after the afterText section, so it should update immediately in all cases.</p>\n<p>Fixed the issue with the negative bottles, and added more silly easter eggs to add to your completion percentage (it's now 37% for winning, plus 7% for each attribute with a nonzero or true value. 100% should be possible, but a lot harder)</p>\n<p>Will publish the new version as soon as I'm back at my computer.</p>\n\n",
      "PostDate": "2020-08-30T17:28:17.943554Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "b180759e-0ffc-4cc4-b423-9b3cc6339617",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Still trying to figure out the delay. It seems to be the function isn't even being called, and I have no idea why.\r\n\r\nMaybe removing and recreating the buttons each time they're used would be better. I'll try that.",
      "EditableFormat": "markdown",
      "HTML": "<p>Still trying to figure out the delay. It seems to be the function isn't even being called, and I have no idea why.</p>\n<p>Maybe removing and recreating the buttons each time they're used would be better. I'll try that.</p>\n\n",
      "PostDate": "2020-08-30T17:34:42.8363641Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "d9f23b14-106b-40bc-9f7a-276e8f39aff2",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "OK. Here's the updated version of the game. Very small changes to the code itself.\r\n\r\nI'll post this here before I experiment with the buttons, because I don't want to break something else and not have a copy of the code to come back to. If it fixes the slowdown, I'll update the code here.\r\n\r\nEDIT: I'm a complete idiot. Somehow I managed to drag two lines to the wrong place and didn't notice after I read and re-read it a dozen times.\r\nEDIT2: A small logic error in one of the puzzles.\r\n\r\n```\r\n@title Inventory test game\r\n\r\n[[Start]]:\r\n    $(function () {\r\n      if (!squiffy.story.originalGo) {\r\n        window.sq = squiffy;\r\n        var updateSidebar = function () {\r\n          if (!$('#sidebar').length) {\r\n            squiffy.ui.write(squiffy.story.sections['sidebar container'].text);\r\n            // Ugly hack to stop the sidebar being hidden by the top/bottom bars in the editor\r\n            // and allow you to remove the sidebar so you can look at the code while testing\r\n            //     (it will reappear as soon as you visit another section in the game)\r\n            if ($('.ui-layout-north:visible').length) {\r\n              $('#showinv').css('top', $('#showinv').offset()['top']+92);\r\n              $('#sidebar').css('top', $('#sidebar').offset()['top']+92);\r\n              $('#sidebar').css('bottom', '100px');\r\n              $('<button>', {id: 'killsidebar', style: 'position: absolute; bottom: 4px; right: 4px'}).click(function () {\r\n                $('#killsidebar,#sidebar,#showinv').remove();\r\n              }).text('kill sidebar').appendTo('#sidebar');\r\n            }\r\n            $('#showinv').click(e => $('#sidebar').animate({left: 0}));\r\n            $('#hideinv').click(e => $('#sidebar').animate({left: 5-$('#sidebar').width()}));\r\n          }\r\n          if ($('#sidebar:visible').length) {\r\n            $('#sidebar').children(':not(#hideinv,#killsidebar)').remove();\r\n            $('#sidebar').append(squiffy.ui.processText(squiffy.story.sections['sidebar contents'].text));\r\n            if (squiffy.get('gameover')) {\r\n              $('#sidebar a').remove();\r\n            }\r\n          }\r\n        };\r\n        squiffy.story.originalGo = squiffy.story.go;\r\n        squiffy.story.go = function (section) {\r\n          console.log(\"go called for \"+section);\r\n          if (section.match(/^quick:/)) {\r\n            var sec = squiffy.story.sections[section.replace(/^quick:\\s*/, '')];\r\n            if (!sec) {\r\n              console.log(\"No such section: \"+section);\r\n              return;\r\n            }\r\n            squiffy.story.run(sec);\r\n            squiffy.ui.write('<blockquote style=\"display: block; left: 2em; right: 2em; border: 1px dotted grey;\">' + sec.text + '</blockquote>');\r\n            squiffy.story.save();\r\n          } else {\r\n            console.log(\"Running originalGo\");\r\n            squiffy.story.originalGo (section);\r\n          }\r\n          if (squiffy.afterText) {\r\n            var after = squiffy.afterText;\r\n            delete(squiffy['afterText']);\r\n            after();\r\n          }\r\n          updateSidebar();\r\n        };\r\n        updateSidebar();\r\n      }\r\n    });\r\n\r\n@set potions = 0\r\n@set bottles = 1\r\n@set acid = 0\r\n    \r\nThis is the starting page! Is it working?\r\n\r\n[[Continue]]\r\n\r\n[[sidebar container]]:\r\n<button style=\"position: fixed; top: 6px; left: 2px;\" id=\"showinv\" type=\"button\">Show sidebar</button>\r\n<div id=\"sidebar\" style=\"background-color: white; position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"><button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\"  type=\"button\">Hide sidebar</button></div>\r\n\r\n[[sidebar contents]]:\r\n\r\n<p style=\"font-weight: bold;\">Inventory</p>\r\n\r\n<p>You are {if health=true:healthy}{else: unhealthy}.</p>\r\n\r\n{if potions>0:<p>{if potions>1:Has {potions} potions}{else:Has a potion}. [[Drink potion]](quick:drink potion)</p>}\r\n{if acid>0:<p>{if acid>1:Has {acid} flasks of acid}{else:Has an acid flask}. [[Drink acid]](quick:drink acid)</p>}\r\n{if bottles>0:<p>{if bottles>1:Has {bottles} empty flasks}{else:Has an empty flask}.</p>}\r\n{if mixbottle>0:<p>{if mixbottle>1:Has {mixbottle} flasks}{else:Has a flask} filled with a weird goop you can't pour out. [[Discard]](quick:discard mix)</p>}\r\n{if key=true:<p>Has {if dissolvedkey:partially dissolved }key {if not eatenkey:[[Swallow]](quick:eat key)}{else:(swallowed)}</p>}\r\n{if soot:<p>Covered in soot.</p>}\r\n{if talisman=true:<p>Has weird glowing talisman [[Rub]](quick:rub talisman)</p>}\r\n```\r\nAnd a collapsible bit for all the stuff that's pretty much an example of how to use the code above:\r\n<details><summary>Click to expand</summary>\r\nHere's the code:\r\n\r\n```\r\n[[rub talisman]]:\r\n@set not talisman\r\n\r\nYou rub the talisman, and your hair seems to stand on end. You feel like an epic vision-quest is about to begin. {if bottles>0:{@bottles-=1}{@potions+=1}Suddenly, with a sloshing sound, one of your empty bottles fills up with a rainbow-coloured liquid. }Then the talisman vanishes.\r\n\r\n[[eat key]]:\r\n@set eatenkey\r\n\r\nYou know it's a really bad idea, but you swallow the key.\r\n\r\n[[Continue]]:\r\n<p>You see a potion and a key.</p>\r\n<p>[[Get the potion]](get potion,takenpotion=true)</p>\r\n<p>[[Get the key]](get key)</p>\r\n<p>[[Move on]](hallway)</p>\r\n\r\n[[get potion]]:\r\n\r\n<p>You pick up the potion</p>\r\n@set potions = 1\r\n{if key=true:}{else:<p>[[Get the key]](get key)</p>}\r\n<p>[[Move on]](hallway)</p>\r\n\r\n[[get key]]:\r\n\r\n@set key=true\r\n\r\n<p>you pick up the key</p>\r\n{if not takenpotion:<p>[[Get the potion]](get potion,takenpotion=true)</p>}\r\n\r\n<p>[[Move on]](hallway)</p>\r\n\r\n[[hallway]]:\r\n\r\nYou are in a hallway.\r\n\r\nDoorways lead to the [[zoo]] and the [[kitchen]].\r\n\r\n[[zoo]]:\r\n\r\nYou are in the zoo.\r\n\r\nYou can go to the [[science lab]] or the [[hallway]].\r\n\r\nThere is also a heavily locked cage door{if corroded: with acid burns on it}. You could kick it with all your strength and never make a dent. {if acid>0:Or you could try to [[melt through it with acid]].}{if key=true:Or [[use the key]] to open it.}\r\n\r\n[[melt through it with acid]]:\r\n@dec acid\r\n@inc bottles\r\n\r\n{if corroded:The bars are already melted, and drop right away. But security is charging angrily towards you, so your only option is to proceed [[into the cage]].}{else:{@corroded}The bars start to melt, but one bottle of acid isn't enough to remove them completely. And the zookeeper has called security, chasing you back towards the [[hallway]].}\r\n\r\n[[into the cage]]:\r\n    var completion = 30;\r\n    $.each(\"bottles potions acid key health talisman eatenkey dissolvedkey mixbottle soot\".split(/ /), function (i, attr) {\r\n      if (squiffy.get(attr)) {completion+=7};\r\n    });\r\n    squiffy.set('complete', completion);\r\n\r\n@set gameover\r\n\r\nYou step nervously into the zoo cage, wondering what kind of terrifying beast could lie beyond. A second later you see the cutest, most beautiful kitten you have ever laid eyes on, purring happily.\r\n\r\nCongratulations, this is as close as this game gets to an ending. I hope you've not found any bugs along the way.\r\n\r\nYou achieved {complete}% completion on this play through.\r\n\r\n[[use the key]]:\r\n{if eatenkey:You stick your fingers down your throat and attempt to regurgitate the key. Unfortunately, this doesn't seem to work so well.}{else:The key doesn't seem to fit this door. But the zookeeper has seen you fiddling around, and is charging towards you. You'll have to come back later, once you found the right key.}\r\n\r\nWould you like to flee towards the [[hallway]], or the [[science lab]]?\r\n\r\n[[science lab]]:\r\nYou are in a science lab.\r\n\r\nThere is a huge vat of acid against one wall. If you want to, you could try [[jumping in]]{if bottles>0:, or [[fill a bottle with acid]]}.\r\n\r\nAlternatively, you could go back up the stairs to the [[zoo]], or take the back passage to the [[carnival]].\r\n\r\n[[jumping in]]:\r\n    squiffy.afterText = function () {\r\n      squiffy.story.go('gameover');\r\n    };\r\n\r\nThat was a very silly thing to do. You are dead. In fact, you are very quickly dissolving.\r\n\r\n[[fill a bottle with acid]]:\r\nYou reach down to the acid vat, and attempt to collect some.\r\n\r\n{if bottles>0:{@acid+=1,bottles-=1}You quickly fill {if bottles=0:your empty bottle}{else:one of your bottles} with acid from the bath, being extra careful not to burn yourself.}{else:{@potions-=1,mixbottle+=1}But as you try to fill the bottle, it seems to be full of some sparkling rainbow liquid, very much like a health potion. You end up with a bottle filled with a weird mixture, which quickly solidifies.}\r\n\r\nNow you can {if bottles>0:[[fill another]](fill a bottle with acid) or }go to the [[zoo]] or the [[carnival]].\r\n\r\n[[carnival]]:\r\n    if (!squiffy.get('talisman') && squiffy.get('bottles')) { setTimeout(function () {squiffy.story.go('quick:fortune teller');}, 4000); }\r\n\r\nYou are in some kind of carnival or circus. You don't see much of interest, but there are all kinds of snake-oil salesmen trying to sell you weird stuff, and dancers so exotic you don't know where to look.\r\n\r\n{if tellerconfused:{if not talisman:{@talisman}A confused-looking fortune teller hands you a strange, mystic talisman. They seem to assume you will know what it means.}}\r\n\r\nFrom here, crowds block most of the exits but you can see a way to get inside to either the [[science lab]] or the [[kitchen]].\r\n\r\n[[fortune teller]]:\r\n    squiffy.set('tellerconfused', squiffy.get('bottles')==0);\r\n    squiffy.set('potions', squiffy.get('potions')+squiffy.get('bottles'));\r\n    squiffy.set('bottles', 0);\r\n\r\nAs you walk away, one of the carnival fortune tellers makes a strange gesture towards your back. You're not sure what happened, but you get a strange urge to look at the bottles you were carrying.\r\n\r\n{if tellerconfused:The bottles are exactly in the state you left them.{if not talisman: A second later, he calls out to you.}}\r\n\r\n[[drink potion]]:\r\n@dec potions\r\n@inc bottles\r\n\r\n@set health = true\r\n\r\n<p>Gulp! you are now healthy!</p>\r\n\r\n[[kitchen]]:\r\n\r\nYou are in a small galley kitchen that lies just off the main [[hallway]]. A back door leads outside, where there seems to be a [[carnival]] going on.\r\n\r\nThere is also a large sink, and a pile of glass [[bottles]](take bottle) which look like they have just been cleaned.\r\n\r\n[[take bottle]]:\r\n    if (squiffy.get('potions')+squiffy.get('bottles')+squiffy.get('acid') > 3) {\r\n      squiffy.story.go(\"handsfull\");\r\n    } else {\r\n      squiffy.set('bottles', squiffy.get('bottles')+1);\r\n    }\r\n    \r\nYou pick up a{if bottles>1:nother} bottle from the pile.\r\n\r\nWould yout like to [[take another]](take bottle), or go back to the [[hallway]], or out to the [[carnival]]?\r\n\r\n[[handsfull]]:\r\nYou're not some kind of octopus! Your hands are full\r\n\r\nYou can go to the [[hallway]], or the [[carnival]].\r\n\r\n[[drink acid]]:\r\n    squiffy.afterText = function () {\r\n      if (!squiffy.get('health')) {\r\n        squiffy.story.go('gameover');\r\n      } else {\r\n        squiffy.set('health', false);\r\n      }\r\n    };\r\n\r\n@dec acid\r\n@inc bottles\r\n\r\nYou drink a bottle of acid. That was a bit dumb.\r\n{if health=true:You are no longer healthy.{if eatenkey:{@not eatenkey,dissolvedkey} You immediately throw up, and can recover a rather corroded key from the pool on the floor.}}{else:You were already sick, and now you are dead.}\r\n\r\n[[discard mix]]:\r\n@set mixbottle = 0\r\n@set potions = 0\r\n@set acid = 0\r\n@set not health\r\n@set soot\r\n\r\n{if not eatenkey:{@not key}}\r\n\r\nYou throw the weird mixture away and it explodes, scorching your clothes and burning up most of the things you were carrying.\r\n\r\n[[gameover]]:\r\n\r\n@set gameover = true\r\n\r\nGAME OVER\r\n\r\nThis is the end of the game for now, but there should be a restart link somewhere in the top right.\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>OK. Here's the updated version of the game. Very small changes to the code itself.</p>\n<p>I'll post this here before I experiment with the buttons, because I don't want to break something else and not have a copy of the code to come back to. If it fixes the slowdown, I'll update the code here.</p>\n<p>EDIT: I'm a complete idiot. Somehow I managed to drag two lines to the wrong place and didn't notice after I read and re-read it a dozen times.<br>\nEDIT2: A small logic error in one of the puzzles.</p>\n<pre><code>@title Inventory test game\n\n[[Start]]:\n    $(function () {\n      if (!squiffy.story.originalGo) {\n        window.sq = squiffy;\n        var updateSidebar = function () {\n          if (!$('#sidebar').length) {\n            squiffy.ui.write(squiffy.story.sections['sidebar container'].text);\n            // Ugly hack to stop the sidebar being hidden by the top/bottom bars in the editor\n            // and allow you to remove the sidebar so you can look at the code while testing\n            //     (it will reappear as soon as you visit another section in the game)\n            if ($('.ui-layout-north:visible').length) {\n              $('#showinv').css('top', $('#showinv').offset()['top']+92);\n              $('#sidebar').css('top', $('#sidebar').offset()['top']+92);\n              $('#sidebar').css('bottom', '100px');\n              $('&lt;button&gt;', {id: 'killsidebar', style: 'position: absolute; bottom: 4px; right: 4px'}).click(function () {\n                $('#killsidebar,#sidebar,#showinv').remove();\n              }).text('kill sidebar').appendTo('#sidebar');\n            }\n            $('#showinv').click(e =&gt; $('#sidebar').animate({left: 0}));\n            $('#hideinv').click(e =&gt; $('#sidebar').animate({left: 5-$('#sidebar').width()}));\n          }\n          if ($('#sidebar:visible').length) {\n            $('#sidebar').children(':not(#hideinv,#killsidebar)').remove();\n            $('#sidebar').append(squiffy.ui.processText(squiffy.story.sections['sidebar contents'].text));\n            if (squiffy.get('gameover')) {\n              $('#sidebar a').remove();\n            }\n          }\n        };\n        squiffy.story.originalGo = squiffy.story.go;\n        squiffy.story.go = function (section) {\n          console.log(\"go called for \"+section);\n          if (section.match(/^quick:/)) {\n            var sec = squiffy.story.sections[section.replace(/^quick:\\s*/, '')];\n            if (!sec) {\n              console.log(\"No such section: \"+section);\n              return;\n            }\n            squiffy.story.run(sec);\n            squiffy.ui.write('&lt;blockquote style=\"display: block; left: 2em; right: 2em; border: 1px dotted grey;\"&gt;' + sec.text + '&lt;/blockquote&gt;');\n            squiffy.story.save();\n          } else {\n            console.log(\"Running originalGo\");\n            squiffy.story.originalGo (section);\n          }\n          if (squiffy.afterText) {\n            var after = squiffy.afterText;\n            delete(squiffy['afterText']);\n            after();\n          }\n          updateSidebar();\n        };\n        updateSidebar();\n      }\n    });\n\n@set potions = 0\n@set bottles = 1\n@set acid = 0\n    \nThis is the starting page! Is it working?\n\n[[Continue]]\n\n[[sidebar container]]:\n&lt;button style=\"position: fixed; top: 6px; left: 2px;\" id=\"showinv\" type=\"button\"&gt;Show sidebar&lt;/button&gt;\n&lt;div id=\"sidebar\" style=\"background-color: white; position: fixed; left: 1px; top: 4px; bottom: 4px; width: 20%; overflow-y: auto; border: 1px double blue;\"&gt;&lt;button style=\"position: absolute; top: 2px; right: 2px;\" id=\"hideinv\"  type=\"button\"&gt;Hide sidebar&lt;/button&gt;&lt;/div&gt;\n\n[[sidebar contents]]:\n\n&lt;p style=\"font-weight: bold;\"&gt;Inventory&lt;/p&gt;\n\n&lt;p&gt;You are {if health=true:healthy}{else: unhealthy}.&lt;/p&gt;\n\n{if potions&gt;0:&lt;p&gt;{if potions&gt;1:Has {potions} potions}{else:Has a potion}. [[Drink potion]](quick:drink potion)&lt;/p&gt;}\n{if acid&gt;0:&lt;p&gt;{if acid&gt;1:Has {acid} flasks of acid}{else:Has an acid flask}. [[Drink acid]](quick:drink acid)&lt;/p&gt;}\n{if bottles&gt;0:&lt;p&gt;{if bottles&gt;1:Has {bottles} empty flasks}{else:Has an empty flask}.&lt;/p&gt;}\n{if mixbottle&gt;0:&lt;p&gt;{if mixbottle&gt;1:Has {mixbottle} flasks}{else:Has a flask} filled with a weird goop you can't pour out. [[Discard]](quick:discard mix)&lt;/p&gt;}\n{if key=true:&lt;p&gt;Has {if dissolvedkey:partially dissolved }key {if not eatenkey:[[Swallow]](quick:eat key)}{else:(swallowed)}&lt;/p&gt;}\n{if soot:&lt;p&gt;Covered in soot.&lt;/p&gt;}\n{if talisman=true:&lt;p&gt;Has weird glowing talisman [[Rub]](quick:rub talisman)&lt;/p&gt;}\n</code></pre>\n<p>And a collapsible bit for all the stuff that's pretty much an example of how to use the code above:</p>\n<details><summary>Click to expand</summary>\nHere's the code:\n<pre><code>[[rub talisman]]:\n@set not talisman\n\nYou rub the talisman, and your hair seems to stand on end. You feel like an epic vision-quest is about to begin. {if bottles&gt;0:{@bottles-=1}{@potions+=1}Suddenly, with a sloshing sound, one of your empty bottles fills up with a rainbow-coloured liquid. }Then the talisman vanishes.\n\n[[eat key]]:\n@set eatenkey\n\nYou know it's a really bad idea, but you swallow the key.\n\n[[Continue]]:\n&lt;p&gt;You see a potion and a key.&lt;/p&gt;\n&lt;p&gt;[[Get the potion]](get potion,takenpotion=true)&lt;/p&gt;\n&lt;p&gt;[[Get the key]](get key)&lt;/p&gt;\n&lt;p&gt;[[Move on]](hallway)&lt;/p&gt;\n\n[[get potion]]:\n\n&lt;p&gt;You pick up the potion&lt;/p&gt;\n@set potions = 1\n{if key=true:}{else:&lt;p&gt;[[Get the key]](get key)&lt;/p&gt;}\n&lt;p&gt;[[Move on]](hallway)&lt;/p&gt;\n\n[[get key]]:\n\n@set key=true\n\n&lt;p&gt;you pick up the key&lt;/p&gt;\n{if not takenpotion:&lt;p&gt;[[Get the potion]](get potion,takenpotion=true)&lt;/p&gt;}\n\n&lt;p&gt;[[Move on]](hallway)&lt;/p&gt;\n\n[[hallway]]:\n\nYou are in a hallway.\n\nDoorways lead to the [[zoo]] and the [[kitchen]].\n\n[[zoo]]:\n\nYou are in the zoo.\n\nYou can go to the [[science lab]] or the [[hallway]].\n\nThere is also a heavily locked cage door{if corroded: with acid burns on it}. You could kick it with all your strength and never make a dent. {if acid&gt;0:Or you could try to [[melt through it with acid]].}{if key=true:Or [[use the key]] to open it.}\n\n[[melt through it with acid]]:\n@dec acid\n@inc bottles\n\n{if corroded:The bars are already melted, and drop right away. But security is charging angrily towards you, so your only option is to proceed [[into the cage]].}{else:{@corroded}The bars start to melt, but one bottle of acid isn't enough to remove them completely. And the zookeeper has called security, chasing you back towards the [[hallway]].}\n\n[[into the cage]]:\n    var completion = 30;\n    $.each(\"bottles potions acid key health talisman eatenkey dissolvedkey mixbottle soot\".split(/ /), function (i, attr) {\n      if (squiffy.get(attr)) {completion+=7};\n    });\n    squiffy.set('complete', completion);\n\n@set gameover\n\nYou step nervously into the zoo cage, wondering what kind of terrifying beast could lie beyond. A second later you see the cutest, most beautiful kitten you have ever laid eyes on, purring happily.\n\nCongratulations, this is as close as this game gets to an ending. I hope you've not found any bugs along the way.\n\nYou achieved {complete}% completion on this play through.\n\n[[use the key]]:\n{if eatenkey:You stick your fingers down your throat and attempt to regurgitate the key. Unfortunately, this doesn't seem to work so well.}{else:The key doesn't seem to fit this door. But the zookeeper has seen you fiddling around, and is charging towards you. You'll have to come back later, once you found the right key.}\n\nWould you like to flee towards the [[hallway]], or the [[science lab]]?\n\n[[science lab]]:\nYou are in a science lab.\n\nThere is a huge vat of acid against one wall. If you want to, you could try [[jumping in]]{if bottles&gt;0:, or [[fill a bottle with acid]]}.\n\nAlternatively, you could go back up the stairs to the [[zoo]], or take the back passage to the [[carnival]].\n\n[[jumping in]]:\n    squiffy.afterText = function () {\n      squiffy.story.go('gameover');\n    };\n\nThat was a very silly thing to do. You are dead. In fact, you are very quickly dissolving.\n\n[[fill a bottle with acid]]:\nYou reach down to the acid vat, and attempt to collect some.\n\n{if bottles&gt;0:{@acid+=1,bottles-=1}You quickly fill {if bottles=0:your empty bottle}{else:one of your bottles} with acid from the bath, being extra careful not to burn yourself.}{else:{@potions-=1,mixbottle+=1}But as you try to fill the bottle, it seems to be full of some sparkling rainbow liquid, very much like a health potion. You end up with a bottle filled with a weird mixture, which quickly solidifies.}\n\nNow you can {if bottles&gt;0:[[fill another]](fill a bottle with acid) or }go to the [[zoo]] or the [[carnival]].\n\n[[carnival]]:\n    if (!squiffy.get('talisman') &amp;&amp; squiffy.get('bottles')) { setTimeout(function () {squiffy.story.go('quick:fortune teller');}, 4000); }\n\nYou are in some kind of carnival or circus. You don't see much of interest, but there are all kinds of snake-oil salesmen trying to sell you weird stuff, and dancers so exotic you don't know where to look.\n\n{if tellerconfused:{if not talisman:{@talisman}A confused-looking fortune teller hands you a strange, mystic talisman. They seem to assume you will know what it means.}}\n\nFrom here, crowds block most of the exits but you can see a way to get inside to either the [[science lab]] or the [[kitchen]].\n\n[[fortune teller]]:\n    squiffy.set('tellerconfused', squiffy.get('bottles')==0);\n    squiffy.set('potions', squiffy.get('potions')+squiffy.get('bottles'));\n    squiffy.set('bottles', 0);\n\nAs you walk away, one of the carnival fortune tellers makes a strange gesture towards your back. You're not sure what happened, but you get a strange urge to look at the bottles you were carrying.\n\n{if tellerconfused:The bottles are exactly in the state you left them.{if not talisman: A second later, he calls out to you.}}\n\n[[drink potion]]:\n@dec potions\n@inc bottles\n\n@set health = true\n\n&lt;p&gt;Gulp! you are now healthy!&lt;/p&gt;\n\n[[kitchen]]:\n\nYou are in a small galley kitchen that lies just off the main [[hallway]]. A back door leads outside, where there seems to be a [[carnival]] going on.\n\nThere is also a large sink, and a pile of glass [[bottles]](take bottle) which look like they have just been cleaned.\n\n[[take bottle]]:\n    if (squiffy.get('potions')+squiffy.get('bottles')+squiffy.get('acid') &gt; 3) {\n      squiffy.story.go(\"handsfull\");\n    } else {\n      squiffy.set('bottles', squiffy.get('bottles')+1);\n    }\n    \nYou pick up a{if bottles&gt;1:nother} bottle from the pile.\n\nWould yout like to [[take another]](take bottle), or go back to the [[hallway]], or out to the [[carnival]]?\n\n[[handsfull]]:\nYou're not some kind of octopus! Your hands are full\n\nYou can go to the [[hallway]], or the [[carnival]].\n\n[[drink acid]]:\n    squiffy.afterText = function () {\n      if (!squiffy.get('health')) {\n        squiffy.story.go('gameover');\n      } else {\n        squiffy.set('health', false);\n      }\n    };\n\n@dec acid\n@inc bottles\n\nYou drink a bottle of acid. That was a bit dumb.\n{if health=true:You are no longer healthy.{if eatenkey:{@not eatenkey,dissolvedkey} You immediately throw up, and can recover a rather corroded key from the pool on the floor.}}{else:You were already sick, and now you are dead.}\n\n[[discard mix]]:\n@set mixbottle = 0\n@set potions = 0\n@set acid = 0\n@set not health\n@set soot\n\n{if not eatenkey:{@not key}}\n\nYou throw the weird mixture away and it explodes, scorching your clothes and burning up most of the things you were carrying.\n\n[[gameover]]:\n\n@set gameover = true\n\nGAME OVER\n\nThis is the end of the game for now, but there should be a restart link somewhere in the top right.\n</code></pre>\n\n</details>",
      "PostDate": "2020-08-30T19:08:50.782955Z",
      "LastEditDate": "2020-08-30T19:39:53.6384784Z",
      "link": null
    },
    {
      "PostId": "5417868e-1a46-4c4a-bc82-87c3e6048f24",
      "UserId": 471394,
      "Username": "fvu109",
      "AvatarUrl": "https://secure.gravatar.com/avatar/b895f3cf2b427a32e38299edd44559a5?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "The show/hide is looking good now - what did you diagnose as the issue causing it to slow down before?\r\n\r\nI couldn't figure out how to get the talisman running this version!\r\n\r\nI'm going to study your code tomorrow and apply it to my game. Thanks again for all your work on this!",
      "EditableFormat": "markdown",
      "HTML": "<p>The show/hide is looking good now - what did you diagnose as the issue causing it to slow down before?</p>\n<p>I couldn't figure out how to get the talisman running this version!</p>\n<p>I'm going to study your code tomorrow and apply it to my game. Thanks again for all your work on this!</p>\n\n",
      "PostDate": "2020-08-30T21:19:06.5829408Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
