{
  "Topic": {
    "TopicId": "5yx5o-j4bu_nw82oty3cta",
    "ForumId": "15",
    "Title": "JavaScript By Reference Issue",
    "LastUpdated": "2024-08-11T18:50:32.9095327Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "376e2939-5224-43db-86ab-4705c94ab819",
      "UserId": 587281,
      "Username": "PsychoVyse",
      "AvatarUrl": "https://secure.gravatar.com/avatar/f359107abf9dc8cfe62bba1e4a8e84a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "As another component of my game I wanted to create a new popup window for Skills, now I have the window aspect mostly working but I'm trying to figure out an issue with variable scoping when by referencing through to another function and I tried various methods but JS seems to be very confusing when it comes to this compared to other languages I know and use regularly so I created this example to debug but I'm not getting much further at the moment so I came for help.\r\n\r\nMy variable availableSP doesn't want to be updated beyond the call to increaseSkill(), and also for some weird reason my \"INT\" skill (or any 1st entry in the skills[] array) cannot be found by my array search function arrayObjectIndexOf(). \r\n\r\nAny ideas what I'm doing wrong please?\r\n\r\ndata.js\r\n```\r\n\"use strict\"\r\n\r\ncreateItem(\"me\", PLAYER(), {\r\n    loc: \"lounge\",\r\n    skillpoints: 4,\r\n    intelligence: 1,\r\n    strength: 1,\r\n    stamina: 1,\r\n    magic: 1,\r\n  synonyms:['me', 'myself'],\r\n  examine: \"Just a regular guy.\",\r\n})\r\n\r\ncreateRoom(\"lounge\", {\r\n  desc:\"The lounge is boring, the author really needs to put stuff in it.\",\r\n})\r\n\r\ncreateItem(\"SkillWindow\", {\r\n    alias: \"Skill Window\",\r\n    loc: \"lounge\",\r\n    hereVerbs: [\"Interact\"],\r\n    examine: \"A tool for upgrading your skills\",\r\n    interact: function () {\r\n        msg(\"<a href=\\\"javascript:void(0);\\\" onclick=\\\"skillsUpgrade(w.me.skillpoints)\\\">Upgrade</a>\")\r\n    },\r\n})\r\n\r\nconst skills = [\r\n    {\r\n        name: \"INT\",\r\n        desc: \"Intelligence\",\r\n        title: \"Your character's intelligence level\",\r\n        currentValue: 0,\r\n        maxValue: 0,\r\n        skillIncrement: 1,\r\n        skillPointsAdded: 0\r\n    },\r\n    {\r\n        name: \"STR\",\r\n        desc: \"Strength\",\r\n        title: \"Your character's strength level\",\r\n        currentValue: 0,\r\n        maxValue: 100,\r\n        skillIncrement: 1,\r\n        skillPointsAdded: 0\r\n    },\r\n    {\r\n        name: \"STA\",\r\n        desc: \"Stamina\",\r\n        title: \"Your character's stamina level\",\r\n        currentValue: 0,\r\n        maxValue: 100,\r\n        skillIncrement: 1,\r\n        skillPointsAdded: 0\r\n    },\r\n    {\r\n        name: \"MAG\",\r\n        desc: \"Stamina\",\r\n        title: \"Your character's stamina level\",\r\n        currentValue: 0,\r\n        maxValue: 0,\r\n        skillIncrement: 2,\r\n        skillPointsAdded: 0\r\n    }\r\n]\r\n\r\nlet availableSP = 4\r\nfunction skillsUpgrade() {\r\n\r\n    console.log(\"Available Skill Points Before - \" + availableSP)\r\n\r\n    for (let skill of skills) {\r\n\r\n        switch (skill.name) {\r\n            case \"INT\":\r\n                skill.currentValue = w.me.intelligence\r\n                break;\r\n            case \"STR\":\r\n                skill.currentValue = w.me.strength\r\n                break;\r\n            case \"STA\":\r\n                skill.currentValue = w.me.stamina\r\n                break;\r\n            case \"MAG\":\r\n                skill.currentValue = w.me.stamina\r\n                break;\r\n        }\r\n        console.log(\"Skill \" + skill.name + \" Old Value - \" + skill.currentValue)\r\n        increaseSkill(skill.name, 1, availableSP)\r\n        console.log(\"Skill \" + skill.name + \" New Value - \" + skill.currentValue)\r\n        console.log(\"Available Skill Points After - \" + availableSP)\r\n    }\r\n}\r\n\r\nfunction increaseSkill(sSkill, skillpoint, availableSP) {\r\n\r\n    var iSkillIndex = arrayObjectIndexOf(skills, sSkill, \"name\");\r\n\r\n    if (iSkillIndex < 1) {\r\n        // Something went wrong\r\n        console.log(\"Skill \" + sSkill + \" not found in skill list\")\r\n        return false\r\n    }\r\n    else {\r\n        console.log(\"Skill \" + sSkill + \" found in skill list\")\r\n    }\r\n    var skill = skills[iSkillIndex]\r\n\r\n    skill.skillPointsAdded += skillpoint\r\n\r\n    skill.currentValue += (skill.skillIncrement * skill.skillPointsAdded)\r\n\r\n    availableSP--\r\n    console.log(\"Available Skill Points Inside - \" + availableSP)\r\n\r\n    // Update the array again\r\n    skills[iSkillIndex] = skill\r\n}\r\n\r\n\r\nfunction arrayObjectIndexOf(myArray, searchTerm, property) {\r\n    for (var i = 0, len = myArray.length; i < len; i++) {\r\n        if (myArray[i][property] === searchTerm)\r\n            return i;\r\n    }\r\n    return -1;\r\n}\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>As another component of my game I wanted to create a new popup window for Skills, now I have the window aspect mostly working but I'm trying to figure out an issue with variable scoping when by referencing through to another function and I tried various methods but JS seems to be very confusing when it comes to this compared to other languages I know and use regularly so I created this example to debug but I'm not getting much further at the moment so I came for help.</p>\n<p>My variable availableSP doesn't want to be updated beyond the call to increaseSkill(), and also for some weird reason my \"INT\" skill (or any 1st entry in the skills[] array) cannot be found by my array search function arrayObjectIndexOf().</p>\n<p>Any ideas what I'm doing wrong please?</p>\n<p>data.js</p>\n<pre><code>\"use strict\"\n\ncreateItem(\"me\", PLAYER(), {\n    loc: \"lounge\",\n    skillpoints: 4,\n    intelligence: 1,\n    strength: 1,\n    stamina: 1,\n    magic: 1,\n  synonyms:['me', 'myself'],\n  examine: \"Just a regular guy.\",\n})\n\ncreateRoom(\"lounge\", {\n  desc:\"The lounge is boring, the author really needs to put stuff in it.\",\n})\n\ncreateItem(\"SkillWindow\", {\n    alias: \"Skill Window\",\n    loc: \"lounge\",\n    hereVerbs: [\"Interact\"],\n    examine: \"A tool for upgrading your skills\",\n    interact: function () {\n        msg(\"&lt;a href=\\\"javascript:void(0);\\\" onclick=\\\"skillsUpgrade(w.me.skillpoints)\\\"&gt;Upgrade&lt;/a&gt;\")\n    },\n})\n\nconst skills = [\n    {\n        name: \"INT\",\n        desc: \"Intelligence\",\n        title: \"Your character's intelligence level\",\n        currentValue: 0,\n        maxValue: 0,\n        skillIncrement: 1,\n        skillPointsAdded: 0\n    },\n    {\n        name: \"STR\",\n        desc: \"Strength\",\n        title: \"Your character's strength level\",\n        currentValue: 0,\n        maxValue: 100,\n        skillIncrement: 1,\n        skillPointsAdded: 0\n    },\n    {\n        name: \"STA\",\n        desc: \"Stamina\",\n        title: \"Your character's stamina level\",\n        currentValue: 0,\n        maxValue: 100,\n        skillIncrement: 1,\n        skillPointsAdded: 0\n    },\n    {\n        name: \"MAG\",\n        desc: \"Stamina\",\n        title: \"Your character's stamina level\",\n        currentValue: 0,\n        maxValue: 0,\n        skillIncrement: 2,\n        skillPointsAdded: 0\n    }\n]\n\nlet availableSP = 4\nfunction skillsUpgrade() {\n\n    console.log(\"Available Skill Points Before - \" + availableSP)\n\n    for (let skill of skills) {\n\n        switch (skill.name) {\n            case \"INT\":\n                skill.currentValue = w.me.intelligence\n                break;\n            case \"STR\":\n                skill.currentValue = w.me.strength\n                break;\n            case \"STA\":\n                skill.currentValue = w.me.stamina\n                break;\n            case \"MAG\":\n                skill.currentValue = w.me.stamina\n                break;\n        }\n        console.log(\"Skill \" + skill.name + \" Old Value - \" + skill.currentValue)\n        increaseSkill(skill.name, 1, availableSP)\n        console.log(\"Skill \" + skill.name + \" New Value - \" + skill.currentValue)\n        console.log(\"Available Skill Points After - \" + availableSP)\n    }\n}\n\nfunction increaseSkill(sSkill, skillpoint, availableSP) {\n\n    var iSkillIndex = arrayObjectIndexOf(skills, sSkill, \"name\");\n\n    if (iSkillIndex &lt; 1) {\n        // Something went wrong\n        console.log(\"Skill \" + sSkill + \" not found in skill list\")\n        return false\n    }\n    else {\n        console.log(\"Skill \" + sSkill + \" found in skill list\")\n    }\n    var skill = skills[iSkillIndex]\n\n    skill.skillPointsAdded += skillpoint\n\n    skill.currentValue += (skill.skillIncrement * skill.skillPointsAdded)\n\n    availableSP--\n    console.log(\"Available Skill Points Inside - \" + availableSP)\n\n    // Update the array again\n    skills[iSkillIndex] = skill\n}\n\n\nfunction arrayObjectIndexOf(myArray, searchTerm, property) {\n    for (var i = 0, len = myArray.length; i &lt; len; i++) {\n        if (myArray[i][property] === searchTerm)\n            return i;\n    }\n    return -1;\n}\n</code></pre>\n\n",
      "PostDate": "2024-08-11T18:50:32.9095327Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "6f2b75f9-93bb-4140-8bf5-2d60016fc7ab",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "You're passing `availableSP` as an argument to the function `increaseSkill`. This creates a local variable named `availableSP` which starts with the same value as the one outside the function.\r\n\r\nAt the start of the increaseSkill function, you also have:\r\n\r\n>     if (iSkillIndex < 1) {\r\n>        // Something went wrong\r\n\r\nNote that the first item in an array has index 0 - so this will treat the first item in the array as an error. You probably wanted `if (iSkillIndex < 0) {`",
      "EditableFormat": "markdown",
      "HTML": "<p>You're passing <code>availableSP</code> as an argument to the function <code>increaseSkill</code>. This creates a local variable named <code>availableSP</code> which starts with the same value as the one outside the function.</p>\n<p>At the start of the increaseSkill function, you also have:</p>\n<blockquote>\n<pre><code>if (iSkillIndex &lt; 1) {\n   // Something went wrong\n</code></pre>\n</blockquote>\n<p>Note that the first item in an array has index 0 - so this will treat the first item in the array as an error. You probably wanted <code>if (iSkillIndex &lt; 0) {</code></p>\n\n",
      "PostDate": "2024-08-12T09:25:20.5727668Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "314608d9-4ed7-46c2-b423-4018eb866f3f",
      "UserId": 587281,
      "Username": "PsychoVyse",
      "AvatarUrl": "https://secure.gravatar.com/avatar/f359107abf9dc8cfe62bba1e4a8e84a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Doh, I'm so used to languages being able to handle by ref with local versions of the same variable name, I'll try to remember that. Also thanks for the array fix too.",
      "EditableFormat": "markdown",
      "HTML": "<p>Doh, I'm so used to languages being able to handle by ref with local versions of the same variable name, I'll try to remember that. Also thanks for the array fix too.</p>\n\n",
      "PostDate": "2024-08-12T11:58:33.3601387Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
