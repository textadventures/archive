{
  "Topic": {
    "TopicId": "w52to8yizekaavmgxfpaxw",
    "ForumId": "18",
    "Title": "Additional Scrolling Functions: scrollToTop, scrollOnePage, and stopScroll Javascript Functions",
    "LastUpdated": "2022-10-02T04:43:36.3039485Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "1f21f570-52af-41fa-b77d-2c5cf06f8c0d",
      "UserId": 599148,
      "Username": "DeepDredux",
      "AvatarUrl": "https://secure.gravatar.com/avatar/ffc0a462eee626f6c92795e847e46890?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Had a use case for my game where I wanted to be able to force the interface to scroll to the top of the page on-demand, but by default Quest will scroll to the bottom of the page as new text is added to the screen (thanks to internal calls of the built-in ```JS.scrollToEnd()``` function). \r\n\r\nCame across an old forum post from 2019 talking about the desire to force a scroll to the top ([link](http://textadventures.co.uk/forum/quest/topic/grsjrpwtl0qvn4q5a6kmua/force-a-scroll-to-the-top)), but the accepted solution seemed to simply disable the ```JS.scrollToEnd()``` function entirely, so the game **never** scrolls to the bottom of the page when new text appears. I didn't like that either, so I came up some custom, scrolling-based functions, bundled into a custom .js file:\r\n\r\n```\r\n// Adds a new JS.scrollToTop function that should scroll to the top of the current page\r\n// Adds a new JS.stopScroll function that will temporarily stop the interface from scrolling to the bottom of the page when the next text is rendered.\r\n// Adds a new JS.scrollOnePage function that will ONLY scroll down one page at a time, even if the rendered text extends beyond that.\r\n// And overrides the existing JS.scrollToEnd function to add additional logic to account for them\r\n\r\nvar scrollToTopFlag = 0;\r\nvar stopScrollFlag = 0;\r\nvar scrollOnePageFlag = 0;\r\nfunction scrollToTop() {\r\n\tscrollToTopFlag = 1;\r\n\t// May not be necessary to animate the scrolling here (rather than only in scrollToEnd), but just in case... Shouldn't hurt anything\r\n\t$('html,body').animate({ scrollTop: 0 }, 'fast');\r\n}\r\n\r\nfunction stopScroll() {\r\n\tstopScrollFlag = 1;\r\n}\r\n\r\nfunction scrollOnePage() {\r\n\tscrollOnePageFlag = 1;\r\n}\r\n\r\nfunction scrollToEnd() {\r\n\tif (!stopScrollFlag) {\r\n\t\tif (!scrollOnePageFlag) {\r\n\t\t\tif (!scrollToTopFlag) {\r\n\t\t\t\tvar scrollTo = _animateScroll ? beginningOfCurrentTurnScrollPosition - 50 - $(\"#gamePanelSpacer\").height() : $(document).height();\r\n\t\t\t\tvar currentScrollTop = Math.max($(\"body\").scrollTop(), $(\"html\").scrollTop());\r\n\t\t\t\tif (scrollTo > currentScrollTop) {\r\n\t\t\t\t\tvar maxScrollTop = $(document).height() - $(window).height();\r\n\t\t\t\t\tif (scrollTo > maxScrollTop) scrollTo = maxScrollTop;\r\n\t\t\t\t\tvar distance = scrollTo - currentScrollTop;\r\n\t\t\t\t\tvar duration = _animateScroll ? distance / 0.4 : 1;\r\n\t\t\t\t\t// Added by The Pixie on behalf of alexandretorres\r\n\t\t\t\t\tif (duration>2000) duration=2000;\r\n\t\t\t\t\t$(\"body,html\").stop().animate({ scrollTop: scrollTo }, duration, \"easeInOutCubic\");\r\n\t\t\t\t}\r\n\t\t\t\t$(\"#txtCommand\").focus();\r\n\t\t\t\t// Added by The Pixie; this is a fall back, as the above seems not to work on some browsers\r\n\t\t\t\t// In fact it may be the all the rest of this can deleted\r\n\t\t\t\t$('html,body').animate({ scrollTop: document.body.scrollHeight }, 'fast');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$('html,body').animate({ scrollTop: 0 }, 'fast');\r\n\t\t\t\tscrollToTopFlag = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar pageSize = 0.9 * ($(window).height() - $(\"#gamePanelSpacer\").height() - $(\"#txtCommandDiv\").height());\r\n\t\t\tvar scrollPageDes = Math.max($(\"body\").scrollTop(), $(\"html\").scrollTop()) + pageSize\r\n\t\t\t// Use similar scroll speed to standard scrollToEnd\r\n\t\t\tvar pageSpeed = _animateScroll ? pageSize / 0.5 : 1\r\n\t\t\tif (pageSpeed>2000) pageSpeed=2000;\r\n\t\t\t$('html,body').animate({ scrollTop: scrollPageDes }, pageSpeed, \"easeInOutCubic\");\r\n\t\t\tscrollOnePageFlag = 0;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tstopScrollFlag = 0;\r\n\t}\r\n}\r\n```\r\n\r\n ```JS.scrollToTop()```  will scroll to the top of the page any time it is called, but otherwise leave the default \"scroll-to-end\" behavior intact for subsequent scrollToEnd calls.\r\n\r\n ```JS.stopScroll()``` will temporarily stop Quest from scrolling to the bottom of the page for the text text that is rendered. Again, subsequent scrollToEnd calls will scroll to the bottom of the page as-normal.\r\n\r\n```JS.scrollOnePage()``` will make it so that the next time scrollToEnd is called, it will only scroll down a single page. Used some of mrangel's code from the 2019 forum post above for this one.\r\n\r\n\r\nTo add these to your game, save off the above code into a javascript ```.js``` file and load it into your game using the advanced options. If you don't know how to do that, I think there's a tutorial on the site here somewhere for adding custom java code.\r\n\r\nHope someone else can also find these useful.",
      "EditableFormat": "markdown",
      "HTML": "<p>Had a use case for my game where I wanted to be able to force the interface to scroll to the top of the page on-demand, but by default Quest will scroll to the bottom of the page as new text is added to the screen (thanks to internal calls of the built-in <code>JS.scrollToEnd()</code> function).</p>\n<p>Came across an old forum post from 2019 talking about the desire to force a scroll to the top (<a href=\"http://textadventures.co.uk/forum/quest/topic/grsjrpwtl0qvn4q5a6kmua/force-a-scroll-to-the-top\">link</a>), but the accepted solution seemed to simply disable the <code>JS.scrollToEnd()</code> function entirely, so the game <strong>never</strong> scrolls to the bottom of the page when new text appears. I didn't like that either, so I came up some custom, scrolling-based functions, bundled into a custom .js file:</p>\n<pre><code>// Adds a new JS.scrollToTop function that should scroll to the top of the current page\n// Adds a new JS.stopScroll function that will temporarily stop the interface from scrolling to the bottom of the page when the next text is rendered.\n// Adds a new JS.scrollOnePage function that will ONLY scroll down one page at a time, even if the rendered text extends beyond that.\n// And overrides the existing JS.scrollToEnd function to add additional logic to account for them\n\nvar scrollToTopFlag = 0;\nvar stopScrollFlag = 0;\nvar scrollOnePageFlag = 0;\nfunction scrollToTop() {\n\tscrollToTopFlag = 1;\n\t// May not be necessary to animate the scrolling here (rather than only in scrollToEnd), but just in case... Shouldn't hurt anything\n\t$('html,body').animate({ scrollTop: 0 }, 'fast');\n}\n\nfunction stopScroll() {\n\tstopScrollFlag = 1;\n}\n\nfunction scrollOnePage() {\n\tscrollOnePageFlag = 1;\n}\n\nfunction scrollToEnd() {\n\tif (!stopScrollFlag) {\n\t\tif (!scrollOnePageFlag) {\n\t\t\tif (!scrollToTopFlag) {\n\t\t\t\tvar scrollTo = _animateScroll ? beginningOfCurrentTurnScrollPosition - 50 - $(\"#gamePanelSpacer\").height() : $(document).height();\n\t\t\t\tvar currentScrollTop = Math.max($(\"body\").scrollTop(), $(\"html\").scrollTop());\n\t\t\t\tif (scrollTo &gt; currentScrollTop) {\n\t\t\t\t\tvar maxScrollTop = $(document).height() - $(window).height();\n\t\t\t\t\tif (scrollTo &gt; maxScrollTop) scrollTo = maxScrollTop;\n\t\t\t\t\tvar distance = scrollTo - currentScrollTop;\n\t\t\t\t\tvar duration = _animateScroll ? distance / 0.4 : 1;\n\t\t\t\t\t// Added by The Pixie on behalf of alexandretorres\n\t\t\t\t\tif (duration&gt;2000) duration=2000;\n\t\t\t\t\t$(\"body,html\").stop().animate({ scrollTop: scrollTo }, duration, \"easeInOutCubic\");\n\t\t\t\t}\n\t\t\t\t$(\"#txtCommand\").focus();\n\t\t\t\t// Added by The Pixie; this is a fall back, as the above seems not to work on some browsers\n\t\t\t\t// In fact it may be the all the rest of this can deleted\n\t\t\t\t$('html,body').animate({ scrollTop: document.body.scrollHeight }, 'fast');\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$('html,body').animate({ scrollTop: 0 }, 'fast');\n\t\t\t\tscrollToTopFlag = 0;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tvar pageSize = 0.9 * ($(window).height() - $(\"#gamePanelSpacer\").height() - $(\"#txtCommandDiv\").height());\n\t\t\tvar scrollPageDes = Math.max($(\"body\").scrollTop(), $(\"html\").scrollTop()) + pageSize\n\t\t\t// Use similar scroll speed to standard scrollToEnd\n\t\t\tvar pageSpeed = _animateScroll ? pageSize / 0.5 : 1\n\t\t\tif (pageSpeed&gt;2000) pageSpeed=2000;\n\t\t\t$('html,body').animate({ scrollTop: scrollPageDes }, pageSpeed, \"easeInOutCubic\");\n\t\t\tscrollOnePageFlag = 0;\n\t\t}\n\t}\n\telse {\n\t\tstopScrollFlag = 0;\n\t}\n}\n</code></pre>\n<p><code>JS.scrollToTop()</code>  will scroll to the top of the page any time it is called, but otherwise leave the default \"scroll-to-end\" behavior intact for subsequent scrollToEnd calls.</p>\n<p><code>JS.stopScroll()</code> will temporarily stop Quest from scrolling to the bottom of the page for the text text that is rendered. Again, subsequent scrollToEnd calls will scroll to the bottom of the page as-normal.</p>\n<p><code>JS.scrollOnePage()</code> will make it so that the next time scrollToEnd is called, it will only scroll down a single page. Used some of mrangel's code from the 2019 forum post above for this one.</p>\n<p>To add these to your game, save off the above code into a javascript <code>.js</code> file and load it into your game using the advanced options. If you don't know how to do that, I think there's a tutorial on the site here somewhere for adding custom java code.</p>\n<p>Hope someone else can also find these useful.</p>\n\n",
      "PostDate": "2022-10-02T04:43:36.3039485Z",
      "LastEditDate": "2022-10-02T05:23:29.741241Z",
      "link": null
    }
  ]
}
