{
  "Topic": {
    "TopicId": "f30v7penx0iruxihbfax5a",
    "ForumId": "18",
    "Title": "Put MULTIPLE OBJECTS in Container (\"put\" command mod for Quest 5.8)",
    "LastUpdated": "2018-05-24T07:24:35.723242Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "9e14c300-57ed-45a7-b2f6-e70122961fa0",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "# This version of the ```put``` command is not included in Quest 5.8!\r\n\r\n## This is a mod.\r\n\r\n---\r\nmrangel came up with a [PUT ALL IN #CONTAINER#](http://textadventures.co.uk/forum/quest/topic/6t01qy1emugm1x4k9t-r9a/put-all-in-satchel) command less than twenty-four hours ago.\r\n\r\n...but, since then (or possibly at the same time), Pixie added a new attribute for commands: ```allow_all```.\r\n\r\nI immediately added this attribute to ```put``` and tried PUT BAT AND BALL IN BAG, and Quest yelled at me.\r\n\r\nSo, I looked at ```wear```, and I added ```multiple``` to ```put``` going by that script.  (I think ```allow_all``` is still doing something, but I'm not positive.)\r\n\r\n\r\n---\r\n### TRANSCRIPT\r\n\r\n```\r\nTranscript enabled for:\r\nTITLE: All Tester 580\r\nVERSION: 1.0\r\nIFID: c85bd44a-a9a0-4c73-9c15-4ac514d2b494\r\n\r\n\r\n\r\n[ Enter SCRIPT OFF to disable the transcript. ]\r\n\r\n> put all in bag\r\nbat: You are not carrying it.\r\nball: You are not carrying it.\r\n\r\n> get all\r\nbat: You pick it up.\r\nbag: You pick it up.\r\nball: You pick it up.\r\n\r\n> put all in bag\r\nbat: Done.\r\nball: Done.\r\n\r\n> i\r\nYou are carrying a bag (containing a bat and a ball).\r\n\r\n> get bat\r\nYou pick it up.\r\n\r\n> get ball\r\nYou pick it up.\r\n\r\n> i\r\nYou are carrying a bat, a bag and a ball.\r\n\r\n> put bat and ball in bag\r\nbat: Done.\r\nball: Done.\r\n\r\n> i\r\nYou are carrying a bag (containing a bat and a ball).\r\n\r\n> put bag in bag\r\nYou can't do that.\r\n\r\n> get bat and ball\r\nbat: You pick it up.\r\nball: You pick it up.\r\n\r\n> i\r\nYou are carrying a bat, a bag and a ball.\r\n\r\n> put bat and bag in bag\r\nbag: You can't do that.\r\nbat: Done.\r\n\r\n> i\r\nYou are carrying a bag (containing a bat) and a ball.\r\n\r\n> get bat\r\nYou pick it up.\r\n\r\n> drop all\r\nbat: You drop it.\r\nbag: You drop it.\r\nball: You drop it.\r\n\r\n> put bag and bat in bag\r\nbag: You can't do that.\r\nbat: You are not carrying it.\r\n\r\n> get all\r\nbat: You pick it up.\r\nbag: You pick it up.\r\nball: You pick it up.\r\n\r\n> put all in bag\r\nbat: Done.\r\nball: Done.\r\n\r\n> put bat and bag in bag\r\nbag: You can't do that.\r\nbat: It is already there.\r\n\r\n> put all in bag\r\nbat: It is already there.\r\nball: It is already there.\r\n\r\n> i\r\nYou are carrying a bag (containing a bat and a ball).\r\n```\r\n\r\n---\r\n### MODIFIED ```put``` command\r\n\r\n```\r\n  <command name=\"put\">\r\n    <pattern type=\"string\"><![CDATA[^put (?<object1>.*) (on|in) (?<object2>.*)$]]></pattern>\r\n    <scope>object1=inventory|object2=container</scope>\r\n    <allow_all />\r\n    <script><![CDATA[\r\n      if (not IsDefined(\"multiple\")) {\r\n        multiple = false\r\n      }\r\n      if (multiple and ListCount(object1) = 0) {\r\n        msg (\"You're not carrying anything.\")\r\n      }\r\n      else if (multiple and ListCount(object2) > 1) {\r\n        msg (\"You'll have to pick one target.\")\r\n      }\r\n      else {\r\n        object2 = ListItem(object2, 0)\r\n        if (not LCase(ToString(DictionaryItem(game.pov.currentcommandvarlist,\"object1\"))) = \"all\" and ListContains(object1,object2)) {\r\n          if (ListCount(object1)>1) {\r\n            OutputTextNoBr (GetDisplayAlias(object2) + \": \")\r\n          }\r\n          msg (Template(\"CannotDoThat\"))\r\n        }\r\n        foreach (obj, ListExclude(object1, object2)) {\r\n          if (multiple) {\r\n            OutputTextNoBr (GetDisplayAlias(obj) + \": \")\r\n          }\r\n          // put object1 in/on object 2\r\n          canbedropped = true\r\n          if (HasBoolean(obj, \"drop\")) {\r\n            if (not obj.drop) {\r\n              canbedropped = false\r\n            }\r\n          }\r\n          if (obj.parent = object2) {\r\n            msg (DynamicTemplate(\"AlreadyThere\", obj))\r\n          }\r\n          else if (obj = object2) {\r\n            msg (\"You can't do that.\")\r\n          }\r\n          else if (not ListContains(ScopeInventory(), obj)) {\r\n            msg (DynamicTemplate(\"NotCarrying\", obj))\r\n          }\r\n          else if (not canbedropped) {\r\n            msg (DynamicTemplate(\"ObjectCannotBeStored\", obj))\r\n          }\r\n          else if (not ListContains(ScopeReachable(), obj)) {\r\n            msg (DynamicTemplate(\"ObjectNotOpen\", GetBlockingObject(obj)))\r\n          }\r\n          else if (not ListContains(ScopeReachable(), object2)) {\r\n            msg (DynamicTemplate(\"ObjectNotOpen\", GetBlockingObject(object2)))\r\n          }\r\n          else if (not object2.container) {\r\n            msg (Template(\"CannotDoThat\"))\r\n          }\r\n          else if (not object2.isopen) {\r\n            msg (DynamicTemplate(\"ObjectNotOpen\", object2))\r\n          }\r\n          else {\r\n            if (GetBoolean(object2, \"hidechildren\")) {\r\n              object2.hidechildren = false\r\n            }\r\n            params = NewDictionary()\r\n            dictionary add (params, \"object\", obj)\r\n            dictionary add (params, \"destination\", object2)\r\n            if (HasScript(object2, \"addscript\")) {\r\n              do (object2, \"addscript\", params)\r\n            }\r\n            else if (HasScript(obj, \"drop\")) {\r\n              do (obj, \"drop\", params)\r\n            }\r\n            else {\r\n              obj.parent = object2\r\n              msg (Template(\"Done\"))\r\n            }\r\n          }\r\n          // must be carrying object1\r\n          // item cannot be dropped\r\n          // object1 must not be inside a closed container\r\n          // object2 must not be inside a closed container\r\n          // object2 must be an open container or surface\r\n        }\r\n      }\r\n    ]]></script>\r\n  </command>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<h1>This version of the <code>put</code> command is not included in Quest 5.8!</h1>\n<h2>This is a mod.</h2>\n<hr>\n<p>mrangel came up with a <a href=\"http://textadventures.co.uk/forum/quest/topic/6t01qy1emugm1x4k9t-r9a/put-all-in-satchel\">PUT ALL IN #CONTAINER#</a> command less than twenty-four hours ago.</p>\n<p>...but, since then (or possibly at the same time), Pixie added a new attribute for commands: <code>allow_all</code>.</p>\n<p>I immediately added this attribute to <code>put</code> and tried PUT BAT AND BALL IN BAG, and Quest yelled at me.</p>\n<p>So, I looked at <code>wear</code>, and I added <code>multiple</code> to <code>put</code> going by that script.  (I think <code>allow_all</code> is still doing something, but I'm not positive.)</p>\n<hr>\n<h3>TRANSCRIPT</h3>\n<pre><code>Transcript enabled for:\nTITLE: All Tester 580\nVERSION: 1.0\nIFID: c85bd44a-a9a0-4c73-9c15-4ac514d2b494\n\n\n\n[ Enter SCRIPT OFF to disable the transcript. ]\n\n&gt; put all in bag\nbat: You are not carrying it.\nball: You are not carrying it.\n\n&gt; get all\nbat: You pick it up.\nbag: You pick it up.\nball: You pick it up.\n\n&gt; put all in bag\nbat: Done.\nball: Done.\n\n&gt; i\nYou are carrying a bag (containing a bat and a ball).\n\n&gt; get bat\nYou pick it up.\n\n&gt; get ball\nYou pick it up.\n\n&gt; i\nYou are carrying a bat, a bag and a ball.\n\n&gt; put bat and ball in bag\nbat: Done.\nball: Done.\n\n&gt; i\nYou are carrying a bag (containing a bat and a ball).\n\n&gt; put bag in bag\nYou can't do that.\n\n&gt; get bat and ball\nbat: You pick it up.\nball: You pick it up.\n\n&gt; i\nYou are carrying a bat, a bag and a ball.\n\n&gt; put bat and bag in bag\nbag: You can't do that.\nbat: Done.\n\n&gt; i\nYou are carrying a bag (containing a bat) and a ball.\n\n&gt; get bat\nYou pick it up.\n\n&gt; drop all\nbat: You drop it.\nbag: You drop it.\nball: You drop it.\n\n&gt; put bag and bat in bag\nbag: You can't do that.\nbat: You are not carrying it.\n\n&gt; get all\nbat: You pick it up.\nbag: You pick it up.\nball: You pick it up.\n\n&gt; put all in bag\nbat: Done.\nball: Done.\n\n&gt; put bat and bag in bag\nbag: You can't do that.\nbat: It is already there.\n\n&gt; put all in bag\nbat: It is already there.\nball: It is already there.\n\n&gt; i\nYou are carrying a bag (containing a bat and a ball).\n</code></pre>\n<hr>\n<h3>MODIFIED <code>put</code> command</h3>\n<pre><code>  &lt;command name=\"put\"&gt;\n    &lt;pattern type=\"string\"&gt;&lt;![CDATA[^put (?&lt;object1&gt;.*) (on|in) (?&lt;object2&gt;.*)$]]&gt;&lt;/pattern&gt;\n    &lt;scope&gt;object1=inventory|object2=container&lt;/scope&gt;\n    &lt;allow_all /&gt;\n    &lt;script&gt;&lt;![CDATA[\n      if (not IsDefined(\"multiple\")) {\n        multiple = false\n      }\n      if (multiple and ListCount(object1) = 0) {\n        msg (\"You're not carrying anything.\")\n      }\n      else if (multiple and ListCount(object2) &gt; 1) {\n        msg (\"You'll have to pick one target.\")\n      }\n      else {\n        object2 = ListItem(object2, 0)\n        if (not LCase(ToString(DictionaryItem(game.pov.currentcommandvarlist,\"object1\"))) = \"all\" and ListContains(object1,object2)) {\n          if (ListCount(object1)&gt;1) {\n            OutputTextNoBr (GetDisplayAlias(object2) + \": \")\n          }\n          msg (Template(\"CannotDoThat\"))\n        }\n        foreach (obj, ListExclude(object1, object2)) {\n          if (multiple) {\n            OutputTextNoBr (GetDisplayAlias(obj) + \": \")\n          }\n          // put object1 in/on object 2\n          canbedropped = true\n          if (HasBoolean(obj, \"drop\")) {\n            if (not obj.drop) {\n              canbedropped = false\n            }\n          }\n          if (obj.parent = object2) {\n            msg (DynamicTemplate(\"AlreadyThere\", obj))\n          }\n          else if (obj = object2) {\n            msg (\"You can't do that.\")\n          }\n          else if (not ListContains(ScopeInventory(), obj)) {\n            msg (DynamicTemplate(\"NotCarrying\", obj))\n          }\n          else if (not canbedropped) {\n            msg (DynamicTemplate(\"ObjectCannotBeStored\", obj))\n          }\n          else if (not ListContains(ScopeReachable(), obj)) {\n            msg (DynamicTemplate(\"ObjectNotOpen\", GetBlockingObject(obj)))\n          }\n          else if (not ListContains(ScopeReachable(), object2)) {\n            msg (DynamicTemplate(\"ObjectNotOpen\", GetBlockingObject(object2)))\n          }\n          else if (not object2.container) {\n            msg (Template(\"CannotDoThat\"))\n          }\n          else if (not object2.isopen) {\n            msg (DynamicTemplate(\"ObjectNotOpen\", object2))\n          }\n          else {\n            if (GetBoolean(object2, \"hidechildren\")) {\n              object2.hidechildren = false\n            }\n            params = NewDictionary()\n            dictionary add (params, \"object\", obj)\n            dictionary add (params, \"destination\", object2)\n            if (HasScript(object2, \"addscript\")) {\n              do (object2, \"addscript\", params)\n            }\n            else if (HasScript(obj, \"drop\")) {\n              do (obj, \"drop\", params)\n            }\n            else {\n              obj.parent = object2\n              msg (Template(\"Done\"))\n            }\n          }\n          // must be carrying object1\n          // item cannot be dropped\n          // object1 must not be inside a closed container\n          // object2 must not be inside a closed container\n          // object2 must be an open container or surface\n        }\n      }\n    ]]&gt;&lt;/script&gt;\n  &lt;/command&gt;\n</code></pre>\n\n",
      "PostDate": "2018-05-24T07:24:35.723242Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "15048592-4141-4acc-a6d1-f63ac8d47749",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "At present, \"multiple\" has enough issues that I'd rather work with separate \"all\" commands.\r\n(Did you see my version with \"all flowers\" and similar? I *like* that, and I think I can see a way to put it into the parser to work with any command… at some point when I don't have 75 pages of a novel to proofread and correct before the end of the day)",
      "EditableFormat": "markdown",
      "HTML": "<p>At present, \"multiple\" has enough issues that I'd rather work with separate \"all\" commands.<br>\n(Did you see my version with \"all flowers\" and similar? I <em>like</em> that, and I think I can see a way to put it into the parser to work with any command… at some point when I don't have 75 pages of a novel to proofread and correct before the end of the day)</p>\n\n",
      "PostDate": "2018-05-24T11:54:57.8959168Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "8e7e2881-af3d-4204-bb53-82c79d5c5526",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "In 5.8, if you flag a command with \"allow_all\" it should handle ALL - as you found out. However, the special variable \"object\" in the command script will then be a list of objects rather than a single object (plus there will be Boolean \"multiple\").",
      "EditableFormat": "markdown",
      "HTML": "<p>In 5.8, if you flag a command with \"allow_all\" it should handle ALL - as you found out. However, the special variable \"object\" in the command script will then be a list of objects rather than a single object (plus there will be Boolean \"multiple\").</p>\n\n",
      "PostDate": "2018-05-24T13:51:08.8061127Z",
      "LastEditDate": "2018-05-24T13:53:34.8712322Z",
      "link": null
    },
    {
      "PostId": "92d0ee45-95ad-4249-94a3-97815bcbf122",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> However, the special variable \"object\" in the command script will then be a list of objects rather than a single object \r\n\r\nI found that out when I added ```allow_all``` to \"put\".  It was an adventure!\r\n\r\n---\r\n> plus there will be Boolean \"multiple\"\r\n\r\nI haven't completely given up on QuestJS, which is why I add this to any command with ```multiple``` involved:\r\n\r\n```\r\nif (not IsDefined (\"multiple\")) multiple = false\r\n```\r\n\r\nOtherwise, a single object throws an error once compiled to JS.\r\n",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>However, the special variable \"object\" in the command script will then be a list of objects rather than a single object</p>\n</blockquote>\n<p>I found that out when I added <code>allow_all</code> to \"put\".  It was an adventure!</p>\n<hr>\n<blockquote>\n<p>plus there will be Boolean \"multiple\"</p>\n</blockquote>\n<p>I haven't completely given up on QuestJS, which is why I add this to any command with <code>multiple</code> involved:</p>\n<pre><code>if (not IsDefined (\"multiple\")) multiple = false\n</code></pre>\n<p>Otherwise, a single object throws an error once compiled to JS.</p>\n\n",
      "PostDate": "2018-05-24T14:11:19.7023543Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2a981079-8f28-4f8c-a025-392c2c40376e",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "If you can't override commands (can online users override commands?):\r\n\r\nhttps://github.com/KVonGit/QuestStuff/wiki/Command--PUT-MULTIPLE-OBJECTS-IN-CONTAINER",
      "EditableFormat": "markdown",
      "HTML": "<p>If you can't override commands (can online users override commands?):</p>\n<p>https://github.com/KVonGit/QuestStuff/wiki/Command--PUT-MULTIPLE-OBJECTS-IN-CONTAINER</p>\n\n",
      "PostDate": "2018-05-26T08:14:18.5770023Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
