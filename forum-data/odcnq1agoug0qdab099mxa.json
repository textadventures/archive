{
  "Topic": {
    "TopicId": "odcnq1agoug0qdab099mxa",
    "ForumId": "10",
    "Title": "ClearScreen oddness",
    "LastUpdated": "2019-06-18T21:16:10.3164576Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "d1d37288-3306-4511-9e68-eaa46d51114b",
      "UserId": 418279,
      "Username": "Zesc",
      "AvatarUrl": "https://i.imgur.com/bGcfC7sb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Greetings fellow Quest users!\r\n\r\nI'm currently experienceing issues with a command i deemed stupidly simple before: ```ClearScreen```.\r\n\r\nI'm working in gamebook mode (and slowly starting to regret it), and i'm having two distinct issues with ClearScreen acting wierd.\r\n\r\nFirst, adding ```ClearScreen``` to the script part of a page doesn't cause it to clear the page it belongs to. I assume this is a timing issue, with the actual page being outputted after the script run through. This is annoying nonetheless, especially since i haven't found a way to circumvent this that doesn't require input. (For example ```on ready {}``` won't work.)\r\n\r\nSecond, and much more troubling: I can't add any links to pages that have been cleared. I can output messages that use ```{page:}``` but that's it. I can't explain why this is happening, especially since it doesn't throws up any errors, either.\r\n\r\nAny help is highly appreciated, and thanks in advance.\r\n\r\n**Example Game:** (Sorry, i couldn't figure out how to put code inside a spoiler.)\r\n```\r\n<asl version=\"580\">\r\n  <include ref=\"GamebookCore.aslx\" />\r\n  <game name=\"Example Game\">\r\n    <gameid>752972fb-0c1f-4c4b-b831-e2833e2c960a</gameid>\r\n    <version>1.0</version>\r\n    <firstpublished>2019</firstpublished>\r\n    <defaultbackground>White</defaultbackground>\r\n    <defaultlinkforeground>Blue</defaultlinkforeground>\r\n    <roomenter type=\"script\">\r\n    </roomenter>\r\n    <setcustomwidth type=\"boolean\">false</setcustomwidth>\r\n    <clearlastpage />\r\n  </game>\r\n  <object name=\"Page0\">\r\n    <description><![CDATA[This is the starting page.<br/><br/>{page:Page1}]]></description>\r\n    <script type=\"script\">\r\n    </script>\r\n    <object name=\"player\">\r\n      <inherit name=\"defaultplayer\" />\r\n    </object>\r\n  </object>\r\n  <object name=\"Page1\">\r\n    <inherit name=\"scripttext\" />\r\n    <description><![CDATA[This shouldn't be visible.<br/><br/>{page:Page2}]]></description>\r\n    <options type=\"stringdictionary\" />\r\n    <script type=\"script\">\r\n      ClearScreen\r\n      msg (\"Screen cleared!\")\r\n      wait {\r\n        ClearScreen\r\n        msg (\"Screen cleared... again.\")\r\n        AddPageLink (this, Page2, \"Page2\")\r\n        wait {\r\n          AddPageLink (this, Page2, \"Page2\")\r\n          wait {\r\n            msg (\"{page:Page2}\")\r\n          }\r\n        }\r\n      }\r\n    </script>\r\n  </object>\r\n  <object name=\"Page2\">\r\n    <description>Whee, you finished the game!</description>\r\n    <script type=\"script\">\r\n    </script>\r\n  </object>\r\n</asl>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>Greetings fellow Quest users!</p>\n<p>I'm currently experienceing issues with a command i deemed stupidly simple before: <code>ClearScreen</code>.</p>\n<p>I'm working in gamebook mode (and slowly starting to regret it), and i'm having two distinct issues with ClearScreen acting wierd.</p>\n<p>First, adding <code>ClearScreen</code> to the script part of a page doesn't cause it to clear the page it belongs to. I assume this is a timing issue, with the actual page being outputted after the script run through. This is annoying nonetheless, especially since i haven't found a way to circumvent this that doesn't require input. (For example <code>on ready {}</code> won't work.)</p>\n<p>Second, and much more troubling: I can't add any links to pages that have been cleared. I can output messages that use <code>{page:}</code> but that's it. I can't explain why this is happening, especially since it doesn't throws up any errors, either.</p>\n<p>Any help is highly appreciated, and thanks in advance.</p>\n<p><strong>Example Game:</strong> (Sorry, i couldn't figure out how to put code inside a spoiler.)</p>\n<pre><code>&lt;asl version=\"580\"&gt;\n  &lt;include ref=\"GamebookCore.aslx\" /&gt;\n  &lt;game name=\"Example Game\"&gt;\n    &lt;gameid&gt;752972fb-0c1f-4c4b-b831-e2833e2c960a&lt;/gameid&gt;\n    &lt;version&gt;1.0&lt;/version&gt;\n    &lt;firstpublished&gt;2019&lt;/firstpublished&gt;\n    &lt;defaultbackground&gt;White&lt;/defaultbackground&gt;\n    &lt;defaultlinkforeground&gt;Blue&lt;/defaultlinkforeground&gt;\n    &lt;roomenter type=\"script\"&gt;\n    &lt;/roomenter&gt;\n    &lt;setcustomwidth type=\"boolean\"&gt;false&lt;/setcustomwidth&gt;\n    &lt;clearlastpage /&gt;\n  &lt;/game&gt;\n  &lt;object name=\"Page0\"&gt;\n    &lt;description&gt;&lt;![CDATA[This is the starting page.&lt;br/&gt;&lt;br/&gt;{page:Page1}]]&gt;&lt;/description&gt;\n    &lt;script type=\"script\"&gt;\n    &lt;/script&gt;\n    &lt;object name=\"player\"&gt;\n      &lt;inherit name=\"defaultplayer\" /&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n  &lt;object name=\"Page1\"&gt;\n    &lt;inherit name=\"scripttext\" /&gt;\n    &lt;description&gt;&lt;![CDATA[This shouldn't be visible.&lt;br/&gt;&lt;br/&gt;{page:Page2}]]&gt;&lt;/description&gt;\n    &lt;options type=\"stringdictionary\" /&gt;\n    &lt;script type=\"script\"&gt;\n      ClearScreen\n      msg (\"Screen cleared!\")\n      wait {\n        ClearScreen\n        msg (\"Screen cleared... again.\")\n        AddPageLink (this, Page2, \"Page2\")\n        wait {\n          AddPageLink (this, Page2, \"Page2\")\n          wait {\n            msg (\"{page:Page2}\")\n          }\n        }\n      }\n    &lt;/script&gt;\n  &lt;/object&gt;\n  &lt;object name=\"Page2\"&gt;\n    &lt;description&gt;Whee, you finished the game!&lt;/description&gt;\n    &lt;script type=\"script\"&gt;\n    &lt;/script&gt;\n  &lt;/object&gt;\n&lt;/asl&gt;\n</code></pre>\n\n",
      "PostDate": "2019-06-18T21:16:10.3164576Z",
      "LastEditDate": "2019-06-18T21:20:41.8101546Z",
      "link": null
    },
    {
      "PostId": "1e245bcd-a7ca-482c-ae0d-5b114dfe9799",
      "UserId": 924,
      "Username": "Pertex",
      "AvatarUrl": "https://secure.gravatar.com/avatar/4cc1e52f99452e841ecf4cbee9eadde9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Actually, it's working as planned. The script is executed before text output. It deletes the screen and prints text, then the script waits. Meanwhile, the normal page text is printed. With 'return' the script continues.  AddPageLink tries to add the link to the normal page text, but the page text has already been printed before. Therefore the link is not visible. With msg(\"{page:Page2}\") an explicit output is made, which can then be seen.\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>Actually, it's working as planned. The script is executed before text output. It deletes the screen and prints text, then the script waits. Meanwhile, the normal page text is printed. With 'return' the script continues.  AddPageLink tries to add the link to the normal page text, but the page text has already been printed before. Therefore the link is not visible. With msg(\"{page:Page2}\") an explicit output is made, which can then be seen.</p>\n\n",
      "PostDate": "2019-06-19T07:44:36.519774Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "4cd7c570-637f-477c-b0eb-aa45f8a05353",
      "UserId": 418279,
      "Username": "Zesc",
      "AvatarUrl": "https://i.imgur.com/bGcfC7sb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I see. Although i don't get why ```AddPageLink``` behaves like that, isn't it unnecessarily convoluted?\r\n\r\nAnd, as far as i can see, there is no simple way to make a script execute *after* the page text is printed, but *before* the player gets to do something? I mean, this would be very handy with a couple of scripts and functions, mostly ```MovePlayer```, etc.",
      "EditableFormat": "markdown",
      "HTML": "<p>I see. Although i don't get why <code>AddPageLink</code> behaves like that, isn't it unnecessarily convoluted?</p>\n<p>And, as far as i can see, there is no simple way to make a script execute <em>after</em> the page text is printed, but <em>before</em> the player gets to do something? I mean, this would be very handy with a couple of scripts and functions, mostly <code>MovePlayer</code>, etc.</p>\n\n",
      "PostDate": "2019-06-19T11:42:21.6643288Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "59588e21-0de0-4316-98f4-c3844b5997f9",
      "UserId": 924,
      "Username": "Pertex",
      "AvatarUrl": "https://secure.gravatar.com/avatar/4cc1e52f99452e841ecf4cbee9eadde9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "You could edit and extend the core function DoPage",
      "EditableFormat": "markdown",
      "HTML": "<p>You could edit and extend the core function DoPage</p>\n\n",
      "PostDate": "2019-06-19T13:27:14.3348616Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "b96410dd-66a4-4d90-9978-d0430efd9b24",
      "UserId": 418279,
      "Username": "Zesc",
      "AvatarUrl": "https://i.imgur.com/bGcfC7sb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "[INVECTIVE EXPURGATED] this.\r\n\r\nI think getting this whole thing over into a \"proper\" textadventure will be easier, and probably safe me from a great deal of aneurysms, even if it means rewritting everything from scratch.\r\n\r\nMore on topic - i do not consider myself skilled enough to tinker around with CoreFunctions or CoreLibraries without advice. If there were any code samples i could use - sure, but not on my own.",
      "EditableFormat": "markdown",
      "HTML": "<p>[INVECTIVE EXPURGATED] this.</p>\n<p>I think getting this whole thing over into a \"proper\" textadventure will be easier, and probably safe me from a great deal of aneurysms, even if it means rewritting everything from scratch.</p>\n<p>More on topic - i do not consider myself skilled enough to tinker around with CoreFunctions or CoreLibraries without advice. If there were any code samples i could use - sure, but not on my own.</p>\n\n",
      "PostDate": "2019-06-19T22:38:58.898671Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "31ba9ba0-742a-46b5-9a32-d1b7e0798ae4",
      "UserId": 924,
      "Username": "Pertex",
      "AvatarUrl": "https://secure.gravatar.com/avatar/4cc1e52f99452e841ecf4cbee9eadde9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "No Problem: choose 'Filter' in the left lower corner of Quest (offline version) and activate 'Show Library Elements'.  You will find now lots of new functions in the Functions section. Select 'DoPage' and press the copy button. Now you can edit this function in your game. There you will find the existing script call \r\n\r\n```\r\n      if (GetBoolean(player.parent, \"runscript\") or GetBoolean(player.parent, \"runscriptonly\")) {\r\n        if (HasScript(player.parent, \"script\")) {\r\n          do (player.parent, \"script\")\r\n        }\r\n      }\r\n```\r\nAt the end of this 'on ready' block you can add something like \r\n```\r\n      if (GetBoolean(player.parent, \"runscript\") or GetBoolean(player.parent, \"runscriptonly\")) {\r\n        if (HasScript(player.parent, \"scriptlast\")) {\r\n          do (player.parent, \"scriptlast\")\r\n        }\r\n      }\r\n```\r\nAnd you must add a new script to your page (in code view, you can't edit it in the  visual editor!)\r\n```\r\n    <scriptlast type=\"script\">\r\n      msg(\"script is executed\")\r\n    </scriptlast>\r\n```\r\nmission accomplished!",
      "EditableFormat": "markdown",
      "HTML": "<p>No Problem: choose 'Filter' in the left lower corner of Quest (offline version) and activate 'Show Library Elements'.  You will find now lots of new functions in the Functions section. Select 'DoPage' and press the copy button. Now you can edit this function in your game. There you will find the existing script call</p>\n<pre><code>      if (GetBoolean(player.parent, \"runscript\") or GetBoolean(player.parent, \"runscriptonly\")) {\n        if (HasScript(player.parent, \"script\")) {\n          do (player.parent, \"script\")\n        }\n      }\n</code></pre>\n<p>At the end of this 'on ready' block you can add something like</p>\n<pre><code>      if (GetBoolean(player.parent, \"runscript\") or GetBoolean(player.parent, \"runscriptonly\")) {\n        if (HasScript(player.parent, \"scriptlast\")) {\n          do (player.parent, \"scriptlast\")\n        }\n      }\n</code></pre>\n<p>And you must add a new script to your page (in code view, you can't edit it in the  visual editor!)</p>\n<pre><code>    &lt;scriptlast type=\"script\"&gt;\n      msg(\"script is executed\")\n    &lt;/scriptlast&gt;\n</code></pre>\n<p>mission accomplished!</p>\n\n",
      "PostDate": "2019-06-20T14:54:06.0983549Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "91f9f1fc-d658-4c88-a133-9d95cef56f02",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Or if you only want to do it for a couple of pages, the page's script could look something like:\r\n\r\n```\r\nmsg (\"This script will run *before* the page's text is displayed\")\r\n\r\nthis.runscript = false\r\nthis.runscriptonly = false\r\nDoPage (this)\r\nthis.runscriptonly = true\r\n\r\nmsg (\"This script will run *after* the page's text and options\")\r\n```\r\n\r\nThat changes the page's type to \"text\", displays it, and then changes the type to \"script\" (so the text isn't displayed again afterwards)",
      "EditableFormat": "markdown",
      "HTML": "<p>Or if you only want to do it for a couple of pages, the page's script could look something like:</p>\n<pre><code>msg (\"This script will run *before* the page's text is displayed\")\n\nthis.runscript = false\nthis.runscriptonly = false\nDoPage (this)\nthis.runscriptonly = true\n\nmsg (\"This script will run *after* the page's text and options\")\n</code></pre>\n<p>That changes the page's type to \"text\", displays it, and then changes the type to \"script\" (so the text isn't displayed again afterwards)</p>\n\n",
      "PostDate": "2019-06-20T20:19:37.0026591Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "b418cf1c-c75a-47b5-a0dd-554ff716e2cb",
      "UserId": 418279,
      "Username": "Zesc",
      "AvatarUrl": "https://i.imgur.com/bGcfC7sb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "@mrangel\r\n\r\nThanks an unfathomably lot!\r\n\r\nI didn't knew you could do such a thing without editing libraries (documentation for Quest, especially Gamebook mode, seems to be lacking), but this is exactly what i need. The  gap where the page format is changed is annoying, but i can deal with that.\r\n\r\nOnce again, i'm deeply grateful.",
      "EditableFormat": "markdown",
      "HTML": "<p>@mrangel</p>\n<p>Thanks an unfathomably lot!</p>\n<p>I didn't knew you could do such a thing without editing libraries (documentation for Quest, especially Gamebook mode, seems to be lacking), but this is exactly what i need. The  gap where the page format is changed is annoying, but i can deal with that.</p>\n<p>Once again, i'm deeply grateful.</p>\n\n",
      "PostDate": "2019-06-22T20:17:36.3831965Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
