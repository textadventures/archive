{
  "Topic": {
    "TopicId": "5cmfadpywegxfnxo2hlgua",
    "ForumId": "10",
    "Title": "A Bug in CombatLib:  NPC \"settodefend\" option",
    "LastUpdated": "2018-11-28T03:36:53.1226947Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "2cf7c403-5ecf-4c15-8aa5-7106473f19f6",
      "UserId": 385983,
      "Username": "JonQ",
      "AvatarUrl": "https://secure.gravatar.com/avatar/1a5b192120bdcb508202c028b133ebca?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I would love to have NPCs fighting alongside my player, but so far it's not possible.  With CombatLib, any given monster (or NPC) in my game will attack itself at random during various sessions of play.  \r\n\r\nThe problem only occurs if you implement the 'friend' option whereby an NPC can fight alongside the player by using this starting script:  do (NpcName, \"settodefend\")\r\n\r\nMy guess is that somehow this 'settodefend' code is not updating lists (attackers or friends) correctly, or in some other way Quest is making the monster or NPC select itself as a target instead of other monsters.  Can anyone help me figure out how to fix this?  It would be an awesome feature for RPGs.\r\n\r\nI isolated the problem by creating a brand new game without interference from any tweaks in my actual game. All I did in this new game (just 3 rooms, 2 monsters, 1 NPC, nothing else at all, no descriptions or anything else) was add the NPCLib and CombatLib. I have the same problem.\r\n\r\nI did try to see if anyone else on the forums had problems like this, and indeed I found an unresolved topic along the same lines back in February: https://textadventures.co.uk/forum/quest/topic/ppcz9qjyp062hw0wvohvhw/problem-with-followers-in-pixies-combat-lib\r\n\r\nHas anyone else tried having NPCs fight as an ally of the player in an RPG using CombatLib?  Any ideas?",
      "EditableFormat": "markdown",
      "HTML": "<p>I would love to have NPCs fighting alongside my player, but so far it's not possible.  With CombatLib, any given monster (or NPC) in my game will attack itself at random during various sessions of play.</p>\n<p>The problem only occurs if you implement the 'friend' option whereby an NPC can fight alongside the player by using this starting script:  do (NpcName, \"settodefend\")</p>\n<p>My guess is that somehow this 'settodefend' code is not updating lists (attackers or friends) correctly, or in some other way Quest is making the monster or NPC select itself as a target instead of other monsters.  Can anyone help me figure out how to fix this?  It would be an awesome feature for RPGs.</p>\n<p>I isolated the problem by creating a brand new game without interference from any tweaks in my actual game. All I did in this new game (just 3 rooms, 2 monsters, 1 NPC, nothing else at all, no descriptions or anything else) was add the NPCLib and CombatLib. I have the same problem.</p>\n<p>I did try to see if anyone else on the forums had problems like this, and indeed I found an unresolved topic along the same lines back in February: https://textadventures.co.uk/forum/quest/topic/ppcz9qjyp062hw0wvohvhw/problem-with-followers-in-pixies-combat-lib</p>\n<p>Has anyone else tried having NPCs fight as an ally of the player in an RPG using CombatLib?  Any ideas?</p>\n\n",
      "PostDate": "2018-11-28T03:36:53.1226947Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "ad86ee41-9fa2-4130-9275-ed1da2ef2d34",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hello.\r\n\r\nIf you can post your code (or a link to view or download your code), we'll look it over and see if something stands out.\r\n\r\n(It sounds like the example game's code would be more than enough.)",
      "EditableFormat": "markdown",
      "HTML": "<p>Hello.</p>\n<p>If you can post your code (or a link to view or download your code), we'll look it over and see if something stands out.</p>\n<p>(It sounds like the example game's code would be more than enough.)</p>\n\n",
      "PostDate": "2018-12-01T22:35:34.7537923Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
