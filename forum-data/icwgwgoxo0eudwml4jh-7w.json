{
  "Topic": {
    "TopicId": "icwgwgoxo0eudwml4jh-7w",
    "ForumId": "10",
    "Title": "How should I make a string safe to use as an HTML id (using JS)?",
    "LastUpdated": "2024-09-17T03:46:55.2884612Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "bcf824d5-9ee1-48f2-8ea6-3810693e7876",
      "UserId": 518866,
      "Username": "K.V.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a97688aadc8152436180b511021e94a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hello.\r\n\r\nThe item key in `localStorage` could be any string.\r\n\r\nI need to:\r\n- Make it safe to use as an HTML element's id\r\n- Do that in a way that is reversible\r\n\r\n---\r\nThis is sloppy, and probably not quite right:\r\n```js\r\n    function getSafeHtmlId(fixme){\r\n      return (fixme.replace(/ /g, \"___SPACE___\").replace(/'/g, \"___SINGLE_QUOTE___\").replace(/\"/g, \"___DOUBLE_QUOTE___\").replace(/:/g, \"___COLON___\").replace(/\\./g, \"___DOT___\").replace(/\\#/g,\"___HASH___\")); \r\n    };\r\n```\r\n\r\n---\r\nCONTEXT\r\n\r\nI've got a build of Quest that writes the transcript to `localStorage`, and the key will be `\"questtranscript-\" + game.gamename`.\r\n\r\nSo, that could be anything, and I wish to be able to use it as an id for a row in an HTML table which displays the user's list of transcripts in their `localStorage`.\r\n\r\nHere is the entire document:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Quest Transcripts</title>\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js\"></script>\r\n    <style>\r\n      body {\r\n        font-family: Source Sans Pro, Calibri, Candara, Arial, sans-serif;\r\n        color: #333333;\r\n      }\r\n      #transcript-table {\r\n        margin: 0 auto;\r\n      }\r\n      #transcript-table-header {\r\n        text-align: center;\r\n      }\r\n    </style>\r\n  </head>\r\n  <body onload=\"init()\">\r\n    <table id=\"transcript-table\">\r\n      <tbody id=\"transcript-tbody\">\r\n        <tr>\r\n          <th colspan=\"3\" id=\"transcript-table-header\">You have no transcripts</th>\r\n        </tr>\r\n        <!-- PLACEHOLDER -->\r\n      </tbody>\r\n    </table>\r\n  </body>\r\n  <script>\r\n    var wnd;\r\n    var tName = \"\";\r\n    var choices = {};\r\n    function getSafeHtmlId(fixme){\r\n      return (fixme.replace(/ /g, \"___SPACE___\").replace(/'/g, \"___SINGLE_QUOTE___\").replace(/\"/g, \"___DOUBLE_QUOTE___\").replace(/:/g, \"___COLON___\").replace(/\\./g, \"___DOT___\").replace(/\\#/g,\"___HASH___\")); \r\n    };\r\n    function reverseSafeHtmlId(unfixme){\r\n      return(unfixme.replace(/___SPACE___/g, \" \").replace(/___SINGLE_QUOTE___/g, \"'\").replace(/___DOUBLE_QUOTE___/g, \"\\\"\").replace(/___COLON___/g, \":\").replace(/___DOT___/g, \".\").replace(/___HASH___/g, \"#\"));\r\n    };\r\n    function openTranscript(tsn){\r\n      var tscriptData = localStorage.getItem(reverseSafeHtmlId(tsn)).replace(/@@@NEW_LINE@@@/g,\"<br/>\") || \"No transcript data found.\";\r\n      wnd = window.open(\"about:blank\", \"\", \"_blank\");\r\n      wnd.document.write(tscriptData);\r\n      wnd.document.title = tsn.replace(/questtranscript-/,\"\") + \" - Transcript\";\r\n    };\r\n    function removeTscript(tscript){\r\n      var result = window.confirm(\"Delete this transcript?\");\r\n      if (result){\r\n        console.log(tscript);\r\n        localStorage.removeItem(reverseSafeHtmlId(tscript));\r\n        document.getElementById(tscript).style.display = \"none\";\r\n        delete choices[tscript.replace(/questtranscript-/,\"\")];\r\n      }\r\n      if (Object.keys(choices).length < 1){\r\n        document.getElementById(\"transcript-table-header\").innerHTML = \"You have no transcripts.\";\r\n      }\r\n    };\r\n    var tScriptTemplate = \"<tr id=\\\"TRANSCRIPT_NAME\\\" class=\\\"transcript-entry-holder\\\"><td class=\\\"transcript-name\\\">TRANSCRIPT_DISPLAYED_NAME</td><td class=\\\"transcript-open-link-holder\\\"><a href=\\\"#\\\"  name=\\\"TRANSCRIPT_NAME\\\" onclick=\\\"openTranscript(this.name);\\\" class=\\\"transcript-open-link\\\">OPEN</a></td><td class=\\\"transcript-delete-link-holder\\\"><a href=\\\"#\\\"  name=\\\"TRANSCRIPT_NAME\\\" onclick=\\\"removeTscript(this.name);\\\" class=\\\"transcript-delete-link\\\">DELETE</a></td></tr>\";\r\n    function init(){\r\n      if (!isLocalStorageAvailable()){\r\n        document.getElementById(\"transcript-table-header\").innerHTML = \"The transcript feature is not available in this browser.\";\r\n        return;\r\n      }\r\n      for (var e in localStorage) {\r\n        if (e.startsWith(\"questtranscript-\")){\r\n          var eName = e.replace(/questtranscript-/,\"\");\r\n          var safeName = getSafeHtmlId(eName);\r\n          choices[safeName] = tScriptTemplate.replace(/TRANSCRIPT_NAME/g, \"questtranscript-\" + safeName).replace(/TRANSCRIPT_DISPLAYED_NAME/g, safeName);\r\n        }\r\n      }\r\n      if (Object.keys(choices).length > 0){\r\n        document.getElementById(\"transcript-table-header\").innerHTML = \"Your Transcripts\";\r\n        for (var tname in choices){\r\n          $(\"#transcript-tbody\").append(choices[tname]);\r\n        }\r\n      }\r\n    };\r\n    \r\n    /* https://stackoverflow.com/a/16427747 */\r\n    function isLocalStorageAvailable(){\r\n        var test = 'test';\r\n        try {\r\n            localStorage.setItem(test, test);\r\n            localStorage.removeItem(test);\r\n            return true;\r\n        } catch(e) {\r\n            return false;\r\n        }\r\n    }\r\n  </script>\r\n</html>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>Hello.</p>\n<p>The item key in <code>localStorage</code> could be any string.</p>\n<p>I need to:</p>\n<ul>\n<li>Make it safe to use as an HTML element's id</li>\n<li>Do that in a way that is reversible</li>\n</ul>\n<hr>\n<p>This is sloppy, and probably not quite right:</p>\n<pre><code>    function getSafeHtmlId(fixme){\n      return (fixme.replace(/ /g, \"___SPACE___\").replace(/'/g, \"___SINGLE_QUOTE___\").replace(/\"/g, \"___DOUBLE_QUOTE___\").replace(/:/g, \"___COLON___\").replace(/\\./g, \"___DOT___\").replace(/\\#/g,\"___HASH___\")); \n    };\n</code></pre>\n<hr>\n<p>CONTEXT</p>\n<p>I've got a build of Quest that writes the transcript to <code>localStorage</code>, and the key will be <code>\"questtranscript-\" + game.gamename</code>.</p>\n<p>So, that could be anything, and I wish to be able to use it as an id for a row in an HTML table which displays the user's list of transcripts in their <code>localStorage</code>.</p>\n<p>Here is the entire document:</p>\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;Quest Transcripts&lt;/title&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js\"&gt;&lt;/script&gt;\n    &lt;style&gt;\n      body {\n        font-family: Source Sans Pro, Calibri, Candara, Arial, sans-serif;\n        color: #333333;\n      }\n      #transcript-table {\n        margin: 0 auto;\n      }\n      #transcript-table-header {\n        text-align: center;\n      }\n    &lt;/style&gt;\n  &lt;/head&gt;\n  &lt;body onload=\"init()\"&gt;\n    &lt;table id=\"transcript-table\"&gt;\n      &lt;tbody id=\"transcript-tbody\"&gt;\n        &lt;tr&gt;\n          &lt;th colspan=\"3\" id=\"transcript-table-header\"&gt;You have no transcripts&lt;/th&gt;\n        &lt;/tr&gt;\n        &lt;!-- PLACEHOLDER --&gt;\n      &lt;/tbody&gt;\n    &lt;/table&gt;\n  &lt;/body&gt;\n  &lt;script&gt;\n    var wnd;\n    var tName = \"\";\n    var choices = {};\n    function getSafeHtmlId(fixme){\n      return (fixme.replace(/ /g, \"___SPACE___\").replace(/'/g, \"___SINGLE_QUOTE___\").replace(/\"/g, \"___DOUBLE_QUOTE___\").replace(/:/g, \"___COLON___\").replace(/\\./g, \"___DOT___\").replace(/\\#/g,\"___HASH___\")); \n    };\n    function reverseSafeHtmlId(unfixme){\n      return(unfixme.replace(/___SPACE___/g, \" \").replace(/___SINGLE_QUOTE___/g, \"'\").replace(/___DOUBLE_QUOTE___/g, \"\\\"\").replace(/___COLON___/g, \":\").replace(/___DOT___/g, \".\").replace(/___HASH___/g, \"#\"));\n    };\n    function openTranscript(tsn){\n      var tscriptData = localStorage.getItem(reverseSafeHtmlId(tsn)).replace(/@@@NEW_LINE@@@/g,\"&lt;br/&gt;\") || \"No transcript data found.\";\n      wnd = window.open(\"about:blank\", \"\", \"_blank\");\n      wnd.document.write(tscriptData);\n      wnd.document.title = tsn.replace(/questtranscript-/,\"\") + \" - Transcript\";\n    };\n    function removeTscript(tscript){\n      var result = window.confirm(\"Delete this transcript?\");\n      if (result){\n        console.log(tscript);\n        localStorage.removeItem(reverseSafeHtmlId(tscript));\n        document.getElementById(tscript).style.display = \"none\";\n        delete choices[tscript.replace(/questtranscript-/,\"\")];\n      }\n      if (Object.keys(choices).length &lt; 1){\n        document.getElementById(\"transcript-table-header\").innerHTML = \"You have no transcripts.\";\n      }\n    };\n    var tScriptTemplate = \"&lt;tr id=\\\"TRANSCRIPT_NAME\\\" class=\\\"transcript-entry-holder\\\"&gt;&lt;td class=\\\"transcript-name\\\"&gt;TRANSCRIPT_DISPLAYED_NAME&lt;/td&gt;&lt;td class=\\\"transcript-open-link-holder\\\"&gt;&lt;a href=\\\"#\\\"  name=\\\"TRANSCRIPT_NAME\\\" onclick=\\\"openTranscript(this.name);\\\" class=\\\"transcript-open-link\\\"&gt;OPEN&lt;/a&gt;&lt;/td&gt;&lt;td class=\\\"transcript-delete-link-holder\\\"&gt;&lt;a href=\\\"#\\\"  name=\\\"TRANSCRIPT_NAME\\\" onclick=\\\"removeTscript(this.name);\\\" class=\\\"transcript-delete-link\\\"&gt;DELETE&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;\";\n    function init(){\n      if (!isLocalStorageAvailable()){\n        document.getElementById(\"transcript-table-header\").innerHTML = \"The transcript feature is not available in this browser.\";\n        return;\n      }\n      for (var e in localStorage) {\n        if (e.startsWith(\"questtranscript-\")){\n          var eName = e.replace(/questtranscript-/,\"\");\n          var safeName = getSafeHtmlId(eName);\n          choices[safeName] = tScriptTemplate.replace(/TRANSCRIPT_NAME/g, \"questtranscript-\" + safeName).replace(/TRANSCRIPT_DISPLAYED_NAME/g, safeName);\n        }\n      }\n      if (Object.keys(choices).length &gt; 0){\n        document.getElementById(\"transcript-table-header\").innerHTML = \"Your Transcripts\";\n        for (var tname in choices){\n          $(\"#transcript-tbody\").append(choices[tname]);\n        }\n      }\n    };\n    \n    /* https://stackoverflow.com/a/16427747 */\n    function isLocalStorageAvailable(){\n        var test = 'test';\n        try {\n            localStorage.setItem(test, test);\n            localStorage.removeItem(test);\n            return true;\n        } catch(e) {\n            return false;\n        }\n    }\n  &lt;/script&gt;\n&lt;/html&gt;\n</code></pre>\n\n",
      "PostDate": "2024-09-17T03:46:55.2884612Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
