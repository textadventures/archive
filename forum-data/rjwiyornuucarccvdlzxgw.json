{
  "Topic": {
    "TopicId": "rjwiyornuucarccvdlzxgw",
    "ForumId": "10",
    "Title": "Another Stinkin' Problem  [SOLVED]",
    "LastUpdated": "2017-06-07T00:00:13.6570654Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "db3d7eee-bb2b-4df0-8992-f8cc6d30da3f",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "http://i.imgur.com/d9UrZ6lb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I know I'm posting a lot.  The lastest challenge is this -- I have a search command.  When searching a certain place, the player finds a widget.  The widget is automatically moved to the player's inventory.  I created an inventory function identical to the default inventory command, and this function runs immediately after the widget is gotten (within the same turn), in order to inform the player (via the text pane) that he now has the widget in his inventory.\r\n\r\nThe issue is this -- the widget IS displayed in the side inventory panel, but does NOT display in the text pane when the inventory function is executed (during the same turn).  If the player types \"inventory\" for the next turn, the widget DOES display in the text pane, as expected.  So there is a one turn delay in the text pane.\r\n\r\nSo I am trying to \"update\" the inventory immediately after the player gets the widget, so that it gets displayed properly in the same turn when the inventory function executes.  I tried sending a parameter to the inventory function to \"manually\" update things, without success.  By the way, the inventory function uses the \"FormatObjectList\" function (as does the default inventory command).  Not the worst problem, I know, but still frustrating!",
      "EditableFormat": "markdown",
      "HTML": "<p>I know I'm posting a lot.  The lastest challenge is this -- I have a search command.  When searching a certain place, the player finds a widget.  The widget is automatically moved to the player's inventory.  I created an inventory function identical to the default inventory command, and this function runs immediately after the widget is gotten (within the same turn), in order to inform the player (via the text pane) that he now has the widget in his inventory.</p>\n<p>The issue is this -- the widget IS displayed in the side inventory panel, but does NOT display in the text pane when the inventory function is executed (during the same turn).  If the player types \"inventory\" for the next turn, the widget DOES display in the text pane, as expected.  So there is a one turn delay in the text pane.</p>\n<p>So I am trying to \"update\" the inventory immediately after the player gets the widget, so that it gets displayed properly in the same turn when the inventory function executes.  I tried sending a parameter to the inventory function to \"manually\" update things, without success.  By the way, the inventory function uses the \"FormatObjectList\" function (as does the default inventory command).  Not the worst problem, I know, but still frustrating!</p>\n\n",
      "PostDate": "2017-06-07T00:00:13.6570654Z",
      "LastEditDate": "2017-06-07T14:21:13.069045Z",
      "link": null
    },
    {
      "PostId": "45869fc5-7d26-4155-b4b3-f55327f88220",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "how are you trying to display the widget in the text pane? Are you just using a 'msg' Script/Function in your custom 'inventory' Function or are you using 'DisplayList (ScopeInventory(), true/false/0/1:whatever_it_is_lol)' or something else?\r\n\r\n(aka, we need to see your relevent code - or your entire game code, if it's not to big, to be sure we have all relevent code lol, as you should know, descriptions/explanations from people in posts, aren't too helpful compared to actually seeing the code itself)",
      "EditableFormat": "markdown",
      "HTML": "<p>how are you trying to display the widget in the text pane? Are you just using a 'msg' Script/Function in your custom 'inventory' Function or are you using 'DisplayList (ScopeInventory(), true/false/0/1:whatever_it_is_lol)' or something else?</p>\n<p>(aka, we need to see your relevent code - or your entire game code, if it's not to big, to be sure we have all relevent code lol, as you should know, descriptions/explanations from people in posts, aren't too helpful compared to actually seeing the code itself)</p>\n\n",
      "PostDate": "2017-06-07T01:30:16.1959361Z",
      "LastEditDate": "2017-06-07T01:31:23.4763435Z",
      "link": null
    },
    {
      "PostId": "9ef4acf0-34aa-4422-ace7-628b38e097ae",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Does your game maintain a list of objects that the inventory function uses? If so, check when the widget gets put in the list. If you use a turn script to keep the list up-to-date, then that will only happen after the players turn, so the widget would only appear next turn.\r\n\r\nOtherwise, you might need to re-order when things are done when the player picks up the widget, so the widget gets moved and/or added to the list earlier.",
      "EditableFormat": "markdown",
      "HTML": "<p>Does your game maintain a list of objects that the inventory function uses? If so, check when the widget gets put in the list. If you use a turn script to keep the list up-to-date, then that will only happen after the players turn, so the widget would only appear next turn.</p>\n<p>Otherwise, you might need to re-order when things are done when the player picks up the widget, so the widget gets moved and/or added to the list earlier.</p>\n\n",
      "PostDate": "2017-06-07T06:53:35.3465383Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "bde1abb8-9479-4581-a437-c266ad7c9de7",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "http://i.imgur.com/d9UrZ6lb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "My game does not maintain a list of objects for my inventory function (it is generated on-the-fly).  My inventory function is just copied and pasted from (and identical to) Quest's default inventory command:\r\n\r\n```\r\nlist = FormatObjectList(Template(\"CarryingListHeader\"), game.pov, Template(\"And\"), \".\")\r\nif (list = \"\") {\r\n  msg (Template(\"NotCarryingAnything\"))\r\n}\r\nelse {\r\n  msg (list)\r\n}\r\n```\r\nThe widget is added to the player's inventory BEFORE the inventory function is run.  When the function is run, the widget shows up right away in the side panel, but not in the text pane.  You have to type \"inventory\" on the next turn to see it in the text pane.  So there is a 1-turn delay for the text pane, but not for the side panel, which is strange.  So the relevant code looks like this:\r\n\r\n```\r\nAddToInventory (game.object) // this is widget\r\nInventoryFunction // which routes to this:\r\n\r\nlist = FormatObjectList(Template(\"CarryingListHeader\"), game.pov, Template(\"And\"), \".\")\r\nif (list = \"\") {\r\n  msg (Template(\"NotCarryingAnything\"))\r\n}\r\nelse {\r\n  msg (list) // Here is where it should display widget in the text pane.\r\n}\r\n```\r\nThe player's inventory is displayed, but there's no widget in there (but you can see it in the side panel).",
      "EditableFormat": "markdown",
      "HTML": "<p>My game does not maintain a list of objects for my inventory function (it is generated on-the-fly).  My inventory function is just copied and pasted from (and identical to) Quest's default inventory command:</p>\n<pre><code>list = FormatObjectList(Template(\"CarryingListHeader\"), game.pov, Template(\"And\"), \".\")\nif (list = \"\") {\n  msg (Template(\"NotCarryingAnything\"))\n}\nelse {\n  msg (list)\n}\n</code></pre>\n<p>The widget is added to the player's inventory BEFORE the inventory function is run.  When the function is run, the widget shows up right away in the side panel, but not in the text pane.  You have to type \"inventory\" on the next turn to see it in the text pane.  So there is a 1-turn delay for the text pane, but not for the side panel, which is strange.  So the relevant code looks like this:</p>\n<pre><code>AddToInventory (game.object) // this is widget\nInventoryFunction // which routes to this:\n\nlist = FormatObjectList(Template(\"CarryingListHeader\"), game.pov, Template(\"And\"), \".\")\nif (list = \"\") {\n  msg (Template(\"NotCarryingAnything\"))\n}\nelse {\n  msg (list) // Here is where it should display widget in the text pane.\n}\n</code></pre>\n<p>The player's inventory is displayed, but there's no widget in there (but you can see it in the side panel).</p>\n\n",
      "PostDate": "2017-06-07T08:58:38.4563808Z",
      "LastEditDate": "2017-06-07T09:20:43.8846676Z",
      "link": null
    },
    {
      "PostId": "3ecbda22-4f65-48e5-9c52-ff9dae22cc13",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> My game does not maintain a list of objects for my inventory function (it is generated on-the-fly). \r\n\r\nGood, that is definitely the best way to do it.\r\n\r\nSo then we have to look at the code that called the inventory function.\r\n\r\nSomething that might help debugging would be to print the location of the widget at various points in the code. Eg:\r\n\r\n```\r\nmsg(\"in inv func: \" + widget.parent)\r\nlist = FormatObjectList(Template(\"CarryingListHeader\"), game.pov, Template(\"And\"), \".\")\r\nif (list = \"\") {\r\n  msg (Template(\"NotCarryingAnything\"))\r\n}\r\nelse {\r\n  msg (list)\r\n}\r\n```\r\nYou can then see where the object is at that point in the code execution.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>My game does not maintain a list of objects for my inventory function (it is generated on-the-fly).</p>\n</blockquote>\n<p>Good, that is definitely the best way to do it.</p>\n<p>So then we have to look at the code that called the inventory function.</p>\n<p>Something that might help debugging would be to print the location of the widget at various points in the code. Eg:</p>\n<pre><code>msg(\"in inv func: \" + widget.parent)\nlist = FormatObjectList(Template(\"CarryingListHeader\"), game.pov, Template(\"And\"), \".\")\nif (list = \"\") {\n  msg (Template(\"NotCarryingAnything\"))\n}\nelse {\n  msg (list)\n}\n</code></pre>\n<p>You can then see where the object is at that point in the code execution.</p>\n\n",
      "PostDate": "2017-06-07T09:12:47.2005249Z",
      "LastEditDate": "2017-06-07T09:13:23.1846784Z",
      "link": null
    },
    {
      "PostId": "8beec82a-7b79-44d6-8b70-39562404bbc6",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "http://i.imgur.com/d9UrZ6lb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I just did as you suggested:\r\n\r\n```\r\nPrintCentered (game.object + \" \" + game.object.parent)\r\nlist = FormatObjectList(Template(\"CarryingListHeader\"), game.pov, Template(\"And\"), \".\")\r\nif (list = \"\") {\r\n  msg (Template(\"NotCarryingAnything\"))\r\n}\r\nelse {\r\n  msg (list)\r\n}\r\nPrintCentered (game.object + \" \" + game.object.parent)\r\n```\r\nIt prints \"Object: widget Object: player\" at the beginning and at the end.  So the widget is where it's supposed to be.",
      "EditableFormat": "markdown",
      "HTML": "<p>I just did as you suggested:</p>\n<pre><code>PrintCentered (game.object + \" \" + game.object.parent)\nlist = FormatObjectList(Template(\"CarryingListHeader\"), game.pov, Template(\"And\"), \".\")\nif (list = \"\") {\n  msg (Template(\"NotCarryingAnything\"))\n}\nelse {\n  msg (list)\n}\nPrintCentered (game.object + \" \" + game.object.parent)\n</code></pre>\n<p>It prints \"Object: widget Object: player\" at the beginning and at the end.  So the widget is where it's supposed to be.</p>\n\n",
      "PostDate": "2017-06-07T09:32:43.5281848Z",
      "LastEditDate": "2017-06-07T09:36:32.6076113Z",
      "link": null
    },
    {
      "PostId": "b416f6d7-4c6b-4f06-967a-7cc88fd82e95",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I assume game.pov is the player?\r\n\r\nLooking in `FormatObjectList`, it does remove dark objects if it is dark. Could that be an issue?\r\n\r\nTry adding this to the start of the function:\r\n```\r\nPrintCentered (\"Held: \" + GetDirectChildren(game.pov))\r\n```\r\nYou should see omething like:\r\n\r\n> Held: List: widget\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>I assume game.pov is the player?</p>\n<p>Looking in <code>FormatObjectList</code>, it does remove dark objects if it is dark. Could that be an issue?</p>\n<p>Try adding this to the start of the function:</p>\n<pre><code>PrintCentered (\"Held: \" + GetDirectChildren(game.pov))\n</code></pre>\n<p>You should see omething like:</p>\n<blockquote>\n<p>Held: List: widget</p>\n</blockquote>\n\n",
      "PostDate": "2017-06-07T10:45:46.0989663Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a48cc25e-85b2-4c40-a463-920f4f9395ae",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "http://i.imgur.com/d9UrZ6lb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I found the problem!  Widget was a scenery object, but I had a script that made it a non-scenery object AFTER my inventory function ran.  So it was in the player inventory, just not shown in the text pane until next turn (strange that side inventory panel still shows scenery objects).  Silly rabbit!\r\n\r\nThanks for all the help Pixie and HK.  Sorry I wasted your time!  I guess that was what today's lesson was all about -- scenery objects in the player inventory won't show up with the \"inventory\" command or function, but will still show up in the inventory side panel.  Ho hum.",
      "EditableFormat": "markdown",
      "HTML": "<p>I found the problem!  Widget was a scenery object, but I had a script that made it a non-scenery object AFTER my inventory function ran.  So it was in the player inventory, just not shown in the text pane until next turn (strange that side inventory panel still shows scenery objects).  Silly rabbit!</p>\n<p>Thanks for all the help Pixie and HK.  Sorry I wasted your time!  I guess that was what today's lesson was all about -- scenery objects in the player inventory won't show up with the \"inventory\" command or function, but will still show up in the inventory side panel.  Ho hum.</p>\n\n",
      "PostDate": "2017-06-07T14:20:36.1181963Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
