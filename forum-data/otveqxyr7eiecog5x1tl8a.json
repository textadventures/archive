{
  "Topic": {
    "TopicId": "otveqxyr7eiecog5x1tl8a",
    "ForumId": "10",
    "Title": "Combat Library 3.0 breaks Quest's map system, apparently.",
    "LastUpdated": "2018-02-26T04:03:43.7730241Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "7c8ede61-3cb6-48ae-a061-3ced6f56ad50",
      "UserId": 207026,
      "Username": "Pykrete",
      "AvatarUrl": "http://i.imgur.com/F7PNLN5b.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Without combat library, as seen in the file 'Map without Combat Library Works', we have 3 connected rooms, the map loads immediately and you can travel between them.\r\n\r\nWith the exact same setup, except now Combat Library has been added (as has the CombatInitialise function in the start script, though this happens regardless of whether or not it's in play), as seen in the file 'Map with Combat Library Broken', we get... nothing. It's completely blank.\r\n\r\nhttps://drive.google.com/open?id=10NUR208mM33678uAeoHbT8GSHm4nFPff\r\n\r\nIssue seems to be the case on 5.7.1 and 5.7.2. Apologies if this is known, not seen it mentioned anywhere. Is there a fix for this or am I buggered? (Or is there something else I've somehow overlooked that is the real cause?)",
      "EditableFormat": "markdown",
      "HTML": "<p>Without combat library, as seen in the file 'Map without Combat Library Works', we have 3 connected rooms, the map loads immediately and you can travel between them.</p>\n<p>With the exact same setup, except now Combat Library has been added (as has the CombatInitialise function in the start script, though this happens regardless of whether or not it's in play), as seen in the file 'Map with Combat Library Broken', we get... nothing. It's completely blank.</p>\n<p>https://drive.google.com/open?id=10NUR208mM33678uAeoHbT8GSHm4nFPff</p>\n<p>Issue seems to be the case on 5.7.1 and 5.7.2. Apologies if this is known, not seen it mentioned anywhere. Is there a fix for this or am I buggered? (Or is there something else I've somehow overlooked that is the real cause?)</p>\n\n",
      "PostDate": "2018-02-26T04:03:43.7730241Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "b4585ebe-337f-45a8-8f22-7999f1150b59",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hrmm...\r\n\r\nThe map breaks when including the library.  You don't even have to put that line in the start script to break it.\r\n\r\nYou can delete the start script: still no map.\r\n\r\nIf you delete the line including CombatLib: the map works.\r\n\r\nSame thing in Quest 5.6.3, too.\r\n\r\n\r\n(Still investigating.)",
      "EditableFormat": "markdown",
      "HTML": "<p>Hrmm...</p>\n<p>The map breaks when including the library.  You don't even have to put that line in the start script to break it.</p>\n<p>You can delete the start script: still no map.</p>\n<p>If you delete the line including CombatLib: the map works.</p>\n<p>Same thing in Quest 5.6.3, too.</p>\n<p>(Still investigating.)</p>\n\n",
      "PostDate": "2018-02-26T04:21:03.7708353Z",
      "LastEditDate": "2018-02-26T04:36:31.9858713Z",
      "link": null
    },
    {
      "PostId": "fe1c1d74-2217-46d3-8045-4d4969c77ca1",
      "UserId": 207026,
      "Username": "Pykrete",
      "AvatarUrl": "http://i.imgur.com/F7PNLN5b.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Yeeeeah, spent most of today learning the library and coming up with all sorts of uses for it; WHOOP, no map. I wonder how long this has been an issue, given Pixie's decision to forgo Quest's map system with one of their own for Deeper. (Apologies if I'm seeing a link where there is none, there.)\r\n\r\nI was considering an alternate map system myself, so it's not the end of the world, but... it's definitely irritating not to have the option.",
      "EditableFormat": "markdown",
      "HTML": "<p>Yeeeeah, spent most of today learning the library and coming up with all sorts of uses for it; WHOOP, no map. I wonder how long this has been an issue, given Pixie's decision to forgo Quest's map system with one of their own for Deeper. (Apologies if I'm seeing a link where there is none, there.)</p>\n<p>I was considering an alternate map system myself, so it's not the end of the world, but... it's definitely irritating not to have the option.</p>\n\n",
      "PostDate": "2018-02-26T04:50:15.5463528Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "df2a54df-0fea-4b7c-8458-06d7a9c8fb44",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "It's something in this:\r\n\r\n```\r\n  <function name=\"OnEnterRoom\" parameters=\"oldRoom\"><![CDATA[\r\n    game.displayroomdescriptiononstart = false\r\n    if (IsDefined(\"oldRoom\")) {\r\n      if (oldRoom <> null) {\r\n        if (HasScript(oldRoom, \"onexit\")) {\r\n          do (oldRoom, \"onexit\")\r\n        }\r\n      }\r\n    }\r\n    on ready {\r\n      if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"beforefirstenter\")) {\r\n        do (game.pov.parent, \"beforefirstenter\")\r\n      }\r\n      on ready {\r\n        if (HasScript(game.pov.parent, \"beforeenter\")) {\r\n          do (game.pov.parent, \"beforeenter\")\r\n        }\r\n        on ready {\r\n          if (IsDefined(\"oldRoom\")) {\r\n            if (oldRoom <> null and game.changeroom_newline and not game.command_newline) {\r\n              msg (\"\")\r\n            }\r\n          }\r\n          //st = DisplayName(game.pov.parent)\r\n          //request (UpdateLocation, \"- \" + st + \" -\")\r\n          //Title (st, 14)\r\n          roomFrameExists = false\r\n          if (game.showdescriptiononenter) {\r\n            ShowRoomDescription\r\n          }\r\n          if (HasScript( game, \"roomenter\")) {\r\n            do (game, \"roomenter\")\r\n          }\r\n          on ready {\r\n            if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"firstenter\")) {\r\n              do (game.pov.parent, \"firstenter\")\r\n            }\r\n            on ready {\r\n              if (HasScript(game.pov.parent, \"enter\")) {\r\n                do (game.pov.parent, \"enter\")\r\n              }\r\n            }\r\n            set (game.pov.parent, \"visited\", true)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ]]></function>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>It's something in this:</p>\n<pre><code>  &lt;function name=\"OnEnterRoom\" parameters=\"oldRoom\"&gt;&lt;![CDATA[\n    game.displayroomdescriptiononstart = false\n    if (IsDefined(\"oldRoom\")) {\n      if (oldRoom &lt;&gt; null) {\n        if (HasScript(oldRoom, \"onexit\")) {\n          do (oldRoom, \"onexit\")\n        }\n      }\n    }\n    on ready {\n      if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"beforefirstenter\")) {\n        do (game.pov.parent, \"beforefirstenter\")\n      }\n      on ready {\n        if (HasScript(game.pov.parent, \"beforeenter\")) {\n          do (game.pov.parent, \"beforeenter\")\n        }\n        on ready {\n          if (IsDefined(\"oldRoom\")) {\n            if (oldRoom &lt;&gt; null and game.changeroom_newline and not game.command_newline) {\n              msg (\"\")\n            }\n          }\n          //st = DisplayName(game.pov.parent)\n          //request (UpdateLocation, \"- \" + st + \" -\")\n          //Title (st, 14)\n          roomFrameExists = false\n          if (game.showdescriptiononenter) {\n            ShowRoomDescription\n          }\n          if (HasScript( game, \"roomenter\")) {\n            do (game, \"roomenter\")\n          }\n          on ready {\n            if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"firstenter\")) {\n              do (game.pov.parent, \"firstenter\")\n            }\n            on ready {\n              if (HasScript(game.pov.parent, \"enter\")) {\n                do (game.pov.parent, \"enter\")\n              }\n            }\n            set (game.pov.parent, \"visited\", true)\n          }\n        }\n      }\n    }\n  ]]&gt;&lt;/function&gt;\n</code></pre>\n\n",
      "PostDate": "2018-02-26T05:10:43.3033Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "fdd72dde-6d4b-43da-9f34-14fe4a06af11",
      "UserId": 207026,
      "Username": "Pykrete",
      "AvatarUrl": "http://i.imgur.com/F7PNLN5b.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Ah? You've narrowed it down? What does that section do?",
      "EditableFormat": "markdown",
      "HTML": "<p>Ah? You've narrowed it down? What does that section do?</p>\n\n",
      "PostDate": "2018-02-26T05:13:37.1744906Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "79dc7c2b-3d25-4cd7-a62d-3bfa5e7cffd2",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "This part isn't in the function:\r\n```\r\nif (game.gridmap) {\r\n  Grid_CalculateMapCoordinates (game.pov.parent, game.pov)\r\n  Grid_DrawPlayerInRoom (game.pov.parent)\r\n}\r\n```\r\n\r\nThe map needs that.\r\n\r\n---\r\nIn the CombatStuff.xml file, starting at line 384, replace the existing ```OnEnterRoom()``` with this:\r\n\r\n```\r\n  <function name=\"OnEnterRoom\" parameters=\"oldRoom\"><![CDATA[\r\n    game.displayroomdescriptiononstart = false\r\n    if (IsDefined(\"oldRoom\")) {\r\n      if (oldRoom <> null) {\r\n        if (HasScript(oldRoom, \"onexit\")) {\r\n          do (oldRoom, \"onexit\")\r\n        }\r\n      }\r\n    }\r\n    on ready {\r\n      if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"beforefirstenter\")) {\r\n        do (game.pov.parent, \"beforefirstenter\")\r\n      }\r\n      on ready {\r\n        if (HasScript(game.pov.parent, \"beforeenter\")) {\r\n          do (game.pov.parent, \"beforeenter\")\r\n        }\r\n        on ready {\r\n\t  if (game.gridmap) {\r\n            Grid_CalculateMapCoordinates (game.pov.parent, game.pov)\r\n            Grid_DrawPlayerInRoom (game.pov.parent)\r\n          }\r\n          if (IsDefined(\"oldRoom\")) {\r\n            if (oldRoom <> null and game.changeroom_newline and not game.command_newline) {\r\n              msg (\"\")\r\n            }\r\n          }\r\n          //st = DisplayName(game.pov.parent)\r\n          //request (UpdateLocation, \"- \" + st + \" -\")\r\n          //Title (st, 14)\r\n          roomFrameExists = false\r\n          if (game.showdescriptiononenter) {\r\n            ShowRoomDescription\r\n          }\r\n          if (HasScript( game, \"roomenter\")) {\r\n            do (game, \"roomenter\")\r\n          }\r\n          on ready {\r\n            if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"firstenter\")) {\r\n              do (game.pov.parent, \"firstenter\")\r\n            }\r\n            on ready {\r\n              if (HasScript(game.pov.parent, \"enter\")) {\r\n                do (game.pov.parent, \"enter\")\r\n              }\r\n            }\r\n            set (game.pov.parent, \"visited\", true)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ]]></function>\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>This part isn't in the function:</p>\n<pre><code>if (game.gridmap) {\n  Grid_CalculateMapCoordinates (game.pov.parent, game.pov)\n  Grid_DrawPlayerInRoom (game.pov.parent)\n}\n</code></pre>\n<p>The map needs that.</p>\n<hr>\n<p>In the CombatStuff.xml file, starting at line 384, replace the existing <code>OnEnterRoom()</code> with this:</p>\n<pre><code>  &lt;function name=\"OnEnterRoom\" parameters=\"oldRoom\"&gt;&lt;![CDATA[\n    game.displayroomdescriptiononstart = false\n    if (IsDefined(\"oldRoom\")) {\n      if (oldRoom &lt;&gt; null) {\n        if (HasScript(oldRoom, \"onexit\")) {\n          do (oldRoom, \"onexit\")\n        }\n      }\n    }\n    on ready {\n      if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"beforefirstenter\")) {\n        do (game.pov.parent, \"beforefirstenter\")\n      }\n      on ready {\n        if (HasScript(game.pov.parent, \"beforeenter\")) {\n          do (game.pov.parent, \"beforeenter\")\n        }\n        on ready {\n\t  if (game.gridmap) {\n            Grid_CalculateMapCoordinates (game.pov.parent, game.pov)\n            Grid_DrawPlayerInRoom (game.pov.parent)\n          }\n          if (IsDefined(\"oldRoom\")) {\n            if (oldRoom &lt;&gt; null and game.changeroom_newline and not game.command_newline) {\n              msg (\"\")\n            }\n          }\n          //st = DisplayName(game.pov.parent)\n          //request (UpdateLocation, \"- \" + st + \" -\")\n          //Title (st, 14)\n          roomFrameExists = false\n          if (game.showdescriptiononenter) {\n            ShowRoomDescription\n          }\n          if (HasScript( game, \"roomenter\")) {\n            do (game, \"roomenter\")\n          }\n          on ready {\n            if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"firstenter\")) {\n              do (game.pov.parent, \"firstenter\")\n            }\n            on ready {\n              if (HasScript(game.pov.parent, \"enter\")) {\n                do (game.pov.parent, \"enter\")\n              }\n            }\n            set (game.pov.parent, \"visited\", true)\n          }\n        }\n      }\n    }\n  ]]&gt;&lt;/function&gt;\n</code></pre>\n\n",
      "PostDate": "2018-02-26T05:13:56.7748488Z",
      "LastEditDate": "2018-02-26T05:16:01.4315137Z",
      "link": null
    },
    {
      "PostId": "24c635a6-b797-4851-8449-43152be34aa8",
      "UserId": 207026,
      "Username": "Pykrete",
      "AvatarUrl": "http://i.imgur.com/F7PNLN5b.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Well I'll be blown! That's fixed it, so far as I can see! Thanks a ton, K.V.",
      "EditableFormat": "markdown",
      "HTML": "<p>Well I'll be blown! That's fixed it, so far as I can see! Thanks a ton, K.V.</p>\n\n",
      "PostDate": "2018-02-26T05:25:28.4061663Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "0f4ddb49-b511-4773-aabc-589e46e91e30",
      "UserId": 318253,
      "Username": "K.V.",
      "AvatarUrl": "https://i.imgur.com/mBf7TBeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "No problem!\r\n\r\nGlad to help!\r\n\r\n(You probably helped out countless people by pointing this out, too, by the way.)\r\n\r\n\r\n---\r\nI'm still trying to wrap my mind around the fact that no one else using CombatLib has ever enabled the map.",
      "EditableFormat": "markdown",
      "HTML": "<p>No problem!</p>\n<p>Glad to help!</p>\n<p>(You probably helped out countless people by pointing this out, too, by the way.)</p>\n<hr>\n<p>I'm still trying to wrap my mind around the fact that no one else using CombatLib has ever enabled the map.</p>\n\n",
      "PostDate": "2018-02-26T05:38:02.6875367Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2aae6e93-eb78-4ff6-b81b-8ef81d25952b",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thanks for pointing this out. I think OnRoomEnter used to do something, but no longer does, and meanwhile the original Quest version has changed to do stuff - not just the map but other things. I have deleted the function altogether from CombatLib, and uploaded a new version. You can delete it from CombatStuff.xml or downloads the updated version.",
      "EditableFormat": "markdown",
      "HTML": "<p>Thanks for pointing this out. I think OnRoomEnter used to do something, but no longer does, and meanwhile the original Quest version has changed to do stuff - not just the map but other things. I have deleted the function altogether from CombatLib, and uploaded a new version. You can delete it from CombatStuff.xml or downloads the updated version.</p>\n\n",
      "PostDate": "2018-02-26T08:32:49.1385981Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "9bce6c6a-6ccf-4422-bd6c-b2ec9f0704a2",
      "UserId": 207026,
      "Username": "Pykrete",
      "AvatarUrl": "http://i.imgur.com/F7PNLN5b.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Understood and done. Though, I have also noticed something else about the Combat Library - you've got it commented that it requires Shoplib and Clothinglib to also be installed and loaded before it, but if I try and do that I get this error message;\r\n\r\n\"For security reasons DTD is prohibited in this XML document. To enable DTD processing set the ProhibitDtd property on XmlReaderSettings to false and pass the settings into XmlReader.Create method.\"\r\n\r\nCan't open up the game at all until I go into notepad ++ and remove BOTH other libraries from the code. Everything seems to work fine without them regardless, so is this an old requirement to begin with?",
      "EditableFormat": "markdown",
      "HTML": "<p>Understood and done. Though, I have also noticed something else about the Combat Library - you've got it commented that it requires Shoplib and Clothinglib to also be installed and loaded before it, but if I try and do that I get this error message;</p>\n<p>\"For security reasons DTD is prohibited in this XML document. To enable DTD processing set the ProhibitDtd property on XmlReaderSettings to false and pass the settings into XmlReader.Create method.\"</p>\n<p>Can't open up the game at all until I go into notepad ++ and remove BOTH other libraries from the code. Everything seems to work fine without them regardless, so is this an old requirement to begin with?</p>\n\n",
      "PostDate": "2018-02-26T15:46:25.1303754Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "4fd2a63c-8225-46e9-a734-ebee8eccecc6",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Yes, that was an old requirement. I updated the docs on my Github, but obviously forgot that. I will update at some point..",
      "EditableFormat": "markdown",
      "HTML": "<p>Yes, that was an old requirement. I updated the docs on my Github, but obviously forgot that. I will update at some point..</p>\n\n",
      "PostDate": "2018-02-26T16:01:24.4816053Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "da1937ce-5a73-4ffc-8996-aba84fe75ec0",
      "UserId": 247325,
      "Username": "hegemonkhan",
      "AvatarUrl": "https://secure.gravatar.com/avatar/a96cf34d8d97c57de38f54ee22b1759b?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Pixie's newest combat library includes the spell and equipment content/code/libraries (they: combat, spell, and equipment, were separate libraries originally), so that's why you're getting an error, as you're trying to load the same code again.",
      "EditableFormat": "markdown",
      "HTML": "<p>Pixie's newest combat library includes the spell and equipment content/code/libraries (they: combat, spell, and equipment, were separate libraries originally), so that's why you're getting an error, as you're trying to load the same code again.</p>\n\n",
      "PostDate": "2018-02-27T04:26:29.0489472Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
