{
  "Topic": {
    "TopicId": "vqas_xivue_l3jugeo7t5a",
    "ForumId": "15",
    "Title": "Quest 6: Adding YouTube API",
    "LastUpdated": "2020-12-08T18:45:40.0990795Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "a6228584-2e1c-498e-8ffb-74fd74d17929",
      "UserId": 301690,
      "Username": "Richard Headkid",
      "AvatarUrl": "http://i.imgur.com/WUGXS8yb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "<details><summary>OLD STUFF</summary>\r\n\r\nThe only way I can get [YouTube API](https://developers.google.com/youtube/iframe_api_reference \"https://developers.google.com/youtube/iframe_api_reference\") to work at all is to add code to the existing 'page.html' file to load everything.\r\n\r\nI also have to include two or three urls in the CSP section at the top of 'page.html'.  Adding something to the CSP via Javascript technically changes the data, but it does not actually update the CSP.  I believe that is a security feature, and Pixie has seconded that.\r\n\r\nHere's my modified 'page.html':\r\n\r\n<details style=\"cursor:pointer;\"><summary><a>page.html</a></summary>\r\n\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"utf-8\"/>\r\n  <title>A Test Page</title>\r\n  <!--<link rel=\"shortcut icon\" type=\"image/png\" href=\"images/favicon.png\"/>-->\r\n  <meta http-equiv=\"Content-Security-Policy\" content=\"\r\n    default-src 'self';\r\n    style-src 'unsafe-inline' 'self';\r\n    font-src 'self';\r\n    script-src 'unsafe-inline' 'self' https://www.youtube.com/ https://www.youtube.com/iframe_api; \r\n    img-src 'self';\r\n    frame-src 'unsafe-inline' 'self' https://www.youtube.com/;\" //KV added youtube to 2 lines for youtube iframe and API capability\r\n  >\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">  <!-- KV ADDED THIS LINE FOR MOBILE STYLING -->\r\n  <script src=\"game/rhfiles/jquerystuff/jquery-3.5.1.min.js\"></script> <!-- KV MODDED THIS LINE. JQUERY FILES ARE IN game/rhfiles/jquerystuff -->\r\n  <link rel=\"stylesheet\" href=\"game/rhfiles/jquerystuff/jquery-ui-1.12.1/jquery-ui-smoothness.css\"> <!-- KV MODDED THIS LINE. JQUERY FILES ARE IN game/rhfiles/jquerystuff -->\r\n  <script src=\"game/rhfiles/jquerystuff/jquery-ui-1.12.1/jquery-ui.min.js\"></script> <!-- KV MODDED THIS LINE. JQUERY FILES ARE IN game/rhfiles/jquerystuff -->\r\n  \r\n  <script src=\"lib/_util.js\"></script>\r\n  <script src=\"lib/_settings.js\"></script>\r\n  <script>\r\n    const FOLDER = \"game\";\r\n    document.writeln('<script src=\"' + FOLDER + '/settings.js\"></scr' + \"ipt>\"); \r\n  </script>\r\n  <script>\r\n    settings.writeScript(FOLDER)\r\n  </script>\r\n  \r\n</head>\r\n\r\n\r\n\r\n<body>\r\n\r\n<div id=\"main\">\r\n<div id=\"output\"></div>\r\n<div id=\"input\"></div>\r\n</div>\r\n\r\n<script>\r\n  io.createPanes();\r\n</script>\r\n\r\n<div id=\"dialog\"></div>\r\n<div id=\"quest-map\"></div>\r\n<div id=\"quest-image\"></div>\r\n\r\n\t<!-- KV added YouTubeAPI  -->\r\n\t\r\n\t<!-- 1. The <iframe> (and video player) will replace this <div> tag. -->\r\n    <div id=\"youtube\"></div>\r\n\r\n    <script>\r\n      // 2. This code loads the IFrame Player API code asynchronously.\r\n      var tag = document.createElement('script');\r\n\r\n      tag.src = \"https://www.youtube.com/iframe_api\";\r\n      var firstScriptTag = document.getElementsByTagName('script')[0];\r\n      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n\r\n      // 3. This function creates an <iframe> (and YouTube player)\r\n      //    after the API code downloads.\r\n      var ytPlayer;\r\n      function CreateYouTube(vid='7vIi0U4rSX4',\r\n\t\t\t\t\t\t\t\tht='390',\r\n\t\t\t\t\t\t\t\twid='640',\r\n\t\t\t\t\t\t\t\tvars={ 'autoplay': 1 },\r\n\t\t\t\t\t\t\t\tevts={\r\n\t\t\t\t\t\t\t\t\t'onReady':onPlayerReady,\r\n\t\t\t\t\t\t\t\t\t'onStateChange':onPlayerStateChange\r\n\t\t\t\t\t\t\t\t}) {\r\n        ytPlayer = new YT.Player('youtube', {\r\n          height: ht,\r\n          width: wid,\r\n          videoId: vid,\r\n          playerVars: vars,\r\n          events: evts\r\n        });\r\n      }\r\n\t  function createYouTube(...args){\r\n\t\t  CreateYouTube(...args)\r\n\t  }\r\n\t  \r\n      // 4. The API will call this function when the video player is ready.\r\n      function onPlayerReady(event) {\r\n        event.target.playVideo();\r\n        \r\n      }\r\n\r\n      // 5. The API calls this function when the player's state changes.\r\n      //    The function indicates that when playing a video (state=1),\r\n      //    the player should play for six seconds and then stop.\r\n      var done = false;\r\n      function onPlayerStateChange(event) {\r\n        if (event.data == YT.PlayerState.PLAYING && !done) {\r\n          //setTimeout(stopYouTube, 6000);\r\n          done = true;\r\n        }\r\n      }\r\n      $('#youtube').hide();\r\n    </script>\r\n\t\r\n\t<!--END OF YOUTUBE API -->\r\n\r\n</body>\r\n</html>\r\n\r\n\r\n```\r\n\r\n</details>\r\n\r\n\r\n\r\n---\r\nI have to run the following code from ```settings.setup```.  Otherwise, issues arise (meaning this code doesn't do jack squat, presumably because everything hasn't loaded yet, which makes it hard to change things which do not yet exist).\r\n\r\n<details style=\"cursor:pointer;\"><summary><a>Code added to <code>settings.setup</code></a></summary>\r\n\r\n```js\r\n\t\t//================================================\r\n\t\t//Clean up the YouTube player div\r\n\t\tvar elem = $(\"#youtube\");\r\n\t\telem.insertBefore($(\"#input\"));\r\n\t\telem.hide();\r\n\t\tsettings.youTubeElem = function(){return $(\"#youtube\")};\r\n\r\n\t\t//-------------------------------------------------\r\n\r\n```\r\n\r\n</details>\r\n\r\n---\r\nI added some YouTube functions  (mostly redundant):\r\n\r\n\r\n<details style=\"cursor:pointer;\"><summary><a>YouTube Functions</a></summary>\r\n\r\n```js\r\n\r\n//==================\r\n//YouTube functions|\r\n//==================\r\n\r\n//Alex Warren's Quest video id  -->  7vIi0U4rSX4\r\n\r\n/*\r\n //OLD FUNCTION as of v0.9\r\nfunction youTube(id='7vIi0U4rSX4',auto=true){\r\n\tkillYoutube();\r\n\tvar autoplay = '1';\r\n\tif (!auto) autoplay = '0';\r\n\tvar s = '<iframe id=\"youTube\" width=\"560\" height=\"315\"';\r\n\ts += ' src=\"https://www.youtube.com/embed/'+id+'?autoplay='+autoplay+'\"';\r\n\ts += ' frameborder=\"0\" allowfullscreen></iframe>';\r\n\tmsg(s);\r\n\t\r\n};\r\n*/\r\n\r\n\r\nfunction setYouTubeVolume(vol){\r\n\tytPlayer.setVolume(vol);\r\n};\r\n\r\nfunction muteYouTube(){\r\n\tvar ytp = $(\"#youtube\");\r\n\tif (ytp.length){\r\n\t\tytPlayer.mute();\r\n\t\treturn 1;\r\n\t}\r\n\treturn 0;\r\n};\r\n\r\nfunction unmuteYouTube(){\r\n\tvar ytp = $(\"#youtube\");\r\n\tif (ytp.length && ytPlayer.isMuted()){\r\n\t\tytPlayer.unMute();\r\n\t\treturn 1;\r\n\t}\r\n\treturn 0;\r\n\t\r\n};\r\n\r\n\r\nfunction pauseYouTube(){\r\n\tytPlayer.pauseVideo();\r\n};\r\n\r\nfunction playYouTube(){\r\n\tytPlayer.playVideo();\r\n};\r\n\r\nfunction stopYouTube(){\r\n\tytPlayer.stopVideo();\r\n};\r\n\r\nfunction hideYouTube(){\r\n\tvar ytp = $(\"#youtube\");\r\n\tytp.hide();\r\n};\r\n\r\nfunction showYouTube(){\r\n\tvar ytp = $(\"#youtube\");\r\n\tytp.show();\r\n};\r\n\r\nfunction loadYouTubeVideoById(vid){\r\n\tytPlayer.loadVideoById(vid);\r\n};\r\n\r\nfunction killYoutube(){\r\n\t//Returns 1 if an element is found.\r\n\t//Returns 0 if no element is found.\r\n\tif ($('#youtube').length){\r\n\t\t$('#youtube').remove();\r\n\t\treturn 1;\r\n\t}\r\n\treturn 0;\r\n};\r\n\r\n\r\nfunction getYouTubeId(){\r\n\tvar ytpId = '';\r\n\tif (typeof(ytPlayer.getVideoData)!=='undefined'){\r\n\t\tytpId = ytPlayer.getVideoData().video_id;\r\n\t}\r\n\treturn ytpId;\r\n};\r\n//=========================\r\n//END OF YouTube functions|\r\n//=========================\r\n\r\n\r\n```\r\n\r\n</details>\r\n\r\n\r\n---\r\nFinally, I just had to add functions to the TV, the first room, and the second room.\r\n\r\n\r\n<details style=\"cursor:pointer;\"><summary><a>GAME OBJECTS with YouTube API calls</a></summary>\r\n\r\n```js\r\ncreateRoom(\"cellar\", {\r\n  desc:\"The cellar is small, dimly lit, and dingy.{once:  It sure is nice of XanMag to let you and Ralph stay here, though!}\",\r\n  up:new Exit(\"stairway\"),\r\n  afterEnter:function(){\r\n\tif (w.TV.switchedon){\r\n\t\t//msg(\"Ralph turns the TV off on the way out.\");\r\n\t\t//w.TV.doSwitchoff();\r\n\t\tshowYouTube();\r\n\t\tytPlayer.setVolume('100');\r\n\t} \r\n  },\r\n  onExit:function(){\r\n\tif (w.TV.switchedon){\r\n\t\t//msg(\"Ralph turns the TV off on the way out.\");\r\n\t\t//w.TV.doSwitchoff();\r\n\t\thideYouTube();\r\n\t\tytPlayer.setVolume('10');\r\n\t\tmsg(\"You can still hear the TV, but just barely.\");\r\n\t} \r\n  },\r\n});\r\n\r\n\r\ncreateItem(\"TV\", SWITCHABLE(false), {\r\n\tloc:\"cellar\",\r\n\texamine:\"An ordinary TV, currently{if:TV:switchedon: tuned to Quest TV: switched off}.<br><br>The remote is not here.\\\r\n\t  So, all you can do is switch it on or off.\",\r\n\tonSwitchOn:function(){\r\n\t\tif (!w.TV.switchedOnTimes){\r\n\t\t\tw.TV.switchedOnTimes = 0;\r\n\t\t\tcreateYouTube('7vIi0U4rSX4',390,640,{ 'playlist': '7vIi0U4rSX4',\r\n\t\t\t\t\t\t\t\t\t'autoplay': 1,\r\n\t\t\t\t\t\t\t\t\t'loop':1,\r\n\t\t\t\t\t\t\t\t\t'rel':0 });\r\n\t\t}else{\r\n\t\t\tvar cvid;\r\n\t\t\tcvid  = getYouTubeId();\r\n\t\t\tif (cvid !== '7vIi0U4rSX4' ){\r\n\t\t\t\tloadYouTubeVideoById('7vIi0U4rSX4');\r\n\t\t\t\t//playYouTube()\r\n\t\t\t}else{\r\n\t\t\t\tplayYouTube();\r\n\t\t\t\tshowYouTube();\r\n\t\t\t}\r\n\t\t}\r\n\t\tw.TV.switchedOnTimes++;\r\n\t\tmsg(\"XM has it on Quest TV, and he has hidden the remote.\");\r\n\t\tshowYouTube();\r\n\t\t\r\n\t\tif (w.TV.switchedOffTimes===1){\r\n\t\t\t//msg (\"The video starts over every time you turn it off and back on.\");\r\n\t\t}\r\n\t},\r\n\tonSwitchOff:function(){\r\n\t\tif (!w.TV.switchedOffTimes){\r\n\t\t\tw.TV.switchedOffTimes = 0;\r\n\t\t\tmsg (\"{b:{i:[SYSTEM MESSAGE:  THANK YOU!]}}\");\r\n\t\t}\r\n\t\tw.TV.switchedOffTimes++;\r\n\t\tpauseYouTube();\r\n\t\thideYouTube();\r\n\t},\r\n});\r\n\r\n\r\n\r\ncreateRoom(\"stairway\", {\r\n\tdesc:\"A narrow stair.\",\r\n\tdown:new Exit(\"cellar\"),\r\n\tup:new Exit(\"Kitchen\"),\r\n\tafterEnter:function(){\r\n\t\tif (w.TV.switchedon && game.player.previousLoc===\"Kitchen\"){\r\n\t\t\t//msg(\"Ralph turns the TV off on the way out.\");\r\n\t\t\t//w.TV.doSwitchoff();\r\n\t\t\tytPlayer.setVolume('10');\r\n\t\t\tmsg(\"You can hear muffled sounds from the TV.\");\r\n\t\t} \r\n\t},\r\n\tonExit:function(){\r\n\t\tif (w.TV.switchedon && game.player.previousLoc===\"cellar\"){\r\n\t\t\t//msg(\"Ralph turns the TV off on the way out.\");\r\n\t\t\t//w.TV.doSwitchoff();\r\n\t\t\tytPlayer.setVolume('0');\r\n\t\t} \r\n\t},\r\n});\r\n\r\n```\r\n\r\n</details>\r\n\r\n\r\n---\r\nCSS settings to adjust the iframe's width on mobile.\r\n\r\n(Only the ```iframe#youtube``` bit is relevant here.)\r\n\r\n\r\n<details style=\"cursor:pointer;\"><summary><a>CSS Settings</a></summary>\r\n\r\n```css\r\n/* Added by KV for MOBILE */\r\n@media only screen and (max-width: 956px) {\r\n\t#panes {\r\n\t\tdisplay: none !important; /* Hide side panes if width less than 956px (on mobile device). */ /* Unnecessary after QuestJS 0.2  */\r\n\t}\r\n\t#status {\r\n\t\twidth:100% !important;\r\n\t}\r\n\t#main {\r\n\t\tmargin-left: 0px;\r\n\t\tmargin-right: 0px;\r\n\t\tpadding: 0px 0px;\r\n\t}\r\n\tinput, select, textarea { /* Stop ZOOM during input  */\r\n\t\tfont-size: 16px;\r\n\t}\r\n\tiframe#youtube {\r\n\t\twidth:auto;\r\n\t\theight:auto;\r\n\t}\r\n}\r\n```\r\n\r\n</details>\r\n\r\n---\r\n### NOTE\r\n\r\nThis code will most assuredly get updated.  In fact, I just updated quite a bit of it before posting it here.\r\n\r\n</details>\r\n\r\n---\r\nHere is a link to this \"test\" game's title page, if anyone feels like trying to break something:  \r\n\r\n[Quest 6 Game 1](http://media.textadventures.co.uk/games/R-PODbpzSk_rxIcdAq1RQA/index.html \"Play Quest 6 Game 1 at 'http://media.textadventures.co.uk/games/R-PODbpzSk_rxIcdAq1RQA/index.html'\")\r\n\r\n---\r\nHappy gaming!\r\n\r\n---\r\n**EDIT**\r\n\r\nNew info is [down the page](http://textadventures.co.uk/forum/questkit/topic/vqas_xivue_l3jugeo7t5a/quest-6-adding-youtube-api#55bb8996-8907-44a2-b468-33b2af689fe7)",
      "EditableFormat": "markdown",
      "HTML": "<details><summary>OLD STUFF</summary>\n<p>The only way I can get <a href=\"https://developers.google.com/youtube/iframe_api_reference\" title=\"https://developers.google.com/youtube/iframe_api_reference\">YouTube API</a> to work at all is to add code to the existing 'page.html' file to load everything.</p>\n<p>I also have to include two or three urls in the CSP section at the top of 'page.html'.  Adding something to the CSP via Javascript technically changes the data, but it does not actually update the CSP.  I believe that is a security feature, and Pixie has seconded that.</p>\n<p>Here's my modified 'page.html':</p>\n<details style=\"cursor: pointer\"><summary><a>page.html</a></summary>\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n  &lt;meta charset=\"utf-8\"/&gt;\n  &lt;title&gt;A Test Page&lt;/title&gt;\n  &lt;!--&lt;link rel=\"shortcut icon\" type=\"image/png\" href=\"images/favicon.png\"/&gt;--&gt;\n  &lt;meta http-equiv=\"Content-Security-Policy\" content=\"\n    default-src 'self';\n    style-src 'unsafe-inline' 'self';\n    font-src 'self';\n    script-src 'unsafe-inline' 'self' https://www.youtube.com/ https://www.youtube.com/iframe_api; \n    img-src 'self';\n    frame-src 'unsafe-inline' 'self' https://www.youtube.com/;\" //KV added youtube to 2 lines for youtube iframe and API capability\n  &gt;\n  &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;  &lt;!-- KV ADDED THIS LINE FOR MOBILE STYLING --&gt;\n  &lt;script src=\"game/rhfiles/jquerystuff/jquery-3.5.1.min.js\"&gt;&lt;/script&gt; &lt;!-- KV MODDED THIS LINE. JQUERY FILES ARE IN game/rhfiles/jquerystuff --&gt;\n  &lt;link rel=\"stylesheet\" href=\"game/rhfiles/jquerystuff/jquery-ui-1.12.1/jquery-ui-smoothness.css\"&gt; &lt;!-- KV MODDED THIS LINE. JQUERY FILES ARE IN game/rhfiles/jquerystuff --&gt;\n  &lt;script src=\"game/rhfiles/jquerystuff/jquery-ui-1.12.1/jquery-ui.min.js\"&gt;&lt;/script&gt; &lt;!-- KV MODDED THIS LINE. JQUERY FILES ARE IN game/rhfiles/jquerystuff --&gt;\n  \n  &lt;script src=\"lib/_util.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"lib/_settings.js\"&gt;&lt;/script&gt;\n  &lt;script&gt;\n    const FOLDER = \"game\";\n    document.writeln('&lt;script src=\"' + FOLDER + '/settings.js\"&gt;&lt;/scr' + \"ipt&gt;\"); \n  &lt;/script&gt;\n  &lt;script&gt;\n    settings.writeScript(FOLDER)\n  &lt;/script&gt;\n  \n&lt;/head&gt;\n\n\n\n&lt;body&gt;\n\n&lt;div id=\"main\"&gt;\n&lt;div id=\"output\"&gt;&lt;/div&gt;\n&lt;div id=\"input\"&gt;&lt;/div&gt;\n&lt;/div&gt;\n\n&lt;script&gt;\n  io.createPanes();\n&lt;/script&gt;\n\n&lt;div id=\"dialog\"&gt;&lt;/div&gt;\n&lt;div id=\"quest-map\"&gt;&lt;/div&gt;\n&lt;div id=\"quest-image\"&gt;&lt;/div&gt;\n\n\t&lt;!-- KV added YouTubeAPI  --&gt;\n\t\n\t&lt;!-- 1. The &lt;iframe&gt; (and video player) will replace this &lt;div&gt; tag. --&gt;\n    &lt;div id=\"youtube\"&gt;&lt;/div&gt;\n\n    &lt;script&gt;\n      // 2. This code loads the IFrame Player API code asynchronously.\n      var tag = document.createElement('script');\n\n      tag.src = \"https://www.youtube.com/iframe_api\";\n      var firstScriptTag = document.getElementsByTagName('script')[0];\n      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n\n      // 3. This function creates an &lt;iframe&gt; (and YouTube player)\n      //    after the API code downloads.\n      var ytPlayer;\n      function CreateYouTube(vid='7vIi0U4rSX4',\n\t\t\t\t\t\t\t\tht='390',\n\t\t\t\t\t\t\t\twid='640',\n\t\t\t\t\t\t\t\tvars={ 'autoplay': 1 },\n\t\t\t\t\t\t\t\tevts={\n\t\t\t\t\t\t\t\t\t'onReady':onPlayerReady,\n\t\t\t\t\t\t\t\t\t'onStateChange':onPlayerStateChange\n\t\t\t\t\t\t\t\t}) {\n        ytPlayer = new YT.Player('youtube', {\n          height: ht,\n          width: wid,\n          videoId: vid,\n          playerVars: vars,\n          events: evts\n        });\n      }\n\t  function createYouTube(...args){\n\t\t  CreateYouTube(...args)\n\t  }\n\t  \n      // 4. The API will call this function when the video player is ready.\n      function onPlayerReady(event) {\n        event.target.playVideo();\n        \n      }\n\n      // 5. The API calls this function when the player's state changes.\n      //    The function indicates that when playing a video (state=1),\n      //    the player should play for six seconds and then stop.\n      var done = false;\n      function onPlayerStateChange(event) {\n        if (event.data == YT.PlayerState.PLAYING &amp;&amp; !done) {\n          //setTimeout(stopYouTube, 6000);\n          done = true;\n        }\n      }\n      $('#youtube').hide();\n    &lt;/script&gt;\n\t\n\t&lt;!--END OF YOUTUBE API --&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n\n\n</code></pre>\n</details>\n<hr>\n<p>I have to run the following code from <code>settings.setup</code>.  Otherwise, issues arise (meaning this code doesn't do jack squat, presumably because everything hasn't loaded yet, which makes it hard to change things which do not yet exist).</p>\n<details style=\"cursor: pointer\"><summary><a>Code added to <code>settings.setup</code></a></summary>\n<pre><code>\t\t//================================================\n\t\t//Clean up the YouTube player div\n\t\tvar elem = $(\"#youtube\");\n\t\telem.insertBefore($(\"#input\"));\n\t\telem.hide();\n\t\tsettings.youTubeElem = function(){return $(\"#youtube\")};\n\n\t\t//-------------------------------------------------\n\n</code></pre>\n</details>\n<hr>\n<p>I added some YouTube functions  (mostly redundant):</p>\n<details style=\"cursor: pointer\"><summary><a>YouTube Functions</a></summary>\n<pre><code>\n//==================\n//YouTube functions|\n//==================\n\n//Alex Warren's Quest video id  --&gt;  7vIi0U4rSX4\n\n/*\n //OLD FUNCTION as of v0.9\nfunction youTube(id='7vIi0U4rSX4',auto=true){\n\tkillYoutube();\n\tvar autoplay = '1';\n\tif (!auto) autoplay = '0';\n\tvar s = '&lt;iframe id=\"youTube\" width=\"560\" height=\"315\"';\n\ts += ' src=\"https://www.youtube.com/embed/'+id+'?autoplay='+autoplay+'\"';\n\ts += ' frameborder=\"0\" allowfullscreen&gt;&lt;/iframe&gt;';\n\tmsg(s);\n\t\n};\n*/\n\n\nfunction setYouTubeVolume(vol){\n\tytPlayer.setVolume(vol);\n};\n\nfunction muteYouTube(){\n\tvar ytp = $(\"#youtube\");\n\tif (ytp.length){\n\t\tytPlayer.mute();\n\t\treturn 1;\n\t}\n\treturn 0;\n};\n\nfunction unmuteYouTube(){\n\tvar ytp = $(\"#youtube\");\n\tif (ytp.length &amp;&amp; ytPlayer.isMuted()){\n\t\tytPlayer.unMute();\n\t\treturn 1;\n\t}\n\treturn 0;\n\t\n};\n\n\nfunction pauseYouTube(){\n\tytPlayer.pauseVideo();\n};\n\nfunction playYouTube(){\n\tytPlayer.playVideo();\n};\n\nfunction stopYouTube(){\n\tytPlayer.stopVideo();\n};\n\nfunction hideYouTube(){\n\tvar ytp = $(\"#youtube\");\n\tytp.hide();\n};\n\nfunction showYouTube(){\n\tvar ytp = $(\"#youtube\");\n\tytp.show();\n};\n\nfunction loadYouTubeVideoById(vid){\n\tytPlayer.loadVideoById(vid);\n};\n\nfunction killYoutube(){\n\t//Returns 1 if an element is found.\n\t//Returns 0 if no element is found.\n\tif ($('#youtube').length){\n\t\t$('#youtube').remove();\n\t\treturn 1;\n\t}\n\treturn 0;\n};\n\n\nfunction getYouTubeId(){\n\tvar ytpId = '';\n\tif (typeof(ytPlayer.getVideoData)!=='undefined'){\n\t\tytpId = ytPlayer.getVideoData().video_id;\n\t}\n\treturn ytpId;\n};\n//=========================\n//END OF YouTube functions|\n//=========================\n\n\n</code></pre>\n</details>\n<hr>\n<p>Finally, I just had to add functions to the TV, the first room, and the second room.</p>\n<details style=\"cursor: pointer\"><summary><a>GAME OBJECTS with YouTube API calls</a></summary>\n<pre><code>createRoom(\"cellar\", {\n  desc:\"The cellar is small, dimly lit, and dingy.{once:  It sure is nice of XanMag to let you and Ralph stay here, though!}\",\n  up:new Exit(\"stairway\"),\n  afterEnter:function(){\n\tif (w.TV.switchedon){\n\t\t//msg(\"Ralph turns the TV off on the way out.\");\n\t\t//w.TV.doSwitchoff();\n\t\tshowYouTube();\n\t\tytPlayer.setVolume('100');\n\t} \n  },\n  onExit:function(){\n\tif (w.TV.switchedon){\n\t\t//msg(\"Ralph turns the TV off on the way out.\");\n\t\t//w.TV.doSwitchoff();\n\t\thideYouTube();\n\t\tytPlayer.setVolume('10');\n\t\tmsg(\"You can still hear the TV, but just barely.\");\n\t} \n  },\n});\n\n\ncreateItem(\"TV\", SWITCHABLE(false), {\n\tloc:\"cellar\",\n\texamine:\"An ordinary TV, currently{if:TV:switchedon: tuned to Quest TV: switched off}.&lt;br&gt;&lt;br&gt;The remote is not here.\\\n\t  So, all you can do is switch it on or off.\",\n\tonSwitchOn:function(){\n\t\tif (!w.TV.switchedOnTimes){\n\t\t\tw.TV.switchedOnTimes = 0;\n\t\t\tcreateYouTube('7vIi0U4rSX4',390,640,{ 'playlist': '7vIi0U4rSX4',\n\t\t\t\t\t\t\t\t\t'autoplay': 1,\n\t\t\t\t\t\t\t\t\t'loop':1,\n\t\t\t\t\t\t\t\t\t'rel':0 });\n\t\t}else{\n\t\t\tvar cvid;\n\t\t\tcvid  = getYouTubeId();\n\t\t\tif (cvid !== '7vIi0U4rSX4' ){\n\t\t\t\tloadYouTubeVideoById('7vIi0U4rSX4');\n\t\t\t\t//playYouTube()\n\t\t\t}else{\n\t\t\t\tplayYouTube();\n\t\t\t\tshowYouTube();\n\t\t\t}\n\t\t}\n\t\tw.TV.switchedOnTimes++;\n\t\tmsg(\"XM has it on Quest TV, and he has hidden the remote.\");\n\t\tshowYouTube();\n\t\t\n\t\tif (w.TV.switchedOffTimes===1){\n\t\t\t//msg (\"The video starts over every time you turn it off and back on.\");\n\t\t}\n\t},\n\tonSwitchOff:function(){\n\t\tif (!w.TV.switchedOffTimes){\n\t\t\tw.TV.switchedOffTimes = 0;\n\t\t\tmsg (\"{b:{i:[SYSTEM MESSAGE:  THANK YOU!]}}\");\n\t\t}\n\t\tw.TV.switchedOffTimes++;\n\t\tpauseYouTube();\n\t\thideYouTube();\n\t},\n});\n\n\n\ncreateRoom(\"stairway\", {\n\tdesc:\"A narrow stair.\",\n\tdown:new Exit(\"cellar\"),\n\tup:new Exit(\"Kitchen\"),\n\tafterEnter:function(){\n\t\tif (w.TV.switchedon &amp;&amp; game.player.previousLoc===\"Kitchen\"){\n\t\t\t//msg(\"Ralph turns the TV off on the way out.\");\n\t\t\t//w.TV.doSwitchoff();\n\t\t\tytPlayer.setVolume('10');\n\t\t\tmsg(\"You can hear muffled sounds from the TV.\");\n\t\t} \n\t},\n\tonExit:function(){\n\t\tif (w.TV.switchedon &amp;&amp; game.player.previousLoc===\"cellar\"){\n\t\t\t//msg(\"Ralph turns the TV off on the way out.\");\n\t\t\t//w.TV.doSwitchoff();\n\t\t\tytPlayer.setVolume('0');\n\t\t} \n\t},\n});\n\n</code></pre>\n</details>\n<hr>\n<p>CSS settings to adjust the iframe's width on mobile.</p>\n<p>(Only the <code>iframe#youtube</code> bit is relevant here.)</p>\n<details style=\"cursor: pointer\"><summary><a>CSS Settings</a></summary>\n<pre><code>/* Added by KV for MOBILE */\n@media only screen and (max-width: 956px) {\n\t#panes {\n\t\tdisplay: none !important; /* Hide side panes if width less than 956px (on mobile device). */ /* Unnecessary after QuestJS 0.2  */\n\t}\n\t#status {\n\t\twidth:100% !important;\n\t}\n\t#main {\n\t\tmargin-left: 0px;\n\t\tmargin-right: 0px;\n\t\tpadding: 0px 0px;\n\t}\n\tinput, select, textarea { /* Stop ZOOM during input  */\n\t\tfont-size: 16px;\n\t}\n\tiframe#youtube {\n\t\twidth:auto;\n\t\theight:auto;\n\t}\n}\n</code></pre>\n</details>\n<hr>\n<h3>NOTE</h3>\n<p>This code will most assuredly get updated.  In fact, I just updated quite a bit of it before posting it here.</p>\n</details>\n<hr>\n<p>Here is a link to this \"test\" game's title page, if anyone feels like trying to break something:</p>\n<p><a href=\"http://media.textadventures.co.uk/games/R-PODbpzSk_rxIcdAq1RQA/index.html\" title=\"Play Quest 6 Game 1 at 'http://media.textadventures.co.uk/games/R-PODbpzSk_rxIcdAq1RQA/index.html'\">Quest 6 Game 1</a></p>\n<hr>\n<p>Happy gaming!</p>\n<hr>\n<p><strong>EDIT</strong></p>\n<p>New info is <a href=\"http://textadventures.co.uk/forum/questkit/topic/vqas_xivue_l3jugeo7t5a/quest-6-adding-youtube-api#55bb8996-8907-44a2-b468-33b2af689fe7\">down the page</a></p>\n\n",
      "PostDate": "2020-12-08T18:45:40.0990795Z",
      "LastEditDate": "2020-12-11T20:53:25.5949328Z",
      "link": null
    },
    {
      "PostId": "32ec7645-4b13-4447-b58b-36acaeaca77e",
      "UserId": 301690,
      "Username": "Richard Headkid",
      "AvatarUrl": "http://i.imgur.com/WUGXS8yb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "UPDATE\r\n\r\nThe video will start by itself in a mobile browser as long as you set it to play from the ```onPlayerReady``` function.",
      "EditableFormat": "markdown",
      "HTML": "<p>UPDATE</p>\n<p>The video will start by itself in a mobile browser as long as you set it to play from the <code>onPlayerReady</code> function.</p>\n\n",
      "PostDate": "2020-12-10T02:51:43.2963313Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "55bb8996-8907-44a2-b468-33b2af689fe7",
      "UserId": 301690,
      "Username": "Richard Headkid",
      "AvatarUrl": "http://i.imgur.com/WUGXS8yb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Here's my first attempt at documentation:\r\n\r\nhttps://gist.github.com/KVonGit/7934e8a7a6ac26fd7edcd6dda7f0bc04\r\n\r\n---\r\nComments and suggestions are welcomed.",
      "EditableFormat": "markdown",
      "HTML": "<p>Here's my first attempt at documentation:</p>\n<p>https://gist.github.com/KVonGit/7934e8a7a6ac26fd7edcd6dda7f0bc04</p>\n<hr>\n<p>Comments and suggestions are welcomed.</p>\n\n",
      "PostDate": "2020-12-11T20:50:29.0990692Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "fd7323e6-8f2f-4172-b346-8151ef3d7754",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thanks, I have linked to that from the QuestJS docs.",
      "EditableFormat": "markdown",
      "HTML": "<p>Thanks, I have linked to that from the QuestJS docs.</p>\n\n",
      "PostDate": "2020-12-12T09:43:08.8436931Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a27d69a0-ada8-4092-8f54-5ea892c3600b",
      "UserId": 924,
      "Username": "Pertex",
      "AvatarUrl": "https://secure.gravatar.com/avatar/4cc1e52f99452e841ecf4cbee9eadde9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "When you turn on the TV, the video starts below it. If you continue playing, new text is displayed above the video. Is it possible to have the video scroll up just like normal text?",
      "EditableFormat": "markdown",
      "HTML": "<p>When you turn on the TV, the video starts below it. If you continue playing, new text is displayed above the video. Is it possible to have the video scroll up just like normal text?</p>\n\n",
      "PostDate": "2020-12-15T12:29:41.852713Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a859bdff-0ad5-42bb-b716-659a96189217",
      "UserId": 301690,
      "Username": "Richard Headkid",
      "AvatarUrl": "http://i.imgur.com/WUGXS8yb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> Is it possible to have the video scroll up just like normal text?\r\n\r\nBehold, the last two lines of youTubeAPISetup.js:\r\n\r\n```js\r\nelem.insertBefore($(\"#input\"));\r\n  elem.hide();\r\n```\r\n\r\n---\r\n<s>You could probably change that to:\r\n\r\n```js\r\n$(\"#output\").append(elem)\r\n//elem.hide()\r\n```\r\n</s>\r\nYou'd probably not want to hide the youtube element in this scenario.\r\n\r\nAlso, I'm not sure if clearing the screen would remove the video this way.\r\n\r\nAlso also, instead of hiding and showing the element (like I do in this game), it would probably be best to hide it, then move it to the end of the #output element before showing it again.\r\n\r\nI'll be back after  a little testing.</s>\r\n\r\nI'm researching this now.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>Is it possible to have the video scroll up just like normal text?</p>\n</blockquote>\n<p>Behold, the last two lines of youTubeAPISetup.js:</p>\n<pre><code>elem.insertBefore($(\"#input\"));\n  elem.hide();\n</code></pre>\n<hr>\n<p><s>You could probably change that to:</s></p><s>\n<pre><code>$(\"#output\").append(elem)\n//elem.hide()\n</code></pre>\n</s>\nYou'd probably not want to hide the youtube element in this scenario.\n<p>Also, I'm not sure if clearing the screen would remove the video this way.</p>\n<p>Also also, instead of hiding and showing the element (like I do in this game), it would probably be best to hide it, then move it to the end of the #output element before showing it again.</p>\n<p>I'll be back after  a little testing.</p>\n<p>I'm researching this now.</p>\n\n",
      "PostDate": "2020-12-15T13:28:13.6914686Z",
      "LastEditDate": "2020-12-15T14:39:49.4111322Z",
      "link": null
    },
    {
      "PostId": "c5b764dd-a8b7-4a4a-9b08-edefdbbbf038",
      "UserId": 301690,
      "Username": "Richard Headkid",
      "AvatarUrl": "http://i.imgur.com/WUGXS8yb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I figured out how to do this, but clearing the screen breaks it.  It removes the element, and the element must always exist so the API can manipulate it.  (There may be something I'm overlooking.)\r\n\r\nIf we want a YouTube video to be added with the normal output text and scroll with it, we'd probably be better off with a normal YouTube iframe (with no API controls over it).\r\n\r\nTo pull this off, the CSP still needs YouTube added, and this function should work fine:\r\n\r\n```\r\nfunction youTube(id='7vIi0U4rSX4',auto=true){\r\n\tkillYoutube();\r\n\tvar autoplay = '1';\r\n\tif (!auto) autoplay = '0';\r\n\tvar s = '<iframe id=\"youTube\" width=\"560\" height=\"315\"';\r\n\ts += ' src=\"https://www.youtube.com/embed/'+id+'?autoplay='+autoplay+'\"';\r\n\ts += ' frameborder=\"0\" allowfullscreen></iframe>';\r\n\tmsg(s);\r\n\t\r\n};\r\n```\r\n\r\n---\r\nNote that clearing the screen will kill the video when its element is in the output element.",
      "EditableFormat": "markdown",
      "HTML": "<p>I figured out how to do this, but clearing the screen breaks it.  It removes the element, and the element must always exist so the API can manipulate it.  (There may be something I'm overlooking.)</p>\n<p>If we want a YouTube video to be added with the normal output text and scroll with it, we'd probably be better off with a normal YouTube iframe (with no API controls over it).</p>\n<p>To pull this off, the CSP still needs YouTube added, and this function should work fine:</p>\n<pre><code>function youTube(id='7vIi0U4rSX4',auto=true){\n\tkillYoutube();\n\tvar autoplay = '1';\n\tif (!auto) autoplay = '0';\n\tvar s = '&lt;iframe id=\"youTube\" width=\"560\" height=\"315\"';\n\ts += ' src=\"https://www.youtube.com/embed/'+id+'?autoplay='+autoplay+'\"';\n\ts += ' frameborder=\"0\" allowfullscreen&gt;&lt;/iframe&gt;';\n\tmsg(s);\n\t\n};\n</code></pre>\n<hr>\n<p>Note that clearing the screen will kill the video when its element is in the output element.</p>\n\n",
      "PostDate": "2020-12-15T14:44:43.9619369Z",
      "LastEditDate": "2020-12-15T14:45:21.858189Z",
      "link": null
    },
    {
      "PostId": "ea51460a-f206-4dfd-9c28-a8b50572c8fc",
      "UserId": 301690,
      "Username": "Richard Headkid",
      "AvatarUrl": "http://i.imgur.com/WUGXS8yb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "## THIS JUST IN\r\n\r\nI just test saving with this.  It's a problem.\r\n\r\nTODO:  Set the preSave and afterLoad stuff on the TV to check the YouTube player status.",
      "EditableFormat": "markdown",
      "HTML": "<h2>THIS JUST IN</h2>\n<p>I just test saving with this.  It's a problem.</p>\n<p>TODO:  Set the preSave and afterLoad stuff on the TV to check the YouTube player status.</p>\n\n",
      "PostDate": "2020-12-15T19:19:26.9949221Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
