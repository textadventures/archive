{
  "Topic": {
    "TopicId": "3ijn7twfbeymzqdcbffdvg",
    "ForumId": "10",
    "Title": "Mapping everything",
    "LastUpdated": "2020-10-25T15:26:57.847427Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "c425960c-9b5b-478b-badd-b9da208c47d9",
      "UserId": 9720,
      "Username": "E.K.Virtanen",
      "AvatarUrl": "https://secure.gravatar.com/avatar/c8e692beab319f6454b25d059f8f95b1?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hi,\r\n\r\nmy idea is to reveal the whole map at the start of the game. Now i did find something usefull from tutorials, however im not sure where i should write that example script.\r\n\r\nTutorial is at https://docs.textadventures.co.uk/quest/showing_a_map.html\r\nand bit after halfway there is subject **Mapping everywhere**\r\n\r\n<pre><code>\r\nif (not GetBoolean(room, \"genvisited\")) {\r\n  room.genvisited = true\r\n  Grid_CalculateMapCoordinates (room, game.pov)\r\n  // Grid_DrawRoom (room, false, game.pov)\r\n  foreach (exit, AllExits()) {\r\n    if (exit.parent = room) {\r\n      VisitRoom (exit.to)\r\n    }\r\n  }\r\n}\r\n</code></pre>\r\n\r\nIm using a desktop version of Quest.\r\n\r\nThanks, E.K.",
      "EditableFormat": "markdown",
      "HTML": "<p>Hi,</p>\n<p>my idea is to reveal the whole map at the start of the game. Now i did find something usefull from tutorials, however im not sure where i should write that example script.</p>\n<p>Tutorial is at https://docs.textadventures.co.uk/quest/showing_a_map.html<br>\nand bit after halfway there is subject <strong>Mapping everywhere</strong></p>\n<pre><code>\nif (not GetBoolean(room, \"genvisited\")) {\n  room.genvisited = true\n  Grid_CalculateMapCoordinates (room, game.pov)\n  // Grid_DrawRoom (room, false, game.pov)\n  foreach (exit, AllExits()) {\n    if (exit.parent = room) {\n      VisitRoom (exit.to)\n    }\n  }\n}\n</code></pre>\n<p>Im using a desktop version of Quest.</p>\n<p>Thanks, E.K.</p>\n\n",
      "PostDate": "2020-10-25T15:26:57.847427Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "97620cf8-88ac-4d6a-8b71-e388027b1f90",
      "UserId": 924,
      "Username": "Pertex",
      "AvatarUrl": "https://secure.gravatar.com/avatar/4cc1e52f99452e841ecf4cbee9eadde9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "It is described exactly in the tutorial! Your code must be put into a function called \"VisitRoom\" and this function must be called in the start script of the game",
      "EditableFormat": "markdown",
      "HTML": "<p>It is described exactly in the tutorial! Your code must be put into a function called \"VisitRoom\" and this function must be called in the start script of the game</p>\n\n",
      "PostDate": "2020-10-25T16:27:31.0991107Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "10559e88-7ecd-4229-82a0-e595f4526602",
      "UserId": 207026,
      "Username": "Pykrete",
      "AvatarUrl": "https://i.imgur.com/n9Ygszeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Question! I've always wondered this, but keep forgetting to ask. Will doing this have any effect on room before/after first time scripts? I use those a lot.",
      "EditableFormat": "markdown",
      "HTML": "<p>Question! I've always wondered this, but keep forgetting to ask. Will doing this have any effect on room before/after first time scripts? I use those a lot.</p>\n\n",
      "PostDate": "2020-10-25T17:25:47.5716474Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "e58c2dff-1d01-4b17-ae3a-8467fc759343",
      "UserId": 9720,
      "Username": "E.K.Virtanen",
      "AvatarUrl": "https://secure.gravatar.com/avatar/c8e692beab319f6454b25d059f8f95b1?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Ok, did find button code view. That solved my problem.\r\n\r\nWhat Pykrete asked interests me too tho.",
      "EditableFormat": "markdown",
      "HTML": "<p>Ok, did find button code view. That solved my problem.</p>\n<p>What Pykrete asked interests me too tho.</p>\n\n",
      "PostDate": "2020-10-25T19:28:01.2847957Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "5f45b063-56f1-45b2-a30d-d033ce002533",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "**(I see you have a solution; but I don't like the code in that tutorial. My inner programmer wants to see if I can improve it)**\r\n\r\nIt seems a little inefficient to do this recursively.\r\nAlso, you're looping over AllExits() once for every room. Might be faster to create a lookup table first.\r\n\r\nWouldn't it be more elegant to do something like:\r\n```\r\nexits_by_room = new Dictionary()\r\nforeach (exit, AllExits()) {\r\n  if (HasObject (exit, \"parent\") and HasObject (exit, \"to\") and DoesInherit (exit, \"direction\")) {\r\n    if (DictionaryContains (exits_by_room, exit.parent.name)) {\r\n      list = DictionaryItem (exits_by_room, exit.parent.name)\r\n    }\r\n    else {\r\n      list = NewObjectList()\r\n      dictionary add (exits_by_room, exit.parent.name, list)\r\n    }\r\n    list add (exit.to)\r\n  }\r\n}\r\n\r\n// The next line sets the coordinates for the current room to zero. Only necessary if the starting room hasn't been drawn yet\r\ngame.pov.grid_coordinates = QuickParams (game.pov.paren.name, QuickParams (\"x\", 0, \"y\", 0, \"z\", 0))\r\n\r\nrooms_to_scan = NewObjectList()\r\nroomnumber = 0\r\nlist add (rooms_to_scan, game.pov.parent)\r\n\r\nwhile (roomnumber < ListCount (rooms_to_scan)) {\r\n  room = ListItem (rooms_to_scan, roomnumber)\r\n  roomnumber = roomnumber + 1\r\n  Grid_CalculateMapCoordinates (room, game.pov)\r\n  // Grid_DrawRoom (room, false, game.pov)\r\n  if (DictionaryContains (exits_by_room, room.name)) {\r\n    roomlist = DictionaryItem (exits_by_room, room.name)\r\n    foreach (room, roomlist) {\r\n      if (not ListContains (rooms_to_scan, room)) list add (rooms_to_scan, room)\r\n    }\r\n  }\r\n}\r\n```\r\n(yeah, it's more code. But I think it should also be more efficient and more robust)\r\n\r\n(also, if you're curious about stuff like that, you could print out the `rooms_to_scan` list; as it will contain a list of all rooms in order of distance from the starting point)",
      "EditableFormat": "markdown",
      "HTML": "<p><strong>(I see you have a solution; but I don't like the code in that tutorial. My inner programmer wants to see if I can improve it)</strong></p>\n<p>It seems a little inefficient to do this recursively.<br>\nAlso, you're looping over AllExits() once for every room. Might be faster to create a lookup table first.</p>\n<p>Wouldn't it be more elegant to do something like:</p>\n<pre><code>exits_by_room = new Dictionary()\nforeach (exit, AllExits()) {\n  if (HasObject (exit, \"parent\") and HasObject (exit, \"to\") and DoesInherit (exit, \"direction\")) {\n    if (DictionaryContains (exits_by_room, exit.parent.name)) {\n      list = DictionaryItem (exits_by_room, exit.parent.name)\n    }\n    else {\n      list = NewObjectList()\n      dictionary add (exits_by_room, exit.parent.name, list)\n    }\n    list add (exit.to)\n  }\n}\n\n// The next line sets the coordinates for the current room to zero. Only necessary if the starting room hasn't been drawn yet\ngame.pov.grid_coordinates = QuickParams (game.pov.paren.name, QuickParams (\"x\", 0, \"y\", 0, \"z\", 0))\n\nrooms_to_scan = NewObjectList()\nroomnumber = 0\nlist add (rooms_to_scan, game.pov.parent)\n\nwhile (roomnumber &lt; ListCount (rooms_to_scan)) {\n  room = ListItem (rooms_to_scan, roomnumber)\n  roomnumber = roomnumber + 1\n  Grid_CalculateMapCoordinates (room, game.pov)\n  // Grid_DrawRoom (room, false, game.pov)\n  if (DictionaryContains (exits_by_room, room.name)) {\n    roomlist = DictionaryItem (exits_by_room, room.name)\n    foreach (room, roomlist) {\n      if (not ListContains (rooms_to_scan, room)) list add (rooms_to_scan, room)\n    }\n  }\n}\n</code></pre>\n<p>(yeah, it's more code. But I think it should also be more efficient and more robust)</p>\n<p>(also, if you're curious about stuff like that, you could print out the <code>rooms_to_scan</code> list; as it will contain a list of all rooms in order of distance from the starting point)</p>\n\n",
      "PostDate": "2020-10-25T20:33:17.4810989Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "e72d6fb2-0176-42c0-afdf-08fb6aeb0453",
      "UserId": 9720,
      "Username": "E.K.Virtanen",
      "AvatarUrl": "https://secure.gravatar.com/avatar/c8e692beab319f6454b25d059f8f95b1?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Coding is not the problem. Been done that for ages.  But for me knowing the code causes a problem. I spend 95% of time thinking of fastest and most optimized way to code. End result is half a million lines of code, not a single finished game or program ;)\r\n\r\nFor me, getting used to this new way to work makes problem. Before everything was on that ide and i controlled everything. So yes, this works for both ways.",
      "EditableFormat": "markdown",
      "HTML": "<p>Coding is not the problem. Been done that for ages.  But for me knowing the code causes a problem. I spend 95% of time thinking of fastest and most optimized way to code. End result is half a million lines of code, not a single finished game or program ;)</p>\n<p>For me, getting used to this new way to work makes problem. Before everything was on that ide and i controlled everything. So yes, this works for both ways.</p>\n\n",
      "PostDate": "2020-10-25T21:09:55.0509585Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "505e68a4-9f12-4891-8fec-2e947883bca7",
      "UserId": 207026,
      "Username": "Pykrete",
      "AvatarUrl": "https://i.imgur.com/n9Ygszeb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I suppose I could answer my own question by inserting the code and running the game, then seeing if my scripts still work. d'oh! Will report back later.",
      "EditableFormat": "markdown",
      "HTML": "<p>I suppose I could answer my own question by inserting the code and running the game, then seeing if my scripts still work. d'oh! Will report back later.</p>\n\n",
      "PostDate": "2020-10-26T18:22:21.9153842Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "80ee4925-c3c1-46f4-944f-071d75342695",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> Question! I've always wondered this, but keep forgetting to ask. Will doing this have any effect on room before/after first time scripts? I use those a lot.\r\n\r\nNo. Those rely on the attribute `visited`, which is set by the function `OnEnterRoom`.\r\n\r\n<hr/>\r\n\r\nAnd now I think about it, `Grid_CalculateMapCoordinates` is still looping over all exits to find the ones for the rooms it's calculating. That's inefficient. Realistically, it might make more sense to divide the map up into \"worlds\". Initially each room is its own world. Then you loop over all exits, and if the exit connects rooms that are in different worlds, you loop over all rooms in  the smaller world and add on an offset to their coordinates to join those two worlds together. I *think* that makes the complexity `O(N log N)` with respect to the number of rooms.\r\n\r\nI did wonder if it might be possible to modify `Grid_CalculateMapCoordinates` in a way that it doesn't recalculate the coordinates of the adjoining room each time the player moves; because that seems rather an inefficient way to do it, especially when you're having to consider so many exits every time. And I think it could be done, but you would instead need to manually recalculate the map if any room or exit's grid size changes. I'm going to try rewriting some of the grid library to make it more efficient; but not today, as I'm currently on chapter 498 of the story I'm writing, and I've put off finishing it for way too long.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>Question! I've always wondered this, but keep forgetting to ask. Will doing this have any effect on room before/after first time scripts? I use those a lot.</p>\n</blockquote>\n<p>No. Those rely on the attribute <code>visited</code>, which is set by the function <code>OnEnterRoom</code>.</p>\n<hr>\n<p>And now I think about it, <code>Grid_CalculateMapCoordinates</code> is still looping over all exits to find the ones for the rooms it's calculating. That's inefficient. Realistically, it might make more sense to divide the map up into \"worlds\". Initially each room is its own world. Then you loop over all exits, and if the exit connects rooms that are in different worlds, you loop over all rooms in  the smaller world and add on an offset to their coordinates to join those two worlds together. I <em>think</em> that makes the complexity <code>O(N log N)</code> with respect to the number of rooms.</p>\n<p>I did wonder if it might be possible to modify <code>Grid_CalculateMapCoordinates</code> in a way that it doesn't recalculate the coordinates of the adjoining room each time the player moves; because that seems rather an inefficient way to do it, especially when you're having to consider so many exits every time. And I think it could be done, but you would instead need to manually recalculate the map if any room or exit's grid size changes. I'm going to try rewriting some of the grid library to make it more efficient; but not today, as I'm currently on chapter 498 of the story I'm writing, and I've put off finishing it for way too long.</p>\n\n",
      "PostDate": "2020-10-26T20:22:45.2800304Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
