{
  "Topic": {
    "TopicId": "pojryvy_ikg4wldfrca7ra",
    "ForumId": "10",
    "Title": "Counter does not change",
    "LastUpdated": "2019-09-05T13:41:18.7387041Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "82b42893-2edd-4690-bb82-22fa3d57247e",
      "UserId": 434788,
      "Username": "AlexIlTabaccaio",
      "AvatarUrl": "https://secure.gravatar.com/avatar/139f546fef6dabd5891576153a4921a4?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Hello Again.\r\nI'm sorry, but I only started programming two days ago.\r\nI find myself in a situation where, on page 2 and page 10, I ask a counter set to 5 to decrease by 1. On page 10, the counter drops to 4, but returns to 5 if you press on one of the links that lead to page 8 or page 9.\r\nThe counter on page 2 instead is completely ignored, remaining at 5.\r\nI would like, if I go from page 2 and also from page 10, that the counter drops to 3 even going back to page 8 or 9 using links on page 10.\r\nHow can I solve it?\r\n\r\n```<!--Saved by Quest 5.8.6836.13983-->\r\n<asl version=\"580\">\r\n  <include ref=\"GamebookCore.aslx\" />\r\n  <game name=\"Una Sfortunata Giornata di Lavoro\">\r\n    <gameid>3d0f190b-fe4b-47bf-8799-b09a46a5439e</gameid>\r\n    <version>Pre Alpha 0.1</version>\r\n    <firstpublished>2019</firstpublished>\r\n    <category>Comedy</category>\r\n    <roomenter type=\"script\"><![CDATA[\r\n      SetCounter (\"pazienza\", 5)\r\n      if (GetInt(game, \"pazienza\") < 0) {\r\n        SetCounter (\"pazienza\", 5)\r\n      }\r\n      if (GetInt(game, \"pazienza\") > 5) {\r\n        SetCounter (\"pazienza\", 5)\r\n      }\r\n    ]]></roomenter>\r\n    <object name=\"Intro\">\r\n      <inherit name=\"script\" />\r\n      <description type=\"string\"></description>\r\n      <options type=\"stringdictionary\" />\r\n      <script type=\"script\"><![CDATA[\r\n        PrintCentered (\"Tu sei Alex.<br/>Un giovane ed ambizioso, per quanto pigro, imprenditore, e stai per affrontare quella che sarà probabilmente la peggiore giornata della tua vita.<br/>Dovrai prendere scelte difficili che influiranno sulla tua pazienza e quindi sulla storia, plasmata solo dalle tue decisioni e dalla tua immaginazione.<br/>Cerca di arrivare alla fine della giornata senza dare di matto.<br/><br/>{page:Page1:Cominciamo.}\")\r\n      ]]></script>\r\n      <object name=\"player\">\r\n        <inherit name=\"defaultplayer\" />\r\n      </object>\r\n    </object>\r\n  </game>\r\n  <object name=\"Parte 1\">\r\n    <description type=\"string\"></description>\r\n    <object name=\"Page1\">\r\n      <inherit name=\"script\" />\r\n      <script type=\"script\"><![CDATA[\r\n        set (this, \"visited\", true)\r\n        ClearScreen\r\n        OutputTextNoBr (\"E' un normale giovedì, in quel di Borgosesia.<br/>Manca ancora mezz'ora perchè scatti la sveglia, impostata tra perfezionamenti continui di Fantozziana memoria alle spaccate 6.30 del mattino, con un posticipo fisso alle 6.40.<br/>Una breve sonno/veglia ti concede qualche minuto di preparazione psicologica a quella che sarà la tua solita routine, o così pare;<br/>quando, improvvisamente, un acuto e fastidioso abbaiare proveniente dalla stazione ferroviaria, a pochi metri dal tuo appartamento, si manifesta.<br/>Tenti invano di ignorarlo ma la costanza del suono si fa sempre più vivida nella tua testa, creando non poca irritazione.<br/>Decidi quindi che tra {page:Page2:l'ignorare la cosa} ed {page:Page3:esprimere il tuo profondo dissenso verso il padrone}, \")\r\n        RemovePageLink (Page1, Page3)\r\n      ]]></script>\r\n      <object name=\"Page2\">\r\n        <inherit name=\"script\" />\r\n        <description type=\"string\"></description>\r\n        <script type=\"script\"><![CDATA[\r\n          set (this, \"visited\", true)\r\n          ChangeCounter (\"pazienza\", -1)\r\n          OutputTextNoBr (\"sia il caso di mandare giù il primo boccone della giornata.<br/>Completamente attonito dal rimbombare nelle orecchie di questo suono sempre più snervante, aspetti solo di alzarti dal letto.\")\r\n          MovePlayer (Page4)\r\n        ]]></script>\r\n      </object>\r\n      <object name=\"Page3\">\r\n        <inherit name=\"script\" />\r\n        <description type=\"string\"></description>\r\n        <script type=\"script\"><![CDATA[\r\n          set (this, \"visited\", true)\r\n          OutputTextNoBr (\"debba partire quasi involontariamente e ad alta voce una minaccia fisica rivolta alla faccia del proprietario dell'animale.<br/>Dopo 10 secondi buoni di silenzio cupo ed imbarazzante, avverti in lontananza un borbottare di alfabeto asemico misto a dialetto campagnolo. Se non altro il cane ha smesso di abbaiare. Soddisfatto ed orgoglioso della tua fuori uscita mattutina, attendi il momento di alzarsi.\")\r\n          MovePlayer (Page4)\r\n        ]]></script>\r\n      </object>\r\n    </object>\r\n    <object name=\"Page4\">\r\n      <inherit name=\"script\" />\r\n      <script type=\"script\"><![CDATA[\r\n        set (this, \"visited\", true)\r\n        OutputTextNoBr (\"<br/>Come di consueto, l'alba rieccheggia su un'assolvente suoneria proveniente dallo smartphone. Nonostante l'idea istintiva nel cervello sia usualmente di posticipare e {page:Page5:chiudere ancora gli occhi}, ti chiedi se questa volta sia il caso di {page:Page6:alzarsi prima}\")\r\n        RemovePageLink (Page4, Page6)\r\n      ]]></script>\r\n      <object name=\"Page5\">\r\n        <inherit name=\"script\" />\r\n        <description type=\"string\"></description>\r\n        <script type=\"script\"><![CDATA[\r\n          set (this, \"visited\", true)\r\n          OutputTextNoBr (\". Non ci pensi due volte e torni a dormire, giusto il tempo di realizzare, come ogni giorno, quanto questa decisione faccia più male che bene.<br/>Dopo 10 minuti, percepiti come 10 secondi, avvicini il tuo telefono alla faccia e spegni la sveglia. \")\r\n          MovePlayer (Page7)\r\n        ]]></script>\r\n      </object>\r\n      <object name=\"Page6\">\r\n        <inherit name=\"script\" />\r\n        <description type=\"string\"></description>\r\n        <script type=\"script\">\r\n          set (this, \"visited\", true)\r\n          OutputTextNoBr (\", e miracolosamente, qualcosa di inizialmente ineccepibile accade. Prima che tu riesca a pensare, decidi in modo scattante di metterti in piedi. Nemmeno il rapido calo di pressione può ostacolare la tua eroica decisione. Prendi quindi il telefono e spegni la sveglia. \")\r\n          MovePlayer (Page7)\r\n        </script>\r\n      </object>\r\n    </object>\r\n    <object name=\"Page7\">\r\n      <inherit name=\"script\" />\r\n      <script type=\"script\">\r\n        set (this, \"visited\", true)\r\n        OutputTextNoBr (\"Parte quindi il calvario di ogni inizio giornata. Pensi però a cosa dare priorità. Se {page:Page8:vestirti}, {page:Page9:andare in bagno} o {page:Page10:guardare le news sul cellulare}. \")\r\n        RemovePageLink (Page7, Page10)\r\n      </script>\r\n      <object name=\"Page8\">\r\n        <inherit name=\"script\" />\r\n        <script type=\"script\">\r\n          set (this, \"visited\", true)\r\n        </script>\r\n      </object>\r\n      <object name=\"Page9\">\r\n        <inherit name=\"script\" />\r\n        <script type=\"script\">\r\n          set (this, \"visited\", true)\r\n        </script>\r\n      </object>\r\n      <object name=\"Page10\">\r\n        <inherit name=\"script\" />\r\n        <script type=\"script\"><![CDATA[\r\n          set (this, \"visited\", true)\r\n          OutputTextNoBr (\"E non avessi mai deciso per l'ultima opzione. Un colpo basso colpisce il tuo cuore, e ancora prima la meritocrazia in generale.<br/>Sullo schermo, una vivace Elettra Lamborghini, sul palco di Deejay Radio a Riccione, impegnata a simulare un'esibizione a tratti canora, sotto le urla dei fan accaniti. Pensi a quanto la musica stia soffrendo di un male incurabile e ricordi quanto sul palco ci saresti voluto essere te, nei tuoi sogni adolescenziali.<br/>Abbattuto da tanto poco rispetto nei confronti della cultura, \")\r\n          ChangeCounter (\"pazienza\", -1)\r\n          if (HasSeenPage(Page2)) {\r\n            OutputTextNoBr (\"con il cane in stazione che ancora abbaia senza frontiere, \")\r\n          }\r\n          OutputTextNoBr (\"rigiri lo sguardo tra la porta del {page:Page9:bagno} e l'armadio dei {page:Page8:vestiti}. \")\r\n          RemovePageLink (Page10, Page7)\r\n        ]]></script>\r\n      </object>\r\n    </object>\r\n  </object>\r\n</asl>",
      "EditableFormat": "markdown",
      "HTML": "<p>Hello Again.<br>\nI'm sorry, but I only started programming two days ago.<br>\nI find myself in a situation where, on page 2 and page 10, I ask a counter set to 5 to decrease by 1. On page 10, the counter drops to 4, but returns to 5 if you press on one of the links that lead to page 8 or page 9.<br>\nThe counter on page 2 instead is completely ignored, remaining at 5.<br>\nI would like, if I go from page 2 and also from page 10, that the counter drops to 3 even going back to page 8 or 9 using links on page 10.<br>\nHow can I solve it?</p>\n<pre><code>&lt;asl version=\"580\"&gt;\n  &lt;include ref=\"GamebookCore.aslx\" /&gt;\n  &lt;game name=\"Una Sfortunata Giornata di Lavoro\"&gt;\n    &lt;gameid&gt;3d0f190b-fe4b-47bf-8799-b09a46a5439e&lt;/gameid&gt;\n    &lt;version&gt;Pre Alpha 0.1&lt;/version&gt;\n    &lt;firstpublished&gt;2019&lt;/firstpublished&gt;\n    &lt;category&gt;Comedy&lt;/category&gt;\n    &lt;roomenter type=\"script\"&gt;&lt;![CDATA[\n      SetCounter (\"pazienza\", 5)\n      if (GetInt(game, \"pazienza\") &lt; 0) {\n        SetCounter (\"pazienza\", 5)\n      }\n      if (GetInt(game, \"pazienza\") &gt; 5) {\n        SetCounter (\"pazienza\", 5)\n      }\n    ]]&gt;&lt;/roomenter&gt;\n    &lt;object name=\"Intro\"&gt;\n      &lt;inherit name=\"script\" /&gt;\n      &lt;description type=\"string\"&gt;&lt;/description&gt;\n      &lt;options type=\"stringdictionary\" /&gt;\n      &lt;script type=\"script\"&gt;&lt;![CDATA[\n        PrintCentered (\"Tu sei Alex.&lt;br/&gt;Un giovane ed ambizioso, per quanto pigro, imprenditore, e stai per affrontare quella che sarà probabilmente la peggiore giornata della tua vita.&lt;br/&gt;Dovrai prendere scelte difficili che influiranno sulla tua pazienza e quindi sulla storia, plasmata solo dalle tue decisioni e dalla tua immaginazione.&lt;br/&gt;Cerca di arrivare alla fine della giornata senza dare di matto.&lt;br/&gt;&lt;br/&gt;{page:Page1:Cominciamo.}\")\n      ]]&gt;&lt;/script&gt;\n      &lt;object name=\"player\"&gt;\n        &lt;inherit name=\"defaultplayer\" /&gt;\n      &lt;/object&gt;\n    &lt;/object&gt;\n  &lt;/game&gt;\n  &lt;object name=\"Parte 1\"&gt;\n    &lt;description type=\"string\"&gt;&lt;/description&gt;\n    &lt;object name=\"Page1\"&gt;\n      &lt;inherit name=\"script\" /&gt;\n      &lt;script type=\"script\"&gt;&lt;![CDATA[\n        set (this, \"visited\", true)\n        ClearScreen\n        OutputTextNoBr (\"E' un normale giovedì, in quel di Borgosesia.&lt;br/&gt;Manca ancora mezz'ora perchè scatti la sveglia, impostata tra perfezionamenti continui di Fantozziana memoria alle spaccate 6.30 del mattino, con un posticipo fisso alle 6.40.&lt;br/&gt;Una breve sonno/veglia ti concede qualche minuto di preparazione psicologica a quella che sarà la tua solita routine, o così pare;&lt;br/&gt;quando, improvvisamente, un acuto e fastidioso abbaiare proveniente dalla stazione ferroviaria, a pochi metri dal tuo appartamento, si manifesta.&lt;br/&gt;Tenti invano di ignorarlo ma la costanza del suono si fa sempre più vivida nella tua testa, creando non poca irritazione.&lt;br/&gt;Decidi quindi che tra {page:Page2:l'ignorare la cosa} ed {page:Page3:esprimere il tuo profondo dissenso verso il padrone}, \")\n        RemovePageLink (Page1, Page3)\n      ]]&gt;&lt;/script&gt;\n      &lt;object name=\"Page2\"&gt;\n        &lt;inherit name=\"script\" /&gt;\n        &lt;description type=\"string\"&gt;&lt;/description&gt;\n        &lt;script type=\"script\"&gt;&lt;![CDATA[\n          set (this, \"visited\", true)\n          ChangeCounter (\"pazienza\", -1)\n          OutputTextNoBr (\"sia il caso di mandare giù il primo boccone della giornata.&lt;br/&gt;Completamente attonito dal rimbombare nelle orecchie di questo suono sempre più snervante, aspetti solo di alzarti dal letto.\")\n          MovePlayer (Page4)\n        ]]&gt;&lt;/script&gt;\n      &lt;/object&gt;\n      &lt;object name=\"Page3\"&gt;\n        &lt;inherit name=\"script\" /&gt;\n        &lt;description type=\"string\"&gt;&lt;/description&gt;\n        &lt;script type=\"script\"&gt;&lt;![CDATA[\n          set (this, \"visited\", true)\n          OutputTextNoBr (\"debba partire quasi involontariamente e ad alta voce una minaccia fisica rivolta alla faccia del proprietario dell'animale.&lt;br/&gt;Dopo 10 secondi buoni di silenzio cupo ed imbarazzante, avverti in lontananza un borbottare di alfabeto asemico misto a dialetto campagnolo. Se non altro il cane ha smesso di abbaiare. Soddisfatto ed orgoglioso della tua fuori uscita mattutina, attendi il momento di alzarsi.\")\n          MovePlayer (Page4)\n        ]]&gt;&lt;/script&gt;\n      &lt;/object&gt;\n    &lt;/object&gt;\n    &lt;object name=\"Page4\"&gt;\n      &lt;inherit name=\"script\" /&gt;\n      &lt;script type=\"script\"&gt;&lt;![CDATA[\n        set (this, \"visited\", true)\n        OutputTextNoBr (\"&lt;br/&gt;Come di consueto, l'alba rieccheggia su un'assolvente suoneria proveniente dallo smartphone. Nonostante l'idea istintiva nel cervello sia usualmente di posticipare e {page:Page5:chiudere ancora gli occhi}, ti chiedi se questa volta sia il caso di {page:Page6:alzarsi prima}\")\n        RemovePageLink (Page4, Page6)\n      ]]&gt;&lt;/script&gt;\n      &lt;object name=\"Page5\"&gt;\n        &lt;inherit name=\"script\" /&gt;\n        &lt;description type=\"string\"&gt;&lt;/description&gt;\n        &lt;script type=\"script\"&gt;&lt;![CDATA[\n          set (this, \"visited\", true)\n          OutputTextNoBr (\". Non ci pensi due volte e torni a dormire, giusto il tempo di realizzare, come ogni giorno, quanto questa decisione faccia più male che bene.&lt;br/&gt;Dopo 10 minuti, percepiti come 10 secondi, avvicini il tuo telefono alla faccia e spegni la sveglia. \")\n          MovePlayer (Page7)\n        ]]&gt;&lt;/script&gt;\n      &lt;/object&gt;\n      &lt;object name=\"Page6\"&gt;\n        &lt;inherit name=\"script\" /&gt;\n        &lt;description type=\"string\"&gt;&lt;/description&gt;\n        &lt;script type=\"script\"&gt;\n          set (this, \"visited\", true)\n          OutputTextNoBr (\", e miracolosamente, qualcosa di inizialmente ineccepibile accade. Prima che tu riesca a pensare, decidi in modo scattante di metterti in piedi. Nemmeno il rapido calo di pressione può ostacolare la tua eroica decisione. Prendi quindi il telefono e spegni la sveglia. \")\n          MovePlayer (Page7)\n        &lt;/script&gt;\n      &lt;/object&gt;\n    &lt;/object&gt;\n    &lt;object name=\"Page7\"&gt;\n      &lt;inherit name=\"script\" /&gt;\n      &lt;script type=\"script\"&gt;\n        set (this, \"visited\", true)\n        OutputTextNoBr (\"Parte quindi il calvario di ogni inizio giornata. Pensi però a cosa dare priorità. Se {page:Page8:vestirti}, {page:Page9:andare in bagno} o {page:Page10:guardare le news sul cellulare}. \")\n        RemovePageLink (Page7, Page10)\n      &lt;/script&gt;\n      &lt;object name=\"Page8\"&gt;\n        &lt;inherit name=\"script\" /&gt;\n        &lt;script type=\"script\"&gt;\n          set (this, \"visited\", true)\n        &lt;/script&gt;\n      &lt;/object&gt;\n      &lt;object name=\"Page9\"&gt;\n        &lt;inherit name=\"script\" /&gt;\n        &lt;script type=\"script\"&gt;\n          set (this, \"visited\", true)\n        &lt;/script&gt;\n      &lt;/object&gt;\n      &lt;object name=\"Page10\"&gt;\n        &lt;inherit name=\"script\" /&gt;\n        &lt;script type=\"script\"&gt;&lt;![CDATA[\n          set (this, \"visited\", true)\n          OutputTextNoBr (\"E non avessi mai deciso per l'ultima opzione. Un colpo basso colpisce il tuo cuore, e ancora prima la meritocrazia in generale.&lt;br/&gt;Sullo schermo, una vivace Elettra Lamborghini, sul palco di Deejay Radio a Riccione, impegnata a simulare un'esibizione a tratti canora, sotto le urla dei fan accaniti. Pensi a quanto la musica stia soffrendo di un male incurabile e ricordi quanto sul palco ci saresti voluto essere te, nei tuoi sogni adolescenziali.&lt;br/&gt;Abbattuto da tanto poco rispetto nei confronti della cultura, \")\n          ChangeCounter (\"pazienza\", -1)\n          if (HasSeenPage(Page2)) {\n            OutputTextNoBr (\"con il cane in stazione che ancora abbaia senza frontiere, \")\n          }\n          OutputTextNoBr (\"rigiri lo sguardo tra la porta del {page:Page9:bagno} e l'armadio dei {page:Page8:vestiti}. \")\n          RemovePageLink (Page10, Page7)\n        ]]&gt;&lt;/script&gt;\n      &lt;/object&gt;\n    &lt;/object&gt;\n  &lt;/object&gt;\n&lt;/asl&gt;\n</code></pre>\n\n",
      "PostDate": "2019-09-05T13:41:18.7387041Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "f2c50b81-f229-4dd9-b67b-e8bf886f9280",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I think the issue is in your `roomenter` script:\r\n\r\n```\r\n      SetCounter (\"pazienza\", 5)\r\n      if (GetInt(game, \"pazienza\") < 0) {\r\n        SetCounter (\"pazienza\", 5)\r\n      }\r\n      if (GetInt(game, \"pazienza\") > 5) {\r\n        SetCounter (\"pazienza\", 5)\r\n      }\r\n```\r\n\r\nFirst, this sets the counter to 5.\r\nThen, if the counter is less than zero (which it can't be, because you just set it to 5), it sets it to 5.\r\nThen, if the counter is greater than 5 (which it can't be, because you just set it to 5), it sets it to 5.\r\n\r\nThis script runs whenever the player arrives on a page, before running the script for that page. So you can subtract 1 from the counter and it's now 4, but as soon as the player visits another page, or the same page again, it gets set back to 5.\r\n\r\nIf you're trying to set the *initial* value for the counter, then you probably want to set it on the first page; or put a `firsttime` block around it.",
      "EditableFormat": "markdown",
      "HTML": "<p>I think the issue is in your <code>roomenter</code> script:</p>\n<pre><code>      SetCounter (\"pazienza\", 5)\n      if (GetInt(game, \"pazienza\") &lt; 0) {\n        SetCounter (\"pazienza\", 5)\n      }\n      if (GetInt(game, \"pazienza\") &gt; 5) {\n        SetCounter (\"pazienza\", 5)\n      }\n</code></pre>\n<p>First, this sets the counter to 5.<br>\nThen, if the counter is less than zero (which it can't be, because you just set it to 5), it sets it to 5.<br>\nThen, if the counter is greater than 5 (which it can't be, because you just set it to 5), it sets it to 5.</p>\n<p>This script runs whenever the player arrives on a page, before running the script for that page. So you can subtract 1 from the counter and it's now 4, but as soon as the player visits another page, or the same page again, it gets set back to 5.</p>\n<p>If you're trying to set the <em>initial</em> value for the counter, then you probably want to set it on the first page; or put a <code>firsttime</code> block around it.</p>\n\n",
      "PostDate": "2019-09-05T20:01:10.265973Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "12de182f-20cf-4aa7-a307-617f9f3417e8",
      "UserId": 434788,
      "Username": "AlexIlTabaccaio",
      "AvatarUrl": "https://i.imgur.com/qRXqho9b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "problem solved by moving the initial value from game to page1.\r\n\r\nThank you so much!\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>problem solved by moving the initial value from game to page1.</p>\n<p>Thank you so much!</p>\n\n",
      "PostDate": "2019-09-05T21:00:18.0490932Z",
      "LastEditDate": "2019-09-05T22:16:27.2132981Z",
      "link": null
    }
  ]
}
