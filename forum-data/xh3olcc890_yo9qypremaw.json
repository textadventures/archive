{
  "Topic": {
    "TopicId": "xh3olcc890_yo9qypremaw",
    "ForumId": "10",
    "Title": "I can't get \"do\" to run and struggle with understanding commands",
    "LastUpdated": "2018-11-09T00:33:25.5082007Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "7fcb0046-5830-407f-ac26-d7541bcf7487",
      "UserId": 326173,
      "Username": "Curt A. P.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/bc1d5d57408cf4d13f9d9f23c1e3dc56?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Certain npc characters have a \"charm\" verb which is working fine. Now I try to create a charm command for the case the player try it on other objects. \r\n```\r\n  <command>\r\n    <pattern>charm #object1#</pattern>\r\n    <unresolved><![CDATA[</br>This can't work. (Unresolved object test) </br>]]></unresolved>\r\n    <script><![CDATA[\r\n      if (GetBoolean(object1, \"npc\")) {\r\n        do (object1, \"charm\")\r\n      }\r\n      else {\r\n        msg (\"<br/>This can't work.<br/>\")\r\n      }\r\n    ]]></script>\r\n  </command>\r\n```\r\nMy problem is: **do (object1, \"charm\")**\r\n\r\nI have read so many topics about this problem and this infamous message: ***Error running script: Object reference not set to an instance of an object.*** \r\nI tried to use HandleSingleCommand but this leads always into a game crash without error.\r\nI tried to use the same command with a reachable npc as object instead of a variable but the error was the same. ",
      "EditableFormat": "markdown",
      "HTML": "<p>Certain npc characters have a \"charm\" verb which is working fine. Now I try to create a charm command for the case the player try it on other objects.</p>\n<pre><code>  &lt;command&gt;\n    &lt;pattern&gt;charm #object1#&lt;/pattern&gt;\n    &lt;unresolved&gt;&lt;![CDATA[&lt;/br&gt;This can't work. (Unresolved object test) &lt;/br&gt;]]&gt;&lt;/unresolved&gt;\n    &lt;script&gt;&lt;![CDATA[\n      if (GetBoolean(object1, \"npc\")) {\n        do (object1, \"charm\")\n      }\n      else {\n        msg (\"&lt;br/&gt;This can't work.&lt;br/&gt;\")\n      }\n    ]]&gt;&lt;/script&gt;\n  &lt;/command&gt;\n</code></pre>\n<p>My problem is: <strong>do (object1, \"charm\")</strong></p>\n<p>I have read so many topics about this problem and this infamous message: <strong><em>Error running script: Object reference not set to an instance of an object.</em></strong><br>\nI tried to use HandleSingleCommand but this leads always into a game crash without error.<br>\nI tried to use the same command with a reachable npc as object instead of a variable but the error was the same.</p>\n\n",
      "PostDate": "2018-11-09T00:33:25.5082007Z",
      "LastEditDate": "2018-11-09T02:55:31.0414574Z",
      "link": null
    },
    {
      "PostId": "15d5f21e-21ab-47ff-9520-3d430982e862",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> I tried to use HandleSingleCommand but this leads always into a game crash without error.\r\n\r\nIs this online or desktop or both? I've never experienced any crashes when it comes to ```HandSingleCommand```\r\n\r\nAnother question: Is your player supposed to be able to charm objects? How many objects are we talking?\r\nMaybe put objects in a switch and script them individually (or call a function) for all charmable objects and throw a default for the uncharmable objects who's not in the switch?",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I tried to use HandleSingleCommand but this leads always into a game crash without error.</p>\n</blockquote>\n<p>Is this online or desktop or both? I've never experienced any crashes when it comes to <code>HandSingleCommand</code></p>\n<p>Another question: Is your player supposed to be able to charm objects? How many objects are we talking?<br>\nMaybe put objects in a switch and script them individually (or call a function) for all charmable objects and throw a default for the uncharmable objects who's not in the switch?</p>\n\n",
      "PostDate": "2018-11-09T07:58:25.3463977Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "27d95b99-7e1c-452f-a3c8-fba9dc55edb1",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Make sure the NPC has a \"charm\" attribute that is a script. You will get that message otherwise.\r\n\r\nI have put that command in a test game, and that looks like it works fine.",
      "EditableFormat": "markdown",
      "HTML": "<p>Make sure the NPC has a \"charm\" attribute that is a script. You will get that message otherwise.</p>\n<p>I have put that command in a test game, and that looks like it works fine.</p>\n\n",
      "PostDate": "2018-11-09T08:03:59.4010052Z",
      "LastEditDate": "2018-11-09T08:06:21.3444414Z",
      "link": null
    },
    {
      "PostId": "1108d61d-8598-4190-8dfc-ec00c4c38375",
      "UserId": 924,
      "Username": "Pertex",
      "AvatarUrl": "https://secure.gravatar.com/avatar/4cc1e52f99452e841ecf4cbee9eadde9?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "So you have a global command \"charm\" and the verb \"charm\" at some npcs? I would do it this way: delete all the charm verbs and add a script attribute \"charm\" to every npc you want. Within this script you can do all you want (perhaps just print a  message).\r\nThen change your command like this:\r\n\r\n```\r\n   <command>\r\n      <pattern>charm #object1#</pattern>\r\n      <unresolved><![CDATA[</br>This can't work. (Unresolved object test) </br>]]></unresolved>\r\n      <script><![CDATA[\r\n        if (GetBoolean(object1, \"npc\") and HasAttribute(object1,\"charm\")) {\r\n          do (object1, \"charm\")\r\n        }\r\n        else {\r\n          msg (\"<br/>This can't work.<br/>\")\r\n        }\r\n      ]]></script>\r\n    </command>\r\n```\r\n\r\nedit: upps, too late",
      "EditableFormat": "markdown",
      "HTML": "<p>So you have a global command \"charm\" and the verb \"charm\" at some npcs? I would do it this way: delete all the charm verbs and add a script attribute \"charm\" to every npc you want. Within this script you can do all you want (perhaps just print a  message).<br>\nThen change your command like this:</p>\n<pre><code>   &lt;command&gt;\n      &lt;pattern&gt;charm #object1#&lt;/pattern&gt;\n      &lt;unresolved&gt;&lt;![CDATA[&lt;/br&gt;This can't work. (Unresolved object test) &lt;/br&gt;]]&gt;&lt;/unresolved&gt;\n      &lt;script&gt;&lt;![CDATA[\n        if (GetBoolean(object1, \"npc\") and HasAttribute(object1,\"charm\")) {\n          do (object1, \"charm\")\n        }\n        else {\n          msg (\"&lt;br/&gt;This can't work.&lt;br/&gt;\")\n        }\n      ]]&gt;&lt;/script&gt;\n    &lt;/command&gt;\n</code></pre>\n<p>edit: upps, too late</p>\n\n",
      "PostDate": "2018-11-09T08:15:42.3599824Z",
      "LastEditDate": "2018-11-09T08:16:25.1846923Z",
      "link": null
    },
    {
      "PostId": "a5e936de-608b-4572-8ff8-951294a1f00a",
      "UserId": 326173,
      "Username": "Curt A. P.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/bc1d5d57408cf4d13f9d9f23c1e3dc56?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">Is this online or desktop or both? I've never experienced any crashes when it comes to HandSingleCommand\r\n>\r\n>Another question: Is your player supposed to be able to charm objects? How many objects are we talking?\r\n\r\nHandSingleCommand, I used **Handle**SingleCommand and this misfunction froze the entire game.\r\nIt's a spell to make regular enemies to followers, so there will be many.\r\n\r\n</br>\r\n</br> \r\n\r\n>Make sure the NPC has a \"charm\" attribute that is a script. You will get that message otherwise.\r\n</br>\r\n\r\n>So you have a global command \"charm\" and the verb \"charm\" at some npcs? I would do it this way: delete all the charm verbs and add a script attribute \"charm\" to every npc you want. Within this script you can do all you want (perhaps just print a message).\r\nThen change your command like this:\r\n\r\nI thought making the verb was enough since I've read somewhere verbs are scriptattributes. \r\nThanks, the script  works fine now.\r\n\r\n</br>\r\n</br>\r\n\r\nNow, I struggle since last year with commands. I don't understand what a \"unresolved object\" is. Not a single clue...\r\nAnd scope on commands. What do they do exactly? I have absolutely no idea. LG\r\n",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>Is this online or desktop or both? I've never experienced any crashes when it comes to HandSingleCommand</p>\n<p>Another question: Is your player supposed to be able to charm objects? How many objects are we talking?</p>\n</blockquote>\n<p>HandSingleCommand, I used <strong>Handle</strong>SingleCommand and this misfunction froze the entire game.<br>\nIt's a spell to make regular enemies to followers, so there will be many.</p>\n<br>\n<br> \n<blockquote>\n<p>Make sure the NPC has a \"charm\" attribute that is a script. You will get that message otherwise.</p>\n</blockquote>\n<br>\n<blockquote>\n<p>So you have a global command \"charm\" and the verb \"charm\" at some npcs? I would do it this way: delete all the charm verbs and add a script attribute \"charm\" to every npc you want. Within this script you can do all you want (perhaps just print a message).<br>\nThen change your command like this:</p>\n</blockquote>\n<p>I thought making the verb was enough since I've read somewhere verbs are scriptattributes.<br>\nThanks, the script  works fine now.</p>\n<br>\n<br>\n<p>Now, I struggle since last year with commands. I don't understand what a \"unresolved object\" is. Not a single clue...<br>\nAnd scope on commands. What do they do exactly? I have absolutely no idea. LG</p>\n\n",
      "PostDate": "2018-11-09T16:06:31.1239224Z",
      "LastEditDate": "2018-11-09T16:10:49.8280874Z",
      "link": null
    },
    {
      "PostId": "3ef0aa76-edf4-4826-8ec5-b32a0e03b2b1",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> HandSingleCommand, I used HandleSingleCommand and this misfunction froze the entire game.\r\n\r\nYeah my mistake. I meant ``` HandleSingleCommand``` of course.  Too stressed out to type the whole thing it seems.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>HandSingleCommand, I used HandleSingleCommand and this misfunction froze the entire game.</p>\n</blockquote>\n<p>Yeah my mistake. I meant <code>HandleSingleCommand</code> of course.  Too stressed out to type the whole thing it seems.</p>\n\n",
      "PostDate": "2018-11-09T17:30:51.95228Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "06848756-600b-46b7-aeec-94c1448e51fa",
      "UserId": 326173,
      "Username": "Curt A. P.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/bc1d5d57408cf4d13f9d9f23c1e3dc56?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "CheeseMyBaby, \r\nokay, I used it this way because I've seen it on another topic: \r\n**HandleSingleCommand (\"charm object1\")**\r\n\r\nThis function just froze the game. \r\n\r\nOther attempts but I don't remember their results:\r\n**HandleSingleCommand (object1, \"charm\")**\r\n**HandleSingleCommand (\"charm \" + GetDisplayName (object1) + \")**\r\n**HandleSingleCommand (\"charm \" + GetDisplayAlias (object1) + \"**\r\n**HandleSingleCommand (\"charm \" + object1.alias + \"\")**\r\n\r\n\r\nSearching this function wasn't helpful, only 4 results or so.",
      "EditableFormat": "markdown",
      "HTML": "<p>CheeseMyBaby,<br>\nokay, I used it this way because I've seen it on another topic:<br>\n<strong>HandleSingleCommand (\"charm object1\")</strong></p>\n<p>This function just froze the game.</p>\n<p>Other attempts but I don't remember their results:<br>\n<strong>HandleSingleCommand (object1, \"charm\")</strong><br>\n<strong>HandleSingleCommand (\"charm \" + GetDisplayName (object1) + \")</strong><br>\n<strong>HandleSingleCommand (\"charm \" + GetDisplayAlias (object1) + \"</strong><br>\n<strong>HandleSingleCommand (\"charm \" + object1.alias + \"\")</strong></p>\n<p>Searching this function wasn't helpful, only 4 results or so.</p>\n\n",
      "PostDate": "2018-11-09T18:17:59.2419092Z",
      "LastEditDate": "2018-11-09T18:24:25.9146631Z",
      "link": null
    },
    {
      "PostId": "de0f7340-746f-4feb-8ce9-5ee43bac1a55",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "HandleSingleCommand() works the exact way as when the player is typing something.\r\n\r\nIf you script```HandleSingleCommand (\"look at slice of cheese\") ``` the result would be the same as if the player were to type ```look at slice of cheese```while playing.\r\n<br>\r\nThis (for example):\r\n> HandleSingleCommand (\"charm \" + GetDisplayName (object1) + \")\r\n\r\n... wouldn't work because ```charm \" + GetDisplayName (object1) + ```is not something the player would feed the parser with.\r\n<small>[EDIT:] Unless it's a verb/command you actually use which wouldn't really make much sense. :) [/Edit]</small>\r\n\r\n<small>[EDIT2:] If you want the quoted example to work using ```HandleSingleCommand()``` you'd need to replace the ``` GetDisplayName (object1)``` with whatever the name is. So if the DisplayName of Object1 is camenbert you'd need to script ```HandleSingleCommand (\"charm camenbert\")```\r\n\r\nI'm too drunk for this atm. Really, go with Pix's/Pertex's way mate.[/Edit2]</small>\r\n<br><br>\r\nHonestly I think you should look into Pix's and Pertex's solutions <small>(earlier in the thread)</small>. They seem to be more in line with what you're trying to accomplish.\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>HandleSingleCommand() works the exact way as when the player is typing something.</p>\n<p>If you script<code>HandleSingleCommand (\"look at slice of cheese\")</code> the result would be the same as if the player were to type <code>look at slice of cheese</code>while playing.<br>\n<br><br>\nThis (for example):</p>\n<blockquote>\n<p>HandleSingleCommand (\"charm \" + GetDisplayName (object1) + \")</p>\n</blockquote>\n<p>... wouldn't work because <code>charm \" + GetDisplayName (object1) +</code>is not something the player would feed the parser with.<br>\n<small>[EDIT:] Unless it's a verb/command you actually use which wouldn't really make much sense. :) [/Edit]</small></p>\n<p><small>[EDIT2:] If you want the quoted example to work using <code>HandleSingleCommand()</code> you'd need to replace the <code>GetDisplayName (object1)</code> with whatever the name is. So if the DisplayName of Object1 is camenbert you'd need to script <code>HandleSingleCommand (\"charm camenbert\")</code></small></p><small>\n</small><p><small>I'm too drunk for this atm. Really, go with Pix's/Pertex's way mate.[/Edit2]</small><br>\n<br><br><br>\nHonestly I think you should look into Pix's and Pertex's solutions <small>(earlier in the thread)</small>. They seem to be more in line with what you're trying to accomplish.</p>\n\n",
      "PostDate": "2018-11-09T21:24:09.8118889Z",
      "LastEditDate": "2018-11-09T21:29:49.3187503Z",
      "link": null
    },
    {
      "PostId": "67bca96f-d845-4f3b-9200-1ac8750911d4",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">. wouldn't work because charm \" + GetDisplayName (object1) +is not something the player would feed the parser with.\r\n\r\nNo, it would work . The expression: `\"charm \" + GetDisplayName (object1)` would return a string like `\"charm goblin\"`, or whatever the object's alias is. So that command would cause Quest to act as if the player had just typed that in.\r\n\r\nHowever, if you're doing this within the charm command, then it's infinite recursion.\r\n\r\nThe player types \"charm goblin\"\r\nQuest resolves the string \"goblin\", and turns it into an object.\r\nThe \"charm\" command script is run with the object1 variable set to the goblin\r\nThis gets the goblin's alias, and calls `HandleSingleCommand (\"charm goblin\")`\r\nThis causes Quest to treat it as if the player had typed \"charm goblin\"\r\nIt does that by repeating all the steps above, including this one.\r\n\r\nSo the command just keeps on running itself, again and again, until it runs out of memory. Then Quest crashes.",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>. wouldn't work because charm \" + GetDisplayName (object1) +is not something the player would feed the parser with.</p>\n</blockquote>\n<p>No, it would work . The expression: <code>\"charm \" + GetDisplayName (object1)</code> would return a string like <code>\"charm goblin\"</code>, or whatever the object's alias is. So that command would cause Quest to act as if the player had just typed that in.</p>\n<p>However, if you're doing this within the charm command, then it's infinite recursion.</p>\n<p>The player types \"charm goblin\"<br>\nQuest resolves the string \"goblin\", and turns it into an object.<br>\nThe \"charm\" command script is run with the object1 variable set to the goblin<br>\nThis gets the goblin's alias, and calls <code>HandleSingleCommand (\"charm goblin\")</code><br>\nThis causes Quest to treat it as if the player had typed \"charm goblin\"<br>\nIt does that by repeating all the steps above, including this one.</p>\n<p>So the command just keeps on running itself, again and again, until it runs out of memory. Then Quest crashes.</p>\n\n",
      "PostDate": "2018-11-09T21:55:26.0233433Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "361e05f2-4d4c-4816-a87c-2fec36a8fdb0",
      "UserId": 326173,
      "Username": "Curt A. P.",
      "AvatarUrl": "https://secure.gravatar.com/avatar/bc1d5d57408cf4d13f9d9f23c1e3dc56?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Yes, i mentioned the solution of Pixie andd Pertex works totally fine. Nothing wrong with learning more... \r\n\r\n>Now, I struggle since last year with commands. I don't understand what a \"unresolved object\" is. Not a single clue...\r\nAnd a scope on commands. What do they do exactly? I have absolutely no idea. LG",
      "EditableFormat": "markdown",
      "HTML": "<p>Yes, i mentioned the solution of Pixie andd Pertex works totally fine. Nothing wrong with learning more...</p>\n<blockquote>\n<p>Now, I struggle since last year with commands. I don't understand what a \"unresolved object\" is. Not a single clue...<br>\nAnd a scope on commands. What do they do exactly? I have absolutely no idea. LG</p>\n</blockquote>\n\n",
      "PostDate": "2018-11-09T23:14:32.9731099Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a1ac20f2-6528-4407-a6a1-fa78ba298c91",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "<b>@MrA</b>\r\n> No, it would work \r\n\r\nCool, I had no idea expressions worked with in \"HandleSC\".  Thanks for sorting me out!\r\n\r\n\r\n<b>@Curt</b>\r\n> Nothing wrong with learning more...\r\n\r\nOfc not, that's why we're all here. =) I sort of missed the part about \"the script working\". \r\n\r\n\r\n<font color=white><p align=right style=\"text-shadow: 2px 2px 4px #000000;\"><small>\r\n(I really should stop posting here, or anywhere, on wine-and-cheese-night)</small>\r\n</p></font>\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p><b>@MrA</b></p>\n<blockquote>\n<p>No, it would work</p>\n</blockquote>\n<p>Cool, I had no idea expressions worked with in \"HandleSC\".  Thanks for sorting me out!</p>\n<p><b>@Curt</b></p>\n<blockquote>\n<p>Nothing wrong with learning more...</p>\n</blockquote>\n<p>Ofc not, that's why we're all here. =) I sort of missed the part about \"the script working\".</p>\n<p><font color=\"white\"></font></p><p align=\"right\"><font color=\"white\"><small><br>\n(I really should stop posting here, or anywhere, on wine-and-cheese-night)</small></font></p><font color=\"white\">\n<p></p></font>\n\n",
      "PostDate": "2018-11-10T08:12:40.0293703Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "60779685-008a-40c2-9e47-bdfaaca8b9d9",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "(This post should not be here.)",
      "EditableFormat": "markdown",
      "HTML": "<p>(This post should not be here.)</p>\n\n",
      "PostDate": "2018-11-10T08:27:00.5937088Z",
      "LastEditDate": "2018-11-10T08:27:31.3672304Z",
      "link": null
    }
  ]
}
