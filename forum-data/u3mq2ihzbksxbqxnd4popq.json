{
  "Topic": {
    "TopicId": "u3mq2ihzbksxbqxnd4popq",
    "ForumId": "10",
    "Title": "Core functions ",
    "LastUpdated": "2020-09-12T22:11:54.0578618Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "a707aa52-158f-4859-a68b-0c26dce32edf",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I'm trying to debug a room-cloning script that keeps throwing errors like these:\r\n\r\n<code>Error running script: Error evaluating expression 'GetAllChildObjects(room)': Collection was modified; enumeration operation may not execute.\r\nError running script: Error evaluating expression 'GetAllChildObjects(newParent)': Collection was modified; enumeration operation may not execute.\r\nError running script: Error evaluating expression 'ListCombine(ScopeReachableNotHeldForRoom(room), ScopeVisibleNotReachableForRoom(room))': Value cannot be null.Parameter name: collection</code>\r\n\r\nWhat's confusing is my script isn't using commands like GetAllChildObjects(newParent).  I suspect the CloneObject or CreateBiExits commands I'm using are clashing with something else.  If I knew how these commands worked, I might be able to diagnose the issue.  \r\n\r\nIn the Wordpress codex, you can review the construction of their core functions.  Is there a similar reference for Quest?",
      "EditableFormat": "markdown",
      "HTML": "<p>I'm trying to debug a room-cloning script that keeps throwing errors like these:</p>\n<p><code>Error running script: Error evaluating expression 'GetAllChildObjects(room)': Collection was modified; enumeration operation may not execute.<br>\nError running script: Error evaluating expression 'GetAllChildObjects(newParent)': Collection was modified; enumeration operation may not execute.<br>\nError running script: Error evaluating expression 'ListCombine(ScopeReachableNotHeldForRoom(room), ScopeVisibleNotReachableForRoom(room))': Value cannot be null.Parameter name: collection</code></p>\n<p>What's confusing is my script isn't using commands like GetAllChildObjects(newParent).  I suspect the CloneObject or CreateBiExits commands I'm using are clashing with something else.  If I knew how these commands worked, I might be able to diagnose the issue.</p>\n<p>In the Wordpress codex, you can review the construction of their core functions.  Is there a similar reference for Quest?</p>\n\n",
      "PostDate": "2020-09-12T22:11:54.0578618Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "6d37d292-2ed7-44ed-b12e-02116ebe0678",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I found it!  (At least the answer to my immediate question.)  It's all in \\quest-master\\quest-master\\WorldModel\\WorldModel\\Core\\CoreFunctions.aslx.  Sorry, I'm still a newbie at this.\r\n\r\nNow for debugging my script to clone a room.  I'll post again if I figure it out.  In the meantime, if you all can already see something that's wrong based on the above, please let me know.",
      "EditableFormat": "markdown",
      "HTML": "<p>I found it!  (At least the answer to my immediate question.)  It's all in \\quest-master\\quest-master\\WorldModel\\WorldModel\\Core\\CoreFunctions.aslx.  Sorry, I'm still a newbie at this.</p>\n<p>Now for debugging my script to clone a room.  I'll post again if I figure it out.  In the meantime, if you all can already see something that's wrong based on the above, please let me know.</p>\n\n",
      "PostDate": "2020-09-13T10:43:43.0668743Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "60b5a06e-d50e-49f8-8d32-11b3b1f01e67",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "EDI: Posted at the same time :) Glad you found it.\r\n\r\nIf you have Quest installed locally, there will be a folder somewhere inside it named 'Core', which contains all the core functions. In the git repository, it's under WorldModel/WorldModel/, but not sure where it can be found once the thing compiles.\r\n\r\nThe expression given in your last error message appears in the file `CoreScopes.aslx`, within the function `ScopeVisibleNotHeldForRoom`.\r\n\r\nThe one above it is in the function `ScopeVisibleNotReachableForRoom`. And the line above that is for a line in the function `ScopeReachableNotHeldForRoom`; both of which are called from the expression in the last one. So I would assume they are the proximate cause of the error.\r\n\r\nI can't see how those errors could come about. However, that particular error message is often uninformative, so can be hard to debug. If you want to share the code that you're having problems with, I'm quite familiar with the core code, so perhaps I can help you find something.\r\n\r\nHope that helps.",
      "EditableFormat": "markdown",
      "HTML": "<p>EDI: Posted at the same time :) Glad you found it.</p>\n<p>If you have Quest installed locally, there will be a folder somewhere inside it named 'Core', which contains all the core functions. In the git repository, it's under WorldModel/WorldModel/, but not sure where it can be found once the thing compiles.</p>\n<p>The expression given in your last error message appears in the file <code>CoreScopes.aslx</code>, within the function <code>ScopeVisibleNotHeldForRoom</code>.</p>\n<p>The one above it is in the function <code>ScopeVisibleNotReachableForRoom</code>. And the line above that is for a line in the function <code>ScopeReachableNotHeldForRoom</code>; both of which are called from the expression in the last one. So I would assume they are the proximate cause of the error.</p>\n<p>I can't see how those errors could come about. However, that particular error message is often uninformative, so can be hard to debug. If you want to share the code that you're having problems with, I'm quite familiar with the core code, so perhaps I can help you find something.</p>\n<p>Hope that helps.</p>\n\n",
      "PostDate": "2020-09-13T10:51:47.1202797Z",
      "LastEditDate": "2020-09-13T10:53:18.9920883Z",
      "link": null
    },
    {
      "PostId": "2ddc6136-ce9f-4437-a5f1-b950683532c4",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Thanks, man.  I've been lurking here for the past month and have always been impressed with the care and attention you show to these posts.  You are a true resource and teacher!\r\n\r\nHere is my scenario.  The player is in a room with the x-y-z coordinates of 2.0.0 (stored as attributes <code>.x</code>, <code>.y</code>, and <code>.z</code>) and alias of \"2.0.0\", and he wants to mine north to 2.1.0.  This is done by cloning a room room called <code>prospectiveroom</code> with the respective placeholder attributes 7.7.7 and <code>.isroom=false</code>.\r\n\r\nThe steps are:\r\n\r\n1.  Set <code>prospectiveroom</code>'s .x, .y., and .z attributes to be the same as player.parent (2.0.0).\r\n\r\n2.  Increment <code>prospectiveroom</code>'s .y +1 to 1, so it's temporarily set to 2.1.0.\r\n\r\n3.  Check if <code>prospectiveroom</code>'s coordinates match those of a room already created.  If they do, <code>CreateBiExits</code> to that room.  (This part works fine.)  If 2.1.0 does not exist yet, <code>newroom = CloneObject(prospectiveroom)</code>.\r\n\r\n* And this is where the execution blows up every once in a while with this:\r\n\r\n<code>Error running script: Error evaluating expression 'GetAllChildObjects(newParent)': Collection was modified; enumeration operation may not execute.\r\nError running script: Error evaluating expression 'ListCombine(ScopeReachableNotHeldForRoom(room), ScopeVisibleNotReachableForRoom(room))': Value cannot be null.Parameter name: collection\r\nError running script: Cannot foreach over '' as it is not a list</code>\r\n\r\n4.  Reset <code>prospectiveroom</code>'s x-y-z and alias attributes to 7.7.7.  \r\n\r\n* At this point, I receive the following error, although I'm not sure if it's not just a continuation of the previous error:\r\n\r\n<code>Error running script: Error evaluating expression 'ListExclude(ScopeVisibleNotHeldNotScenery(), game.pov)': Object reference not set to an instance of an object.</code>\r\n\r\n5.  <code>newroom.isroom = true</code>   ... All this manipulation of <code>.isroom</code> is because I have timer scripts using the scope AllRooms to randomly place objects and NPCs, and I don't want them dropping into places like <code>prospectiveroom</code>.\r\n\r\n6.  <code>CreateBiExits (direction, currentroom, newroom)</code>  ... In this case, it's passing in <code>\"east\", player.parent, newroom</code>\r\n\r\n* This step occasionally throws similar errors as under #3 above:\r\n\r\n<code>Error running script: Error evaluating expression 'GetAllChildObjects(newParent)': Collection was modified; enumeration operation may not execute.\r\nError running script: Error evaluating expression 'ListCombine(ScopeReachableNotHeldForRoom(room), ScopeVisibleNotReachableForRoom(room))': Value cannot be null.Parameter name: collection\r\nError running script: Cannot foreach over '' as it is not a list</code>\r\n\r\nIt also tacks on:\r\n\r\n<code>Error running script: Error evaluating expression 'ListExclude(ScopeVisibleNotHeldNotScenery(),game.pov)': Object reference not set to an instance of an object.</code>\r\n\r\nWhat do you think?  I have a feeling I'm going to have to ditch this this whole cloning-room thing and just pre-make the ones I want, and then hide or not construct the exits between them.",
      "EditableFormat": "markdown",
      "HTML": "<p>Thanks, man.  I've been lurking here for the past month and have always been impressed with the care and attention you show to these posts.  You are a true resource and teacher!</p>\n<p>Here is my scenario.  The player is in a room with the x-y-z coordinates of 2.0.0 (stored as attributes <code>.x</code>, <code>.y</code>, and <code>.z</code>) and alias of \"2.0.0\", and he wants to mine north to 2.1.0.  This is done by cloning a room room called <code>prospectiveroom</code> with the respective placeholder attributes 7.7.7 and <code>.isroom=false</code>.</p>\n<p>The steps are:</p>\n<ol>\n<li>\n<p>Set <code>prospectiveroom</code>'s .x, .y., and .z attributes to be the same as player.parent (2.0.0).</p>\n</li>\n<li>\n<p>Increment <code>prospectiveroom</code>'s .y +1 to 1, so it's temporarily set to 2.1.0.</p>\n</li>\n<li>\n<p>Check if <code>prospectiveroom</code>'s coordinates match those of a room already created.  If they do, <code>CreateBiExits</code> to that room.  (This part works fine.)  If 2.1.0 does not exist yet, <code>newroom = CloneObject(prospectiveroom)</code>.</p>\n</li>\n</ol>\n<ul>\n<li>And this is where the execution blows up every once in a while with this:</li>\n</ul>\n<p><code>Error running script: Error evaluating expression 'GetAllChildObjects(newParent)': Collection was modified; enumeration operation may not execute.<br>\nError running script: Error evaluating expression 'ListCombine(ScopeReachableNotHeldForRoom(room), ScopeVisibleNotReachableForRoom(room))': Value cannot be null.Parameter name: collection<br>\nError running script: Cannot foreach over '' as it is not a list</code></p>\n<ol start=\"4\">\n<li>Reset <code>prospectiveroom</code>'s x-y-z and alias attributes to 7.7.7.</li>\n</ol>\n<ul>\n<li>At this point, I receive the following error, although I'm not sure if it's not just a continuation of the previous error:</li>\n</ul>\n<p><code>Error running script: Error evaluating expression 'ListExclude(ScopeVisibleNotHeldNotScenery(), game.pov)': Object reference not set to an instance of an object.</code></p>\n<ol start=\"5\">\n<li>\n<p><code>newroom.isroom = true</code>   ... All this manipulation of <code>.isroom</code> is because I have timer scripts using the scope AllRooms to randomly place objects and NPCs, and I don't want them dropping into places like <code>prospectiveroom</code>.</p>\n</li>\n<li>\n<p><code>CreateBiExits (direction, currentroom, newroom)</code>  ... In this case, it's passing in <code>\"east\", player.parent, newroom</code></p>\n</li>\n</ol>\n<ul>\n<li>This step occasionally throws similar errors as under #3 above:</li>\n</ul>\n<p><code>Error running script: Error evaluating expression 'GetAllChildObjects(newParent)': Collection was modified; enumeration operation may not execute.<br>\nError running script: Error evaluating expression 'ListCombine(ScopeReachableNotHeldForRoom(room), ScopeVisibleNotReachableForRoom(room))': Value cannot be null.Parameter name: collection<br>\nError running script: Cannot foreach over '' as it is not a list</code></p>\n<p>It also tacks on:</p>\n<p><code>Error running script: Error evaluating expression 'ListExclude(ScopeVisibleNotHeldNotScenery(),game.pov)': Object reference not set to an instance of an object.</code></p>\n<p>What do you think?  I have a feeling I'm going to have to ditch this this whole cloning-room thing and just pre-make the ones I want, and then hide or not construct the exits between them.</p>\n\n",
      "PostDate": "2020-09-13T23:53:47.9364989Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "69fbaeaa-bcfa-47ba-b629-2d40c0d885a7",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Do you move the player into the newly replicated room? The only explanation I can guess for those errors is if the player's parent has somehow become `null`.\r\n\r\nI'm trying to recreate your code from the description so I can try some things; but would be easier if I could see either the game or this part of the code.\r\n\r\nWill try again after lunch",
      "EditableFormat": "markdown",
      "HTML": "<p>Do you move the player into the newly replicated room? The only explanation I can guess for those errors is if the player's parent has somehow become <code>null</code>.</p>\n<p>I'm trying to recreate your code from the description so I can try some things; but would be easier if I could see either the game or this part of the code.</p>\n<p>Will try again after lunch</p>\n\n",
      "PostDate": "2020-09-14T11:26:30.1230806Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "cd5351b4-88c1-4a4a-99d3-72ba65e14fa6",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "The player doesn't enter the new room until he enters \"n\" to move into it. So that's something I find confusing, that the CloneObject command would even be concerned with what's going on in player.parent.\r\n\r\nI made some modifications to the above to address concerns with shallow versus deep cloning.  So instead of assigning my test .x-.z attibutes to prospectiveroom and then cloning prospectiveroom when they pass muster, the test attributes are assigned to local variables and then only copied to the newly cloned object after it's made, leaving the prospectiveroom template alone.  \r\n\r\nThe weird thing it, it all seems to work until I've cloned and moved through 20 rooms in a row, and then on the 21st time, it goes on again about <code>GetAllChildObjects(game.pov)</code>.\r\n\r\nAll that being said, I'd be happy to share my entire ASLX file with you, if you'd care to peak under the hood.  What is the best way to do that?  And thanks again!  :)",
      "EditableFormat": "markdown",
      "HTML": "<p>The player doesn't enter the new room until he enters \"n\" to move into it. So that's something I find confusing, that the CloneObject command would even be concerned with what's going on in player.parent.</p>\n<p>I made some modifications to the above to address concerns with shallow versus deep cloning.  So instead of assigning my test .x-.z attibutes to prospectiveroom and then cloning prospectiveroom when they pass muster, the test attributes are assigned to local variables and then only copied to the newly cloned object after it's made, leaving the prospectiveroom template alone.</p>\n<p>The weird thing it, it all seems to work until I've cloned and moved through 20 rooms in a row, and then on the 21st time, it goes on again about <code>GetAllChildObjects(game.pov)</code>.</p>\n<p>All that being said, I'd be happy to share my entire ASLX file with you, if you'd care to peak under the hood.  What is the best way to do that?  And thanks again!  :)</p>\n\n",
      "PostDate": "2020-09-14T12:07:55.5332889Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2f0a8d5b-52dd-4c99-bd70-59a909875678",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Are there any objects inside the room being cloned? And if so, do any of them have a `changedparent` that will fire when they're moved? Changescripts can do some really unexpected stuff when their object is cloned.\r\n\r\nIs it always the same number of rooms before you get an error?\r\n\r\nI'm mostly guessing now",
      "EditableFormat": "markdown",
      "HTML": "<p>Are there any objects inside the room being cloned? And if so, do any of them have a <code>changedparent</code> that will fire when they're moved? Changescripts can do some really unexpected stuff when their object is cloned.</p>\n<p>Is it always the same number of rooms before you get an error?</p>\n<p>I'm mostly guessing now</p>\n\n",
      "PostDate": "2020-09-14T13:05:31.6002766Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "e40e86a0-529f-472d-b8b8-248b4af73765",
      "UserId": 493549,
      "Username": "mattgmr1",
      "AvatarUrl": "https://i.imgur.com/iN86YP8b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Excellent questions.  No, there are no child objects of the room I'm cloning.  I even re-created my room template clean and made sure the functions that <em>do</em> populate the newly made room happen after cloning and the creation of bidirectional exits.  \r\n\r\nThere doesn't appear to be any consistency with  the frequency of the error messages.  Sometimes it's after 3 clones, sometimes 17, sometimes 30.\r\n\r\nAt this point, I'm really frustrated and will put this project on hold. I'll come back later to explore the code libraries here, or maybe just do things the hard way and pre-create all the rooms.",
      "EditableFormat": "markdown",
      "HTML": "<p>Excellent questions.  No, there are no child objects of the room I'm cloning.  I even re-created my room template clean and made sure the functions that <em>do</em> populate the newly made room happen after cloning and the creation of bidirectional exits.</p>\n<p>There doesn't appear to be any consistency with  the frequency of the error messages.  Sometimes it's after 3 clones, sometimes 17, sometimes 30.</p>\n<p>At this point, I'm really frustrated and will put this project on hold. I'll come back later to explore the code libraries here, or maybe just do things the hard way and pre-create all the rooms.</p>\n\n",
      "PostDate": "2020-09-14T19:19:14.5192141Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "ee4a570b-740e-4831-862e-b9bf1ca64a58",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Sorry I can't offer any more useful advice.\r\nCould you share the game so far, so that I can try to figure out the issue?",
      "EditableFormat": "markdown",
      "HTML": "<p>Sorry I can't offer any more useful advice.<br>\nCould you share the game so far, so that I can try to figure out the issue?</p>\n\n",
      "PostDate": "2020-09-15T07:33:55.3719949Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
