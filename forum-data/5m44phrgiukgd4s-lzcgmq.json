{
  "Topic": {
    "TopicId": "5m44phrgiukgd4s-lzcgmq",
    "ForumId": "10",
    "Title": "Adding displayverb to shop items you just sold",
    "LastUpdated": "2020-04-03T08:55:28.7174459Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "a012ca71-7c41-4689-955b-4e1c6c0ef2df",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "**Edited post**\r\nWhen using: \"Setting up a shop\". The uncloned items in inventory will not show \"Sell\" in the inventory item's drop-down box of verbs.\r\nI am attempting to do this through the player.changedparent script. You can see the addition I made.\r\n\r\nI get an error stating:  Can not modify the contents of the list as it is defined by an inherited type. And it needs to be cloned first.\r\nWhat say ye?\r\n\r\n**Edited script**\r\n```\r\nif (HasAttribute(game.pov.parent, \"is_shop\")) {\r\n  foreach (object, GetDirectChildren (player)) {\r\n    list add (object.displayverbs, \"Sell\")\r\n  }\r\n}\r\nif (game.pov = this) {\r\n  if (IsDefined(\"oldvalue\")) {\r\n    OnEnterRoom (oldvalue)\r\n  }\r\n  else {\r\n    OnEnterRoom (null)\r\n  }\r\n  if (game.gridmap) {\r\n    MergePOVCoordinates\r\n  }\r\n}\r\nthis.hasbeenmoved = true\r\n```\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p><strong>Edited post</strong><br>\nWhen using: \"Setting up a shop\". The uncloned items in inventory will not show \"Sell\" in the inventory item's drop-down box of verbs.<br>\nI am attempting to do this through the player.changedparent script. You can see the addition I made.</p>\n<p>I get an error stating:  Can not modify the contents of the list as it is defined by an inherited type. And it needs to be cloned first.<br>\nWhat say ye?</p>\n<p><strong>Edited script</strong></p>\n<pre><code>if (HasAttribute(game.pov.parent, \"is_shop\")) {\n  foreach (object, GetDirectChildren (player)) {\n    list add (object.displayverbs, \"Sell\")\n  }\n}\nif (game.pov = this) {\n  if (IsDefined(\"oldvalue\")) {\n    OnEnterRoom (oldvalue)\n  }\n  else {\n    OnEnterRoom (null)\n  }\n  if (game.gridmap) {\n    MergePOVCoordinates\n  }\n}\nthis.hasbeenmoved = true\n</code></pre>\n\n",
      "PostDate": "2020-04-03T08:55:28.7174459Z",
      "LastEditDate": "2020-04-03T11:11:43.6427959Z",
      "link": null
    },
    {
      "PostId": "16ee72c1-ca6c-4213-8651-fbf449e07b8b",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "First, I haven't used Pixie's Shop library, although I've created my own shop in my game(s).\r\n\r\nSecond, you should not use the player.changedparent script -- it is not necessary to do it there, and more unnecessary code there will add overhead to your game.\r\n\r\n<s>It sounds like you want to add the \"Buy\" displayverb to items the player sells to the shop, in case he wants to buy them back again later?  If so, can't you just put the ```list add (object.displayverbs, \"Buy\")``` code into your \"sell\" command?  Maybe I'm not understanding your intent.</s>",
      "EditableFormat": "markdown",
      "HTML": "<p>First, I haven't used Pixie's Shop library, although I've created my own shop in my game(s).</p>\n<p>Second, you should not use the player.changedparent script -- it is not necessary to do it there, and more unnecessary code there will add overhead to your game.</p>\n<p><s>It sounds like you want to add the \"Buy\" displayverb to items the player sells to the shop, in case he wants to buy them back again later?  If so, can't you just put the <code>list add (object.displayverbs, \"Buy\")</code> code into your \"sell\" command?  Maybe I'm not understanding your intent.</s></p>\n\n",
      "PostDate": "2020-04-03T09:58:21.3807235Z",
      "LastEditDate": "2020-04-03T11:22:08.1381304Z",
      "link": null
    },
    {
      "PostId": "70f2a2f9-b630-496f-8c91-799b3033af12",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "<s>Oh, you're trying to add the \"Buy\" displayverb to all the new items the shop is selling.  In that case, why are the items in the player's inventory instead of in the shop room, i.e. ```foreach (object, GetDirectChildren (player)```?  Maybe that should be ```foreach (object, GetDirectChildren (game.pov.parent)```?  (You'll have to remove the player from the object list.)</s>",
      "EditableFormat": "markdown",
      "HTML": "<p><s>Oh, you're trying to add the \"Buy\" displayverb to all the new items the shop is selling.  In that case, why are the items in the player's inventory instead of in the shop room, i.e. <code>foreach (object, GetDirectChildren (player)</code>?  Maybe that should be <code>foreach (object, GetDirectChildren (game.pov.parent)</code>?  (You'll have to remove the player from the object list.)</s></p>\n\n",
      "PostDate": "2020-04-03T10:09:42.7169585Z",
      "LastEditDate": "2020-04-03T11:23:08.0825132Z",
      "link": null
    },
    {
      "PostId": "702d02d6-11e7-4268-857a-0753ddf6e2c7",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "KV had a simple way of copying an object's displayverbs list so that it could be modified:\r\n\r\n```\r\nobject.displayverbs = ListExclude(object.displayverbs, \"\")\r\n```\r\n\r\nhttp://textadventures.co.uk/forum/samples/topic/d1-rxlik1ewi-zhkb5mqoa/easy-way-to-alter-an-objects-displayverbs-list\r\n\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>KV had a simple way of copying an object's displayverbs list so that it could be modified:</p>\n<pre><code>object.displayverbs = ListExclude(object.displayverbs, \"\")\n</code></pre>\n<p>http://textadventures.co.uk/forum/samples/topic/d1-rxlik1ewi-zhkb5mqoa/easy-way-to-alter-an-objects-displayverbs-list</p>\n\n",
      "PostDate": "2020-04-03T10:16:57.1511272Z",
      "LastEditDate": "2020-04-03T10:18:55.0198495Z",
      "link": null
    },
    {
      "PostId": "32a26f2f-7585-4c27-a6e9-27eeaf86aa99",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "So I would start at the source, i.e., the code that adds/creates the sellable items to the shop (instead of player.changedparent) -- add scripting there that iterates through the list of sellable items with a ```foreach``` script, and run 1) KV's code on each item, plus 2) the ```list add (object.displayverbs, \"Buy\")``` code on each item.\r\n\r\nI will try to follow up with a coded example.\r\n\r\n@mrangel -\r\nFeel free to jump in if you feel the need...",
      "EditableFormat": "markdown",
      "HTML": "<p>So I would start at the source, i.e., the code that adds/creates the sellable items to the shop (instead of player.changedparent) -- add scripting there that iterates through the list of sellable items with a <code>foreach</code> script, and run 1) KV's code on each item, plus 2) the <code>list add (object.displayverbs, \"Buy\")</code> code on each item.</p>\n<p>I will try to follow up with a coded example.</p>\n<p>@mrangel -<br>\nFeel free to jump in if you feel the need...</p>\n\n",
      "PostDate": "2020-04-03T10:28:21.3360041Z",
      "LastEditDate": "2020-04-03T10:34:48.0759067Z",
      "link": null
    },
    {
      "PostId": "7de9ea67-eecf-4b84-a43b-1d27dad67f8c",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "So sorry, Dcoder. Somehow I put in the wrong verb and explanation. Was late here. Was last working on buy script and goofed up on post.\r\nBuy should be sell.\r\nWhen player is in a shop, all of their inventory should have a sell verb added. \r\nRight now they can type it in but I would like to see the sell button.\r\nWhen they move around there will be no sell button till they enter a shop flagged shop. Then when they leave it disappears.\r\n \r\n\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>So sorry, Dcoder. Somehow I put in the wrong verb and explanation. Was late here. Was last working on buy script and goofed up on post.<br>\nBuy should be sell.<br>\nWhen player is in a shop, all of their inventory should have a sell verb added.<br>\nRight now they can type it in but I would like to see the sell button.<br>\nWhen they move around there will be no sell button till they enter a shop flagged shop. Then when they leave it disappears.</p>\n\n",
      "PostDate": "2020-04-03T10:47:05.1356344Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "a3a0d052-c534-4b21-8f5c-80bbeb5221c2",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "A simple example -- I made a few sellable objects and put them in the room ```YourShop```:\r\n```\r\nSellablesList = GetDirectChildren(YourShop)\r\nlist remove (SellablesList, game.pov)\r\nforeach (item, SellablesList) {\r\n  item.displayverbs = ListExclude(item.displayverbs, \"\")\r\n  list add (item.displayverbs, \"Buy\")\r\n}\r\n```\r\nNow each (sellable) item in ```YourShop``` minus the player will have the \"Buy\" displayverb added to it.",
      "EditableFormat": "markdown",
      "HTML": "<p>A simple example -- I made a few sellable objects and put them in the room <code>YourShop</code>:</p>\n<pre><code>SellablesList = GetDirectChildren(YourShop)\nlist remove (SellablesList, game.pov)\nforeach (item, SellablesList) {\n  item.displayverbs = ListExclude(item.displayverbs, \"\")\n  list add (item.displayverbs, \"Buy\")\n}\n</code></pre>\n<p>Now each (sellable) item in <code>YourShop</code> minus the player will have the \"Buy\" displayverb added to it.</p>\n\n",
      "PostDate": "2020-04-03T10:47:50.5061526Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2db97e1a-95dc-4004-9f7c-6f6d1ec454d0",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Ok, in that case, go to the Shop room's \"Scripts\" tab, where it says \"After entering the room:\", and put in this code:\r\n```\r\nPlayerSellList = GetDirectChildren(game.pov)\r\nforeach (item, PlayerSellList) {\r\n  item.inventoryverbs = ListExclude(item.inventoryverbs, \"\")\r\n  list add (item.inventoryverbs, \"Sell\")\r\n}\r\n```\r\nTo get rid of all the \"Sell\" inventoryverbs when the player leaves the Shop is a bit trickier, but definitely doable.  More code to follow...",
      "EditableFormat": "markdown",
      "HTML": "<p>Ok, in that case, go to the Shop room's \"Scripts\" tab, where it says \"After entering the room:\", and put in this code:</p>\n<pre><code>PlayerSellList = GetDirectChildren(game.pov)\nforeach (item, PlayerSellList) {\n  item.inventoryverbs = ListExclude(item.inventoryverbs, \"\")\n  list add (item.inventoryverbs, \"Sell\")\n}\n</code></pre>\n<p>To get rid of all the \"Sell\" inventoryverbs when the player leaves the Shop is a bit trickier, but definitely doable.  More code to follow...</p>\n\n",
      "PostDate": "2020-04-03T10:58:19.3252224Z",
      "LastEditDate": "2020-04-03T10:59:38.6203399Z",
      "link": null
    },
    {
      "PostId": "904de2c8-593b-4286-a223-1f5004c28529",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "That worked like a charm",
      "EditableFormat": "markdown",
      "HTML": "<p>That worked like a charm</p>\n\n",
      "PostDate": "2020-04-03T11:05:49.0684803Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "11f1c9c8-59d3-4884-9363-e2a92651f530",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Actually, getting rid of all the \"Sell\" verbs should be easier.  Just put this in the Shop's \"After leaving the room:\" section:\r\n```\r\nPlayerSellList = GetAllChildObjects(game.pov)\r\nforeach (item, PlayerSellList) {\r\n  list remove (item.inventoryverbs, \"Sell\")\r\n}\r\n```\r\nI <i>think</i> that that will be OK.  Trying to remove the \"Sell\" inventoryverb from an object that doesn't have it in its list should be OK.\r\n\r\nI used ```GetAllChildObjects``` instead of ```GetDirectChildren``` in case the player put sellable objects in containers he was carrying, while he was in the shop.",
      "EditableFormat": "markdown",
      "HTML": "<p>Actually, getting rid of all the \"Sell\" verbs should be easier.  Just put this in the Shop's \"After leaving the room:\" section:</p>\n<pre><code>PlayerSellList = GetAllChildObjects(game.pov)\nforeach (item, PlayerSellList) {\n  list remove (item.inventoryverbs, \"Sell\")\n}\n</code></pre>\n<p>I <i>think</i> that that will be OK.  Trying to remove the \"Sell\" inventoryverb from an object that doesn't have it in its list should be OK.</p>\n<p>I used <code>GetAllChildObjects</code> instead of <code>GetDirectChildren</code> in case the player put sellable objects in containers he was carrying, while he was in the shop.</p>\n\n",
      "PostDate": "2020-04-03T11:09:18.5190801Z",
      "LastEditDate": "2020-04-03T11:16:19.1968734Z",
      "link": null
    },
    {
      "PostId": "e4aa720a-de68-42e1-8324-c7a71d98e4c5",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Works on entry. but if I buy it back it has two sell verbs. and when I sell it it has two buy verbs... This is probably something else on my end. Will have to investigate...",
      "EditableFormat": "markdown",
      "HTML": "<p>Works on entry. but if I buy it back it has two sell verbs. and when I sell it it has two buy verbs... This is probably something else on my end. Will have to investigate...</p>\n\n",
      "PostDate": "2020-04-03T11:24:52.8513744Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "c54646da-8ff1-4a13-bb83-f4e403bcae4e",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Modified code for the Shop's \"After entering the room:\" section:\r\n```\r\nPlayerSellList = GetDirectChildren(game.pov)\r\nforeach (item, PlayerSellList) {\r\n  item.inventoryverbs = ListExclude(item.inventoryverbs, \"\")\r\n  if (not ListContains(item.inventoryverbs, \"Sell\")) {\r\n    list add (item.inventoryverbs, \"Sell\")\r\n  }\r\n}\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>Modified code for the Shop's \"After entering the room:\" section:</p>\n<pre><code>PlayerSellList = GetDirectChildren(game.pov)\nforeach (item, PlayerSellList) {\n  item.inventoryverbs = ListExclude(item.inventoryverbs, \"\")\n  if (not ListContains(item.inventoryverbs, \"Sell\")) {\n    list add (item.inventoryverbs, \"Sell\")\n  }\n}\n</code></pre>\n\n",
      "PostDate": "2020-04-03T11:44:14.501358Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "59510730-063a-48cd-9ab9-09af2009f3bd",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Conversely, modified Buy code for the Shop, also add to Shop's \"After entering...\" section:\r\n```\r\nShopSellList = GetDirectChildren(YourShop)\r\nlist remove (ShopSellList, game.pov)\r\nforeach (item, ShopSellList) {\r\n  item.displayverbs = ListExclude(item.displayverbs, \"\")\r\n  if (not ListContains(item.displayverbs, \"Buy\")) {\r\n    list add (item.displayverbs, \"Buy\")\r\n  }\r\n}\r\n```\r\nOne issue is that items you have just sold will still have their \"Sell\" verb and no \"Buy\" verb, and items you have just bought will still have their \"Buy\" verb and no \"Sell\" verb, until you re-enter the Shop.\r\n\r\nTo resolve this, either a) put ```list remove``` and ```list add``` scripts on your \"Sell\" and \"Buy\" commands, so that the item's display/inventory verbs will be updated immediately, or b) have a local turn script (in the Shop) run the code every turn.",
      "EditableFormat": "markdown",
      "HTML": "<p>Conversely, modified Buy code for the Shop, also add to Shop's \"After entering...\" section:</p>\n<pre><code>ShopSellList = GetDirectChildren(YourShop)\nlist remove (ShopSellList, game.pov)\nforeach (item, ShopSellList) {\n  item.displayverbs = ListExclude(item.displayverbs, \"\")\n  if (not ListContains(item.displayverbs, \"Buy\")) {\n    list add (item.displayverbs, \"Buy\")\n  }\n}\n</code></pre>\n<p>One issue is that items you have just sold will still have their \"Sell\" verb and no \"Buy\" verb, and items you have just bought will still have their \"Buy\" verb and no \"Sell\" verb, until you re-enter the Shop.</p>\n<p>To resolve this, either a) put <code>list remove</code> and <code>list add</code> scripts on your \"Sell\" and \"Buy\" commands, so that the item's display/inventory verbs will be updated immediately, or b) have a local turn script (in the Shop) run the code every turn.</p>\n\n",
      "PostDate": "2020-04-03T11:58:25.2603968Z",
      "LastEditDate": "2020-04-03T12:06:49.8693785Z",
      "link": null
    },
    {
      "PostId": "bf165b47-d6e7-4a8c-97af-64cf3c42b69c",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I'll make it simple -- delete all the above code and start over.  Put this in the Shop's \"Scripts\" tab as a local turn script:\r\n```\r\nPlayerSellList = GetAllChildObjects(game.pov)\r\nforeach (item, PlayerSellList) {\r\n  item.inventoryverbs = ListExclude(item.inventoryverbs, \"\")\r\n  if (not ListContains(item.inventoryverbs, \"Sell\")) {\r\n    list add (item.inventoryverbs, \"Sell\")\r\n  list remove (item.inventoryverbs, \"Buy\")\r\n  }\r\n}\r\nShopSellList = GetDirectChildren(YourShop)\r\nlist remove (ShopSellList, game.pov)\r\nforeach (item, ShopSellList) {\r\n  item.displayverbs = ListExclude(item.displayverbs, \"\")\r\n  if (not ListContains(item.displayverbs, \"Buy\")) {\r\n    list add (item.displayverbs, \"Buy\")\r\n  list remove (item.displayverbs, \"Sell\")\r\n  }\r\n}\r\n```\r\nThis will put a \"Sell\" verb on everything the player is carrying and remove any \"Buy\" verbs.  The reverse is true of the Shop's merchandise.  It's overkill but it should work.\r\n\r\nThen, in the Shop's \"After leaving the room:\" section:\r\n```\r\nforeach (item, GetAllChildObjects(game.pov)) {\r\n  list remove (item.inventoryverbs, \"Sell\")\r\n}\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>I'll make it simple -- delete all the above code and start over.  Put this in the Shop's \"Scripts\" tab as a local turn script:</p>\n<pre><code>PlayerSellList = GetAllChildObjects(game.pov)\nforeach (item, PlayerSellList) {\n  item.inventoryverbs = ListExclude(item.inventoryverbs, \"\")\n  if (not ListContains(item.inventoryverbs, \"Sell\")) {\n    list add (item.inventoryverbs, \"Sell\")\n  list remove (item.inventoryverbs, \"Buy\")\n  }\n}\nShopSellList = GetDirectChildren(YourShop)\nlist remove (ShopSellList, game.pov)\nforeach (item, ShopSellList) {\n  item.displayverbs = ListExclude(item.displayverbs, \"\")\n  if (not ListContains(item.displayverbs, \"Buy\")) {\n    list add (item.displayverbs, \"Buy\")\n  list remove (item.displayverbs, \"Sell\")\n  }\n}\n</code></pre>\n<p>This will put a \"Sell\" verb on everything the player is carrying and remove any \"Buy\" verbs.  The reverse is true of the Shop's merchandise.  It's overkill but it should work.</p>\n<p>Then, in the Shop's \"After leaving the room:\" section:</p>\n<pre><code>foreach (item, GetAllChildObjects(game.pov)) {\n  list remove (item.inventoryverbs, \"Sell\")\n}\n</code></pre>\n\n",
      "PostDate": "2020-04-03T12:26:19.3771876Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "0a348e66-052d-4e12-93c0-8167c5aec2c1",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "As far as I can tell after some testing, you have got this running 100%. Impressive",
      "EditableFormat": "markdown",
      "HTML": "<p>As far as I can tell after some testing, you have got this running 100%. Impressive</p>\n\n",
      "PostDate": "2020-04-03T14:12:12.3112038Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "c253df8d-d630-4573-b937-df27dbbbd1fc",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "(edited slightly because I don't know the shop system that well; fixed a minor issue)\r\n\r\nThat seems a bigger piece of code than I would have expected.\r\n\r\nI'd comment that `item.inventoryverbs = ListExclude(item.inventoryverbs, \"\")` is inefficient because you're looping over the whole list to check if any of the elements is `\"\"`. I think you can just do `item.inventoryverbs = item.inventoryverbs`; because assignment to an object attribute implicitly serialises lists and dictionaries. ISTR the `ListExclude` trick is only necessary if the thing to the left hand side of the `=` is a local variable.\r\n\r\nAlso a little confused by `list remove (item.inventoryverbs, \"Buy\")` - surely \"Buy\" will never be on an object's inventoryverbs, and \"Sell\" will never be in its displayverbs. Or do the existing parts of your shop script add the verbs to both lists?\r\n\r\nI'd probably have done it by adding a few lines to a core function:\r\n<pre><code>  &lt;function name=\"GetDisplayVerbs\" parameters=\"object\" type=\"stringlist\">\r\n    if (Contains(game.pov, object)) {\r\n      baselist = object.inventoryverbs\r\n      <b style=\"border: 1px solid green\">shopverb = \"Sell\"</b>\r\n    }\r\n    else {\r\n      baselist = object.displayverbs\r\n      <b style=\"border: 1px solid green\">shopverb = \"Buy\"</b>\r\n    }\r\n\r\n    if (not game.autodisplayverbs or GetBoolean(object, \"usestandardverblist\") or not HasAttribute(game, \"verbattributes\")) {\r\n      return (baselist)\r\n    }\r\n    else {\r\n      if (HasAttribute(object, \"generatedverbslist\")) {\r\n        verbs = object.generatedverbslist\r\n      }\r\n      else {\r\n        verbs = NewStringList()\r\n        foreach (attr, GetAttributeNames(object, false)) {\r\n          if (ListContains(game.verbattributes, attr)) {\r\n            cmd = ObjectDictionaryItem(game.verbattributeslookup, attr)\r\n            if (HasString(cmd, \"displayverb\")) {\r\n              displayverb = CapFirst(cmd.displayverb)\r\n            }\r\n            else {\r\n              displayverb = CapFirst(attr)\r\n            }\r\n            if (not ListContains(baselist, displayverb)) {\r\n              list add (verbs, displayverb)\r\n            }\r\n          }\r\n        }\r\n        object.generatedverbslist = verbs\r\n      }<b style=\"display: block; border: 1px solid green\">      if (GetBoolean (object, \"sell\") and HasAttribute(game.pov.parent, \"is_shop\")) {\r\n        verbs = ListCombine (Split (shopverb), ListExclude (verbs, Split(\"Buy;Sell\")))\r\n      }</b>\r\n      if (GetBoolean(object, \"useindividualverblist\")) {\r\n        return (verbs)\r\n      }\r\n      else {\r\n        return (ListCombine(baselist, verbs))\r\n      } \r\n    }\r\n  &lt;/function></code></pre>",
      "EditableFormat": "markdown",
      "HTML": "<p>(edited slightly because I don't know the shop system that well; fixed a minor issue)</p>\n<p>That seems a bigger piece of code than I would have expected.</p>\n<p>I'd comment that <code>item.inventoryverbs = ListExclude(item.inventoryverbs, \"\")</code> is inefficient because you're looping over the whole list to check if any of the elements is <code>\"\"</code>. I think you can just do <code>item.inventoryverbs = item.inventoryverbs</code>; because assignment to an object attribute implicitly serialises lists and dictionaries. ISTR the <code>ListExclude</code> trick is only necessary if the thing to the left hand side of the <code>=</code> is a local variable.</p>\n<p>Also a little confused by <code>list remove (item.inventoryverbs, \"Buy\")</code> - surely \"Buy\" will never be on an object's inventoryverbs, and \"Sell\" will never be in its displayverbs. Or do the existing parts of your shop script add the verbs to both lists?</p>\n<p>I'd probably have done it by adding a few lines to a core function:</p>\n<pre><code>  &lt;function name=\"GetDisplayVerbs\" parameters=\"object\" type=\"stringlist\"&gt;\n    if (Contains(game.pov, object)) {\n      baselist = object.inventoryverbs\n      <b style=\"border: 1px solid green\">shopverb = \"Sell\"</b>\n    }\n    else {\n      baselist = object.displayverbs\n      <b style=\"border: 1px solid green\">shopverb = \"Buy\"</b>\n    }\n\n    if (not game.autodisplayverbs or GetBoolean(object, \"usestandardverblist\") or not HasAttribute(game, \"verbattributes\")) {\n      return (baselist)\n    }\n    else {\n      if (HasAttribute(object, \"generatedverbslist\")) {\n        verbs = object.generatedverbslist\n      }\n      else {\n        verbs = NewStringList()\n        foreach (attr, GetAttributeNames(object, false)) {\n          if (ListContains(game.verbattributes, attr)) {\n            cmd = ObjectDictionaryItem(game.verbattributeslookup, attr)\n            if (HasString(cmd, \"displayverb\")) {\n              displayverb = CapFirst(cmd.displayverb)\n            }\n            else {\n              displayverb = CapFirst(attr)\n            }\n            if (not ListContains(baselist, displayverb)) {\n              list add (verbs, displayverb)\n            }\n          }\n        }\n        object.generatedverbslist = verbs\n      }<b style=\"display: block; border: 1px solid green\">      if (GetBoolean (object, \"sell\") and HasAttribute(game.pov.parent, \"is_shop\")) {\n        verbs = ListCombine (Split (shopverb), ListExclude (verbs, Split(\"Buy;Sell\")))\n      }</b>\n      if (GetBoolean(object, \"useindividualverblist\")) {\n        return (verbs)\n      }\n      else {\n        return (ListCombine(baselist, verbs))\n      } \n    }\n  &lt;/function&gt;</code></pre>\n\n",
      "PostDate": "2020-04-03T15:18:18.3828779Z",
      "LastEditDate": "2020-04-05T19:18:54.5083447Z",
      "link": null
    },
    {
      "PostId": "a0b6b2dc-ca5e-40a9-94c7-de7534a85209",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Have to make sure any items that start in the shop have their display verbs set correctly. Those items were giving me grief but setting the verbs fixed it. We'll see what happens down the road.\r\n\r\nKinda scared to touch it now Mrangel. But I will make another copy of the game to test your code.",
      "EditableFormat": "markdown",
      "HTML": "<p>Have to make sure any items that start in the shop have their display verbs set correctly. Those items were giving me grief but setting the verbs fixed it. We'll see what happens down the road.</p>\n<p>Kinda scared to touch it now Mrangel. But I will make another copy of the game to test your code.</p>\n\n",
      "PostDate": "2020-04-03T15:54:42.8595063Z",
      "LastEditDate": "2020-04-03T15:58:30.8674417Z",
      "link": null
    },
    {
      "PostId": "1ee9439c-a094-4b24-9e4e-7dbd6bad1e0c",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "@Forgewright -\r\nOk, as per mrangel, in my local turnscript, just replace the 2 lines in bold (they are replaced below).  This will reduce some of the overhead:\r\n```\r\nPlayerSellList = GetAllChildObjects(game.pov)\r\nforeach (item, PlayerSellList) {\r\n```\r\n\r\n<b>\r\n\r\n```\r\n  item.inventoryverbs = item.inventoryverbs\r\n```\r\n\r\n</b>\r\n\r\n```\r\n  if (not ListContains(item.inventoryverbs, \"Sell\")) {\r\n    list add (item.inventoryverbs, \"Sell\")\r\n  list remove (item.inventoryverbs, \"Buy\")\r\n  }\r\n}\r\nShopSellList = GetDirectChildren(YourShop)\r\nlist remove (ShopSellList, game.pov)\r\nforeach (item, ShopSellList) {\r\n```\r\n\r\n<b>\r\n\r\n```\r\n  item.displayverbs = item.displayverbs\r\n```\r\n\r\n</b>\r\n\r\n```\r\n  if (not ListContains(item.displayverbs, \"Buy\")) {\r\n    list add (item.displayverbs, \"Buy\")\r\n  list remove (item.displayverbs, \"Sell\")\r\n  }\r\n}\r\n```\r\n@mrangel -\r\nAs for the buy/sell verbs, when you buy an item from the store, the buy verb will still be on the bought item in the player's inventory; the sell verb will still be on an item after being sold to the shop.  In order to update those verbs immediately, that is why the additional ```listremove``` lines are there.",
      "EditableFormat": "markdown",
      "HTML": "<p>@Forgewright -<br>\nOk, as per mrangel, in my local turnscript, just replace the 2 lines in bold (they are replaced below).  This will reduce some of the overhead:</p>\n<pre><code>PlayerSellList = GetAllChildObjects(game.pov)\nforeach (item, PlayerSellList) {\n</code></pre>\n<b>\n<pre><code>  item.inventoryverbs = item.inventoryverbs\n</code></pre>\n</b>\n<pre><code>  if (not ListContains(item.inventoryverbs, \"Sell\")) {\n    list add (item.inventoryverbs, \"Sell\")\n  list remove (item.inventoryverbs, \"Buy\")\n  }\n}\nShopSellList = GetDirectChildren(YourShop)\nlist remove (ShopSellList, game.pov)\nforeach (item, ShopSellList) {\n</code></pre>\n<b>\n<pre><code>  item.displayverbs = item.displayverbs\n</code></pre>\n</b>\n<pre><code>  if (not ListContains(item.displayverbs, \"Buy\")) {\n    list add (item.displayverbs, \"Buy\")\n  list remove (item.displayverbs, \"Sell\")\n  }\n}\n</code></pre>\n<p>@mrangel -<br>\nAs for the buy/sell verbs, when you buy an item from the store, the buy verb will still be on the bought item in the player's inventory; the sell verb will still be on an item after being sold to the shop.  In order to update those verbs immediately, that is why the additional <code>listremove</code> lines are there.</p>\n\n",
      "PostDate": "2020-04-05T12:07:59.4024867Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "73dc5ece-7f23-4097-9dfc-f6552ee90a23",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I think you misunderstood my question; but in explaining why I get \"sorry, you can't post that here\".\r\n\r\nSo a shortened form: Is there ever a reason why the player would need buy an object that's in their inventory; or sell an object they don't own?\r\n\r\nIt seems to me that \"Buy\" would only go in the object's <code><b>display</b>verbs</code>, and \"Sell\" should only go in <code><b>inventory</b>verbs</code>.\r\n\r\nSo I questioned why your code is removing those verbs from lists I think they would never be in.",
      "EditableFormat": "markdown",
      "HTML": "<p>I think you misunderstood my question; but in explaining why I get \"sorry, you can't post that here\".</p>\n<p>So a shortened form: Is there ever a reason why the player would need buy an object that's in their inventory; or sell an object they don't own?</p>\n<p>It seems to me that \"Buy\" would only go in the object's <code><b>display</b>verbs</code>, and \"Sell\" should only go in <code><b>inventory</b>verbs</code>.</p>\n<p>So I questioned why your code is removing those verbs from lists I think they would never be in.</p>\n\n",
      "PostDate": "2020-04-05T13:27:03.7190957Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "aa26bf8f-5c4d-4bdb-a4f2-96ec6f710e7b",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "https://i.imgur.com/O07mlRtb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "How about this:\r\n```\r\nPlayerSellList = GetAllChildObjects(game.pov)\r\nforeach (item, PlayerSellList) {\r\n  item.inventoryverbs = item.inventoryverbs\r\n  if (not ListContains(item.inventoryverbs, \"Sell\")) {\r\n    list add (item.inventoryverbs, \"Sell\")\r\n  list remove (item.displayverbs, \"Buy\")               // This line changed\r\n  }\r\n}\r\nShopSellList = GetDirectChildren(YourShop)\r\nlist remove (ShopSellList, game.pov)\r\nforeach (item, ShopSellList) {\r\n  item.displayverbs = item.displayverbs\r\n  if (not ListContains(item.displayverbs, \"Buy\")) {\r\n    list add (item.displayverbs, \"Buy\")\r\n  list remove (item.inventoryverbs, \"Sell\")             // This line changed\r\n  }\r\n}\r\n```\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>How about this:</p>\n<pre><code>PlayerSellList = GetAllChildObjects(game.pov)\nforeach (item, PlayerSellList) {\n  item.inventoryverbs = item.inventoryverbs\n  if (not ListContains(item.inventoryverbs, \"Sell\")) {\n    list add (item.inventoryverbs, \"Sell\")\n  list remove (item.displayverbs, \"Buy\")               // This line changed\n  }\n}\nShopSellList = GetDirectChildren(YourShop)\nlist remove (ShopSellList, game.pov)\nforeach (item, ShopSellList) {\n  item.displayverbs = item.displayverbs\n  if (not ListContains(item.displayverbs, \"Buy\")) {\n    list add (item.displayverbs, \"Buy\")\n  list remove (item.inventoryverbs, \"Sell\")             // This line changed\n  }\n}\n</code></pre>\n\n",
      "PostDate": "2020-04-05T14:09:53.030595Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "67d6c147-0239-45c1-a63b-072b012a3154",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "That's what I would have expected it to look like :)",
      "EditableFormat": "markdown",
      "HTML": "<p>That's what I would have expected it to look like :)</p>\n\n",
      "PostDate": "2020-04-05T16:19:01.0361746Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "d962f67e-4b3b-4e18-a714-d235bc70d11c",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I just realized that I have not paid attention to the 'Display and Inventory' differences. This would be a cause of some of my grief. Such an obvious part but I missed it. I thought the game would control this from the settings under the object verb set up. Completely went over my head.  Dang ",
      "EditableFormat": "markdown",
      "HTML": "<p>I just realized that I have not paid attention to the 'Display and Inventory' differences. This would be a cause of some of my grief. Such an obvious part but I missed it. I thought the game would control this from the settings under the object verb set up. Completely went over my head.  Dang</p>\n\n",
      "PostDate": "2020-04-05T16:56:00.2660321Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "62f7f02a-ab71-4a9c-95c4-fda05b220648",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Ok, this is where I stand now.\r\n\r\n```sell #object#``` command:\r\n\r\n```\r\nif (not HasAttribute(game.pov.parent, \"stock\")) {\r\n  ClearTurn\r\n  msg (\"You can't sell stuff here.\")\r\n}\r\nelse if (not object.parent = game.pov) {\r\n  ClearTurn\r\n  msg (\"You're not carrying \" + object.article + \".\")\r\n}\r\nelse if (HasAttribute(object, \"burned\")) {\r\n  if (object.burned = true) {\r\n    ClearTurn\r\n    msg (player.parent.owner.alias + \" says,<br><i>I have no use for a used torch.\")\r\n  }\r\n}\r\nelse if (HasAttribute(object, \"sell\")) {\r\n  ClearTurn\r\n  game.selling_object = object\r\n  Ask (\"I will give you \" + game.selling_object.price + \" gold. OK?\") {\r\n    object = game.selling_object\r\n    if (result) {\r\n      msg (\"You sell \" + object.article + \" for \" + object.price + \" gold.\")\r\n      game.pov.money = game.pov.money + object.price\r\n      if (GetBoolean(object, \"cloneme\")) {\r\n        RemoveObject (object)\r\n      }\r\n      else {\r\n        object.parent = game.pov.parent.stock\r\n        SetUpMerchandise (object)\r\n      }\r\n    }\r\n    else {\r\n      msg (\"You turn down the offer of \" + object.price + \" gold.\")\r\n    }\r\n  }\r\n}\r\n```\r\nThen the ```buy #object#``` command.\r\n\r\n```\r\nif (object.price > game.pov.money) {\r\n  msg (\"You can't afford that!\")\r\n}\r\nelse {\r\n  object.take = true\r\n  object.parent = game.pov\r\n  object.buy = null\r\n  object.listalias = object.alias\r\n  list remove (object.inventoryverbs, \"Buy\")\r\n  player.money = game.pov.money - BuyingPrice(object)\r\n  msg (\"You decide to buy \" + object.article + \" for \" + DisplayMoney(BuyingPrice(object)) + \".\")\r\n}\r\n```\r\n\r\nNext comes the ```SetUpMerchandise``` Function used above with ```obj``` parameter.\r\n\r\n```\r\nif (not HasString(obj, \"alias\")) {\r\n  obj.alias = obj.name\r\n}\r\nobj.listalias = obj.alias + \" (\" + DisplayMoney(BuyingPrice(obj)) + \")\"\r\nobj.cloneme = false\r\nobj.take => {\r\n  StealObject (this)\r\n}\r\nobj.buy => {\r\n  BuyObject (this)\r\n}\r\n```\r\nNext is the ```BuyObject ``` function also with the ```obj``` parameter used in ```SetUpMechandise``` function.\r\n\r\n```\r\nif (obj.price > game.pov.money) {\r\n  msg (\"You can't afford that!\")\r\n}\r\nelse {\r\n  if (GetBoolean(obj, \"cloneme\")) {\r\n    obj = CloneObject(obj)\r\n  }\r\n  list remove (obj.inventoryverbs, \"Buy\")\r\n  obj.take = true\r\n  obj.parent = game.pov\r\n  obj.buy = null\r\n  obj.listalias = obj.alias\r\n  player.money = game.pov.money - BuyingPrice(obj)\r\n  msg (\"You buy \" + obj.article + \" for \" + DisplayMoney(BuyingPrice(obj)) + \".\")\r\n}\r\n```\r\n\r\nSo far everything checks out and I have yet to find a bug. That really isn't saying a lot though.\r\n\r\n\r\n\r\n\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>Ok, this is where I stand now.</p>\n<p><code>sell #object#</code> command:</p>\n<pre><code>if (not HasAttribute(game.pov.parent, \"stock\")) {\n  ClearTurn\n  msg (\"You can't sell stuff here.\")\n}\nelse if (not object.parent = game.pov) {\n  ClearTurn\n  msg (\"You're not carrying \" + object.article + \".\")\n}\nelse if (HasAttribute(object, \"burned\")) {\n  if (object.burned = true) {\n    ClearTurn\n    msg (player.parent.owner.alias + \" says,&lt;br&gt;&lt;i&gt;I have no use for a used torch.\")\n  }\n}\nelse if (HasAttribute(object, \"sell\")) {\n  ClearTurn\n  game.selling_object = object\n  Ask (\"I will give you \" + game.selling_object.price + \" gold. OK?\") {\n    object = game.selling_object\n    if (result) {\n      msg (\"You sell \" + object.article + \" for \" + object.price + \" gold.\")\n      game.pov.money = game.pov.money + object.price\n      if (GetBoolean(object, \"cloneme\")) {\n        RemoveObject (object)\n      }\n      else {\n        object.parent = game.pov.parent.stock\n        SetUpMerchandise (object)\n      }\n    }\n    else {\n      msg (\"You turn down the offer of \" + object.price + \" gold.\")\n    }\n  }\n}\n</code></pre>\n<p>Then the <code>buy #object#</code> command.</p>\n<pre><code>if (object.price &gt; game.pov.money) {\n  msg (\"You can't afford that!\")\n}\nelse {\n  object.take = true\n  object.parent = game.pov\n  object.buy = null\n  object.listalias = object.alias\n  list remove (object.inventoryverbs, \"Buy\")\n  player.money = game.pov.money - BuyingPrice(object)\n  msg (\"You decide to buy \" + object.article + \" for \" + DisplayMoney(BuyingPrice(object)) + \".\")\n}\n</code></pre>\n<p>Next comes the <code>SetUpMerchandise</code> Function used above with <code>obj</code> parameter.</p>\n<pre><code>if (not HasString(obj, \"alias\")) {\n  obj.alias = obj.name\n}\nobj.listalias = obj.alias + \" (\" + DisplayMoney(BuyingPrice(obj)) + \")\"\nobj.cloneme = false\nobj.take =&gt; {\n  StealObject (this)\n}\nobj.buy =&gt; {\n  BuyObject (this)\n}\n</code></pre>\n<p>Next is the <code>BuyObject</code> function also with the <code>obj</code> parameter used in <code>SetUpMechandise</code> function.</p>\n<pre><code>if (obj.price &gt; game.pov.money) {\n  msg (\"You can't afford that!\")\n}\nelse {\n  if (GetBoolean(obj, \"cloneme\")) {\n    obj = CloneObject(obj)\n  }\n  list remove (obj.inventoryverbs, \"Buy\")\n  obj.take = true\n  obj.parent = game.pov\n  obj.buy = null\n  obj.listalias = obj.alias\n  player.money = game.pov.money - BuyingPrice(obj)\n  msg (\"You buy \" + obj.article + \" for \" + DisplayMoney(BuyingPrice(obj)) + \".\")\n}\n</code></pre>\n<p>So far everything checks out and I have yet to find a bug. That really isn't saying a lot though.</p>\n\n",
      "PostDate": "2020-04-05T17:25:35.0446157Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "9807b0bd-2d09-47c1-b055-b48c16711096",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Oh. And the GetDisplayVerbs function is awesome. \r\nI don't have items with multi states like a torch having an inventory verb 'Sell' because the use of a torch will not be allowed to sell. And I have not decided how and where to put the script for changing the inventory verb if it is not burned. However, the player can type it in and sell it if the torch is not used. If it is the shop owner tells them he has no use for a burned torch.\r\n\r\nI thought that was a cool thing to do. Eh...\r\n\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>Oh. And the GetDisplayVerbs function is awesome.<br>\nI don't have items with multi states like a torch having an inventory verb 'Sell' because the use of a torch will not be allowed to sell. And I have not decided how and where to put the script for changing the inventory verb if it is not burned. However, the player can type it in and sell it if the torch is not used. If it is the shop owner tells them he has no use for a burned torch.</p>\n<p>I thought that was a cool thing to do. Eh...</p>\n\n",
      "PostDate": "2020-04-05T17:36:57.9964828Z",
      "LastEditDate": "2020-04-05T18:13:55.536023Z",
      "link": null
    },
    {
      "PostId": "8ee45e69-6cfa-45b6-9fd6-61719a433b00",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Another alternate way to do this :¬p\r\n\r\nIn the player's `changedparent` script, add a line\r\n<pre><code>\r\nif (game.pov = this) {\r\n  <em style=\"border: 1px dashed green\">this.is_in_shop = GetBoolean (this.parent, \"is_shop\")</em>\r\n  if (IsDefined(\"oldvalue\")) {\r\n    OnEnterRoom (oldvalue)\r\n  }\r\n  else {\r\n    OnEnterRoom (null)\r\n  }\r\n  if (game.gridmap) {\r\n    MergePOVCoordinates\r\n  }\r\n}\r\nthis.hasbeenmoved = true</code></pre>\r\n\r\nAnd then give him a script `changedis_in_shop`:\r\n```\r\nforeach (obj, ScopeVisibleInventory()) {\r\n  obj.inventoryverbs = ListExclude (obj.inventoryverbs, \"Sell\")\r\n  if (this.is_in_shop) {\r\n    list add (obj.inventoryverbs, \"Sell\")\r\n  }\r\n}\r\n```\r\nIt would be just as easy to add \"Buy\" to `displayverbs` in the same script; but there's no reason to do so. Because I believe if you followed the \"Setting up a shop\" guide, the buy and sell scripts will already add and remove the \"Buy\" verb as necessary.",
      "EditableFormat": "markdown",
      "HTML": "<p>Another alternate way to do this :¬p</p>\n<p>In the player's <code>changedparent</code> script, add a line</p>\n<pre><code>\nif (game.pov = this) {\n  <em style=\"border: 1px dashed green\">this.is_in_shop = GetBoolean (this.parent, \"is_shop\")</em>\n  if (IsDefined(\"oldvalue\")) {\n    OnEnterRoom (oldvalue)\n  }\n  else {\n    OnEnterRoom (null)\n  }\n  if (game.gridmap) {\n    MergePOVCoordinates\n  }\n}\nthis.hasbeenmoved = true</code></pre>\n<p>And then give him a script <code>changedis_in_shop</code>:</p>\n<pre><code>foreach (obj, ScopeVisibleInventory()) {\n  obj.inventoryverbs = ListExclude (obj.inventoryverbs, \"Sell\")\n  if (this.is_in_shop) {\n    list add (obj.inventoryverbs, \"Sell\")\n  }\n}\n</code></pre>\n<p>It would be just as easy to add \"Buy\" to <code>displayverbs</code> in the same script; but there's no reason to do so. Because I believe if you followed the \"Setting up a shop\" guide, the buy and sell scripts will already add and remove the \"Buy\" verb as necessary.</p>\n\n",
      "PostDate": "2020-04-05T19:03:39.6193401Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "212151f4-8dc1-4b03-a2d2-f0b682e3f0ee",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> I don't have items with multi states like a torch having an inventory verb 'Sell' because the use of a torch will not be allowed to sell. And I have not decided how and where to put the script for changing the inventory verb if it is not burned. However, the player can type it in and sell it if the torch is not used. If it is the shop owner tells them he has no use for a burned torch.\r\n>\r\n>I thought that was a cool thing to do. Eh...\r\n\r\nI thought of an alternative way to do that.\r\nWhere your 'sell' command has:\r\n```\r\nelse if (HasAttribute(object, \"burned\")) {\r\n  if (object.burned = true) {\r\n    ClearTurn\r\n    msg (player.parent.owner.alias + \" says,<br><i>I have no use for a used torch.\")\r\n  }\r\n}\r\n```\r\nyou could change that to:\r\n```\r\nelse if (HasString (object, \"price\")) {\r\n  ClearTurn\r\n  msg (player.parent.owner.alias + \" says,<br><i>\" + object.price + \"</i>\")\r\n}\r\n```\r\nthen in the script for using the torch, you could put:\r\n```\r\nthis.burned = true\r\nthis.sell = false\r\nthis.price = \"I have no use for a burned torch.\"\r\n```\r\n\r\nChanging the price of an object to a string causes the shopkeeper to refuse to accept it; changing `sell` to false removes the \"Sell\" inventory verb (if you're using my `GetInventoryVerbs` script above - I just fixed it because I didn't know that there was a sell boolean, so it previously checked if the object has a price)",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I don't have items with multi states like a torch having an inventory verb 'Sell' because the use of a torch will not be allowed to sell. And I have not decided how and where to put the script for changing the inventory verb if it is not burned. However, the player can type it in and sell it if the torch is not used. If it is the shop owner tells them he has no use for a burned torch.</p>\n<p>I thought that was a cool thing to do. Eh...</p>\n</blockquote>\n<p>I thought of an alternative way to do that.<br>\nWhere your 'sell' command has:</p>\n<pre><code>else if (HasAttribute(object, \"burned\")) {\n  if (object.burned = true) {\n    ClearTurn\n    msg (player.parent.owner.alias + \" says,&lt;br&gt;&lt;i&gt;I have no use for a used torch.\")\n  }\n}\n</code></pre>\n<p>you could change that to:</p>\n<pre><code>else if (HasString (object, \"price\")) {\n  ClearTurn\n  msg (player.parent.owner.alias + \" says,&lt;br&gt;&lt;i&gt;\" + object.price + \"&lt;/i&gt;\")\n}\n</code></pre>\n<p>then in the script for using the torch, you could put:</p>\n<pre><code>this.burned = true\nthis.sell = false\nthis.price = \"I have no use for a burned torch.\"\n</code></pre>\n<p>Changing the price of an object to a string causes the shopkeeper to refuse to accept it; changing <code>sell</code> to false removes the \"Sell\" inventory verb (if you're using my <code>GetInventoryVerbs</code> script above - I just fixed it because I didn't know that there was a sell boolean, so it previously checked if the object has a price)</p>\n\n",
      "PostDate": "2020-04-05T19:16:59.7619535Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "c64517b9-9697-41fd-ba1f-9d321410b188",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Off-topic, but I have been gone a while and was wondering if KV was still active in the forums?",
      "EditableFormat": "markdown",
      "HTML": "<p>Off-topic, but I have been gone a while and was wondering if KV was still active in the forums?</p>\n\n",
      "PostDate": "2020-04-05T21:19:07.4404247Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "acd8f1b6-21c0-43e1-b29a-8864d6a525d8",
      "UserId": 142763,
      "Username": "Forgewright",
      "AvatarUrl": "http://i.imgur.com/Ea6HecZb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Wow, I somehow missed these last couple of posts from you Mrangel. I will make those changes. \r\nThank you Dcoder and Mrangel for your help. You really make my coding time so much less and teach me new and better ways to code.",
      "EditableFormat": "markdown",
      "HTML": "<p>Wow, I somehow missed these last couple of posts from you Mrangel. I will make those changes.<br>\nThank you Dcoder and Mrangel for your help. You really make my coding time so much less and teach me new and better ways to code.</p>\n\n",
      "PostDate": "2020-04-23T08:24:43.4863759Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
