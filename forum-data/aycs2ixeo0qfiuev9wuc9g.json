{
  "Topic": {
    "TopicId": "aycs2ixeo0qfiuev9wuc9g",
    "ForumId": "10",
    "Title": "Moving random object from one room to inventory and then removing it from a list?",
    "LastUpdated": "2018-09-27T12:05:04.0065257Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "750565b5-e3bb-4053-9ffd-235ec57b1990",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I have a room called LOOTROOM where I keep all lootable objects.\r\nWhen the player types \"loot soldier\" I want one lootable object to be moved to the inventory.\r\nI can't get it to work, probably 'cause I suck terribly at lists.\r\n\r\nHere's what I've done so far:\r\n---------------------------------------------------------------------\r\nIn the start script I have: ```game.lootlist = NewObjectList() ```\r\n\r\nWhen the player use the loot command I have a switch witch has a 25% chance to lead to actual loot. I scripted it like this:\r\n\r\n```\r\nforeach (obj, GetDirectChildren(LOOTROOM)) {\r\n  list add (game.lootlist, obj)\r\n}\r\nif (ListCount(game.lootlist) > 0) {\r\n  loot = PickOneString (game.lootlist)\r\n  AddToInventory (loot)\r\n  msg (\"You find \"+ loot+ \".\")\r\n  list remove (game.lootlist, loot)\r\n  object.looted = true\r\n}\r\nelse {\r\n  msg (\"You find nothing.\")\r\n  object.looted = true\r\n}\r\n```\r\nThis is not working. Again: I suck at lists.... badly!\r\nThe error message I get is this:\r\n\r\n> * loot corpse\r\n<font color=red>Error running script: Error compiling expression 'object': RootExpressionElement: Cannot convert type 'Object' to expression result of 'Element'</font>\r\nYou find .\r\n\r\nIf I do it again I get this (as it should be)\r\n\r\n> g\r\nBeen there, looted that\r\n\r\n\r\nCan any of you smart people give me a hand with this... it's driving me crazy!\r\n<font color=white>dsfsdfsdffdfsdfdsfsdklllllllllllllllllllllllllllllllllllllllllllllllllllffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffs dssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</font>",
      "EditableFormat": "markdown",
      "HTML": "<p>I have a room called LOOTROOM where I keep all lootable objects.<br>\nWhen the player types \"loot soldier\" I want one lootable object to be moved to the inventory.<br>\nI can't get it to work, probably 'cause I suck terribly at lists.</p>\n<h2>Here's what I've done so far:</h2>\n<p>In the start script I have: <code>game.lootlist = NewObjectList()</code></p>\n<p>When the player use the loot command I have a switch witch has a 25% chance to lead to actual loot. I scripted it like this:</p>\n<pre><code>foreach (obj, GetDirectChildren(LOOTROOM)) {\n  list add (game.lootlist, obj)\n}\nif (ListCount(game.lootlist) &gt; 0) {\n  loot = PickOneString (game.lootlist)\n  AddToInventory (loot)\n  msg (\"You find \"+ loot+ \".\")\n  list remove (game.lootlist, loot)\n  object.looted = true\n}\nelse {\n  msg (\"You find nothing.\")\n  object.looted = true\n}\n</code></pre>\n<p>This is not working. Again: I suck at lists.... badly!<br>\nThe error message I get is this:</p>\n<blockquote>\n<ul>\n<li>loot corpse<br>\n<font color=\"red\">Error running script: Error compiling expression 'object': RootExpressionElement: Cannot convert type 'Object' to expression result of 'Element'</font><br>\nYou find .</li>\n</ul>\n</blockquote>\n<p>If I do it again I get this (as it should be)</p>\n<blockquote>\n<p>g<br>\nBeen there, looted that</p>\n</blockquote>\n<p>Can any of you smart people give me a hand with this... it's driving me crazy!<br>\n<font color=\"white\">dsfsdfsdffdfsdfdsfsdklllllllllllllllllllllllllllllllllllllllllllllllllllffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffs dssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</font></p>\n\n",
      "PostDate": "2018-09-27T12:05:04.0065257Z",
      "LastEditDate": "2018-09-27T12:07:06.1801202Z",
      "link": null
    },
    {
      "PostId": "fcf1ad56-e867-485b-8531-cbda8dfccffb",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I solved it. \r\n\r\n```  PickOneString  ``` should've been ```PickOneObject ```.\r\n\r\n\r\n\r\nIt's ok to point and laugh if you want to!",
      "EditableFormat": "markdown",
      "HTML": "<p>I solved it.</p>\n<p><code>PickOneString</code> should've been <code>PickOneObject</code>.</p>\n<p>It's ok to point and laugh if you want to!</p>\n\n",
      "PostDate": "2018-09-27T12:21:18.1158835Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "be72781a-6a5b-49c0-a0a9-20c0dadd5d38",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "Ok. I didn't solve it after all.\r\nEverything seems to be working just fine except the fact that I can loot the same object twice.\r\n\r\nI want the object (located in LOOTROOM) to be unlootable after the player picks it up... for some reason the same object can be looted over and over now.\r\n\r\nSo... I guess I still need help :)\r\nAnyone?",
      "EditableFormat": "markdown",
      "HTML": "<p>Ok. I didn't solve it after all.<br>\nEverything seems to be working just fine except the fact that I can loot the same object twice.</p>\n<p>I want the object (located in LOOTROOM) to be unlootable after the player picks it up... for some reason the same object can be looted over and over now.</p>\n<p>So... I guess I still need help :)<br>\nAnyone?</p>\n\n",
      "PostDate": "2018-09-27T13:03:10.814449Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "007db16f-904a-4506-85c3-704249290e11",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "You are making it much harder than it is. Use `GetDirectChildren` to get a list of objects. If there is at least one item there, pick one, move it to the inventory, and tell the player about it.\r\n```\r\nl = GetDirectChildren(LOOTROOM)\r\nif (ListCount(l) > 0) {\r\n  loot = PickOneObject ()\r\n  AddToInventory (loot)\r\n  msg (\"You find \" + GetDisplayName(loot) + \".\")\r\n}\r\nelse {\r\n  msg (\"You find nothing.\")\r\n}\r\nobject.looted = true\r\n```\r\nThat second line could be changed to give a random chance (30% here) of finding something.\r\n```\r\nif (ListCount > 0 and RandomChance(30)) {",
      "EditableFormat": "markdown",
      "HTML": "<p>You are making it much harder than it is. Use <code>GetDirectChildren</code> to get a list of objects. If there is at least one item there, pick one, move it to the inventory, and tell the player about it.</p>\n<pre><code>l = GetDirectChildren(LOOTROOM)\nif (ListCount(l) &gt; 0) {\n  loot = PickOneObject ()\n  AddToInventory (loot)\n  msg (\"You find \" + GetDisplayName(loot) + \".\")\n}\nelse {\n  msg (\"You find nothing.\")\n}\nobject.looted = true\n</code></pre>\n<p>That second line could be changed to give a random chance (30% here) of finding something.</p>\n<pre><code>if (ListCount &gt; 0 and RandomChance(30)) {\n</code></pre>\n\n",
      "PostDate": "2018-09-27T13:29:35.5606749Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "396d4fcc-b543-4355-b009-f43cb0b0c797",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I would probably have made it:\r\n```\r\nloot = PickOneObject (GetDirectChildren (LOOTROOM))\r\nif (loot = null) {\r\n  msg (\"You find nothing.\")\r\n}\r\nelse {\r\n  msg (\"You find \" + GetDisplayName(loot) + \".\")\r\n  AddToInventory (loot)\r\n}\r\nobject.looted = true\r\n```\r\nbut that's just a matter of personal preference.",
      "EditableFormat": "markdown",
      "HTML": "<p>I would probably have made it:</p>\n<pre><code>loot = PickOneObject (GetDirectChildren (LOOTROOM))\nif (loot = null) {\n  msg (\"You find nothing.\")\n}\nelse {\n  msg (\"You find \" + GetDisplayName(loot) + \".\")\n  AddToInventory (loot)\n}\nobject.looted = true\n</code></pre>\n<p>but that's just a matter of personal preference.</p>\n\n",
      "PostDate": "2018-09-27T13:44:08.9822227Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "b7bc44e4-f91f-4db9-bee7-f20ecb27360e",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "This returned an error ``` loot = PickOneObject () ```but I added ```l ``` to it and it's working like a charm!\r\n\r\nThank you so much!",
      "EditableFormat": "markdown",
      "HTML": "<p>This returned an error <code>loot = PickOneObject ()</code>but I added <code>l</code> to it and it's working like a charm!</p>\n<p>Thank you so much!</p>\n\n",
      "PostDate": "2018-09-27T13:53:28.8149568Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "22a2f25b-10f1-4288-87fb-b988850c8f03",
      "UserId": 277074,
      "Username": "Dcoder",
      "AvatarUrl": "http://i.imgur.com/d9UrZ6lb.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": ">I want the object (located in LOOTROOM) to be unlootable after the player picks it up... for some reason the same object can be looted over and over now.\r\n\r\nIt would seem that the looted object is not being removed from LOOTROOM, but only from game.lootlist.  Can you verify this in-game with the debugger tool?",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I want the object (located in LOOTROOM) to be unlootable after the player picks it up... for some reason the same object can be looted over and over now.</p>\n</blockquote>\n<p>It would seem that the looted object is not being removed from LOOTROOM, but only from game.lootlist.  Can you verify this in-game with the debugger tool?</p>\n\n",
      "PostDate": "2018-09-27T13:53:59.3733093Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "af7058ef-8125-4446-a08f-f5b65671755f",
      "UserId": 1346,
      "Username": "The Pixie",
      "AvatarUrl": "https://secure.gravatar.com/avatar/cfa37e927f96177bcf6053ae8f108f77?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> It would seem that the looted object is not being removed from LOOTROOM, but only from game.lootlist. Can you verify this in-game with the debugger tool?\r\n\r\nI think the reverse. Adding to the inventory removes it from the room, but it is still on the list so still available to be picked again. ",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>It would seem that the looted object is not being removed from LOOTROOM, but only from game.lootlist. Can you verify this in-game with the debugger tool?</p>\n</blockquote>\n<p>I think the reverse. Adding to the inventory removes it from the room, but it is still on the list so still available to be picked again.</p>\n\n",
      "PostDate": "2018-09-27T13:57:34.4283736Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "59ef3e84-2a90-4b03-a876-c84bebd8be35",
      "UserId": 319917,
      "Username": "mrangel",
      "AvatarUrl": "https://secure.gravatar.com/avatar/?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "> I think the reverse. Adding to the inventory removes it from the room, but it is still on the list so still available to be picked again.\r\n\r\nYep. With the original code, if LOOTROOM contained an Apple, Bell, Candle, and Duck, then the list is initially blank.\r\n\r\nCall the script the first time:\r\n* lootlist is blank\r\n* LOOTROOM contains Apple, Bell, Candle, Duck\r\n* Add those to the list; lootlist is now [Apple, Bell, Candle, Duck]\r\n* Pick one (Apple) and remove it from the list\r\n* lootlist is now [Bell, Candle, Duck]\r\n\r\nThen loot a second enemy.\r\n* lootlist is [Bell, Candle, Duck]\r\n* LOOTROOM contains Bell, Candle, Duck\r\n* Add those to the list; lootlist is now [Bell, Candle, Duck, Bell, Candle, Duck]\r\n* Pick one (Bell) and remove it from the list\r\n* lootlist is now [Candle, Duck, Bell, Candle, Duck]\r\n\r\nThen loot a third enemy.\r\n* lootlist is [Candle, Duck, Bell, Candle, Duck]\r\n* LOOTROOM contains Candle, Duck\r\n* Add those to the list; lootlist is now [Candle, Duck, Bell, Candle, Duck, Candle, Duck]\r\n* Pick one (Duck) and remove it from the list\r\n* lootlist is now [Candle, Bell, Candle, Duck, Candle, Duck]\r\n\r\nThen loot a fourth enemy.\r\n* lootlist is [Candle, Bell, Candle, Duck, Candle, Duck]\r\n* LOOTROOM contains Candle\r\n* Add those to the list; lootlist is now [Candle, Bell, Candle, Duck, Candle, Duck, Candle]\r\n* Pick one (Duck again) and remove it from the list\r\n* lootlist is now [Candle, Bell, Candle, Candle, Duck, Candle]\r\n\r\nObjects that are still in the loot room are more *likely* to be chosen, because every time the script runs they're added to the list again. But if it takes you 6 attempts to get the apple, then you'll get 6 apples before it admits that the list is empty.\r\n(Well, not actually 6 apples. But the same apple moved into your inventory 6 times)",
      "EditableFormat": "markdown",
      "HTML": "<blockquote>\n<p>I think the reverse. Adding to the inventory removes it from the room, but it is still on the list so still available to be picked again.</p>\n</blockquote>\n<p>Yep. With the original code, if LOOTROOM contained an Apple, Bell, Candle, and Duck, then the list is initially blank.</p>\n<p>Call the script the first time:</p>\n<ul>\n<li>lootlist is blank</li>\n<li>LOOTROOM contains Apple, Bell, Candle, Duck</li>\n<li>Add those to the list; lootlist is now [Apple, Bell, Candle, Duck]</li>\n<li>Pick one (Apple) and remove it from the list</li>\n<li>lootlist is now [Bell, Candle, Duck]</li>\n</ul>\n<p>Then loot a second enemy.</p>\n<ul>\n<li>lootlist is [Bell, Candle, Duck]</li>\n<li>LOOTROOM contains Bell, Candle, Duck</li>\n<li>Add those to the list; lootlist is now [Bell, Candle, Duck, Bell, Candle, Duck]</li>\n<li>Pick one (Bell) and remove it from the list</li>\n<li>lootlist is now [Candle, Duck, Bell, Candle, Duck]</li>\n</ul>\n<p>Then loot a third enemy.</p>\n<ul>\n<li>lootlist is [Candle, Duck, Bell, Candle, Duck]</li>\n<li>LOOTROOM contains Candle, Duck</li>\n<li>Add those to the list; lootlist is now [Candle, Duck, Bell, Candle, Duck, Candle, Duck]</li>\n<li>Pick one (Duck) and remove it from the list</li>\n<li>lootlist is now [Candle, Bell, Candle, Duck, Candle, Duck]</li>\n</ul>\n<p>Then loot a fourth enemy.</p>\n<ul>\n<li>lootlist is [Candle, Bell, Candle, Duck, Candle, Duck]</li>\n<li>LOOTROOM contains Candle</li>\n<li>Add those to the list; lootlist is now [Candle, Bell, Candle, Duck, Candle, Duck, Candle]</li>\n<li>Pick one (Duck again) and remove it from the list</li>\n<li>lootlist is now [Candle, Bell, Candle, Candle, Duck, Candle]</li>\n</ul>\n<p>Objects that are still in the loot room are more <em>likely</em> to be chosen, because every time the script runs they're added to the list again. But if it takes you 6 attempts to get the apple, then you'll get 6 apples before it admits that the list is empty.<br>\n(Well, not actually 6 apples. But the same apple moved into your inventory 6 times)</p>\n\n",
      "PostDate": "2018-09-27T16:17:55.9992429Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "2657e73f-8415-4682-b5c2-8406d9253a57",
      "UserId": 260569,
      "Username": "DarkLizerd",
      "AvatarUrl": "https://i.imgur.com/vjdH3t6b.jpg",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I would have hit this backwards...\r\nIf loot chance<25 then (you found something)\r\n   Random pick of object from the loot room\r\nelse\r\n\"You don't find anything useful\"\r\n\r\nYou could also have a second list of useless stuff to find...\r\nLike: pocket lent, a washer, a picture of his girlfriend,... A picture of his boyfriend...\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>I would have hit this backwards...<br>\nIf loot chance&lt;25 then (you found something)<br>\nRandom pick of object from the loot room<br>\nelse<br>\n\"You don't find anything useful\"</p>\n<p>You could also have a second list of useless stuff to find...<br>\nLike: pocket lent, a washer, a picture of his girlfriend,... A picture of his boyfriend...</p>\n\n",
      "PostDate": "2018-09-28T03:16:10.4822746Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "64202d97-d70f-40b3-99d1-053680103925",
      "UserId": 348994,
      "Username": "CheeseMyBaby",
      "AvatarUrl": "https://i.imgur.com/c5nBbAgb.png",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "@DarkLizerd\r\nNo lists needed at all. Like Pix said; I was doing it  way more difficult than needed.\r\nHis code (below) worked like a charm. :)\r\n\r\n```\r\nl = GetDirectChildren(LOOTROOM)\r\nif (ListCount(l) > 0) {\r\n  loot = PickOneObject(l)\r\n  AddToInventory (loot)\r\n  msg (\"You find \" + GetDisplayName(loot) + \".\")\r\n}\r\nelse {\r\n  msg (\"You find nothing.\")\r\n}\r\nobject.looted = true\r\n```\r\n",
      "EditableFormat": "markdown",
      "HTML": "<p>@DarkLizerd<br>\nNo lists needed at all. Like Pix said; I was doing it  way more difficult than needed.<br>\nHis code (below) worked like a charm. :)</p>\n<pre><code>l = GetDirectChildren(LOOTROOM)\nif (ListCount(l) &gt; 0) {\n  loot = PickOneObject(l)\n  AddToInventory (loot)\n  msg (\"You find \" + GetDisplayName(loot) + \".\")\n}\nelse {\n  msg (\"You find nothing.\")\n}\nobject.looted = true\n</code></pre>\n\n",
      "PostDate": "2018-09-28T07:46:58.6536166Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
