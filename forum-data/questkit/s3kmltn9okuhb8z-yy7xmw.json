{
  "Topic": {
    "TopicId": "s3kmltn9okuhb8z-yy7xmw",
    "ForumId": "15",
    "Title": "Game Clock issues",
    "LastUpdated": "2024-04-28T17:57:48.497554Z",
    "ReplyCount": 0
  },
  "Posts": [
    {
      "PostId": "5f749a00-c236-4540-abf4-bf282ed62c2b",
      "UserId": 587281,
      "Username": "PsychoVyse",
      "AvatarUrl": "https://secure.gravatar.com/avatar/f359107abf9dc8cfe62bba1e4a8e84a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "I've created a local game clock (not real time) that increments by 5 minutes for every 1 game turn using an event called GameClock but I'm having trouble formatting it into a displayable item like \"14:15 PM\" or \"09:05\", the only problem is I don't know the syntax to format numbers in JS to an image like 5 being displayed using this image \"##\" is shown as \"05\". \r\n\r\n```\r\ncreateItem(\"EventClock\", \r\n  {\r\n    eventPeriod:1,\r\n    eventActive:true,\r\n\tgameTime: 720, // Defaulted to 12:00 (AM) - (M x 12) x H = Time - (5 x 12) x 12 = 720\r\n\tgameTimeFormatted: \"12:00\",\r\n\texamine: \"\",\r\n\tnHour: 12,\r\n\tnMinutes: 0,\r\n\tbMorning: false,\r\n    eventScript:function() { \r\n\t\t// Update the game clock by 5 minutes\r\n\t\tthis.gameTime = this.gameTime + 5\r\n\t\t\r\n\t\tif (this.gameTime >= 1440) {\r\n\t\t\tthis.gameTime = 0 // Passed into midnight (00:00) so reset the clock\r\n\t\t\tthis.nHour = 0\r\n\t\t\tthis.nMinutes = 0\r\n\t\t}\r\n\t\tthis.timeDisplaySync()\r\n\t},\r\n\ttimeDisplaySync: function()\r\n\t{\t\r\n\t\t// Extract the hour only\r\n\t\tthis.nHour = parseInt(this.gameTime / 60)\r\n\t\t\r\n\t\t// Extract the minutes by taking away the value for the hour from the total game time\r\n\t\tthis.nMinutes = this.gameTime - (this.nHour * 60)\r\n\t\tif (this.gameTime >= 720) {\r\n\t\t\tthis.bMorning = false\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.bMorning = true\r\n\t\t}\r\n\t\t\r\n\t\t// Format the time into a displayable item\r\n\t        this.gameTimeFormatted = msg (\"{EventClock.nHour}:{EventClock.nMinutes}either{EventClock.gameTime >= 720:PM: AM}\")\r\n\t}\r\n  }\r\n)\r\n```\r\n\r\nand this is my custom side pane to display it\r\n```\r\nsettings.setup = function() \r\n{\r\n\tdocument.getElementById('panes').style = \"display: none\"\r\n\r\n\tcreateAdditionalPane(1, \"Clock\", 'gameclock', function() {\r\n\t\tlet html = ''\r\n\t\thtml += '<p class=\"gameclock\">' + w.EventClock.gameTimeFormatted + '</p><br/>'\r\n\t\treturn html\r\n\t})\r\n}\r\n\r\n```\r\n\r\nThis would only display \"09:05\" as \"9:5\" so I want to pad out the number to a string format \"##\" where # is a number. I also get this error on the current display when I try to take a turn.\r\n\r\n```\r\nERROR: Attempting to use unknown text processor directive 'EventClock.gameTime >= 720' ({EventClock.nHour}:{EventClock.nMinutes}either{EventClock.gameTime >= 720:PM: AM})\r\nprintError @ _io.js:5\r\nerrormsg @ _io.js:376\r\ntp.processText @ _text.js:124\r\ntp.processText @ _text.js:129\r\ntp.processText @ _text.js:129\r\nprocessText @ _text.js:30\r\n_msg @ _io.js:78\r\nmsg @ _io.js:139\r\ntimeDisplaySync @ data.js:108\r\neventScript @ data.js:90\r\ndoEvent @ _defaults.js:198\r\nendTurn @ _defaults.js:184\r\nendTurn @ _world.js:427\r\nparser.execute @ _parser.js:143\r\nparser.parseSingle @ _parser.js:113\r\nparser.parse @ _parser.js:54\r\nrunCmd @ _util.js:37\r\nio.clickExit @ _io.js:1370\r\nonclick @ index.html:80\r\n_io.js:12 Look through the trace below to find the offending code. The first entry in the list may be \"errormsg\" in the file \"_io.js\", which is me so can be ignored. The next will the code that detected the error and called the \"errormsg\" message. You may need to look further down to find the root cause, especially for a text process issue.\r\n_io.js:14 Error: error state caught by QuestJS runtime\r\n    at errormsg (_io.js:376:17)\r\n    at tp.processText (_text.js:124:9)\r\n    at tp.processText (_text.js:129:14)\r\n    at tp.processText (_text.js:129:14)\r\n    at processText (_text.js:30:15)\r\n    at _msg (_io.js:78:28)\r\n    at msg (_io.js:139:5)\r\n    at Object.timeDisplaySync (data.js:108:31)\r\n    at Object.eventScript (data.js:90:8)\r\n    at Object.doEvent (_defaults.js:198:10)\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>I've created a local game clock (not real time) that increments by 5 minutes for every 1 game turn using an event called GameClock but I'm having trouble formatting it into a displayable item like \"14:15 PM\" or \"09:05\", the only problem is I don't know the syntax to format numbers in JS to an image like 5 being displayed using this image \"##\" is shown as \"05\".</p>\n<pre><code>createItem(\"EventClock\", \n  {\n    eventPeriod:1,\n    eventActive:true,\n\tgameTime: 720, // Defaulted to 12:00 (AM) - (M x 12) x H = Time - (5 x 12) x 12 = 720\n\tgameTimeFormatted: \"12:00\",\n\texamine: \"\",\n\tnHour: 12,\n\tnMinutes: 0,\n\tbMorning: false,\n    eventScript:function() { \n\t\t// Update the game clock by 5 minutes\n\t\tthis.gameTime = this.gameTime + 5\n\t\t\n\t\tif (this.gameTime &gt;= 1440) {\n\t\t\tthis.gameTime = 0 // Passed into midnight (00:00) so reset the clock\n\t\t\tthis.nHour = 0\n\t\t\tthis.nMinutes = 0\n\t\t}\n\t\tthis.timeDisplaySync()\n\t},\n\ttimeDisplaySync: function()\n\t{\t\n\t\t// Extract the hour only\n\t\tthis.nHour = parseInt(this.gameTime / 60)\n\t\t\n\t\t// Extract the minutes by taking away the value for the hour from the total game time\n\t\tthis.nMinutes = this.gameTime - (this.nHour * 60)\n\t\tif (this.gameTime &gt;= 720) {\n\t\t\tthis.bMorning = false\n\t\t}\n\t\telse {\n\t\t\tthis.bMorning = true\n\t\t}\n\t\t\n\t\t// Format the time into a displayable item\n\t        this.gameTimeFormatted = msg (\"{EventClock.nHour}:{EventClock.nMinutes}either{EventClock.gameTime &gt;= 720:PM: AM}\")\n\t}\n  }\n)\n</code></pre>\n<p>and this is my custom side pane to display it</p>\n<pre><code>settings.setup = function() \n{\n\tdocument.getElementById('panes').style = \"display: none\"\n\n\tcreateAdditionalPane(1, \"Clock\", 'gameclock', function() {\n\t\tlet html = ''\n\t\thtml += '&lt;p class=\"gameclock\"&gt;' + w.EventClock.gameTimeFormatted + '&lt;/p&gt;&lt;br/&gt;'\n\t\treturn html\n\t})\n}\n\n</code></pre>\n<p>This would only display \"09:05\" as \"9:5\" so I want to pad out the number to a string format \"##\" where # is a number. I also get this error on the current display when I try to take a turn.</p>\n<pre><code>ERROR: Attempting to use unknown text processor directive 'EventClock.gameTime &gt;= 720' ({EventClock.nHour}:{EventClock.nMinutes}either{EventClock.gameTime &gt;= 720:PM: AM})\nprintError @ _io.js:5\nerrormsg @ _io.js:376\ntp.processText @ _text.js:124\ntp.processText @ _text.js:129\ntp.processText @ _text.js:129\nprocessText @ _text.js:30\n_msg @ _io.js:78\nmsg @ _io.js:139\ntimeDisplaySync @ data.js:108\neventScript @ data.js:90\ndoEvent @ _defaults.js:198\nendTurn @ _defaults.js:184\nendTurn @ _world.js:427\nparser.execute @ _parser.js:143\nparser.parseSingle @ _parser.js:113\nparser.parse @ _parser.js:54\nrunCmd @ _util.js:37\nio.clickExit @ _io.js:1370\nonclick @ index.html:80\n_io.js:12 Look through the trace below to find the offending code. The first entry in the list may be \"errormsg\" in the file \"_io.js\", which is me so can be ignored. The next will the code that detected the error and called the \"errormsg\" message. You may need to look further down to find the root cause, especially for a text process issue.\n_io.js:14 Error: error state caught by QuestJS runtime\n    at errormsg (_io.js:376:17)\n    at tp.processText (_text.js:124:9)\n    at tp.processText (_text.js:129:14)\n    at tp.processText (_text.js:129:14)\n    at processText (_text.js:30:15)\n    at _msg (_io.js:78:28)\n    at msg (_io.js:139:5)\n    at Object.timeDisplaySync (data.js:108:31)\n    at Object.eventScript (data.js:90:8)\n    at Object.doEvent (_defaults.js:198:10)\n</code></pre>\n\n",
      "PostDate": "2024-04-28T17:57:48.497554Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "6321b88b-b82e-4f75-81b8-8c8618e97436",
      "UserId": 659063,
      "Username": "cellarderecho",
      "AvatarUrl": "https://secure.gravatar.com/avatar/c0c504aab6249b22fd8633e13dc9c62f?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "As a quick way to get the time to display with two digits like you want, you could convert them to a string with a minimum number of digits.\r\n```\r\nthis.gameTimeFormatted = `${w.EventClock.nHour.toLocaleString('en-US', {minimumIntegerDigits: 2})}:${w.EventClock.nMinutes.toLocaleString('en-US', {minimumIntegerDigits: 2})}`\r\n```\r\nIf it were me though, I'd use a builtin Date, that way it keeps track of the real time in the background, including days, and you can format it however you want.\r\n```\r\ncreateItem(\"EventClock\", \r\n  {\r\n    eventPeriod:1,\r\n    eventActive:true,\r\n    examine: \"\",\r\n    gameTime: new Date(\"2024-04-28 12:00:00\"),\r\n    bMorning: false,\r\n    eventScript:function() { \r\n      // Update the game clock by 5 minutes\r\n      this.gameTime = new Date(this.gameTime.getTime() + (5*60000))\r\n      this.bMorning = this.gameTime.getHours() < 12\r\n    },\r\n  }\r\n)\r\n\r\nsettings.setup = function() \r\n{\r\n\tcreateAdditionalPane(1, \"Clock\", 'gameclock', function() {\r\n\t\tlet html = ''\r\n\t\thtml += '<p class=\"gameclock\">' + w.EventClock.gameTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12:true}) + '</p><br/>'\r\n\t\treturn html\r\n\t})\r\n}\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>As a quick way to get the time to display with two digits like you want, you could convert them to a string with a minimum number of digits.</p>\n<pre><code>this.gameTimeFormatted = `${w.EventClock.nHour.toLocaleString('en-US', {minimumIntegerDigits: 2})}:${w.EventClock.nMinutes.toLocaleString('en-US', {minimumIntegerDigits: 2})}`\n</code></pre>\n<p>If it were me though, I'd use a builtin Date, that way it keeps track of the real time in the background, including days, and you can format it however you want.</p>\n<pre><code>createItem(\"EventClock\", \n  {\n    eventPeriod:1,\n    eventActive:true,\n    examine: \"\",\n    gameTime: new Date(\"2024-04-28 12:00:00\"),\n    bMorning: false,\n    eventScript:function() { \n      // Update the game clock by 5 minutes\n      this.gameTime = new Date(this.gameTime.getTime() + (5*60000))\n      this.bMorning = this.gameTime.getHours() &lt; 12\n    },\n  }\n)\n\nsettings.setup = function() \n{\n\tcreateAdditionalPane(1, \"Clock\", 'gameclock', function() {\n\t\tlet html = ''\n\t\thtml += '&lt;p class=\"gameclock\"&gt;' + w.EventClock.gameTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12:true}) + '&lt;/p&gt;&lt;br/&gt;'\n\t\treturn html\n\t})\n}\n</code></pre>\n\n",
      "PostDate": "2024-04-28T20:24:11.6129295Z",
      "LastEditDate": null,
      "link": null
    },
    {
      "PostId": "4c9aa6fe-b484-4e53-8bd8-9db11ab9adb6",
      "UserId": 587281,
      "Username": "PsychoVyse",
      "AvatarUrl": "https://secure.gravatar.com/avatar/f359107abf9dc8cfe62bba1e4a8e84a7?d=retro",
      "UserAvatar": null,
      "UserGravatar": null,
      "EditableText": "This is working 100% how I wanted it to, I don't want real time/date stuff as I'm not going full on life sim, just a very basic time scheduler system\r\n\r\n```\r\ncreateItem(\"EventClock\", \r\n  {\r\n    eventPeriod:1,\r\n    eventActive:true,\r\n\tgameTime: 720, // Defaulted to 12:00 (AM) - (M x 12) x H = Time - (5 x 12) x 12 = 720\r\n\tgameTimeFormatted: \"12:00 PM\",\r\n\texamine: \"\",\r\n    eventScript:function() { \r\n\t\t// Update the game clock by 5 minutes\r\n\t\tthis.gameTime = this.gameTime + 5\r\n\t\t\r\n\t\tif (this.gameTime >= 1440) {\r\n\t\t\tthis.gameTime = 0 // Passed into midnight (00:00) so reset the clock\r\n\t\t}\r\n\t\tthis.timeDisplaySync()\r\n\t},\r\n\ttimeDisplaySync: function()\r\n\t{\t\r\n\t\tvar timeFormat = \" AM\"\r\n\t\t// Extract the hour only\r\n\t\tvar nHour = parseInt(this.gameTime / 60)\r\n\t\t\r\n\t\t// Extract the minutes by taking away the value for the hour from the total game time\r\n\t\tvar nMinutes = this.gameTime - (nHour * 60)\r\n\t\tif (this.gameTime >= 720) {\r\n\t\t\tvar timeFormat = \" PM\"\r\n\t\t}\t\t\r\n\t\t// Format the time into a displayable item\r\n\t\tthis.gameTimeFormatted = `${nHour.toLocaleString('en-US', {minimumIntegerDigits: 2})}:${nMinutes.toLocaleString('en-US', {minimumIntegerDigits: 2})}${timeFormat}`\r\n\t}\r\n  }\r\n)\r\n```",
      "EditableFormat": "markdown",
      "HTML": "<p>This is working 100% how I wanted it to, I don't want real time/date stuff as I'm not going full on life sim, just a very basic time scheduler system</p>\n<pre><code>createItem(\"EventClock\", \n  {\n    eventPeriod:1,\n    eventActive:true,\n\tgameTime: 720, // Defaulted to 12:00 (AM) - (M x 12) x H = Time - (5 x 12) x 12 = 720\n\tgameTimeFormatted: \"12:00 PM\",\n\texamine: \"\",\n    eventScript:function() { \n\t\t// Update the game clock by 5 minutes\n\t\tthis.gameTime = this.gameTime + 5\n\t\t\n\t\tif (this.gameTime &gt;= 1440) {\n\t\t\tthis.gameTime = 0 // Passed into midnight (00:00) so reset the clock\n\t\t}\n\t\tthis.timeDisplaySync()\n\t},\n\ttimeDisplaySync: function()\n\t{\t\n\t\tvar timeFormat = \" AM\"\n\t\t// Extract the hour only\n\t\tvar nHour = parseInt(this.gameTime / 60)\n\t\t\n\t\t// Extract the minutes by taking away the value for the hour from the total game time\n\t\tvar nMinutes = this.gameTime - (nHour * 60)\n\t\tif (this.gameTime &gt;= 720) {\n\t\t\tvar timeFormat = \" PM\"\n\t\t}\t\t\n\t\t// Format the time into a displayable item\n\t\tthis.gameTimeFormatted = `${nHour.toLocaleString('en-US', {minimumIntegerDigits: 2})}:${nMinutes.toLocaleString('en-US', {minimumIntegerDigits: 2})}${timeFormat}`\n\t}\n  }\n)\n</code></pre>\n\n",
      "PostDate": "2024-04-29T16:37:38.04696Z",
      "LastEditDate": null,
      "link": null
    }
  ]
}
